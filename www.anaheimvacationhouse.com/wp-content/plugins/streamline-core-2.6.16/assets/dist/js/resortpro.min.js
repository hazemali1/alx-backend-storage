(function(){var directives=angular.module("resortpro.directives",[]);directives.directive("ngAlt",function(){return{restrict:"A",link:function(scope,elem,attrs){if(attrs.ngAlt){elem.on("load",function(event){elem[0].setAttribute("alt",attrs.ngAlt)})}}}});directives.directive("errSrc",function(){return{link:function(scope,element,attrs){scope.$watch(function(){return attrs["ngSrc"]},function(value){if(!value){element.attr("src",attrs.errSrc)}});element.bind("error",function(){if(attrs.src!=attrs.errSrc){attrs.$set("src",attrs.errSrc)}})}}});directives.directive("calendar",function($rootScope){return{restrict:"A",require:"ngModel",scope:{showDays:"&",updateModalCheckin:"&"},link:function(scope,elem,attrs,pCtrl){var months="";if($rootScope.bookingSettings.show_calendar_daily_rate==1){months=2}else{if($rootScope.bookingSettings.availability_months>3){months=3;setTimeout(function(){jQuery(".availability-calendar:first-child").append("<button id='loadMonths' class='btn btn-primary '>Show More</button>");jQuery(".availability-calendar:first-child").append("<button id='resetMonths' class='btn btn-primary '>Show Less</button>");jQuery("#resetMonths").hide();jQuery(".ui-datepicker-multi").addClass("multi_calendar");jQuery("#loadMonths").on("click",function(){if(months<$rootScope.bookingSettings.availability_months){months+=3;jQuery(".availability-calendar ").datepicker("option","numberOfMonths",months)}if(months==$rootScope.bookingSettings.availability_months){jQuery("#loadMonths").hide();jQuery("#resetMonths").show();jQuery("#resetMonths").on("click",function(){months=3;jQuery(".availability-calendar ").datepicker("option","numberOfMonths",months);jQuery("#loadMonths").show();jQuery("#resetMonths").hide()})}})},1)}else{months=3}}var calendarMonthsLimit=$rootScope.dinamic_calendar_limit;if($rootScope.enable_cr==1){var options={dateFormat:"mm/dd/yy",minDate:0,maxDate:calendarMonthsLimit,numberOfMonths:months,showButtonPanel:false,onSelect:function(dateText){if($rootScope.bookingSettings.show_calendar_daily_rate==1){jQuery(".availability-calendar .ui-datepicker-calendar td").each(function(){var span_date=jQuery(this).find("small").data("date");if(typeof span_date!="undefined"){scope.updateModalCheckin({date:dateText});pCtrl.$setViewValue(span_date);var myDateArr=span_date.split("/");var month=myDateArr[0]-1;var numDays=0;var foundDay=false;var numDays=0;var foundDay=false;var selected_date="";var get_day_value=jQuery(this).find("a").html();if(typeof get_day_value!="undefined"){var day=selected_date;if(parseInt(selected_date)>parseInt(day)){foundDay=true;numDays++}else if(foundDay){return false}}}})}else{scope.updateModalCheckin({date:dateText});pCtrl.$setViewValue(dateText);var myDateArr=dateText.split("/");var month=myDateArr[0]-1;var day=myDateArr[1];var numDays=0;var foundDay=false;jQuery(".availability-calendar .ui-datepicker-calendar td").each(function(){if(jQuery(this).attr("data-month")==month){if(parseInt(jQuery(this).find("a").html())>parseInt(day)){foundDay=true;numDays++}else if(foundDay){return false}}})}jQuery(".modal-calendar .text-uplift").css("display","none");jQuery("#modal_checkin").val(dateText);jQuery("#myModal").modal();setTimeout(function(){add_tooltip()},500)},onClose:function(){setTimeout(function(){if(jQuery("#modal_end_date").is(":visible")){jQuery("#modal_end_date").datepicker("show")}},0)},beforeShowDay:function(date){return scope.showDays({date:date})},onChangeMonthYear:function(year,month,inst){setTimeout(function(){add_tooltip()},500)}}}else{var options={dateFormat:"mm/dd/yy",minDate:0,maxDate:"",numberOfMonths:months,showButtonPanel:false,onSelect:function(dateText){if($rootScope.bookingSettings.show_calendar_daily_rate==1){jQuery(".availability-calendar .ui-datepicker-calendar td").each(function(){var span_date=jQuery(this).find("small").data("date");if(typeof span_date!="undefined"){scope.updateModalCheckin({date:dateText});pCtrl.$setViewValue(span_date);var myDateArr=span_date.split("/");var month=myDateArr[0]-1;var numDays=0;var foundDay=false;var numDays=0;var foundDay=false;var selected_date="";var get_day_value=jQuery(this).find("a").html();if(typeof get_day_value!="undefined"){var day=selected_date;if(parseInt(selected_date)>parseInt(day)){foundDay=true;numDays++}else if(foundDay){return false}}}})}else{scope.updateModalCheckin({date:dateText});pCtrl.$setViewValue(dateText);var myDateArr=dateText.split("/");var month=myDateArr[0]-1;var day=myDateArr[1];var numDays=0;var foundDay=false;jQuery(".availability-calendar .ui-datepicker-calendar td").each(function(){if(jQuery(this).attr("data-month")==month){if(parseInt(jQuery(this).find("a").html())>parseInt(day)){foundDay=true;numDays++}else if(foundDay){return false}}})}jQuery(".modal-calendar .text-uplift").css("display","none");jQuery("#modal_checkin").val(dateText);jQuery("#myModal").modal();if($rootScope.hideTooltips!=1){setTimeout(function(){add_tooltip()},500)}else{hide_tooltip()}},onClose:function(){setTimeout(function(){if(jQuery("#modal_end_date").is(":visible")){jQuery("#modal_end_date").datepicker("show")}},0)},beforeShowDay:function(date){return scope.showDays({date:date})},onChangeMonthYear:function(year,month,inst){if($rootScope.hideTooltips!=1){setTimeout(function(){add_tooltip()},500)}else{hide_tooltip()}}}}if($rootScope.bookingSettings.enable_premium_calendar==1){jQuery(".availability-calendar").addClass("premium_calendar");options.dayNamesMin=["SUN","MON","TUE","WED","THU","FRI","SAT"];options.numberOfMonths=1}elem.datepicker(options);jQuery("#quick-availability").on("click",function(){elem.datepicker("destroy");setTimeout(function(){elem.datepicker(options)},5)})}}});directives.directive("sdpicker",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var checkin_days=0;if(!isNaN(jQuery("#filter_start_date").data("checkin-days"))){checkin_days=jQuery("#filter_start_date").data("checkin-days")}var str_filterturndates=jQuery("#filter_start_date").data("filterturndates");var arr_filterturndates=[];if(typeof str_filterturndates=="number"){arr_filterturndates.push(str_filterturndates.toString())}else{if(str_filterturndates&&str_filterturndates.indexOf(",")>-1){arr_filterturndates=str_filterturndates.split(",")}}var calendarMonthsLimit=jQuery("#monthsLimit").text();element.datepicker({dateFormat:"mm/dd/yy",minDate:"+"+checkin_days+"d",maxDate:calendarMonthsLimit,onSelect:function(date){ngModelCtrl.$setViewValue(date);scope.$apply();var frm=new Date(date);nts=1;if(!Number.isNaN(jQuery("#filter_start_date").attr("data-min-stay"))){nts=parseInt(jQuery("#filter_start_date").attr("data-min-stay"))}var the_year=frm.getFullYear();if(the_year<2e3)the_year=2e3+the_year%100;var to=new Date(the_year,frm.getMonth(),frm.getDate()+nts);jQuery("#filter_end_date").datepicker("option","minDate",to);setTimeout(function(){jQuery("#filter_end_date").datepicker("show")},0);scope.search.start_date=frm.format("mm/dd/yyyy");scope.clearProperties();scope.availabilitySearch(scope.search)},beforeShowDay:function(date){var is_available=true;var class_day="available";if(arr_filterturndates.length>0&&jQuery.inArray(date.getUTCDay().toString(),arr_filterturndates)==-1){is_available=false}if(!is_available){class_day="booked"}return[is_available,class_day]}})})}}});directives.directive("edpicker",function(){return{restrict:"A",minDate:"+1d",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var startdate=jQuery("#filter_start_date").val();var frm=new Date(startdate);var str_filterturndates=jQuery("#filter_start_date").data("filterturndates");var arr_filterturndates=[];if(str_filterturndates!=""&&!isNaN(str_filterturndates)){arr_filterturndates.push(str_filterturndates.toString())}else{if(str_filterturndates&&str_filterturndates.indexOf(",")>-1){arr_filterturndates=str_filterturndates.split(",")}}var calendarMonthsLimit=jQuery("#monthsLimit").text();element.datepicker({dateFormat:"mm/dd/yy",minDate:frm,maxDate:calendarMonthsLimit,onSelect:function(date){ngModelCtrl.$setViewValue(date);scope.$apply();var frm=new Date(date);var the_year=frm.getFullYear();if(the_year<2e3)the_year=2e3+the_year%100;var to=new Date(the_year,frm.getMonth(),frm.getDate());scope.search.end_date=to.format("mm/dd/yyyy");scope.clearProperties();scope.availabilitySearch(scope.search)},beforeShowDay:function(date){var is_available=true;var class_day="available";var start_date=jQuery("#filter_start_date").datepicker("getDate");if(start_date){if(arr_filterturndates.length>0&&start_date.getUTCDay().toString()!=date.getUTCDay().toString()){is_available=false;class_day="booked"}}else{if(arr_filterturndates.length>0&&jQuery.inArray(date.getUTCDay().toString(),arr_filterturndates)==-1){is_available=false}if(!is_available){class_day="booked"}}return[is_available,class_day]}})})}}});directives.directive("drpicker",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function($){var checkin_days=0;if(!isNaN(element.data("checkin-days"))){checkin_days=element.data("checkin-days")}var str_filterturndates=element.data("filterturndates");var arr_filterturndates=[];if(typeof str_filterturndates=="number"){arr_filterturndates.push(str_filterturndates.toString())}else{if(str_filterturndates&&str_filterturndates.indexOf(",")>-1){arr_filterturndates=str_filterturndates.split(",")}}if(attrs.calendarType==="one-popup-calendar"){moment.locale(jsLangVars.currentLanguage);var minCheckinDate=moment().add(checkin_days,"days"),minDaysToStay=0,calendarIterations=0;if(!isNaN(element.attr("data-min-stay"))){minDaysToStay=element.attr("data-min-stay")}scope.clearCalendarRange=function(){element.val("");element.data("daterangepicker").setStartDate(moment());element.data("daterangepicker").setEndDate(moment());element.data("daterangepicker").endDate=moment();calendarIterations=0;element.data("daterangepicker").updateCalendars();if(scope.search){if(scope.search.start_date.length||scope.search.end_date.length>0){scope.resetSearch();scope.search.start_date="";scope.search.end_date="";scope.search.book_range="";element.data("daterangepicker").hide();element.val("");element.data("daterangepicker").endDate=moment();element.blur()}}};var oneMonth=true;if($(window).innerWidth()<=768){oneMonth=false;setTimeout(function(){jQuery(".daterangepicker .drp-calendar.right").hide()},1e3)}element.daterangepicker({locale:{format:"MM/DD/YYYY",monthNames:moment.months()},linkedCalendars:oneMonth,alwaysShowCalendars:true,minDate:minCheckinDate.format("MM/DD/YYYY"),minSpan:{days:minDaysToStay},autoApply:true,autoUpdateInput:false,isInvalidDate:function(date){if(arr_filterturndates.length&&$.inArray(date.day().toString(),arr_filterturndates)===-1){return true}},isCustomDate:function(date){var leftCalendarMonth=element.data("daterangepicker").leftCalendar.month.month(),currentMonth;calendarIterations++;if(parseInt((calendarIterations-1)/42)%2==0){currentMonth=leftCalendarMonth}if(parseInt((calendarIterations-1)/42)%2==1){currentMonth=leftCalendarMonth!==11?leftCalendarMonth+1:0}if(date.month()!==currentMonth){return"other-month"}}},function(start,end,label){var selectedStartDate=start.format("MM/DD/YYYY");var selectedEndDate=end.format("MM/DD/YYYY");element.val(selectedStartDate+" - "+selectedEndDate)});element.on("show.daterangepicker",function(ev,picker){var drpButtons=$("div.daterangepicker .drp-buttons");drpButtons.css("display","block").append('<a class="clearBtn btn btn-link" href="#">'+jsLangVars.drpBtnText+"</a>");element.data("daterangepicker").container[0].classList.add("daterangepicker--filter");$("div.daterangepicker .clearBtn").on("click",function(event){event.preventDefault();scope.clearCalendarRange();element.one("hide.daterangepicker",function(ev,picker){if(picker.startDate.isSameOrBefore(minCheckinDate,"day")&&picker.endDate.isSameOrBefore(minCheckinDate,"day")){element.val("")}})})});element.on("hide.daterangepicker",function(ev,picker){$("div.daterangepicker .clearBtn").remove();calendarIterations=0});element.on("showCalendar.daterangepicker",function(){calendarIterations=0});element.on("apply.daterangepicker",function(ev,picker){element.change();scope.$apply();scope.search.start_date=picker.startDate.format("MM/DD/YYYY");scope.search.end_date=picker.endDate.format("MM/DD/YYYY");scope.clearProperties();scope.availabilitySearch(scope.search)});if(scope.search&&scope.search.start_date&&scope.search.end_date){scope.search.book_range=scope.search.start_date+" - "+scope.search.end_date;element.data("daterangepicker").setStartDate(moment(scope.search.start_date,"MM/DD/YYYY"));element.data("daterangepicker").setEndDate(moment(scope.search.end_date,"MM/DD/YYYY"))}}})}}});directives.directive("bookcheckin",function($rootScope){return{restrict:"A",scope:{showDays:"&",updatePrice:"&",updateCheckout:"&"},require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var days=0;var appendTimeout;var calendarTips='<ul class="calendar-tips"><li class="cal-selectable"><span>Checkin Available</span></li><li class="cal-available"><span>Checkout Available</span></li><li class="cal-unavailable"><span>Not Available</span></li></ul>';function appendText(text){clearTimeout(appendTimeout);appendTimeout=setTimeout(function(){jQuery("#ui-datepicker-div .ui-datepicker-calendar").after("<div>"+text+"</div>")},50)}if(!isNaN(jQuery("#book_start_date").attr("data-checkin-days"))){days=jQuery("#book_start_date").attr("data-checkin-days")}var calendarMonthsLimit=jQuery("#monthsLimit").text();element.datepicker({dateFormat:"mm/dd/yy",minDate:"+"+days+"d",maxDate:calendarMonthsLimit,onSelect:function(date){ngModelCtrl.$setViewValue(date);scope.$apply();var frm=new Date(date);nts=1;if(!isNaN(jQuery("#book_start_date").attr("data-min-stay"))){nts=jQuery("#book_start_date").attr("data-min-stay")}if($rootScope.dynamicCalendarMinStay){angular.forEach($rootScope.rates_details,function(rate){var startDate=new Date(rate.period_begin);var endDate=new Date(rate.period_end);if(frm.getTime()<=endDate.getTime()&&frm.getTime()>=startDate.getTime()){nts=parseInt(rate.narrow_defined_days)}})}var the_year=frm.getFullYear();if(the_year<2e3)the_year=2e3+the_year%100;var to=new Date(the_year,frm.getMonth(),parseInt(frm.getDate())+parseInt(nts));jQuery("#book_end_date").datepicker("option","minDate",to);scope.updateCheckout({date:to});if($rootScope.hideTooltips!=1){setTimeout(function(){add_tooltip()},500)}else{hide_tooltip()}},onClose:function(){setTimeout(function(){jQuery("#book_end_date").datepicker("show")},0)},beforeShowDay:function(date){return scope.showDays({date:date})},beforeShow:function(){appendText(calendarTips)},onChangeMonthYear:function(){appendText(calendarTips);if($rootScope.hideTooltips!=1){setTimeout(function(){add_tooltip()},500)}else{hide_tooltip()}}})})}}});directives.directive("inquirycheckin",function($rootScope){return{restrict:"A",scope:{showDays:"&",updatePrice:"&",updateCheckout:"&"},require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var days=0;var appendTimeout;var calendarTips='<ul class="calendar-tips"><li class="cal-selectable"><span>Checkin Available</span></li><li class="cal-available"><span>Checkout Available</span></li><li class="cal-unavailable"><span>Not Available</span></li></ul>';function appendText(text){clearTimeout(appendTimeout);appendTimeout=setTimeout(function(){jQuery("#ui-datepicker-div .ui-datepicker-calendar").after("<div>"+text+"</div>")},50)}if(!isNaN(jQuery("#inquiry_startdate").attr("data-checkin-days"))){days=jQuery("#inquiry_startdate").attr("data-checkin-days")}var calendarMonthsLimit=jQuery("#monthsLimit").text();element.datepicker({dateFormat:"mm/dd/yy",minDate:"+"+days+"d",maxDate:calendarMonthsLimit,onSelect:function(date){ngModelCtrl.$setViewValue(date);scope.$apply();var frm=new Date(date);nts=1;if(!isNaN(jQuery("#inquiry_startdate").attr("data-min-stay"))){nts=jQuery("#inquiry_startdate").attr("data-min-stay")}var the_year=frm.getFullYear();if(the_year<2e3)the_year=2e3+the_year%100;var to=new Date(the_year,frm.getMonth(),parseInt(frm.getDate())+parseInt(nts));jQuery("#inquiry_enddate").datepicker("option","minDate",to);scope.updateCheckout({date:to})},onClose:function(){setTimeout(function(){jQuery("#inquiry_enddate").datepicker("show")},0)},beforeShowDay:function(date){return scope.showDays({date:date})},beforeShow:function(){appendText(calendarTips)},onChangeMonthYear:function(){appendText(calendarTips)}})})}}});directives.directive("bookcheckout",function($rootScope){return{restrict:"A",scope:{showDays:"&",updatePrice:"&"},require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var startdate=jQuery("#book_start_date").val();var frm=new Date(startdate);var appendTimeout;var calendarTips='<ul class="calendar-tips"><li class="cal-available"><span>Checkin Available</span></li><li class="cal-selectable"><span>Checkout Available</span></li><li class="cal-unavailable"><span>Not Available</span></li><ul/>';function appendText(text){clearTimeout(appendTimeout);appendTimeout=setTimeout(function(){jQuery("#ui-datepicker-div .ui-datepicker-calendar").after("<div>"+text+"</div>")},50)}var calendarMonthsLimit=jQuery("#monthsLimit").text();element.datepicker({dateFormat:"mm/dd/yy",minDate:frm,maxDate:calendarMonthsLimit,onSelect:function(date){scope.$apply(function(){ngModelCtrl.$setViewValue(date)});scope.updatePrice()},beforeShowDay:function(date){return scope.showDays({date:date})},beforeShow:function(){appendText(calendarTips)},onChangeMonthYear:function(){appendText(calendarTips);if($rootScope.hideTooltips!=1){setTimeout(function(){add_tooltip()},500)}else{hide_tooltip()}}})})}}});directives.directive("inquirycheckout",function($rootScope){return{restrict:"A",scope:{showDays:"&",updatePrice:"&"},require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var startdate=jQuery("#inquiry_startdate").val();var frm=new Date(startdate);var appendTimeout;var calendarTips='<ul class="calendar-tips"><li class="cal-available"><span>Checkin Available</span></li><li class="cal-selectable"><span>Checkout Available</span></li><li class="cal-unavailable"><span>Not Available</span></li><ul/>';function appendText(text){clearTimeout(appendTimeout);appendTimeout=setTimeout(function(){jQuery("#ui-datepicker-div .ui-datepicker-calendar").after("<div>"+text+"</div>")},50)}var calendarMonthsLimit=jQuery("#monthsLimit").text();element.datepicker({dateFormat:"mm/dd/yy",minDate:frm,maxDate:calendarMonthsLimit,onSelect:function(date){scope.$apply(function(){ngModelCtrl.$setViewValue(date)});scope.updatePrice()},beforeShowDay:function(date){return scope.showDays({date:date})},beforeShow:function(){appendText(calendarTips)},onChangeMonthYear:function(){appendText(calendarTips)}})})}}});directives.directive("sliderange",function($rootScope){return{restrict:"A",scope:{showAvailability:"&",minPrice:"=",maxPrice:"="},link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var get_min_price="";var get_max_price="";if($rootScope.searchSettings.min_price>0){get_min_price=$rootScope.searchSettings.min_price;get_max_price=$rootScope.searchSettings.max_price}else if($rootScope.searchSettings.min_price==0&&$rootScope.searchSettings.max_price>1){get_min_price=0;get_max_price=$rootScope.searchSettings.max_price}else{get_min_price=scope.minPrice;get_max_price=scope.maxPrice}element.slider({range:true,min:scope.minPrice,max:scope.maxPrice,step:100,values:[get_min_price,get_max_price],slide:function(event,ui){jQuery("#streamlinecore_sw_price_range").val("$"+ui.values[0]+" - $"+ui.values[1])},change:function(event,ui){scope.showAvailability({minPrice:ui.values[0],maxPrice:ui.values[1]})}});jQuery("#streamlinecore_sw_price_range").val("$"+get_min_price+" - $"+get_max_price)})}}});directives.directive("bookdaterange",function($rootScope,$window){return{restrict:"A",scope:{showDays:"&",updatePrice:"&"},require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function($){if(attrs.calendarType==="one-popup-calendar"){var days=0;if(!isNaN(element.attr("data-checkin-days"))){days=element.attr("data-checkin-days")}moment.locale(jsLangVars.currentLanguage);var minCheckinDate=moment().add(days,"days"),minDaysToStay=0,calendarIterations=0,startDateSelected=false,rangeStart=false,outRangeDate=false,drpButtons,alertActionText=jsLangVars.drpCheckIn,opensPosition="right";$rootScope.bookActionCheckin=true;scope.width=$window.innerWidth;opensPosition=scope.width>1199?"left":"right";function onWindowResize(){scope.width=$window.innerWidth;scope.$digest();opensPosition=scope.width>1199?"left":"right"}angular.element($window).on("resize",onWindowResize);if(!isNaN(element.attr("data-min-stay"))){minDaysToStay=element.attr("data-min-stay")}function appendAlert(actionText){var calendarAlerts=['<div class="alerts">','<div class="alert alert-info fade in alert-dismissible">','<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>','<i class="fa fa-hand-pointer-o"></i>',jsLangVars.drpAlertMsg+" "+actionText,"</div>","</div>"].join("\n");return calendarAlerts}oneMonth=true;if($(window).innerWidth()<=768){oneMonth=false;setTimeout(function(){jQuery(".daterangepicker .drp-calendar.right").hide()},1e3)}element.daterangepicker({locale:{format:"MM/DD/YYYY",monthNames:moment.months()},linkedCalendars:oneMonth,alwaysShowCalendars:true,minDate:minCheckinDate.format("MM/DD/YYYY"),minSpan:{days:minDaysToStay},opens:opensPosition,autoApply:true,autoUpdateInput:false,isInvalidDate:function(date){return scope.showDays({date:date.toDate()})[0]===true?false:true},isCustomDate:function(date){var leftCalendarMonth=element.data("daterangepicker").leftCalendar.month!==undefined?element.data("daterangepicker").leftCalendar.month.month():element.data("daterangepicker").leftCalendar.month.month(),currentMonth,slashClasses=scope.showDays({date:date.toDate()})[1].split(" "),bookedIndex=slashClasses.indexOf("booked"),availableIndex=slashClasses.indexOf("available");calendarIterations++;if(date<minCheckinDate&&bookedIndex>-1){slashClasses.splice(bookedIndex,1)}if(availableIndex>-1){slashClasses.splice(availableIndex,1)}if(startDateSelected){if(this.startDate.isSame(date)){rangeStart=true;outRangeDate=false}if(slashClasses[0]=="slash-start"){slashClasses.push("available")}if(!scope.showDays({date:this.startDate.toDate()})[0]){outRangeDate=true}if(rangeStart&&outRangeDate){slashClasses.push("off","disabled")}}if(parseInt((calendarIterations-1)/42)%2==0){currentMonth=leftCalendarMonth}if(parseInt((calendarIterations-1)/42)%2==1){currentMonth=leftCalendarMonth!==11?leftCalendarMonth+1:0}if(date.month()!==currentMonth){return"other-month"}else{return slashClasses}}},function(start,end,label){var selectedStartDate=start.format("MM/DD/YYYY");var selectedEndDate=end.format("MM/DD/YYYY");element.val(selectedStartDate+" - "+selectedEndDate)});var flexDate="";element.on("show.daterangepicker",function(ev,picker){picker.opens=opensPosition;switch(true){case picker.opens==="right"&&picker.container[0].classList.contains("opensleft"):picker.container[0].classList.remove("opensleft");picker.container[0].classList.add("opensright");break;case picker.opens==="left"&&picker.container[0].classList.contains("opensright"):picker.container[0].classList.remove("opensright");picker.container[0].classList.add("opensleft")}drpButtons=$("div.daterangepicker .drp-buttons");if($rootScope.enable_flex_calendar==1){var isFlex=$("#flexCalendar").val();drpButtons.css("display","block").append('<div class="flex-calendar" >'+'<div class="dp-flex noflex" data-flex="0">Exact dates</div>'+'<div class="dp-flex flex1" data-flex="1"> ±1 day</div>'+'<div class="dp-flex flex2" data-flex="2"> ±2 days</div>'+'<div class="dp-flex flex3" data-flex="3"> ±3 days</div>'+"</div>");if(isFlex>0){$(".dp-flex").each(function(){if($(this).attr("data-flex")==isFlex){$(this).addClass("dp-flex-active")}})}else{$(".noflex").addClass("dp-flex-active")}$("div.daterangepicker .drp-buttons .flex-calendar .dp-flex").on("click",function(event){$(this).addClass("dp-flex-active");$(".dp-flex").removeClass("dp-flex-active");$(this).addClass("dp-flex-active");flexDate=$(this).attr("data-flex")});drpButtons.css("display","block").append('<button class="cancelBtn flex-closebtn" type="button" style="display: block;">Done</button>')}drpButtons.css("display","block").append('<a class="clearBtn btn btn-link" href="#">'+jsLangVars.drpBtnText+"</a>");drpButtons.before(appendAlert(alertActionText));element.data("daterangepicker").container[0].classList.add("daterangepicker--book","daterangepicker--flat");picker.updateView();$("div.daterangepicker .clearBtn").on("click",function(event){event.preventDefault();$rootScope.bookActionCheckin=true;startDateSelected=false;alertActionText=jsLangVars.drpCheckIn;element.val("");picker.setStartDate(moment());picker.setEndDate(moment());picker.endDate=moment();calendarIterations=0;picker.updateCalendars();element.focus();element.data("daterangepicker").container[0].classList.remove("is-checkoutActive");drpButtons.siblings(".alerts").remove();drpButtons.before(appendAlert(alertActionText));ngModelCtrl.$setViewValue("");scope.$apply();element.one("hide.daterangepicker",function(ev,picker){if(picker.startDate.isSameOrBefore(minCheckinDate,"day")&&picker.endDate.isSameOrBefore(minCheckinDate,"day")){element.val("");picker.endDate=moment()}})});$("div.daterangepicker .cancelBtn.flex-closebtn").on("click",function(event){scope.$apply();scope.updatePrice()})});element.on("hide.daterangepicker",function(ev,picker){if($rootScope.enable_flex_calendar==1){$("#flexCalendar").val(flexDate);$("div.daterangepicker .flex-calendar").remove();$("div.daterangepicker .cancelBtn.flex-closebtn").remove()}$("div.daterangepicker .clearBtn").remove();$("div.daterangepicker .alerts").remove();startDateSelected=false;rangeStart=false;calendarIterations=0});element.on("showCalendar.daterangepicker",function(){calendarIterations=0});element.on("click.daterangepicker",function(){element.data("daterangepicker").hide();element.data("daterangepicker").show();if(element.data("daterangepicker").endDate<=minCheckinDate){element.focus();element.data("daterangepicker").container[0].classList.remove("is-checkoutActive")}else{element.data("daterangepicker").container[0].classList.add("is-checkoutActive")}});element.on("click.daterangepicker",function(){element.data("daterangepicker").container[0].classList.remove("is-checkoutActive")});element.on("apply.daterangepicker",function(ev,picker){ngModelCtrl.$setViewValue({start_date:picker.startDate.format("MM/DD/YYYY"),end_date:picker.endDate.format("MM/DD/YYYY")});scope.$apply();scope.updatePrice();$rootScope.bookActionCheckin=true;alertActionText=jsLangVars.drpCheckIn});element.on("startDateClick.daterangepicker",function(ev,picker){startDateSelected=true;$rootScope.bookActionCheckin=false;alertActionText=jsLangVars.drpCheckOut;drpButtons.siblings(".alerts").remove();drpButtons.before(appendAlert(alertActionText))})}})}}});directives.directive("sliderangesearch",function($rootScope){return{restrict:"A",scope:{showAvailability:"&",minPrice:"=",maxPrice:"="},link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var get_min_price="";var get_max_price="";if($rootScope.searchSettings.min_price>0){get_min_price=$rootScope.searchSettings.min_price;get_max_price=$rootScope.searchSettings.max_price}else if($rootScope.searchSettings.min_price==0&&$rootScope.searchSettings.max_price>1){get_min_price=0;get_max_price=$rootScope.searchSettings.max_price}else{get_min_price=scope.minPrice;get_max_price=scope.maxPrice}element.slider({range:true,min:scope.minPrice,max:scope.maxPrice,step:100,values:[get_min_price,get_max_price],slide:function(event,ui){jQuery("#streamlinecore_sw_price_range").val("$"+ui.values[0]+" - $"+ui.values[1])},click:function(event,ui){scope.showAvailability({minPrice:scope.minPrice,maxPrice:scope.maxPrice})}});jQuery("#streamlinecore_sw_price_range").val("$"+get_min_price+" - $"+get_max_price)})}}});directives.directive("bedroomrange",function($rootScope){return{restrict:"A",scope:{showAvailability:"&",minBedroomsNumber:"=",maxBedroomsNumber:"="},link:function(scope,element,attrs,ngModelCtrl){if($rootScope.searchSettings.min_beds>0){min_beds=$rootScope.searchSettings.min_beds}else{min_beds=scope.minBedroomsNumber}if($rootScope.searchSettings.max_beds>0){max_beds=$rootScope.searchSettings.max_beds}else{max_beds=scope.maxBedroomsNumber}jQuery(function(){element.slider({range:true,min:scope.minBedroomsNumber,max:scope.maxBedroomsNumber,step:1,values:[min_beds,max_beds],slide:function(event,ui){jQuery("#streamlinecore_sw_bedrooms_number").val("Min Bed:"+ui.values[0]+" - Max Bed:"+ui.values[1])},change:function(event,ui){scope.showAvailability({minBedroomsNumber:ui.values[0],maxBedroomsNumber:ui.values[1]});scope.$apply()}});jQuery("#streamlinecore_sw_bedrooms_number").val("Min Bed:"+min_beds+" - Max Bed:"+max_beds)})}}});directives.directive("adultsrange",function($rootScope){return{restrict:"A",scope:{showAvailability:"&",minAdultsNumber:"=",maxAdultsNumber:"="},link:function(scope,element,attrs,ngModelCtrl){if($rootScope.searchSettings.min_oc>0){min_adults=$rootScope.searchSettings.min_oc}else{min_adults=scope.minAdultsNumber}if($rootScope.searchSettings.max_oc>0){max_adults=$rootScope.searchSettings.max_oc}else{max_adults=scope.maxAdultsNumber}jQuery(function(){element.slider({range:true,min:scope.minAdultsNumber,max:scope.maxAdultsNumber,step:1,values:[min_adults,max_adults],slide:function(event,ui){jQuery("#streamlinecore_fw_adults").val("Min Adults:"+ui.values[0]+" - Max Adults:"+ui.values[1])},change:function(event,ui){scope.showAvailability({minAdultsNumber:ui.values[0],maxAdultsNumber:ui.values[1]});scope.$apply()}});jQuery("#streamlinecore_fw_adults").val("Min Adults:"+min_adults+" - Max Adults:"+max_adults)})}}});directives.directive("adultsrangesearch",function($rootScope){return{restrict:"A",scope:{showAvailability:"&",minAdultsNumber:"=",maxAdultsNumber:"="},link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var get_min_oc="";var get_max_oc="";if($rootScope.searchSettings.min_oc>0){get_min_oc=$rootScope.searchSettings.min_oc;get_max_oc=$rootScope.searchSettings.max_oc}else{get_min_oc=scope.minAdultsNumber;get_max_oc=scope.maxAdultsNumber}element.slider({range:true,min:scope.minAdultsNumber,max:scope.maxAdultsNumber,step:1,values:[get_min_oc,get_max_oc],slide:function(event,ui){jQuery("#streamlinecore_fw_adults").val("Min Adults:"+ui.values[0]+" - Max Adults:"+ui.values[1])},click:function(event,ui){scope.showAvailability({minAdultsNumber:scope.minAdultsNumber,maxAdultsNumber:scope.maxAdultsNumber})}});jQuery("#streamlinecore_fw_adults").val("Min Adults:"+get_min_oc+" - Max Adults:"+get_max_oc)})}}});directives.directive("bedroomrangesearch",function($rootScope){return{restrict:"A",scope:{showAvailability:"&",minBedroomsNumber:"=",maxBedroomsNumber:"="},link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){var get_min_beds="";var get_max_beds="";if($rootScope.searchSettings.min_beds>0){get_min_beds=$rootScope.searchSettings.min_beds;get_max_beds=$rootScope.searchSettings.max_beds}else if($rootScope.searchSettings.min_beds==0&&$rootScope.searchSettings.max_beds>1){get_min_beds=0;get_max_beds=$rootScope.searchSettings.max_beds}else{get_min_beds=scope.minBedroomsNumber;get_max_beds=scope.maxBedroomsNumber}element.slider({range:true,min:scope.minBedroomsNumber,max:scope.maxBedroomsNumber,step:1,values:[get_min_beds,get_max_beds],slide:function(event,ui){jQuery("#streamlinecore_sw_bedrooms_number").val("Min Bed:"+ui.values[0]+" - Max Bed:"+ui.values[1])},click:function(event,ui){scope.showAvailability({minBedroomsNumber:ui.values[0],maxBedroomsNumber:ui.values[1]})}});jQuery("#streamlinecore_sw_bedrooms_number").val("Min Bed:"+get_min_beds+" - Max Bed:"+get_max_beds)})}}});directives.directive("modalcheckin",function($rootScope){return{restrict:"A",scope:{showDays:"&",updatePrice:"&"},require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){element.datepicker({dateFormat:"mm/dd/yy",minDate:"+1d",maxDate:$rootScope.dinamic_calendar_limit,onSelect:function(date){ngModelCtrl.$setViewValue(date);scope.$apply();var frm=new Date(date);nts=1;if(!Number.isNaN(jQuery("#modal_end_date").attr("data-min-stay"))){nts=jQuery("#modal_end_date").attr("data-min-stay")}if($rootScope.dynamicCalendarMinStay){angular.forEach($rootScope.rates_details,function(rate){var startDate=new Date(rate.period_begin);var endDate=new Date(rate.period_end);if(frm.getTime()<=endDate.getTime()&&frm.getTime()>=startDate.getTime()){nts=parseInt(rate.narrow_defined_days)}})}var the_year=frm.getFullYear();if(the_year<2e3)the_year=2e3+the_year%100;var to=new Date(the_year,frm.getMonth(),parseInt(frm.getDate())+parseInt(nts));jQuery("#modal_end_date").datepicker("option","minDate",to);scope.updatePrice()},beforeShowDay:function(date){return scope.showDays({date:date})}})})}}});directives.directive("modalcheckout",function($rootScope){return{restrict:"A",scope:{showDays:"&",updatePrice:"&"},require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){jQuery(function(){element.datepicker({dateFormat:"mm/dd/yy",minDate:"+1d",maxDate:$rootScope.dinamic_calendar_limit,onSelect:function(date){ngModelCtrl.$setViewValue(date);scope.$apply();scope.updatePrice()},beforeShowDay:function(date){return scope.showDays({date:date})}})})}}});directives.directive("starRating",function(){return{restrict:"A",template:'<div class="star_rating">                 <span style="width:{[(ratingValue > 5) ? ratingValue : (ratingValue/5)*100 ]}%"></span>                </div>',scope:{ratingValue:"=",max:"="},link:function(scope,elem,attrs){}}});directives.directive("checkRequired",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$validators.checkRequired=function(modelValue,viewValue){var value=modelValue||viewValue;var match=scope.$eval(attrs.ngTrueValue)||true;return value&&match===value}}}})})();(function(root,factory){if(typeof define==="function"&&define.amd){define([],function(){return factory()})}else if(typeof module==="object"&&module.exports){module.exports=factory()}else{factory()}})(this,function(){runTranslate.$inject=["$translate"];$translate.$inject=["$STORAGE_KEY","$windowProvider","$translateSanitizationProvider","pascalprechtTranslateOverrider"];$translateDefaultInterpolation.$inject=["$interpolate","$translateSanitization"];translateDirective.$inject=["$translate","$interpolate","$compile","$parse","$rootScope"];translateAttrDirective.$inject=["$translate","$rootScope"];translateCloakDirective.$inject=["$translate","$rootScope"];translateFilterFactory.$inject=["$parse","$translate"];$translationCache.$inject=["$cacheFactory"];angular.module("pascalprecht.translate",["ng"]).run(runTranslate);function runTranslate($translate){"use strict";var key=$translate.storageKey(),storage=$translate.storage();var fallbackFromIncorrectStorageValue=function(){var preferred=$translate.preferredLanguage();if(angular.isString(preferred)){$translate.use(preferred)}else{storage.put(key,$translate.use())}};fallbackFromIncorrectStorageValue.displayName="fallbackFromIncorrectStorageValue";if(storage){if(!storage.get(key)){fallbackFromIncorrectStorageValue()}else{$translate.use(storage.get(key))["catch"](fallbackFromIncorrectStorageValue)}}else if(angular.isString($translate.preferredLanguage())){$translate.use($translate.preferredLanguage())}}runTranslate.displayName="runTranslate";angular.module("pascalprecht.translate").provider("$translateSanitization",$translateSanitizationProvider);function $translateSanitizationProvider(){"use strict";var $sanitize,$sce,currentStrategy=null,hasConfiguredStrategy=false,hasShownNoStrategyConfiguredWarning=false,strategies;strategies={sanitize:function(value,mode){if(mode==="text"){value=htmlSanitizeValue(value)}return value},escape:function(value,mode){if(mode==="text"){value=htmlEscapeValue(value)}return value},sanitizeParameters:function(value,mode){if(mode==="params"){value=mapInterpolationParameters(value,htmlSanitizeValue)}return value},escapeParameters:function(value,mode){if(mode==="params"){value=mapInterpolationParameters(value,htmlEscapeValue)}return value},sce:function(value,mode,context){if(mode==="text"){value=htmlTrustValue(value)}else if(mode==="params"){if(context!=="filter"){value=mapInterpolationParameters(value,htmlEscapeValue)}}return value},sceParameters:function(value,mode){if(mode==="params"){value=mapInterpolationParameters(value,htmlTrustValue)}return value}};strategies.escaped=strategies.escapeParameters;this.addStrategy=function(strategyName,strategyFunction){strategies[strategyName]=strategyFunction;return this};this.removeStrategy=function(strategyName){delete strategies[strategyName];return this};this.useStrategy=function(strategy){hasConfiguredStrategy=true;currentStrategy=strategy;return this};this.$get=["$injector","$log",function($injector,$log){var cachedStrategyMap={};var applyStrategies=function(value,mode,context,selectedStrategies){angular.forEach(selectedStrategies,function(selectedStrategy){if(angular.isFunction(selectedStrategy)){value=selectedStrategy(value,mode,context)}else if(angular.isFunction(strategies[selectedStrategy])){value=strategies[selectedStrategy](value,mode,context)}else if(angular.isString(strategies[selectedStrategy])){if(!cachedStrategyMap[strategies[selectedStrategy]]){try{cachedStrategyMap[strategies[selectedStrategy]]=$injector.get(strategies[selectedStrategy])}catch(e){cachedStrategyMap[strategies[selectedStrategy]]=function(){};throw new Error("pascalprecht.translate.$translateSanitization: Unknown sanitization strategy: '"+selectedStrategy+"'")}}value=cachedStrategyMap[strategies[selectedStrategy]](value,mode,context)}else{throw new Error("pascalprecht.translate.$translateSanitization: Unknown sanitization strategy: '"+selectedStrategy+"'")}});return value};var showNoStrategyConfiguredWarning=function(){if(!hasConfiguredStrategy&&!hasShownNoStrategyConfiguredWarning){$log.warn("pascalprecht.translate.$translateSanitization: No sanitization strategy has been configured. This can have serious security implications. See http://angular-translate.github.io/docs/#/guide/19_security for details.");hasShownNoStrategyConfiguredWarning=true}};if($injector.has("$sanitize")){$sanitize=$injector.get("$sanitize")}if($injector.has("$sce")){$sce=$injector.get("$sce")}return{useStrategy:function(self){return function(strategy){self.useStrategy(strategy)}}(this),sanitize:function(value,mode,strategy,context){if(!currentStrategy){showNoStrategyConfiguredWarning()}if(!strategy&&strategy!==null){strategy=currentStrategy}if(!strategy){return value}if(!context){context="service"}var selectedStrategies=angular.isArray(strategy)?strategy:[strategy];return applyStrategies(value,mode,context,selectedStrategies)}}}];var htmlEscapeValue=function(value){var element=angular.element("<div></div>");element.text(value);return element.html()};var htmlSanitizeValue=function(value){if(!$sanitize){throw new Error("pascalprecht.translate.$translateSanitization: Error cannot find $sanitize service. Either include the ngSanitize module (https://docs.angularjs.org/api/ngSanitize) or use a sanitization strategy which does not depend on $sanitize, such as 'escape'.")}return $sanitize(value)};var htmlTrustValue=function(value){if(!$sce){throw new Error("pascalprecht.translate.$translateSanitization: Error cannot find $sce service.")}return $sce.trustAsHtml(value)};var mapInterpolationParameters=function(value,iteratee,stack){if(angular.isDate(value)){return value}else if(angular.isObject(value)){var result=angular.isArray(value)?[]:{};if(!stack){stack=[]}else{if(stack.indexOf(value)>-1){throw new Error("pascalprecht.translate.$translateSanitization: Error cannot interpolate parameter due recursive object")}}stack.push(value);angular.forEach(value,function(propertyValue,propertyKey){if(angular.isFunction(propertyValue)){return}result[propertyKey]=mapInterpolationParameters(propertyValue,iteratee,stack)});stack.splice(-1,1);return result}else if(angular.isNumber(value)){return value}else if(value===true||value===false){return value}else if(!angular.isUndefined(value)&&value!==null){return iteratee(value)}else{return value}}}angular.module("pascalprecht.translate").constant("pascalprechtTranslateOverrider",{}).provider("$translate",$translate);function $translate($STORAGE_KEY,$windowProvider,$translateSanitizationProvider,pascalprechtTranslateOverrider){"use strict";var $translationTable={},$preferredLanguage,$availableLanguageKeys=[],$languageKeyAliases,$fallbackLanguage,$fallbackWasString,$uses,$nextLang,$storageFactory,$storageKey=$STORAGE_KEY,$storagePrefix,$missingTranslationHandlerFactory,$interpolationFactory,$interpolatorFactories=[],$loaderFactory,$cloakClassName="translate-cloak",$loaderOptions,$notFoundIndicatorLeft,$notFoundIndicatorRight,$postCompilingEnabled=false,$forceAsyncReloadEnabled=false,$nestedObjectDelimeter=".",$isReady=false,$keepContent=false,loaderCache,directivePriority=0,statefulFilter=true,postProcessFn,uniformLanguageTagResolver="default",languageTagResolver={default:function(tag){return(tag||"").split("-").join("_")},java:function(tag){var temp=(tag||"").split("-").join("_");var parts=temp.split("_");return parts.length>1?parts[0].toLowerCase()+"_"+parts[1].toUpperCase():temp},bcp47:function(tag){var temp=(tag||"").split("_").join("-");var parts=temp.split("-");return parts.length>1?parts[0].toLowerCase()+"-"+parts[1].toUpperCase():temp},"iso639-1":function(tag){var temp=(tag||"").split("_").join("-");var parts=temp.split("-");return parts[0].toLowerCase()}};var version="2.15.2";var getFirstBrowserLanguage=function(){if(angular.isFunction(pascalprechtTranslateOverrider.getLocale)){return pascalprechtTranslateOverrider.getLocale()}var nav=$windowProvider.$get().navigator,browserLanguagePropertyKeys=["language","browserLanguage","systemLanguage","userLanguage"],i,language;if(angular.isArray(nav.languages)){for(i=0;i<nav.languages.length;i++){language=nav.languages[i];if(language&&language.length){return language}}}for(i=0;i<browserLanguagePropertyKeys.length;i++){language=nav[browserLanguagePropertyKeys[i]];if(language&&language.length){return language}}return null};getFirstBrowserLanguage.displayName="angular-translate/service: getFirstBrowserLanguage";var getLocale=function(){var locale=getFirstBrowserLanguage()||"";if(languageTagResolver[uniformLanguageTagResolver]){locale=languageTagResolver[uniformLanguageTagResolver](locale)}return locale};getLocale.displayName="angular-translate/service: getLocale";var indexOf=function(array,searchElement){for(var i=0,len=array.length;i<len;i++){if(array[i]===searchElement){return i}}return-1};var trim=function(){return this.toString().replace(/^\s+|\s+$/g,"")};var negotiateLocale=function(preferred){if(!preferred){return}var avail=[],locale=angular.lowercase(preferred),i=0,n=$availableLanguageKeys.length;for(;i<n;i++){avail.push(angular.lowercase($availableLanguageKeys[i]))}if(indexOf(avail,locale)>-1){return preferred}if($languageKeyAliases){var alias;for(var langKeyAlias in $languageKeyAliases){if($languageKeyAliases.hasOwnProperty(langKeyAlias)){var hasWildcardKey=false;var hasExactKey=Object.prototype.hasOwnProperty.call($languageKeyAliases,langKeyAlias)&&angular.lowercase(langKeyAlias)===angular.lowercase(preferred);if(langKeyAlias.slice(-1)==="*"){hasWildcardKey=langKeyAlias.slice(0,-1)===preferred.slice(0,langKeyAlias.length-1)}if(hasExactKey||hasWildcardKey){alias=$languageKeyAliases[langKeyAlias];if(indexOf(avail,angular.lowercase(alias))>-1){return alias}}}}}var parts=preferred.split("_");if(parts.length>1&&indexOf(avail,angular.lowercase(parts[0]))>-1){return parts[0]}return};var translations=function(langKey,translationTable){if(!langKey&&!translationTable){return $translationTable}if(langKey&&!translationTable){if(angular.isString(langKey)){return $translationTable[langKey]}}else{if(!angular.isObject($translationTable[langKey])){$translationTable[langKey]={}}angular.extend($translationTable[langKey],flatObject(translationTable))}return this};this.translations=translations;this.cloakClassName=function(name){if(!name){return $cloakClassName}$cloakClassName=name;return this};this.nestedObjectDelimeter=function(delimiter){if(!delimiter){return $nestedObjectDelimeter}$nestedObjectDelimeter=delimiter;return this};var flatObject=function(data,path,result,prevKey){var key,keyWithPath,keyWithShortPath,val;if(!path){path=[]}if(!result){result={}}for(key in data){if(!Object.prototype.hasOwnProperty.call(data,key)){continue}val=data[key];if(angular.isObject(val)){flatObject(val,path.concat(key),result,key)}else{keyWithPath=path.length?""+path.join($nestedObjectDelimeter)+$nestedObjectDelimeter+key:key;if(path.length&&key===prevKey){keyWithShortPath=""+path.join($nestedObjectDelimeter);result[keyWithShortPath]="@:"+keyWithPath}result[keyWithPath]=val}}return result};flatObject.displayName="flatObject";this.addInterpolation=function(factory){$interpolatorFactories.push(factory);return this};this.useMessageFormatInterpolation=function(){return this.useInterpolation("$translateMessageFormatInterpolation")};this.useInterpolation=function(factory){$interpolationFactory=factory;return this};this.useSanitizeValueStrategy=function(value){$translateSanitizationProvider.useStrategy(value);return this};this.preferredLanguage=function(langKey){if(langKey){setupPreferredLanguage(langKey);return this}return $preferredLanguage};var setupPreferredLanguage=function(langKey){if(langKey){$preferredLanguage=langKey}return $preferredLanguage};this.translationNotFoundIndicator=function(indicator){this.translationNotFoundIndicatorLeft(indicator);this.translationNotFoundIndicatorRight(indicator);return this};this.translationNotFoundIndicatorLeft=function(indicator){if(!indicator){return $notFoundIndicatorLeft}$notFoundIndicatorLeft=indicator;return this};this.translationNotFoundIndicatorRight=function(indicator){if(!indicator){return $notFoundIndicatorRight}$notFoundIndicatorRight=indicator;return this};this.fallbackLanguage=function(langKey){fallbackStack(langKey);return this};var fallbackStack=function(langKey){if(langKey){if(angular.isString(langKey)){$fallbackWasString=true;$fallbackLanguage=[langKey]}else if(angular.isArray(langKey)){$fallbackWasString=false;$fallbackLanguage=langKey}if(angular.isString($preferredLanguage)&&indexOf($fallbackLanguage,$preferredLanguage)<0){$fallbackLanguage.push($preferredLanguage)}return this}else{if($fallbackWasString){return $fallbackLanguage[0]}else{return $fallbackLanguage}}};this.use=function(langKey){if(langKey){if(!$translationTable[langKey]&&!$loaderFactory){throw new Error("$translateProvider couldn't find translationTable for langKey: '"+langKey+"'")}$uses=langKey;return this}return $uses};this.resolveClientLocale=function(){return getLocale()};var storageKey=function(key){if(!key){if($storagePrefix){return $storagePrefix+$storageKey}return $storageKey}$storageKey=key;return this};this.storageKey=storageKey;this.useUrlLoader=function(url,options){return this.useLoader("$translateUrlLoader",angular.extend({url:url},options))};this.useStaticFilesLoader=function(options){return this.useLoader("$translateStaticFilesLoader",options)};this.useLoader=function(loaderFactory,options){$loaderFactory=loaderFactory;$loaderOptions=options||{};return this};this.useLocalStorage=function(){return this.useStorage("$translateLocalStorage")};this.useCookieStorage=function(){return this.useStorage("$translateCookieStorage")};this.useStorage=function(storageFactory){$storageFactory=storageFactory;return this};this.storagePrefix=function(prefix){if(!prefix){return prefix}$storagePrefix=prefix;return this};this.useMissingTranslationHandlerLog=function(){return this.useMissingTranslationHandler("$translateMissingTranslationHandlerLog")};this.useMissingTranslationHandler=function(factory){$missingTranslationHandlerFactory=factory;return this};this.usePostCompiling=function(value){$postCompilingEnabled=!!value;return this};this.forceAsyncReload=function(value){$forceAsyncReloadEnabled=!!value;return this};this.uniformLanguageTag=function(options){if(!options){options={}}else if(angular.isString(options)){options={standard:options}}uniformLanguageTagResolver=options.standard;return this};this.determinePreferredLanguage=function(fn){var locale=fn&&angular.isFunction(fn)?fn():getLocale();if(!$availableLanguageKeys.length){$preferredLanguage=locale}else{$preferredLanguage=negotiateLocale(locale)||locale}return this};this.registerAvailableLanguageKeys=function(languageKeys,aliases){if(languageKeys){$availableLanguageKeys=languageKeys;if(aliases){$languageKeyAliases=aliases}return this}return $availableLanguageKeys};this.useLoaderCache=function(cache){if(cache===false){loaderCache=undefined}else if(cache===true){loaderCache=true}else if(typeof cache==="undefined"){loaderCache="$translationCache"}else if(cache){loaderCache=cache}return this};this.directivePriority=function(priority){if(priority===undefined){return directivePriority}else{directivePriority=priority;return this}};this.statefulFilter=function(state){if(state===undefined){return statefulFilter}else{statefulFilter=state;return this}};this.postProcess=function(fn){if(fn){postProcessFn=fn}else{postProcessFn=undefined}return this};this.keepContent=function(value){$keepContent=!!value;return this};this.$get=["$log","$injector","$rootScope","$q",function($log,$injector,$rootScope,$q){var Storage,defaultInterpolator=$injector.get($interpolationFactory||"$translateDefaultInterpolation"),pendingLoader=false,interpolatorHashMap={},langPromises={},fallbackIndex,startFallbackIteration;var $translate=function(translationId,interpolateParams,interpolationId,defaultTranslationText,forceLanguage){if(!$uses&&$preferredLanguage){$uses=$preferredLanguage}var uses=forceLanguage&&forceLanguage!==$uses?negotiateLocale(forceLanguage)||forceLanguage:$uses;if(forceLanguage){loadTranslationsIfMissing(forceLanguage)}if(angular.isArray(translationId)){var translateAll=function(translationIds){var results={};var promises=[];var translate=function(translationId){var deferred=$q.defer();var regardless=function(value){results[translationId]=value;deferred.resolve([translationId,value])};$translate(translationId,interpolateParams,interpolationId,defaultTranslationText,forceLanguage).then(regardless,regardless);return deferred.promise};for(var i=0,c=translationIds.length;i<c;i++){promises.push(translate(translationIds[i]))}return $q.all(promises).then(function(){return results})};return translateAll(translationId)}var deferred=$q.defer();if(translationId){translationId=trim.apply(translationId)}var promiseToWaitFor=function(){var promise=$preferredLanguage?langPromises[$preferredLanguage]:langPromises[uses];fallbackIndex=0;if($storageFactory&&!promise){var langKey=Storage.get($storageKey);promise=langPromises[langKey];if($fallbackLanguage&&$fallbackLanguage.length){var index=indexOf($fallbackLanguage,langKey);fallbackIndex=index===0?1:0;if(indexOf($fallbackLanguage,$preferredLanguage)<0){$fallbackLanguage.push($preferredLanguage)}}}return promise}();if(!promiseToWaitFor){determineTranslation(translationId,interpolateParams,interpolationId,defaultTranslationText,uses).then(deferred.resolve,deferred.reject)}else{var promiseResolved=function(){if(!forceLanguage){uses=$uses}determineTranslation(translationId,interpolateParams,interpolationId,defaultTranslationText,uses).then(deferred.resolve,deferred.reject)};promiseResolved.displayName="promiseResolved";promiseToWaitFor["finally"](promiseResolved)["catch"](angular.noop)}return deferred.promise};var applyNotFoundIndicators=function(translationId){if($notFoundIndicatorLeft){translationId=[$notFoundIndicatorLeft,translationId].join(" ")}if($notFoundIndicatorRight){translationId=[translationId,$notFoundIndicatorRight].join(" ")}return translationId};var useLanguage=function(key){$uses=key;if($storageFactory){Storage.put($translate.storageKey(),$uses)}$rootScope.$emit("$translateChangeSuccess",{language:key});defaultInterpolator.setLocale($uses);var eachInterpolator=function(interpolator,id){interpolatorHashMap[id].setLocale($uses)};eachInterpolator.displayName="eachInterpolatorLocaleSetter";angular.forEach(interpolatorHashMap,eachInterpolator);$rootScope.$emit("$translateChangeEnd",{language:key})};var loadAsync=function(key){if(!key){throw"No language key specified for loading."}var deferred=$q.defer();$rootScope.$emit("$translateLoadingStart",{language:key});pendingLoader=true;var cache=loaderCache;if(typeof cache==="string"){cache=$injector.get(cache)}var loaderOptions=angular.extend({},$loaderOptions,{key:key,$http:angular.extend({},{cache:cache},$loaderOptions.$http)});var onLoaderSuccess=function(data){var translationTable={};$rootScope.$emit("$translateLoadingSuccess",{language:key});if(angular.isArray(data)){angular.forEach(data,function(table){angular.extend(translationTable,flatObject(table))})}else{angular.extend(translationTable,flatObject(data))}pendingLoader=false;deferred.resolve({key:key,table:translationTable});$rootScope.$emit("$translateLoadingEnd",{language:key})};onLoaderSuccess.displayName="onLoaderSuccess";var onLoaderError=function(key){$rootScope.$emit("$translateLoadingError",{language:key});deferred.reject(key);$rootScope.$emit("$translateLoadingEnd",{language:key})};onLoaderError.displayName="onLoaderError";$injector.get($loaderFactory)(loaderOptions).then(onLoaderSuccess,onLoaderError);return deferred.promise};if($storageFactory){Storage=$injector.get($storageFactory);if(!Storage.get||!Storage.put){throw new Error("Couldn't use storage '"+$storageFactory+"', missing get() or put() method!")}}if($interpolatorFactories.length){var eachInterpolationFactory=function(interpolatorFactory){var interpolator=$injector.get(interpolatorFactory);interpolator.setLocale($preferredLanguage||$uses);interpolatorHashMap[interpolator.getInterpolationIdentifier()]=interpolator};eachInterpolationFactory.displayName="interpolationFactoryAdder";angular.forEach($interpolatorFactories,eachInterpolationFactory)}var getTranslationTable=function(langKey){var deferred=$q.defer();if(Object.prototype.hasOwnProperty.call($translationTable,langKey)){deferred.resolve($translationTable[langKey])}else if(langPromises[langKey]){var onResolve=function(data){translations(data.key,data.table);deferred.resolve(data.table)};onResolve.displayName="translationTableResolver";langPromises[langKey].then(onResolve,deferred.reject)}else{deferred.reject()}return deferred.promise};var getFallbackTranslation=function(langKey,translationId,interpolateParams,Interpolator,sanitizeStrategy){var deferred=$q.defer();var onResolve=function(translationTable){if(Object.prototype.hasOwnProperty.call(translationTable,translationId)&&translationTable[translationId]!==null){Interpolator.setLocale(langKey);var translation=translationTable[translationId];if(translation.substr(0,2)==="@:"){getFallbackTranslation(langKey,translation.substr(2),interpolateParams,Interpolator,sanitizeStrategy).then(deferred.resolve,deferred.reject)}else{var interpolatedValue=Interpolator.interpolate(translationTable[translationId],interpolateParams,"service",sanitizeStrategy,translationId);interpolatedValue=applyPostProcessing(translationId,translationTable[translationId],interpolatedValue,interpolateParams,langKey);deferred.resolve(interpolatedValue)}Interpolator.setLocale($uses)}else{deferred.reject()}};onResolve.displayName="fallbackTranslationResolver";getTranslationTable(langKey).then(onResolve,deferred.reject);return deferred.promise};var getFallbackTranslationInstant=function(langKey,translationId,interpolateParams,Interpolator,sanitizeStrategy){var result,translationTable=$translationTable[langKey];if(translationTable&&Object.prototype.hasOwnProperty.call(translationTable,translationId)&&translationTable[translationId]!==null){Interpolator.setLocale(langKey);result=Interpolator.interpolate(translationTable[translationId],interpolateParams,"filter",sanitizeStrategy,translationId);result=applyPostProcessing(translationId,translationTable[translationId],result,interpolateParams,langKey,sanitizeStrategy);if(!angular.isString(result)&&angular.isFunction(result.$$unwrapTrustedValue)){var result2=result.$$unwrapTrustedValue();if(result2.substr(0,2)==="@:"){return getFallbackTranslationInstant(langKey,result2.substr(2),interpolateParams,Interpolator,sanitizeStrategy)}}else if(result.substr(0,2)==="@:"){return getFallbackTranslationInstant(langKey,result.substr(2),interpolateParams,Interpolator,sanitizeStrategy)}Interpolator.setLocale($uses)}return result};var translateByHandler=function(translationId,interpolateParams,defaultTranslationText,sanitizeStrategy){if($missingTranslationHandlerFactory){return $injector.get($missingTranslationHandlerFactory)(translationId,$uses,interpolateParams,defaultTranslationText,sanitizeStrategy)}else{return translationId}};var resolveForFallbackLanguage=function(fallbackLanguageIndex,translationId,interpolateParams,Interpolator,defaultTranslationText,sanitizeStrategy){var deferred=$q.defer();if(fallbackLanguageIndex<$fallbackLanguage.length){var langKey=$fallbackLanguage[fallbackLanguageIndex];getFallbackTranslation(langKey,translationId,interpolateParams,Interpolator,sanitizeStrategy).then(function(data){deferred.resolve(data)},function(){return resolveForFallbackLanguage(fallbackLanguageIndex+1,translationId,interpolateParams,Interpolator,defaultTranslationText,sanitizeStrategy).then(deferred.resolve,deferred.reject)})}else{if(defaultTranslationText){deferred.resolve(defaultTranslationText)}else{var missingTranslationHandlerTranslation=translateByHandler(translationId,interpolateParams,defaultTranslationText);if($missingTranslationHandlerFactory&&missingTranslationHandlerTranslation){deferred.resolve(missingTranslationHandlerTranslation)}else{deferred.reject(applyNotFoundIndicators(translationId))}}}return deferred.promise};var resolveForFallbackLanguageInstant=function(fallbackLanguageIndex,translationId,interpolateParams,Interpolator,sanitizeStrategy){var result;if(fallbackLanguageIndex<$fallbackLanguage.length){var langKey=$fallbackLanguage[fallbackLanguageIndex];result=getFallbackTranslationInstant(langKey,translationId,interpolateParams,Interpolator,sanitizeStrategy);if(!result&&result!==""){result=resolveForFallbackLanguageInstant(fallbackLanguageIndex+1,translationId,interpolateParams,Interpolator)}}return result};var fallbackTranslation=function(translationId,interpolateParams,Interpolator,defaultTranslationText,sanitizeStrategy){return resolveForFallbackLanguage(startFallbackIteration>0?startFallbackIteration:fallbackIndex,translationId,interpolateParams,Interpolator,defaultTranslationText,sanitizeStrategy)};var fallbackTranslationInstant=function(translationId,interpolateParams,Interpolator,sanitizeStrategy){return resolveForFallbackLanguageInstant(startFallbackIteration>0?startFallbackIteration:fallbackIndex,translationId,interpolateParams,Interpolator,sanitizeStrategy)};var determineTranslation=function(translationId,interpolateParams,interpolationId,defaultTranslationText,uses,sanitizeStrategy){var deferred=$q.defer();var table=uses?$translationTable[uses]:$translationTable,Interpolator=interpolationId?interpolatorHashMap[interpolationId]:defaultInterpolator;if(table&&Object.prototype.hasOwnProperty.call(table,translationId)&&table[translationId]!==null){var translation=table[translationId];if(translation.substr(0,2)==="@:"){$translate(translation.substr(2),interpolateParams,interpolationId,defaultTranslationText,uses).then(deferred.resolve,deferred.reject)}else{var resolvedTranslation=Interpolator.interpolate(translation,interpolateParams,"service",sanitizeStrategy,translationId);resolvedTranslation=applyPostProcessing(translationId,translation,resolvedTranslation,interpolateParams,uses);deferred.resolve(resolvedTranslation)}}else{var missingTranslationHandlerTranslation;if($missingTranslationHandlerFactory&&!pendingLoader){missingTranslationHandlerTranslation=translateByHandler(translationId,interpolateParams,defaultTranslationText)}if(uses&&$fallbackLanguage&&$fallbackLanguage.length){fallbackTranslation(translationId,interpolateParams,Interpolator,defaultTranslationText,sanitizeStrategy).then(function(translation){deferred.resolve(translation)},function(_translationId){deferred.reject(applyNotFoundIndicators(_translationId))})}else if($missingTranslationHandlerFactory&&!pendingLoader&&missingTranslationHandlerTranslation){if(defaultTranslationText){deferred.resolve(defaultTranslationText)}else{deferred.resolve(missingTranslationHandlerTranslation)}}else{if(defaultTranslationText){deferred.resolve(defaultTranslationText)}else{deferred.reject(applyNotFoundIndicators(translationId))}}}return deferred.promise};var determineTranslationInstant=function(translationId,interpolateParams,interpolationId,uses,sanitizeStrategy){var result,table=uses?$translationTable[uses]:$translationTable,Interpolator=defaultInterpolator;if(interpolatorHashMap&&Object.prototype.hasOwnProperty.call(interpolatorHashMap,interpolationId)){Interpolator=interpolatorHashMap[interpolationId]}if(table&&Object.prototype.hasOwnProperty.call(table,translationId)&&table[translationId]!==null){var translation=table[translationId];if(translation.substr(0,2)==="@:"){result=determineTranslationInstant(translation.substr(2),interpolateParams,interpolationId,uses,sanitizeStrategy)}else{result=Interpolator.interpolate(translation,interpolateParams,"filter",sanitizeStrategy,translationId);result=applyPostProcessing(translationId,translation,result,interpolateParams,uses,sanitizeStrategy)}}else{var missingTranslationHandlerTranslation;if($missingTranslationHandlerFactory&&!pendingLoader){missingTranslationHandlerTranslation=translateByHandler(translationId,interpolateParams,sanitizeStrategy)}if(uses&&$fallbackLanguage&&$fallbackLanguage.length){fallbackIndex=0;result=fallbackTranslationInstant(translationId,interpolateParams,Interpolator,sanitizeStrategy)}else if($missingTranslationHandlerFactory&&!pendingLoader&&missingTranslationHandlerTranslation){result=missingTranslationHandlerTranslation}else{result=applyNotFoundIndicators(translationId)}}return result};var clearNextLangAndPromise=function(key){if($nextLang===key){$nextLang=undefined}langPromises[key]=undefined};var applyPostProcessing=function(translationId,translation,resolvedTranslation,interpolateParams,uses,sanitizeStrategy){var fn=postProcessFn;if(fn){if(typeof fn==="string"){fn=$injector.get(fn)}if(fn){return fn(translationId,translation,resolvedTranslation,interpolateParams,uses,sanitizeStrategy)}}return resolvedTranslation};var loadTranslationsIfMissing=function(key){if(!$translationTable[key]&&$loaderFactory&&!langPromises[key]){langPromises[key]=loadAsync(key).then(function(translation){translations(translation.key,translation.table);return translation})}};$translate.preferredLanguage=function(langKey){if(langKey){setupPreferredLanguage(langKey)}return $preferredLanguage};$translate.cloakClassName=function(){return $cloakClassName};$translate.nestedObjectDelimeter=function(){return $nestedObjectDelimeter};$translate.fallbackLanguage=function(langKey){if(langKey!==undefined&&langKey!==null){fallbackStack(langKey);if($loaderFactory){if($fallbackLanguage&&$fallbackLanguage.length){for(var i=0,len=$fallbackLanguage.length;i<len;i++){if(!langPromises[$fallbackLanguage[i]]){langPromises[$fallbackLanguage[i]]=loadAsync($fallbackLanguage[i])}}}}$translate.use($translate.use())}if($fallbackWasString){return $fallbackLanguage[0]}else{return $fallbackLanguage}};$translate.useFallbackLanguage=function(langKey){if(langKey!==undefined&&langKey!==null){if(!langKey){startFallbackIteration=0}else{var langKeyPosition=indexOf($fallbackLanguage,langKey);if(langKeyPosition>-1){startFallbackIteration=langKeyPosition}}}};$translate.proposedLanguage=function(){return $nextLang};$translate.storage=function(){return Storage};$translate.negotiateLocale=negotiateLocale;$translate.use=function(key){if(!key){return $uses}var deferred=$q.defer();deferred.promise.then(null,angular.noop);$rootScope.$emit("$translateChangeStart",{language:key});var aliasedKey=negotiateLocale(key);if($availableLanguageKeys.length>0&&!aliasedKey){return $q.reject(key)}if(aliasedKey){key=aliasedKey}$nextLang=key;if(($forceAsyncReloadEnabled||!$translationTable[key])&&$loaderFactory&&!langPromises[key]){langPromises[key]=loadAsync(key).then(function(translation){translations(translation.key,translation.table);deferred.resolve(translation.key);if($nextLang===key){useLanguage(translation.key)}return translation},function(key){$rootScope.$emit("$translateChangeError",{language:key});deferred.reject(key);$rootScope.$emit("$translateChangeEnd",{language:key});return $q.reject(key)});langPromises[key]["finally"](function(){clearNextLangAndPromise(key)})["catch"](angular.noop)}else if(langPromises[key]){langPromises[key].then(function(translation){if($nextLang===translation.key){useLanguage(translation.key)}deferred.resolve(translation.key);return translation},function(key){if(!$uses&&$fallbackLanguage&&$fallbackLanguage.length>0&&$fallbackLanguage[0]!==key){return $translate.use($fallbackLanguage[0]).then(deferred.resolve,deferred.reject)}else{return deferred.reject(key)}})}else{deferred.resolve(key);useLanguage(key)}return deferred.promise};$translate.resolveClientLocale=function(){return getLocale()};$translate.storageKey=function(){return storageKey()};$translate.isPostCompilingEnabled=function(){return $postCompilingEnabled};$translate.isForceAsyncReloadEnabled=function(){return $forceAsyncReloadEnabled};$translate.isKeepContent=function(){return $keepContent};$translate.refresh=function(langKey){if(!$loaderFactory){throw new Error("Couldn't refresh translation table, no loader registered!")}$rootScope.$emit("$translateRefreshStart",{language:langKey});var deferred=$q.defer(),updatedLanguages={};function loadNewData(languageKey){var promise=loadAsync(languageKey);langPromises[languageKey]=promise;promise.then(function(data){$translationTable[languageKey]={};translations(languageKey,data.table);updatedLanguages[languageKey]=true},angular.noop);return promise}deferred.promise.then(function(){for(var key in $translationTable){if($translationTable.hasOwnProperty(key)){if(!(key in updatedLanguages)){delete $translationTable[key]}}}if($uses){useLanguage($uses)}},angular.noop)["finally"](function(){$rootScope.$emit("$translateRefreshEnd",{language:langKey})});if(!langKey){var languagesToReload=$fallbackLanguage&&$fallbackLanguage.slice()||[];if($uses&&languagesToReload.indexOf($uses)===-1){languagesToReload.push($uses)}$q.all(languagesToReload.map(loadNewData)).then(deferred.resolve,deferred.reject)}else if($translationTable[langKey]){loadNewData(langKey).then(deferred.resolve,deferred.reject)}else{deferred.reject()}return deferred.promise};$translate.instant=function(translationId,interpolateParams,interpolationId,forceLanguage,sanitizeStrategy){var uses=forceLanguage&&forceLanguage!==$uses?negotiateLocale(forceLanguage)||forceLanguage:$uses;if(translationId===null||angular.isUndefined(translationId)){return translationId}if(forceLanguage){loadTranslationsIfMissing(forceLanguage)}if(angular.isArray(translationId)){var results={};for(var i=0,c=translationId.length;i<c;i++){results[translationId[i]]=$translate.instant(translationId[i],interpolateParams,interpolationId,forceLanguage,sanitizeStrategy)}return results}if(angular.isString(translationId)&&translationId.length<1){return translationId}if(translationId){translationId=trim.apply(translationId)}var result,possibleLangKeys=[];if($preferredLanguage){possibleLangKeys.push($preferredLanguage)}if(uses){possibleLangKeys.push(uses)}if($fallbackLanguage&&$fallbackLanguage.length){possibleLangKeys=possibleLangKeys.concat($fallbackLanguage)}for(var j=0,d=possibleLangKeys.length;j<d;j++){var possibleLangKey=possibleLangKeys[j];if($translationTable[possibleLangKey]){if(typeof $translationTable[possibleLangKey][translationId]!=="undefined"){result=determineTranslationInstant(translationId,interpolateParams,interpolationId,uses,sanitizeStrategy)}}if(typeof result!=="undefined"){break}}if(!result&&result!==""){if($notFoundIndicatorLeft||$notFoundIndicatorRight){result=applyNotFoundIndicators(translationId)}else{result=defaultInterpolator.interpolate(translationId,interpolateParams,"filter",sanitizeStrategy);var missingTranslationHandlerTranslation;if($missingTranslationHandlerFactory&&!pendingLoader){missingTranslationHandlerTranslation=translateByHandler(translationId,interpolateParams,sanitizeStrategy)}if($missingTranslationHandlerFactory&&!pendingLoader&&missingTranslationHandlerTranslation){result=missingTranslationHandlerTranslation}}}return result};$translate.versionInfo=function(){return version};$translate.loaderCache=function(){return loaderCache};$translate.directivePriority=function(){return directivePriority};$translate.statefulFilter=function(){return statefulFilter};$translate.isReady=function(){return $isReady};var $onReadyDeferred=$q.defer();$onReadyDeferred.promise.then(function(){$isReady=true});$translate.onReady=function(fn){var deferred=$q.defer();if(angular.isFunction(fn)){deferred.promise.then(fn)}if($isReady){deferred.resolve()}else{$onReadyDeferred.promise.then(deferred.resolve)}return deferred.promise};$translate.getAvailableLanguageKeys=function(){if($availableLanguageKeys.length>0){return $availableLanguageKeys}return null};$translate.getTranslationTable=function(langKey){langKey=langKey||$translate.use();if(langKey&&$translationTable[langKey]){return angular.copy($translationTable[langKey])}return null};var globalOnReadyListener=$rootScope.$on("$translateReady",function(){$onReadyDeferred.resolve();globalOnReadyListener();globalOnReadyListener=null});var globalOnChangeListener=$rootScope.$on("$translateChangeEnd",function(){$onReadyDeferred.resolve();globalOnChangeListener();globalOnChangeListener=null});if($loaderFactory){if(angular.equals($translationTable,{})){if($translate.use()){$translate.use($translate.use())}}if($fallbackLanguage&&$fallbackLanguage.length){var processAsyncResult=function(translation){translations(translation.key,translation.table);$rootScope.$emit("$translateChangeEnd",{language:translation.key});return translation};for(var i=0,len=$fallbackLanguage.length;i<len;i++){var fallbackLanguageId=$fallbackLanguage[i];if($forceAsyncReloadEnabled||!$translationTable[fallbackLanguageId]){langPromises[fallbackLanguageId]=loadAsync(fallbackLanguageId).then(processAsyncResult)}}}}else{$rootScope.$emit("$translateReady",{language:$translate.use()})}return $translate}]}$translate.displayName="displayName";angular.module("pascalprecht.translate").factory("$translateDefaultInterpolation",$translateDefaultInterpolation);function $translateDefaultInterpolation($interpolate,$translateSanitization){"use strict";var $translateInterpolator={},$locale,$identifier="default";$translateInterpolator.setLocale=function(locale){$locale=locale};$translateInterpolator.getInterpolationIdentifier=function(){return $identifier};$translateInterpolator.useSanitizeValueStrategy=function(value){$translateSanitization.useStrategy(value);return this};$translateInterpolator.interpolate=function(value,interpolationParams,context,sanitizeStrategy,translationId){interpolationParams=interpolationParams||{};interpolationParams=$translateSanitization.sanitize(interpolationParams,"params",sanitizeStrategy,context);var interpolatedText;if(angular.isNumber(value)){interpolatedText=""+value}else if(angular.isString(value)){interpolatedText=$interpolate(value)(interpolationParams);interpolatedText=$translateSanitization.sanitize(interpolatedText,"text",sanitizeStrategy,context)}else{interpolatedText=""}return interpolatedText};return $translateInterpolator}$translateDefaultInterpolation.displayName="$translateDefaultInterpolation";angular.module("pascalprecht.translate").constant("$STORAGE_KEY","NG_TRANSLATE_LANG_KEY");angular.module("pascalprecht.translate").directive("translate",translateDirective);function translateDirective($translate,$interpolate,$compile,$parse,$rootScope){"use strict";var trim=function(){return this.toString().replace(/^\s+|\s+$/g,"")};return{restrict:"AE",scope:true,priority:$translate.directivePriority(),compile:function(tElement,tAttr){var translateValuesExist=tAttr.translateValues?tAttr.translateValues:undefined;var translateInterpolation=tAttr.translateInterpolation?tAttr.translateInterpolation:undefined;var translateValueExist=tElement[0].outerHTML.match(/translate-value-+/i);var interpolateRegExp="^(.*)("+$interpolate.startSymbol()+".*"+$interpolate.endSymbol()+")(.*)",watcherRegExp="^(.*)"+$interpolate.startSymbol()+"(.*)"+$interpolate.endSymbol()+"(.*)";return function linkFn(scope,iElement,iAttr){scope.interpolateParams={};scope.preText="";scope.postText="";scope.translateNamespace=getTranslateNamespace(scope);var translationIds={};var initInterpolationParams=function(interpolateParams,iAttr,tAttr){if(iAttr.translateValues){angular.extend(interpolateParams,$parse(iAttr.translateValues)(scope.$parent))}if(translateValueExist){for(var attr in tAttr){if(Object.prototype.hasOwnProperty.call(iAttr,attr)&&attr.substr(0,14)==="translateValue"&&attr!=="translateValues"){var attributeName=angular.lowercase(attr.substr(14,1))+attr.substr(15);interpolateParams[attributeName]=tAttr[attr]}}}};var observeElementTranslation=function(translationId){if(angular.isFunction(observeElementTranslation._unwatchOld)){observeElementTranslation._unwatchOld();observeElementTranslation._unwatchOld=undefined}if(angular.equals(translationId,"")||!angular.isDefined(translationId)){var iElementText=trim.apply(iElement.text());var interpolateMatches=iElementText.match(interpolateRegExp);if(angular.isArray(interpolateMatches)){scope.preText=interpolateMatches[1];scope.postText=interpolateMatches[3];translationIds.translate=$interpolate(interpolateMatches[2])(scope.$parent);var watcherMatches=iElementText.match(watcherRegExp);if(angular.isArray(watcherMatches)&&watcherMatches[2]&&watcherMatches[2].length){observeElementTranslation._unwatchOld=scope.$watch(watcherMatches[2],function(newValue){translationIds.translate=newValue;updateTranslations()})}}else{translationIds.translate=!iElementText?undefined:iElementText}}else{translationIds.translate=translationId}updateTranslations()};var observeAttributeTranslation=function(translateAttr){iAttr.$observe(translateAttr,function(translationId){translationIds[translateAttr]=translationId;updateTranslations()})};initInterpolationParams(scope.interpolateParams,iAttr,tAttr);var firstAttributeChangedEvent=true;iAttr.$observe("translate",function(translationId){if(typeof translationId==="undefined"){observeElementTranslation("")}else{if(translationId!==""||!firstAttributeChangedEvent){translationIds.translate=translationId;updateTranslations()}}firstAttributeChangedEvent=false});for(var translateAttr in iAttr){if(iAttr.hasOwnProperty(translateAttr)&&translateAttr.substr(0,13)==="translateAttr"&&translateAttr.length>13){observeAttributeTranslation(translateAttr)}}iAttr.$observe("translateDefault",function(value){scope.defaultText=value;updateTranslations()});if(translateValuesExist){iAttr.$observe("translateValues",function(interpolateParams){if(interpolateParams){scope.$parent.$watch(function(){angular.extend(scope.interpolateParams,$parse(interpolateParams)(scope.$parent))})}})}if(translateValueExist){var observeValueAttribute=function(attrName){iAttr.$observe(attrName,function(value){var attributeName=angular.lowercase(attrName.substr(14,1))+attrName.substr(15);scope.interpolateParams[attributeName]=value})};for(var attr in iAttr){if(Object.prototype.hasOwnProperty.call(iAttr,attr)&&attr.substr(0,14)==="translateValue"&&attr!=="translateValues"){observeValueAttribute(attr)}}}var updateTranslations=function(){for(var key in translationIds){if(translationIds.hasOwnProperty(key)&&translationIds[key]!==undefined){updateTranslation(key,translationIds[key],scope,scope.interpolateParams,scope.defaultText,scope.translateNamespace)}}};var updateTranslation=function(translateAttr,translationId,scope,interpolateParams,defaultTranslationText,translateNamespace){if(translationId){if(translateNamespace&&translationId.charAt(0)==="."){translationId=translateNamespace+translationId}$translate(translationId,interpolateParams,translateInterpolation,defaultTranslationText,scope.translateLanguage).then(function(translation){applyTranslation(translation,scope,true,translateAttr)},function(translationId){applyTranslation(translationId,scope,false,translateAttr)})}else{applyTranslation(translationId,scope,false,translateAttr)}};var applyTranslation=function(value,scope,successful,translateAttr){if(!successful){if(typeof scope.defaultText!=="undefined"){value=scope.defaultText}}if(translateAttr==="translate"){if(successful||!successful&&!$translate.isKeepContent()&&typeof iAttr.translateKeepContent==="undefined"){iElement.empty().append(scope.preText+value+scope.postText)}var globallyEnabled=$translate.isPostCompilingEnabled();var locallyDefined=typeof tAttr.translateCompile!=="undefined";var locallyEnabled=locallyDefined&&tAttr.translateCompile!=="false";if(globallyEnabled&&!locallyDefined||locallyEnabled){$compile(iElement.contents())(scope)}}else{var attributeName=iAttr.$attr[translateAttr];if(attributeName.substr(0,5)==="data-"){attributeName=attributeName.substr(5)}attributeName=attributeName.substr(15);iElement.attr(attributeName,value)}};if(translateValuesExist||translateValueExist||iAttr.translateDefault){scope.$watch("interpolateParams",updateTranslations,true)}scope.$on("translateLanguageChanged",updateTranslations);var unbind=$rootScope.$on("$translateChangeSuccess",updateTranslations);if(iElement.text().length){if(iAttr.translate){observeElementTranslation(iAttr.translate)}else{observeElementTranslation("")}}else if(iAttr.translate){observeElementTranslation(iAttr.translate)}updateTranslations();scope.$on("$destroy",unbind)}}}}function getTranslateNamespace(scope){"use strict";if(scope.translateNamespace){return scope.translateNamespace}if(scope.$parent){return getTranslateNamespace(scope.$parent)}}translateDirective.displayName="translateDirective";angular.module("pascalprecht.translate").directive("translateAttr",translateAttrDirective);function translateAttrDirective($translate,$rootScope){"use strict";return{restrict:"A",priority:$translate.directivePriority(),link:function linkFn(scope,element,attr){var translateAttr,translateValues,previousAttributes={};var updateTranslations=function(){angular.forEach(translateAttr,function(translationId,attributeName){if(!translationId){return}previousAttributes[attributeName]=true;if(scope.translateNamespace&&translationId.charAt(0)==="."){translationId=scope.translateNamespace+translationId}$translate(translationId,translateValues,attr.translateInterpolation,undefined,scope.translateLanguage).then(function(translation){element.attr(attributeName,translation)},function(translationId){element.attr(attributeName,translationId)})});angular.forEach(previousAttributes,function(flag,attributeName){if(!translateAttr[attributeName]){element.removeAttr(attributeName);delete previousAttributes[attributeName]}})};watchAttribute(scope,attr.translateAttr,function(newValue){translateAttr=newValue},updateTranslations);watchAttribute(scope,attr.translateValues,function(newValue){translateValues=newValue},updateTranslations);if(attr.translateValues){scope.$watch(attr.translateValues,updateTranslations,true)}scope.$on("translateLanguageChanged",updateTranslations);var unbind=$rootScope.$on("$translateChangeSuccess",updateTranslations);updateTranslations();scope.$on("$destroy",unbind)}}}function watchAttribute(scope,attribute,valueCallback,changeCallback){"use strict";if(!attribute){return}if(attribute.substr(0,2)==="::"){attribute=attribute.substr(2)}else{scope.$watch(attribute,function(newValue){valueCallback(newValue);changeCallback()},true)}valueCallback(scope.$eval(attribute))}translateAttrDirective.displayName="translateAttrDirective";angular.module("pascalprecht.translate").directive("translateCloak",translateCloakDirective);function translateCloakDirective($translate,$rootScope){"use strict";return{compile:function(tElement){var applyCloak=function(element){element.addClass($translate.cloakClassName())},removeCloak=function(element){element.removeClass($translate.cloakClassName())};applyCloak(tElement);return function linkFn(scope,iElement,iAttr){var iRemoveCloak=removeCloak.bind(this,iElement),iApplyCloak=applyCloak.bind(this,iElement);if(iAttr.translateCloak&&iAttr.translateCloak.length){iAttr.$observe("translateCloak",function(translationId){$translate(translationId).then(iRemoveCloak,iApplyCloak)});$rootScope.$on("$translateChangeSuccess",function(){$translate(iAttr.translateCloak).then(iRemoveCloak,iApplyCloak)})}else{$translate.onReady(iRemoveCloak)}}}}}translateCloakDirective.displayName="translateCloakDirective";angular.module("pascalprecht.translate").directive("translateNamespace",translateNamespaceDirective);function translateNamespaceDirective(){"use strict";return{restrict:"A",scope:true,compile:function(){return{pre:function(scope,iElement,iAttrs){scope.translateNamespace=getTranslateNamespace(scope);if(scope.translateNamespace&&iAttrs.translateNamespace.charAt(0)==="."){scope.translateNamespace+=iAttrs.translateNamespace}else{scope.translateNamespace=iAttrs.translateNamespace}}}}}}function getTranslateNamespace(scope){"use strict";if(scope.translateNamespace){return scope.translateNamespace}if(scope.$parent){return getTranslateNamespace(scope.$parent)}}translateNamespaceDirective.displayName="translateNamespaceDirective";angular.module("pascalprecht.translate").directive("translateLanguage",translateLanguageDirective);function translateLanguageDirective(){"use strict";return{restrict:"A",scope:true,compile:function(){return function linkFn(scope,iElement,iAttrs){iAttrs.$observe("translateLanguage",function(newTranslateLanguage){scope.translateLanguage=newTranslateLanguage});scope.$watch("translateLanguage",function(){scope.$broadcast("translateLanguageChanged")})}}}}translateLanguageDirective.displayName="translateLanguageDirective";angular.module("pascalprecht.translate").filter("translate",translateFilterFactory);function translateFilterFactory($parse,$translate){"use strict";var translateFilter=function(translationId,interpolateParams,interpolation,forceLanguage){if(!angular.isObject(interpolateParams)){var ctx=this||{__SCOPE_IS_NOT_AVAILABLE:"More info at https://github.com/angular/angular.js/commit/8863b9d04c722b278fa93c5d66ad1e578ad6eb1f"};interpolateParams=$parse(interpolateParams)(ctx)}return $translate.instant(translationId,interpolateParams,interpolation,forceLanguage)};if($translate.statefulFilter()){translateFilter.$stateful=true}return translateFilter}translateFilterFactory.displayName="translateFilterFactory";angular.module("pascalprecht.translate").factory("$translationCache",$translationCache);function $translationCache($cacheFactory){"use strict";return $cacheFactory("translations")}$translationCache.displayName="$translationCache";return"pascalprecht.translate"});(function(){var app=angular.module("resortpro",["resortpro.services","resortpro.filters","resortpro.property","resortpro.checkout","ngMap","pascalprecht.translate","angularPayments"],function($interpolateProvider){$interpolateProvider.startSymbol("{[");$interpolateProvider.endSymbol("]}")});app.config(function($locationProvider){$locationProvider.html5Mode({enabled:true,requireBase:false,rewriteLinks:false})});app.run(function($rootScope){if($rootScope.enable_multilanguage==1){app.config(function($translateProvider){$translateProvider.useLoader("wpmlTranslationLoader");$translateProvider.useSanitizeValueStrategy("escape");$translateProvider.useMissingTranslationHandler("missingTranslationHandler")})}});angular.element(document).ready(function(){angular.bootstrap(document,["resortpro"])})})();(function(){var app=angular.module("resortpro.checkout",["resortpro.services","resortpro.filters","resortpro.directives","ngCookies"]);app.controller("CheckoutController",["$scope","$rootScope","$sce","$http","$window","$filter","$location","Alert","rpapi","rpuri","streamlineService","$cookies",function($scope,$rootScope,$sce,$http,$window,$filter,$location,Alert,rpapi,rpuri,streamlineService,$cookies){$scope.cookieCheckout={};$scope.cookieConfirmation={};$scope.checkout={};$scope.card={};$scope.error=false;$scope.startDate=$filter("date")(rpuri.getQueryStringParam("sd"),"MM/dd/yyyy");$scope.endDate=$filter("date")(rpuri.getQueryStringParam("ed"),"MM/dd/yyyy");$scope.unit=rpuri.getQueryStringParam("unit");$scope.occupants=rpuri.getQueryStringParam("oc");$scope.occupants_small=rpuri.getQueryStringParam("os");$scope.pets=rpuri.getQueryStringParam("pets");$scope.amenities=[];$scope.sidebarAmenities=[];$scope.hasAddOns=false;$scope.hasTravelInsurance=false;$scope.hasDamageProtection=false;$scope.upliftInsurance=0;$scope.haveInsORCfar=false;$scope.hasCfar=false;$scope.protectionError=false;$scope.confirmationId=0;$scope.referrer_url="";$scope.pbgEnabled=false;$scope.optionalItems="";$scope.enableUplift=false;$scope.showUpliftIframe=false;$scope.monthlyAmount="";$scope.loanConfirmed=false;$scope.showApprovedBtn=false;$scope.showBtnAgree=false;$scope.justTRI=0;$scope.hasBoth=0;$scope.justFees=0;$scope.showMonthlyPrice=true;$scope.showStartingFrom=true;$scope.secureForm=null;$scope.vgsInitialized=false;$scope.payFullSelected=true;$scope.lblPayMonthly="from";$scope.disableBtnAgree=false;$scope.paymentProcessed=false;$scope.payFullResPrice=false;$scope.CheckedTerms=false;$scope.securityDeposit=0;$scope.useStreamShare=0;$scope.aptexx_response=[];$scope.aptexx_gateway_id=0;var year=(new Date).getFullYear();var range=[];range.push(year);for(var i=1;i<10;i++){range.push(year+i)}$scope.years=range;$scope.stepOneDisabled=true;$scope.stepTwoDisabled=true;$scope.chkTravelInsurance=false;$scope.chkCfar=false;$scope.chkTravelInsuranceR={selectedOption:false};$scope.chkDamageWaiverR={selectedOption:false};$scope.chkCfarR={selectedOption:false};$scope.validateStepOne=function(checkout){if(checkout){if(checkout.fname&&checkout.lname&&checkout.email&&checkout.phone){$scope.stepOneDisabled=false}else{$scope.stepOneDisabled=true}}};$scope.currencyValue=function(value){if($rootScope.enable_multicurrency==1){return $filter("currencyTranslate")(value)}else{return $filter("currency")(value)}};$scope.createCheckoutCookie=function(){var now=new Date;now.setDate(now.getDate()+30);if($scope.checkout.fname){$scope.cookieCheckout["fname"]=$scope.checkout.fname}if($scope.checkout.lname){$scope.cookieCheckout["lname"]=$scope.checkout.lname}if($scope.checkout.email){$scope.cookieCheckout["email"]=$scope.checkout.email}if($scope.checkout.phone){$scope.cookieCheckout["phone"]=$scope.checkout.phone}var res=$cookies.putObject("streamline-checkout-cookie",$scope.cookieCheckout,{path:"/",expires:now,secure:"true"})};$scope.validateStepTwo=function(){var travelOk=true;var damageOk=true;if(($scope.hasTravelInsurance||$scope.hasCfar)&&!($scope.chkCfar||$scope.chkTravelInsurance||$scope.chkTravelInsuranceNo)){travelOk=false}if($scope.hasDamageProtection&&!($scope.chkDamageWaiver||$scope.chkDamageWaiverNo)){damageOk=false}if(travelOk&&damageOk){$scope.stepTwoDisabled=false}else{$scope.stepTwoDisabled=true}$scope.getPreReservation()};$scope.calculateMarkup=function(strPrice){var price=strPrice;if(typeof strPrice=="string"){price=parseFloat(strPrice.replace("$|,",""))}if($rootScope.rateMarkup>0){var pct=1+parseFloat($rootScope.rateMarkup)/100;price=price*pct}return price};$scope.toggleCfar=function(feeId){if($scope.chkCfarR.selectedOption){$scope.chkCfar=true;$scope.chkTravelInsuranceNo=false;$scope.chkTravelInsurance=false;$scope.chkTravelInsuranceR.selectedOption=false}else{$scope.chkCfar=false}setTimeout(function(){$scope.validateStepTwo()},100)};$scope.toggleTravelInsurance=function(feeId){if($scope.chkTravelInsuranceR.selectedOption){$scope.chkTravelInsurance=true;$scope.chkCfar=false;$scope.chkCfarR.selectedOption=false;$scope.chkTravelInsuranceNo=false}else{$scope.chkTravelInsurance=false}setTimeout(function(){$scope.validateStepTwo()},100)};$scope.acceptCfar=function(){if($scope.chkCfar){$scope.chkTravelInsurance=false;$scope.chkTravelInsuranceNo=false;$scope.chkCfarR.selectedOption=true;$scope.chkTravelInsuranceR.selectedOption=false}else{$scope.chkCfarR.selectedOption=false}setTimeout(function(){$scope.validateStepTwo()},100)};$scope.acceptTravelInsurance=function(){if($scope.chkTravelInsurance){$scope.chkCfar=false;$scope.chkTravelInsuranceNo=false;$scope.chkTravelInsuranceR.selectedOption=true;$scope.chkCfarR.selectedOption=false}else{$scope.chkTravelInsuranceR.selectedOption=false}setTimeout(function(){$scope.validateStepTwo()},100)};$scope.rejectTravelInsurance=function(){if($scope.chkTravelInsuranceNo){$scope.chkTravelInsurance=false;$scope.chkTravelInsuranceR.selectedOption=false;$scope.chkCfar=false;$scope.chkCfarR.selectedOption=false}setTimeout(function(){$scope.validateStepTwo()},100)};$scope.addToReservation=function(){jQuery(".addOn:checked").each(function(index){if(jQuery(this).prop("checked")){foundAddon=true;jQuery("#optional-fee-"+jQuery(this).val()).prop("checked",true);var qty=parseInt(jQuery("#qty-optional-fee-"+jQuery(this).val()).val());var addOn_Id=jQuery(this).val();if(!isNaN(qty)){jQuery("#label-qty-"+jQuery(this).val()).html(" x "+jQuery("#qty-optional-fee-"+jQuery(this).val()).val())}else{jQuery("#label-qty-"+jQuery(this).val()).html("")}angular.forEach($scope.amenityAddons,function(value,index){if(parseInt(addOn_Id)==value.amenity_id){$scope.amenityAddons[index].quantity=qty;$scope.amenityAddons[index].active=1}})}});if(foundAddon){$scope.getPreReservation();jQuery("#modalAmenities").modal("hide")}else{alert("You have not selected any add-ons.");return false}};$scope.toggleDamageWaiver=function(feeId){if($scope.chkDamageWaiverR.selectedOption){$scope.chkDamageWaiver=true;$scope.chkDamageWaiverNo=false}else{$scope.chkDamageWaiver=false}setTimeout(function(){$scope.validateStepTwo()},100)};$scope.acceptDamageWaiver=function(){if($scope.chkDamageWaiver){$scope.chkDamageWaiverNo=false;$scope.chkDamageWaiverR.selectedOption=true}else{$scope.chkDamageWaiverR.selectedOption=false}setTimeout(function(){$scope.validateStepTwo()},100)};$scope.rejectDamageWaiver=function(){if($scope.chkDamageWaiverNo){$scope.chkDamageWaiver=false;$scope.chkDamageWaiverR.selectedOption=false}setTimeout(function(){$scope.validateStepTwo()},100)};if($rootScope.checkoutSettings.useAddOns==0){jQuery(".optionalstep").hide()}$scope.goToStepOne=function(){jQuery("#step2").collapse("hide");jQuery("#step1").collapse("show");jQuery("#step2_1").collapse("hide");jQuery("#step3").collapse("hide")};$scope.checkSteptwo=function(){if($rootScope.checkoutSettings.checkout_layout==4){if($scope.hasCfar||$scope.hasTravelInsurance){$scope.goToStep2()}else if(!$scope.hasCfar&&!$scope.hasTravelInsurance&&$scope.reservationDetails.optional_fees.length>0&&($scope.hasDamageProtection||$rootScope.checkoutSettings.useAddOns==1)){$scope.goToStep2_1()}else{$scope.goToStep3()}}};$scope.goToStep2=function(isPbg){jQuery('.stepwizard a[href="#step-2"]').tab("show");jQuery('.stepwizard a[href="#step-3"]').tab("show");$scope.pbgEnabled=isPbg;$scope.createCheckoutCookie();if($scope.formStep1.$valid){setTimeout(function(){$scope.updateUplift()},200);if(jQuery(".chk2").length){if(typeof $scope.preOptionalFees.id!="undefined"){$scope.haveInsORCfar=true;if($scope.preOptionalFees.cfar==0)$scope.hasCfar=false;if($scope.preOptionalFees.travel_insurance==0)$scope.hasTravelInsurance=false}else{$scope.hasCfar=false;$scope.hasTravelInsurance=false;angular.forEach($scope.preOptionalFees,function(fee,i){if(typeof fee.name!="undefined"||(fee.name.indexOf("Insurance")>=0||fee.name.indexOf("Any Reason")>=0)){if(fee.name.indexOf("Any Reason")>=0){$scope.hasCfar=true}if(fee.name.indexOf("Insurance")>=0){$scope.hasTravelInsurance=true}if(fee.name.indexOf("Insurance")>=0){$scope.hasTravelInsurance=true}else{$scope.hasTravelInsurance=false}$scope.haveInsORCfar=true}else if(typeof fee.name=="undefined"){$scope.haveInsORCfar=false}else{$scope.haveInsORCfar=false}})}if($scope.haveInsORCfar==true||$rootScope.checkoutSettings.useAddOns==1){if(jQuery(".chk2").length&&($scope.hasTravelInsurance||$scope.hasCfar||$scope.hasDamageProtection)){$scope.goToStepTwo()}else{if($scope.haveInsORCfar==true&&$scope.hasTravelInsurance==false&&$scope.hasCfar==false&&$rootScope.checkoutSettings.useAddOns==0){$scope.goToStepThree(true)}else{$scope.goToStepHalfTwo()}}}else{$scope.goToStepThree(true)}}else{if($scope.reservationDetails.optional_fees.length>0){$scope.goToStepTwo()}else{$scope.goToStepThree(true)}}}};$scope.loadUplift=function(){if(typeof UpLift!=="undefined"){UpLift.Payments.init({apiKey:$rootScope.upliftApiKey,checkout:true,container:"#up-pay-monthly-container",onApproved:$scope.onApprovedHandler,onRejected:$scope.onRejectedHandler,onRejectedContinue:$scope.onRejectedContinueHandler,onConfirmUnready:$scope.onConfirmUnreadyHandler,onConfirmReady:$scope.onConfirmReadyHandler,onPaymentReady:$scope.onPaymentReadyHandler,onPaymentUnready:$scope.onPaymentUnreadyHandler,locale:"en-US",currency:"USD"});var tripInfo=$scope.getTripObject();UpLift.Payments.load(tripInfo,$scope.myPaymentsLoadCallback)}};$scope.pushConfirmationCode=function(confirmation_id){UpLift.Payments.init({apiKey:$rootScope.upliftApiKey,checkout:false,locale:"en-US",currency:"USD"});UpLift.Payments.orderConfirmation(confirmation_id)};$scope.updateUplift=function(){if(typeof UpLift!=="undefined"){var tripInfo=$scope.getTripObject();UpLift.Payments.update(tripInfo,$scope.myPaymentsUpdateCallback)}};$scope.goToStepTwo=function(){jQuery("#step2").collapse("show");jQuery("#step1").collapse("hide");jQuery("#step2_1").collapse("hide");jQuery("#step3").collapse("hide");if($scope.amenities.length>0&&$rootScope.checkoutSettings.useAddOns==1&&$rootScope.checkoutSettings.AddOnsPopup==1){jQuery("#modalAmenities").modal()}return false};$scope.goToStepHalfTwo=function(){if($rootScope.checkoutSettings.useAddOns==1){jQuery("#step2").collapse("hide");jQuery("#step1").collapse("hide");jQuery("#step2_1").collapse("show");jQuery("#step3").collapse("hide")}else{jQuery("#step2").collapse("show");jQuery("#step1").collapse("hide");jQuery("#step2_1").collapse("show");jQuery("#step3").collapse("hide")}return false};$scope.goToStep2_1=function(){if($rootScope.checkoutSettings.checkout_layout==4){$scope.stepTwoDisabled=false}if($rootScope.checkoutSettings.useAddOns==0){if(!$scope.stepTwoDisabled){$scope.protectionError=false;$scope.goToStepThree($scope.chkDamageWaiverNo);if($scope.pbgEnabled){PBG.onReady()}}else{$scope.protectionError=true}}if(!$scope.stepTwoDisabled){$scope.protectionError=false;$scope.goToStepHalfTwo($scope.chkDamageWaiverNo);if($scope.pbgEnabled){PBG.onReady()}}else{$scope.protectionError=true}};$scope.add_ons_reservation=function(){jQuery(".addOn").each(function(index){if(jQuery(this).prop("checked")){jQuery("#optional-fee-"+jQuery(this).val()).prop("checked",true);var qty=parseInt(jQuery("#qty-optional-fee-"+jQuery(this).val()).val());if(!isNaN(qty)){jQuery("#label-qty-"+jQuery(this).val()).html(" x "+jQuery("#qty-optional-fee-"+jQuery(this).val()).val())}else{jQuery("#label-qty-"+jQuery(this).val()).html("")}}else{jQuery("#optional-fee-"+jQuery(this).val()).prop("checked",false);jQuery("#label-qty-"+jQuery(this).val()).html("")}});$scope.getPreReservation()};$scope.goToStep3=function(){if(!$scope.stepTwoDisabled){$scope.protectionError=false;$scope.goToStepThree($scope.chkDamageWaiverNo);jQuery("#st3").show();if($scope.pbgEnabled){PBG.onReady()}}else{$scope.protectionError=true}};$scope.initFields=function(){var vault=$rootScope.checkoutSettings.vgsVault;$scope.secureForm=VGSCollect.create(vault,"live",function(state){});var field=$scope.secureForm.field("#cc-name .fake-input",{type:"text",name:"params.credit_card_holder",color:"333333",placeholder:"",validations:["required"],errorMessages:[""],autoComplete:"cc-name"});$scope.secureForm.field("#cc-number .fake-input",{type:"card-number",name:"params.credit_card_number",successColor:"green",errorColor:"red",placeholder:"",autoComplete:"cc-number",validations:["required","validCardNumber"]});$scope.secureForm.field("#cc-cvc .fake-input",{type:"card-security-code",name:"params.credit_card_cid",placeholder:"",autoComplete:"cc-csc",validations:["required","validCardSecurityCode"]});$scope.secureForm.field("#cc-expiration-date .fake-input",{type:"card-expiration-date",name:"params.credit_card_expiration_month_year",placeholder:"mm/yyyy",autoComplete:"cc-exp",validations:["required","validCardExpirationDate"]})};$scope.stringToHash=function(string){var hash=0;if(!string)string="";if(string.length==0)return hash;for(i=0;i<string.length;i++){char=string.charCodeAt(i);hash=(hash<<5)-hash+char;hash=hash&hash}return hash};$scope.initLynbrook=function(){run_waitMe("#step3","bounce","Initialize fields");var integrationId=Math.abs($scope.stringToHash($scope.checkout.email));var data={targetId:$rootScope.checkoutSettings.lynbrook_target_id,accountNumber:1,integrationId:integrationId,firstName:$scope.checkout.fname,lastName:$scope.checkout.lname,email:$scope.checkout.email,countryCode:"1",phone:$scope.checkout.phone,successUrl:"https://example.com/payment/success/",cancelUrl:"https://example.com/payment/cancel/"};if(typeof $scope.hash_res!="undefined"){integrationId=Math.abs($scope.stringToHash($scope.hash_res.email));data["firstName"]=$scope.hash_res.first_name;data["lastName"]=$scope.hash_res.last_name;data["email"]=$scope.hash_res.email;data["phone"]=$scope.hash_res.phone;data["integrationId"]=integrationId}jQuery.ajax({method:"POST",url:$rootScope.checkoutSettings.lynbrook_createaccountperson,data:data}).then(function successCallback(response){if(response){$scope.aptexx_account_person_id=response.accountPersonId;$scope.initLynbrookHostedFields()}else{alert("something is bad 2")}},function errorCallback(response){Alert.add(Alert.errorType,"Cant send request")})};$scope.initLynbrookHostedFields=function(){jQuery("#card-name iframe").remove();jQuery("#card-number iframe").remove();jQuery("#cc-expiration-date iframe").remove();jQuery("#cc-zip-code iframe").remove();var response_data={targetId:$rootScope.checkoutSettings.lynbrook_target_id,accountPersonId:$scope.aptexx_account_person_id,mobileApp:false};jQuery.ajax({method:"POST",url:$rootScope.checkoutSettings.lynbrook_createasessionid,data:response_data}).then(function successCallback(response){if(response){var config={sessionId:response.sessionId,production:true,callback:$scope.AptexCallback,testEnv:false,domain:$rootScope.checkoutSettings.aptexx_domain,fields:[{type:"CARD_NAME",id:"card-name",style:"border:solid 1px #ccc; line-height:1.42857143; padding: 6px 12px; border-radius: 4px",placeholder:"Card Name"},{type:"CARD_NUMBER",id:"card-number",style:"border:solid 1px #ccc; line-height:1.42857143; padding: 6px 12px; border-radius: 4px"},{type:"EXPIRATION_DATE",id:"expiration-date",style:"border:solid 1px #ccc; line-height:1.42857143; padding: 6px 12px; border-radius: 4px"},{type:"ZIP_CODE",id:"zip-code",style:"border:solid 1px #ccc; line-height:1.42857143; padding: 6px 12px; border-radius: 4px",placeholder:"Zip Code"}]};aptxFields.setup(config);hide_waitMe("#step3")}else{Alert.add(Alert.errorType,"Cant send request")}},function errorCallback(response){Alert.add(Alert.errorType,"Cant send request")})};$scope.updateLynbrookHostedFields=function(){var response_data={targetId:$rootScope.checkoutSettings.lynbrook_target_id,accountPersonId:$scope.aptexx_account_person_id,mobileApp:false};jQuery.ajax({method:"POST",url:$rootScope.checkoutSettings.lynbrook_createasessionid,data:response_data}).then(function successCallback(response){if(response){aptxFields.updateSessionId(response.sessionId);hide_waitMe("#step3")}else{Alert.add(Alert.errorType,"Cant send request")}},function errorCallback(response){Alert.add(Alert.errorType,"Cant send request")})};jQuery("header").mouseenter(function(event){if(jQuery("#cartAbandomentPopup").length>0&&jQuery("#cartAbandomentPopup").attr("data-shown")==="false"){jQuery("#cartAbandomentPopup").modal({show:true,backdrop:"static"});jQuery("#cartAbandomentPopup").attr("data-shown","true")}jQuery("#cartAbandomentPopup .close,#cartAbandomentPopup .btn-secondary").click(function(){jQuery("#cartAbandomentPopup").attr("data-shown","false")})});document.body.addEventListener("mouseleave",function(event){if(event.clientY<=0||event.clientX<=0||(event.pageX>=window.innerWidth||event.pageY>=window.innerHeight)){if(jQuery("#cartAbandomentPopup").length>0&&jQuery("#cartAbandomentPopup").attr("data-shown")==="false"){jQuery("#cartAbandomentPopup").modal({show:true,backdrop:"static"});jQuery("#cartAbandomentPopup").attr("data-shown","true")}jQuery("#cartAbandomentPopup .close,#cartAbandomentPopup .btn-secondary").click(function(){jQuery("#cartAbandomentPopup").attr("data-shown","false")})}});$scope.createLeads=function(){if(!$scope.hash&&$rootScope.checkoutSettings&&$rootScope.checkoutSettings.createLeads==1&&!($scope.confirmationId>0)){run_waitMe("#cartAbandomentPopup");var params={not_blocked_request:"yes",startdate:$scope.startDate,enddate:$scope.endDate,occupants:$scope.occupants,occupants_small:$scope.occupants_small,first_name:$scope.checkout.fname,last_name:$scope.checkout.lname,email:$scope.checkout.email,mobile_phone:$scope.checkout.phone,pets:$scope.pets,disable_minimal_days:"yes"};if($scope.checkout&&$scope.checkout.promo_code!=""){params["coupon_code"]=$scope.checkout.promo_code}var rate_type_name=$cookies.get("streamline-rate_type");if($rootScope.bookingSettings.enable_rates_pw==1&&typeof rate_type_name!="undefined"){params["rate_type_name"]=rate_type_name}if($rootScope.bookingSettings&&$rootScope.bookingSettings.hearedAboutId>0&&!$scope.hash)params["hear_about_id"]=$rootScope.bookingSettings.hearedAboutId;if($rootScope.bookingSettings&&$rootScope.bookingSettings.abandoned_heard_about>0)params["hear_about_id"]=$rootScope.bookingSettings.abandoned_heard_about;if($scope.referrer_url!="")params["referrer_url"]=$scope.referrer_url;if($rootScope.roomTypeLogic==1){params["use_room_type_logic"]=1;params["condo_type_id"]=$scope.checkout.condo_type_id;params["location_id"]=$scope.checkout.location_id}else{params["unit_id"]=$scope.unit}params["flags"]={flag_id:[2027,39]};if($scope.advanced_reservations){var advanceDate=new Date($scope.advanced_reservations_date);var checkinDate=new Date($scope.startDate);if(checkinDate>=advanceDate&&$rootScope.enableAdvancedRes==1){params["type_id"]=428}}if($scope.checkout.email){rpapi.getWithParams("MakeReservation",params).success(function(obj){if(obj.status){Alert.add(Alert.errorType,obj.status.description)}else{$scope.confirmationId=obj.data.reservation.confirmation_id;var checkout_url=window.location.search;$scope.cookieConfirmation["confirmation_id"]=obj.data.reservation.confirmation_id;$scope.cookieConfirmation["seo_page_name"]=$scope.seo_page_name;$scope.cookieConfirmation["checkout_url"]=$scope.referrer_url+checkout_url;var now=new Date;now.setDate(now.getDate()+10);conf_cookie=$cookies.putObject("streamline-confirmation-cookie",$scope.cookieConfirmation,{path:"/",expires:now,secure:"true"});jQuery("#cartAbandomentPopup").modal("hide")}jQuery("#cartAbandomentPopup").attr("data-shown",true);hide_waitMe("#cartAbandomentPopup")})}else{jQuery("#cartAbandomentPopup").modal("hide");jQuery("#cartAbandomentPopup").attr("data-shown",true);hide_waitMe("#cartAbandomentPopup")}}else{jQuery("#cartAbandomentPopup").modal("hide");var params={not_blocked_request:"yes",startdate:$scope.startDate,enddate:$scope.endDate,occupants:$scope.occupants,occupants_small:$scope.occupants_small,first_name:$scope.checkout.fname,last_name:$scope.checkout.lname,email:$scope.checkout.email,mobile_phone:$scope.checkout.phone,pets:$scope.pets,disable_minimal_days:"yes"};if($scope.referrer_url!=""){params["referrer_url"]=$scope.referrer_url}var checkout_url=window.location.search;$scope.cookieConfirmation["confirmation_id"]=$scope.reservationDetails.reservation_id;$scope.cookieConfirmation["seo_page_name"]=$scope.seo_page_name;$scope.cookieConfirmation["checkout_url"]=$scope.referrer_url+checkout_url;var now=new Date;now.setDate(now.getDate()+10);conf_cookie=$cookies.putObject("streamline-confirmation-cookie",$scope.cookieConfirmation,{path:"/",expires:now,secure:"true"})}};$scope.goToStepThree=function(damageWaiverNo){$scope.chkDamageWaiverNo=damageWaiverNo;jQuery("#step3").collapse("show");jQuery("#step2").collapse("hide");jQuery("#step2_1").collapse("hide");jQuery("#step1").collapse("hide");if($rootScope.checkoutSettings.enable_lynbrook==1&&$scope.aptexx_gateway_id!=0){$scope.initLynbrook()}if(!$scope.vgsInitialized&&$rootScope.checkoutSettings.enableVGSProxy===1&&($rootScope.checkoutSettings.enable_lynbrook==0||$scope.aptexx_gateway_id==0)){$scope.initFields();$scope.vgsInitialized=true}if(!$scope.payFullSelected){UpLift.Payments.select()}else{jQuery("#pay_full").focus()}};$scope.togglePayments=function(){if($scope.checkout.card_type==5){$scope.vgsInitialized=false}if($scope.checkout.card_type<5&&!$scope.vgsInitialized&&$rootScope.checkoutSettings.enableVGSProxy===1&&($rootScope.checkoutSettings.enable_lynbrook==0||$scope.aptexx_gateway_id==0)){setTimeout(function(){$scope.initFields();$scope.vgsInitialized=true},100)}};$scope.validateStep3ReCaptcha=function(checkout){if($rootScope.checkoutSettings.enable_grecaptcha){run_waitMe("#step3","bounce","Processing your request");var response=grecaptcha.getResponse();if($scope.isString(response)){params={response:response};rpapi.gReCaptcha(params).success(function(response){if(response.success){$scope.validateStep3(checkout)}})}hide_waitMe("#step3")}};$scope.validateStep3=function(checkout){if($scope.formStep3.$valid){$scope.CheckedTerms=true;if(!$scope.hash&&($rootScope.checkoutSettings&&$rootScope.checkoutSettings.createLeads==1||$rootScope.bookingSettings&&$rootScope.bookingSettings.nonBlockedRequest==1)&&$scope.confirmationId>0){run_waitMe("#step3","bounce","Processing your request");var flagparams={flags:{flag:{confirmation_id:$scope.confirmationId,flag_id:39,active:false}}};rpapi.getWithParams("SetReservationFlags",flagparams).success(function(){hide_waitMe("#step3");var now=new Date;now.setDate(now.getDate()-10);$cookies.putObject("streamline-confirmation-cookie",null,{path:"/",expires:now,secure:"true"});$cookies.remove("streamline-confirmation-cookie");$scope.processCheckout(checkout)})}else{if($rootScope.checkoutSettings.enable_lynbrook==1&&$scope.aptexx_gateway_id!=0&&checkout.card_type<5){aptxFields.submit("CARD");run_waitMe("#step3","bounce","Processing Request...");setTimeout(function(){hide_waitMe("#step3");$scope.processCheckout(checkout)},3500)}else{$scope.processCheckout(checkout)}}}};$scope.AptexCallback=function(response){$scope.aptexx_response=response};$scope.validateInsurancePayment=function(checkout){var params=[];if($scope.formStep3.$valid){run_waitMe(".add-payment-body","bounce","Processing your request");params={confirmation_id:checkout.confirmation_id,startdate:$scope.reservationDetails.startdate,enddate:$scope.reservationDetails.enddate,occupants:$scope.reservationDetails.occupants,unit_id:$scope.reservationDetails.unit_id,first_name:$scope.insurance_res_data.first_name,last_name:$scope.insurance_res_data.last_name,occupants_small:$scope.reservationDetails.occupants_small,email:$scope.insurance_res_data.email,phone:$scope.insurance_res_data.phone,mobile_phone:$scope.insurance_res_data.mobile_phone,address:$scope.insurance_res_data.address,city:$scope.insurance_res_data.city,zip:$scope.insurance_res_data.zip,state_name:$scope.insurance_res_data.state_name,country_name:$scope.insurance_res_data.country_name,disable_payments:1};var amenity_addons=[];jQuery(".optional_fee:checked").each(function(index){if(jQuery(this).prop("checked")){if(typeof jQuery(this).data("price")!="undefined"){params["optional_fee_"+jQuery(this).val()]=1;var amenity_addon={amenity_id:jQuery(this).val(),amenity_cost:jQuery(this).data("price")};amenity_addons.push(amenity_addon)}}});params["confirmation_id"]=checkout.confirmation_id;params["startdate"]=$scope.reservationDetails.startdate;params["enddate"]=$scope.reservationDetails.enddate;params["occupants"]=$scope.reservationDetails.occupants;params["unit_id"]=$scope.reservationDetails.unit_id;params["first_name"]=$scope.reservationDetails.first_name;params["last_name"]=$scope.reservationDetails.last_name;params["occupants_small"]=$scope.reservationDetails.occupants_small;params["email"]=$scope.reservationDetails.email;params["phone"]=$scope.reservationDetails.phone;params["mobile_phone"]=$scope.reservationDetails.mobile_phone;params["address"]=$scope.insurance_res_data.address;params["city"]=$scope.insurance_res_data.city;params["zip"]=$scope.insurance_res_data.zip;params["state_name"]=$scope.insurance_res_data.state_name;params["country_name"]=$scope.insurance_res_data.country_name;params["disable_payments"]=1;if(checkout.card_type<5){if($rootScope.checkoutSettings.enableVGSProxy!==1){var exp_month,exp_year;if(checkout.expiration_date){var exp_date=checkout.expiration_date.split("/");exp_month=exp_date[0];exp_year=exp_date[1]}else{exp_month=checkout.expire_month;exp_year=checkout.expire_year}params["credit_card_type_id"]=checkout.card_type;params["credit_card_number"]=checkout.card_number;params["credit_card_expiration_month"]=exp_month;params["credit_card_expiration_year"]=exp_year;params["credit_card_cid"]=checkout.card_cvv}}else{params["payment_type_id"]=33;params["bank_account_number"]=checkout.bank_account_number;params["bank_routing_number"]=checkout.bank_routing_number;params["bank_account_holder_name"]=checkout.bank_account_holder_name}run_waitMe(".add-payment-body","bounce","Processing your payment");if($rootScope.checkoutSettings.enableVGSProxy&&checkout.card_type<5){params["company_code"]=$rootScope.checkoutSettings.vgsToken;var request={methodName:"MakeReservation",params:params};$scope.secureForm.submit("/api/json",{serializer:"deep",data:request,mapDotToObject:"merge",headers:{"Content-Type":"application/json"}},function(status,response){if(status!==200){console.log(status,data)}else{document.getElementById("response").innerText=JSON.stringify(data.json,null,4)}hide_waitMe(".add-payment-body");$scope.$apply(function(){$scope.paymentProcessed=true;Alert.clear();if(response.data){if(response.data.payment_applied==1){$scope.paymentComplete=true;Alert.add(Alert.successType,"Insurance has been successfully bought!")}else{Alert.add(Alert.infoType,response.data.message)}}else{if(response.status&&response.status.description){Alert.add(Alert.errorType,response.status.description)}else{Alert.add(Alert.errorType,"Unknown error ocurred.")}}})},function(errors){hide_waitMe("#step3");Alert.clear();Alert.add(Alert.errorType,"Invalid Credit Card Information provided, Please Review All Payment Information.")})}else{rpapi.getWithParams("MakeReservation",params).success(function(response){hide_waitMe(".add-payment-body");Alert.clear();$scope.paymentProcessed=true;if(response.data){if(response.data.payment_applied==1){$scope.paymentComplete=true;Alert.add(Alert.successType,"Insurance has been successfully bought!")}else{Alert.add(Alert.infoType,"Insurance has been successfully bought!")}}else{if(response.status&&response.status.description){Alert.add(Alert.errorType,response.status.description)}else{Alert.add(Alert.errorType,"Unknown error ocurred.")}}}).error(function(err){hide_waitMe("#step3");$scope.paymentProcessed=true;Alert.add(Alert.errorType,err)})}}};$scope.validatePaymentForm=function(checkout){if($scope.formStep3.$valid){if(parseFloat($scope.Total+$scope.securityDeposit)<parseFloat($scope.checkout.payment_amount)){Alert.add(Alert.infoType,"Please enter payment amount lower than the price balance");return false}run_waitMe(".add-payment-body","bounce","Processing your request");jQuery(document).find("#btn-checkout").attr("disabled","disabled");var params={first_name:checkout.fname,last_name:checkout.lname,email:checkout.email,phone:checkout.phone,address:checkout.address,address2:checkout.address2,city:checkout.city,state_name:checkout.state,country_name:checkout.country,confirmation_id:checkout.confirmation_id,payment_amount:checkout.payment_amount,payment_type_id:1};if($rootScope.checkoutSettings.enable_lynbrook==0){params["zip"]=checkout.postal_code}if($rootScope.checkoutSettings.enable_lynbrook==1&&$scope.aptexx_gateway_id!=0&&checkout.card_type<5){aptxFields.submit("CARD")}if(checkout.card_type<5&&($rootScope.checkoutSettings.enable_lynbrook==0||$scope.aptexx_gateway_id==0)){if($rootScope.checkoutSettings.enableVGSProxy!==1){var exp_month,exp_year;if(checkout.expiration_date){var exp_date=checkout.expiration_date.split("/");exp_month=exp_date[0];exp_year=exp_date[1]}else{exp_month=checkout.expire_month;exp_year=checkout.expire_year}params["credit_card_type_id"]=checkout.card_type;params["credit_card_number"]=checkout.card_number;params["credit_card_expiration_month"]=exp_month;params["credit_card_expiration_year"]=exp_year;params["credit_card_cid"]=checkout.card_cvv}}else if(checkout.card_type>=5&&($rootScope.checkoutSettings.enable_lynbrook==0||$scope.aptexx_gateway_id==0)){params["payment_type_id"]=33;params["bank_account_number"]=checkout.bank_account_number;params["bank_routing_number"]=checkout.bank_routing_number;params["bank_account_holder_name"]=checkout.bank_account_holder_name}run_waitMe(".add-payment-body","bounce","Processing your payment");if($rootScope.checkoutSettings.enableVGSProxy&&checkout.card_type<5&&($rootScope.checkoutSettings.enable_lynbrook==0||$scope.aptexx_gateway_id==0)){var request={methodName:"GetVGSToken",params:params};$scope.secureForm.submit("/api/json/",{serializer:"deep",data:request,mapDotToObject:"merge",headers:{"Content-Type":"application/json"}},function(status,response){var dates=response.data.credit_card_expiration_date.split("/");var month=dates[0];var year=dates[1];params["credit_card_number"]=response.data.credit_card_number;params["credit_card_expiration_month"]=month;params["credit_card_expiration_year"]=year;params["credit_card_cid"]=response.data.credit_card_cid;params["credit_card_holder"]=response.data.credit_card_holder;params["enable_vgs_alias"]=1;rpapi.getWithParams("AddReservationPayment",params).success(function(response){hide_waitMe(".add-payment-body");jQuery(document).find("#btn-checkout").removeAttr("disabled");Alert.clear();$scope.paymentProcessed=true;if(response.data){if(response.data.payment_applied==1){$scope.paymentComplete=true;if($rootScope.checkoutSettings.paymentRedirect==0){Alert.add(Alert.successType,response.data.message)}else{$scope.reservationDetails["payment_amount"]=params.payment_amount;$scope.reservationDetails["confirmation_id"]=params.confirmation_id;$scope.submitForm($scope.reservationDetails)}}else{Alert.add(Alert.infoType,response.data.message)}}else{if(response.status&&response.status.description){Alert.add(Alert.errorType,response.status.description)}else{Alert.add(Alert.errorType,"Unknown error ocurred.")}}}).error(function(err){hide_waitMe("#step3");$scope.paymentProcessed=true;Alert.add(Alert.errorType,err)})})}else if(($rootScope.checkoutSettings.enableVGSProxy==0||$scope.aptexx_gateway_id!=0)&&checkout.card_type<5&&$rootScope.checkoutSettings.enable_lynbrook==1&&$scope.aptexx_gateway_id!=0){setTimeout(function(){var success_aptxx=[];if($scope.aptexx_response.length>0){var success_aptxx=JSON.parse($scope.aptexx_response.trim())}if(success_aptxx.errors&&success_aptxx.errors.length>0){if(success_aptxx.errors[0].type=="POSSIBLE_DUPLICATE"){angular.forEach(success_aptxx.duplicateCardMethods,function(method,key){success_aptxx.methodId=method.methodId;success_aptxx.brandType=method.brand;success_aptxx.channelType=method.type;success_aptxx.lastFour=method.lastFour;success_aptxx.expiresOn=method.expiresOn;params["do_not_verify_zip_code"]=1;params["zip"]=method.methodId})}}if(typeof success_aptxx.methodId!="undefined"){var credit_card_expiration_month_year="";if(typeof success_aptxx.expiresOn!="undefined"){credit_card_expiration_month_year=success_aptxx.expiresOn.split("-");credit_card_expiration_month_year=credit_card_expiration_month_year[1]+"/"+credit_card_expiration_month_year[0]}params["aptxx_method_id"]=success_aptxx.methodId;params["aptxx_account_person_id"]=$scope.aptexx_account_person_id;if($scope.aptexx_gateway_id>0){params["aptxx_target_id"]=$scope.aptexx_gateway_id}params["credit_card_brand"]=success_aptxx.brandType;params["credit_card_type"]=success_aptxx.channelType;params["credit_card_last_four"]=success_aptxx.lastFour;params["credit_card_expiration_month_year"]=credit_card_expiration_month_year;if(success_aptxx.zipCode)params["zip"]=success_aptxx.zipCode;params["hash"]=$scope.hash;rpapi.getWithParams("AddReservationPayment",params).success(function(response){hide_waitMe(".add-payment-body");jQuery(document).find("#btn-checkout").removeAttr("disabled");Alert.clear();$scope.paymentProcessed=true;if(response.data){if(response.data.payment_applied==1){$scope.paymentComplete=true;if($rootScope.checkoutSettings.paymentRedirect==0){Alert.add(Alert.successType,response.data.message)}else{$scope.reservationDetails["payment_amount"]=params.payment_amount;$scope.reservationDetails["confirmation_id"]=params.confirmation_id;$scope.submitForm($scope.reservationDetails)}}else{$scope.updateLynbrookHostedFields();Alert.add(Alert.infoType,response.data.message)}}else{$scope.updateLynbrookHostedFields();if(response.status&&response.status.description){Alert.add(Alert.errorType,response.status.description)}else{Alert.add(Alert.errorType,"Unknown error ocurred.")}}}).error(function(err){Alert.clear();hide_waitMe(".add-payment-body");jQuery(document).find("#btn-checkout").removeAttr("disabled");$scope.updateLynbrookHostedFields();$scope.paymentProcessed=false;Alert.add(Alert.errorType,err)})}else{hide_waitMe(".add-payment-body");jQuery(document).find("#btn-checkout").removeAttr("disabled");$scope.$apply(function(){Alert.clear();angular.forEach(success_aptxx.errors,function(error,key){if(error.type=="SESSION_EXPIRED"||error.type=="SESSION_INVALID"||error.type=="SESSION_USED"||error.type=="SERVICE_API_NOT_AUTHENTICATED"){Alert.add(Alert.errorType,"An error occurred processing your request, please review the information and try again");$scope.updateLynbrookHostedFields()}else{var error=error.type;if(error=="INVALID"||error=="METHOD_ERROR"||error=="POSSIBLE_DUPLICATE")error="Credit card information provided cannot be verified, please review the credit card information and try again";Alert.add(Alert.errorType,error)}})})}},3500)}else{rpapi.getWithParams("AddReservationPayment",params).success(function(response){hide_waitMe(".add-payment-body");jQuery(document).find("#btn-checkout").removeAttr("disabled");Alert.clear();$scope.paymentProcessed=true;if(response.data){if(response.data.payment_applied==1){$scope.paymentComplete=true;if($rootScope.checkoutSettings.paymentRedirect==0){Alert.add(Alert.successType,response.data.message)}else{$scope.reservationDetails["payment_amount"]=params.payment_amount;$scope.reservationDetails["confirmation_id"]=params.confirmation_id;$scope.submitForm($scope.reservationDetails)}}else{hide_waitMe("#step3");Alert.add(Alert.infoType,response.data.message)}}else{hide_waitMe("#step3");if(response.status&&response.status.description){Alert.add(Alert.errorType,response.status.description)}else{Alert.add(Alert.errorType,"Unknown error ocurred.")}}}).error(function(err){hide_waitMe("#step3");$scope.paymentProcessed=true;Alert.add(Alert.errorType,err)})}}};$scope.initInsurancePayment=function(){$scope.hasTravelInsurance=true;$scope.hasDamageProtection=true;$scope.chkCfar=true;$scope.hasCfar=true};$scope.initCheckout=function(){var security_params=$cookies.getObject("streamline-checkout-params");if(typeof security_params!="undefined"&&security_params.repeats>=3){window.location.href="/security-check/"}if($rootScope.checkoutSettings.checkout_layout==4){$scope.getPropertyInfo()}if($scope.hash){var params={hash:$scope.hash,return_payments:"yes",updated_expected_charges:1,include_coupon_information:1,include_grandtotal_cost:1,include_grandtotal_cost_with_guest_deposits:1,check_rg_eligibility:1,guest_description:1};if($rootScope.checkoutSettings.rentalGuardianRestrictions==1){params["check_insurance_eligibility"]=1}if($scope.advanced_reservations){var advanceDate=new Date($scope.advanced_reservations_date);var checkinDate=new Date($scope.startDate);if(checkinDate>=advanceDate&&$rootScope.enableAdvancedRes==1){params["type_id"]=428}}if(!$scope.isCheckout){params.show_security_deposit_information="yes"}if($rootScope.separate_taxes_and_feed==1){params["separate_taxes"]=1}run_waitMe(".form-checkout-wrapper","bounce","Updating Information...");rpapi.getWithParams("GetReservationPrice",params).success(function(obj){hide_waitMe(".form-checkout-wrapper");var res_price=obj.data;$scope.unit=res_price.unit_id;if($scope.startDate==""||$scope.startDate==undefined){$scope.startDate=res_price.startdate}if($scope.endDate==""||$scope.endDate==undefined){$scope.endDate=res_price.enddate}if($scope.occupants==""||$scope.occupants==undefined){$scope.occupants=res_price.occupants}if($scope.occupants_small==""||$scope.occupants_small==undefined){$scope.occupants_small=res_price.occupants_small}if($scope.pets==""||$scope.pets==undefined){$scope.pets=res_price.pets}$scope.reservationDetails=res_price;$scope.reservationDetails.location_name=res_price.unit_name;if(parseInt($rootScope.roomTypeLogic)==1){$scope.unit_name=res_price.condo_type_name}if(res_price.optional_fees.id){resultData=[];resultData.push(res_price.optional_fees);res_price.optional_fees=resultData}if(res_price.expected_charges&&res_price.expected_charges.type_id){resultData=[];resultData.push(res_price.expected_charges);res_price.expected_charges=resultData}if(res_price.security_deposits&&res_price.security_deposits.security_deposit.ledger_id){resultData=[];resultData.push(res_price.security_deposits.security_deposit);res_price.security_deposits.security_deposit=resultData}$scope.isDepositRequired=false;angular.forEach(res_price.security_deposits.security_deposit,function(value,key){if(value.deposit_required>0){$scope.isDepositRequired=true}});if($rootScope.checkoutSettings.useAddOns==1){$scope.initAddonsWeb()}if($rootScope.checkoutSettings.groupExpectedCharges===1&&obj.data.expected_charges.length>1){var grouped_charges=[];angular.forEach(obj.data.expected_charges,function(charge,i){var found_charge=false;angular.forEach(grouped_charges,function(grouped_charge,i){if(grouped_charge.charge_date==charge.charge_date){found_charge=true;grouped_charge.charge_value+=charge.charge_value;grouped_charge.description="Payment Schedule"}});if(!found_charge){grouped_charges.push(charge)}});obj.data.expected_charges=grouped_charges}var arr_amenities=[];if(res_price.optional_fees.length>0){angular.forEach(res_price.optional_fees,function(optional_fee,i){if(optional_fee.travel_insurance==0&&optional_fee.cfar==0&&optional_fee.damage_waiver==0){arr_amenities.push({amenity_cost:optional_fee.value,amenity_id:optional_fee.id,amenity_thumbnail:null,amenity_name:optional_fee.name,packages:optional_fee.packages,amenity_description:optional_fee.description,damage_waiver:optional_fee.damage_waiver,travel_insurance:optional_fee.travel_insurance,cfar:optional_fee.cfar,active:optional_fee.active,value:optional_fee.value})}})}if($scope.amenities.length==0){$scope.amenities=arr_amenities;$scope.sidebarAmenities=arr_amenities}if(res_price.required_fees.id){resultData=[];resultData.push(res_price.required_fees);res_price.required_fees=resultData}if(res_price.taxes_details.id){resultData=[];resultData.push(res_price.taxes_details);res_price.taxes_details=resultData}if(res_price.security_deposits&&res_price.security_deposits.security_deposit.ledger_id){resultData=[];resultData.push(res_price.security_deposits.security_deposit);res_price.security_deposits.security_deposit=resultData;$scope.chkDamageWaiverNo=true}var total_taxes=0;angular.forEach(res_price.taxes_details,function(value,key){total_taxes+=value.value});angular.forEach(res_price.required_fees,function(value,key){total_taxes+=value.value});angular.forEach(res_price.optional_fees,function(value,key){if(value.damage_waiver==1){$scope.hasDamageProtection=true;$scope.damageProtection=value.value}if(value.travel_insurance==1){$scope.hasTravelInsurance=true;$scope.travelInsurance=value.value}if(value.cfar==1){$scope.hasCfar=true;$scope.cfar=value.value}if(!$scope.hasDamageProtection&&!$scope.hasTravelInsurance){$scope.stepTwoDisabled=false}});$scope.subTotal=$scope.calculateMarkup((obj.data.price+obj.data.coupon_discount).toString());var dif=$scope.subTotal-obj.data.coupon_discount-obj.data.price;if($rootScope.separate_taxes_and_feed==1){$scope.taxes=obj.data.taxes_details_value;$scope.fees=obj.data.required_fees_value}else{$scope.taxesAndFees=total_taxes-dif}if(!$scope.isCheckout){params["include_security_deposit"]=1}if(res_price.reservation_id){rpapi.getWithParams("GetReservationInfo",params).success(function(obj){$scope.hash_res=obj.data.reservation;if(!$scope.isCheckout&&$rootScope.checkoutSettings.enable_lynbrook==1&&$scope.aptexx_gateway_id!=0){$scope.initLynbrook()}if(!$scope.vgsInitialized&&$rootScope.checkoutSettings.enableVGSProxy===1&&($rootScope.checkoutSettings.enable_lynbrook==0||$scope.aptexx_gateway_id==0)){$scope.initFields();$scope.vgsInitialized=true}var res_info=obj.data.reservation;var params={startdate:res_price.startdate,enddate:res_price.enddate,occupants:res_price.occupants,use_room_type_logic:parseInt($rootScope.roomTypeLogic),page_number:1,page_results_number:1e3,disable_minimal_days:"yes"};if(parseInt($rootScope.roomTypeLogic)!=1){params["unit_id"]=res_price.unit_id}else{params["condo_type_id"]=res_info.condo_type_id;params["location_id"]=res_info.location_id}if($scope.advanced_reservations){var advanceDate=new Date($scope.advanced_reservations_date);var checkinDate=new Date($scope.startDate);if(checkinDate>=advanceDate&&$rootScope.enableAdvancedRes==1){params["type_id"]=428}}rpapi.getWithParams("GetPropertyAvailability",params).success(function(obj){if(obj.status){$scope.error=true;$scope.errorMessage=obj.status.description;return false}else{var result=obj.data.available_properties;if(result.pagination.total_units==0){$scope.error=true;$scope.errorMessage="Sorry, this property is not available during the selected dates.";return false}}}).error(function(){$scope.error=true;$scope.errorMessage=Alert.errorMessage;return false});$scope.checkout={confirmation_id:res_info.confirmation_id,fname:res_info.first_name,lname:res_info.last_name,email:res_info.email,phone:$scope.isEmptyObject(res_info.phone)?"":res_info.phone,unit:res_info.unit_id,promo_code:$scope.isEmptyObject(res_info.coupon_code)?"":res_info.coupon_code,address:res_info.address,city:res_info.city,state:res_info.state_name,country:res_info.country_name,postal_code:res_info.zip,price_balance:res_info.price_balance,unit_name:res_info.unit_name};var today=new Date;today.setHours(0,0,0,0);var charge_amounts=0;for(var i=0;i<res_price.expected_charges.length;i++){var charge_date=new Date(res_price.expected_charges[i].charge_date);if($scope.isCheckout){if(today>=charge_date&&res_price.expected_charges[i].type_id==1){charge_amounts+=res_price.expected_charges[i].charge_value}}else{if(today>=charge_date){charge_amounts+=res_price.expected_charges[i].charge_value}}}if(!$scope.isCheckout){res_info.price_paidsum=res_info.price_paidsum+res_info.guest_deposits_required-res_info.guest_deposits_due;$scope.securityDeposit=res_info.guest_deposits_required;$scope.chkDamageWaiverNo=true}else{angular.forEach(obj.data.expected_charges,function(charge,i){if(charge.type_id==2&&charge.description.toLowerCase().indexOf("security")>=0){$scope.securityDeposit=charge.charge_value;$scope.chkDamageWaiverNo=true}});var totalDeposits=0;angular.forEach(res_price.security_deposits.security_deposit,function(deposit){totalDeposits+=deposit.deposit_required});if(totalDeposits>$scope.securityDeposit&&$scope.securityDeposit==0){$scope.securityDeposit=totalDeposits;$scope.chkDamageWaiverNo=true}}if(res_info.price_paidsum<charge_amounts){$scope.dueToday=$scope.checkout.payment_amount=parseFloat((charge_amounts-res_info.price_paidsum).toFixed(2))}else{$scope.dueToday=res_info.price_total-res_info.price_paidsum;$scope.checkout.payment_amount=parseFloat((res_info.price_total-res_info.price_paidsum).toFixed(2))}$scope.stepOneDisabled=false;$scope.totalPayments=res_info.price_paidsum;$scope.upliftTotal=$scope.Total=res_info.price_total;if($scope.Total<res_info.price_common){$scope.upliftTotal=$scope.Total=res_info.price_common}$scope.getCountries();$scope.getStates();$scope.setOptFeeAsAmenity($scope.reservationDetails.optional_fees);if($scope.hash!=""){$scope.getTermsAndConditions()}setTimeout(function(){$scope.loadUplift()},1e3)})}})}else{var checkout_cookie=$cookies.getObject("streamline-checkout-cookie");var confirmation_cookie=$cookies.getObject("streamline-confirmation-cookie");$scope.checkout={};if(checkout_cookie){if(checkout_cookie["fname"]){$scope.checkout.fname=checkout_cookie["fname"]}if(checkout_cookie["lname"]){$scope.checkout.lname=checkout_cookie["lname"]}if(checkout_cookie["email"]){$scope.checkout.email=checkout_cookie["email"]}if(checkout_cookie["phone"]){$scope.checkout.phone=checkout_cookie["phone"]}}$scope.checkout.promo_code=rpuri.getQueryStringParam("coupon_code");if(confirmation_cookie){rpapi.getWithParams("GetReservationInfo",{confirmation_id:confirmation_cookie["confirmation_id"]}).success(function(obj){if(obj.data){if(obj.data.reservation.unit_id==$scope.unit&&obj.data.reservation.startdate==$scope.startDate&&obj.data.reservation.enddate==$scope.endDate){$scope.confirmationId=confirmation_cookie["confirmation_id"]}}})}var params={startdate:$scope.startDate,enddate:$scope.endDate,occupants:$scope.occupants,page_number:1,page_results_number:1e3,use_room_type_logic:parseInt($rootScope.roomTypeLogic),include_coupon_information:1,include_grandtotal_cost:1,include_grandtotal_cost_with_guest_deposits:1,guest_description:1};if($rootScope.checkoutSettings.rentalGuardianRestrictions==1){params["guest_country_insurance_validation"]=1;params["guest_state_insurance_validation"]=1}if(parseInt($rootScope.roomTypeLogic)!=1){params["unit_id"]=$scope.unit_id}else{params["condo_type_id"]=$scope.condo_type_id;params["location_id"]=$scope.location_id}if($scope.advanced_reservations){var advanceDate=new Date($scope.advanced_reservations_date);var checkinDate=new Date($scope.startDate);if(checkinDate>=advanceDate&&$rootScope.enableAdvancedRes==1){params["type_id"]=428}}if($scope.unit&&$scope.startDate&&$scope.endDate&&$scope.occupants){rpapi.getWithParams("GetPropertyAvailability",params).success(function(obj){if(obj.status){$scope.error=true;$scope.errorMessage=obj.status.description}else{if($rootScope.checkoutSettings.useAddOns==1){$scope.initAddonsWeb()}$scope.getPreReservation(1);$scope.getCountries();$scope.getStates()}}).error(function(){$scope.error=true;$scope.errorMessage=Alert.errorMessage})}else{$scope.error=true;$scope.errorMessage=Alert.errorMessage}}};$scope.toggleOptionalFee=function(index,quantity){$scope.new_optional_fees[index].checked=!$scope.new_optional_fees[index].checked;$scope.new_optional_fees[index].quantity=quantity;var optional_fees=[];angular.forEach($scope.new_optional_fees,function(fee,key){if(fee.checked||key==index){optional_fees.push(fee)}});$scope.getReservationPrice(optional_fees);$scope.reservationDetails.conciergeUpdated=false};$scope.updateAddons=function(index,quantity){$scope.new_optional_fees[index].quantity=quantity;$scope.new_optional_fees[index].active=1;var optional_fees=[];angular.forEach($scope.new_optional_fees,function(fee,key){if(fee.checked||key==index){optional_fees.push(fee)}});if($scope.isCheckout){$scope.reservationDetails.optional_fees=$scope.new_optional_fees;setTimeout(function(){$scope.getPreReservation()},500)}else{$scope.getReservationPrice(optional_fees)}};$scope.initAddonsWeb=function(){if(!$scope.hash){$scope.hash=""}var arr_amenities=[];$scope.optionalFees=[];$scope.confirmationId=$scope.checkout.confirmation_id;$scope.amenityAddons=[];run_waitMe(".form-checkout-wrapper");amenitiesParams={startdate:$scope.startDate,enddate:$scope.endDate,unit_id:$scope.unit};rpapi.getWithParams("GetPropertyAmenitiesWithRates",amenitiesParams).success(function(response){hide_waitMe(".form-checkout-wrapper");if(response.data&&response.data.amenity_addon){if(response.data.amenity_addon.amenity_id){$scope.amenityAddons.push(response.data.amenity_addon)}else{$scope.amenityAddons=response.data.amenity_addon}}})};$scope.setOptFeeAsAmenity=function(opt_fees){$scope.amenities=[];if(opt_fees.length>0){var addons=[];angular.forEach(opt_fees,function(fee,i){angular.forEach($scope.amenityAddons,function(value,index){if(fee.id==value.amenity_id){$scope.reservationDetails.optional_fees[i].quantity=fee.quantity?fee.quantity.toString():"0";$scope.reservationDetails.optional_fees[i].allow_multiple=true;if(value.amenity_description)$scope.reservationDetails.optional_fees[i].description=value.amenity_description;if(value.amenity_thumbnail)$scope.reservationDetails.optional_fees[i].thumbnail=value.amenity_thumbnail}})});$scope.new_optional_fees=$scope.reservationDetails.optional_fees}};$scope.updateAmenityList=function(){angular.forEach($scope.amenityAddons,function(value,index){angular.forEach($scope.amenities,function(fee,i){if(fee.id==value.amenity_id&&!fee.real_id){$scope.amenityAddons[index].quantity=fee.quantity}})});setTimeout(function(){$scope.addToReservation()},300)};$scope.getReservationPrice=function(optional_fees){$scope.confirmationId=$scope.checkout.confirmation_id;var params={confirmation_id:$scope.confirmationId,return_payments:true,include_coupon_information:1,updated_expected_charges:1,include_grandtotal_cost:1,include_grandtotal_cost_with_guest_deposits:1};if($rootScope.checkoutSettings.rentalGuardianRestrictions==1){params["check_insurance_eligibility"]=1}angular.forEach(optional_fees,function(fee){if(fee.active||fee.checked){quantity="1";if(fee.quantity&&fee.quantity>1){quantity=fee.quantity.toString()}params["optional_fee_"+fee.id]=quantity}});run_waitMe(".form-checkout-wrapper");rpapi.getWithParams("GetReservationPrice",params).success(function(response){hide_waitMe(".form-checkout-wrapper");$rootScope.reservationPrice=response.data;$scope.occupants=$rootScope.reservationPrice.occupants;$scope.occupants_small=$rootScope.reservationPrice.occupants_small;$rootScope.pets=$rootScope.reservationPrice.pets;$rootScope.unitName=$rootScope.reservationPrice.unit_name;$scope.taxes=$rootScope.reservationPrice.taxes;$scope.subTotal=$rootScope.reservationPrice.price;$scope.total=$rootScope.reservationPrice.total;$scope.extras=0;if($rootScope.reservationPrice&&$rootScope.reservationPrice.optional_fees.id){$rootScope.reservationPrice.optional_fees=[$rootScope.reservationPrice.optional_fees]}angular.forEach($rootScope.reservationPrice.optional_fees,function(fee){if(fee.active==1&&!fee.real_id){$scope.extras+=parseFloat(fee.value)}});var requiredFees=[];if($rootScope.reservationPrice.required_fees.id){requiredFees.push($rootScope.reservationPrice.required_fees)}else{requiredFees=$rootScope.reservationPrice.required_fees}angular.forEach(requiredFees,function(fee){$scope.taxes+=parseFloat(fee.value)});angular.forEach($rootScope.reservationPrice.optional_fees,function(fee){if(fee.active==1&&fee.real_id){$scope.taxes+=parseFloat(fee.value)}});$scope.reservationDetails=$rootScope.reservationPrice;$scope.setOptFeeAsAmenity($rootScope.reservationPrice.optional_fees);$scope.new_optional_fees=[];angular.forEach($rootScope.reservationPrice.optional_fees,function(fee,key){if(fee.quantity){if(Array.isArray(fee.quantity)||Number.isNaN(fee.quantity)){fee.quantity="1"}else{fee.quantity=fee.quantity.toString()}}fee.checked=fee.active=="1"?true:false;$rootScope.reservationPrice.optional_fees[key]["cost"]=fee.value;fee.cost=fee.value;var foundFee=false;angular.forEach($scope.amenityAddons,function(addon){addon.quantity="1";if(fee.id==addon.amenity_id){foundFee=true;$rootScope.reservationPrice.optional_fees[key]["description"]=addon.amenity_description;$rootScope.reservationPrice.optional_fees[key]["cost"]=addon.amenity_cost;$rootScope.reservationPrice.optional_fees[key]["thumbnail"]=addon.amenity_thumbnail;fee.cost=addon.amenity_cost}});if(!fee.real_id){if(!foundFee){fee.isAmenity=false}else{fee.isAmenity=true}$scope.new_optional_fees.push(fee)}})})};$scope.isEmptyObject=function(obj){return angular.equals({},obj)};$scope.onePageCheckoutInit=function(booking,res){if(booking.checkin&&booking.checkout){$scope.startDate=booking.checkin;$scope.endDate=booking.checkout;$scope.occupants=booking.occupants;$scope.unit=booking.unit_id;$scope.occupants_small=booking.occupants_small;$scope.pets=booking.pets;$scope.checkout.promo_code=booking.coupon_code}};$scope.getPreReservation=function(use_default){use_default=use_default||0;var params={startdate:$scope.startDate,enddate:$scope.endDate,occupants:$scope.occupants,unit_id:$scope.unit,return_payments:"yes",show_package_addons:"yes",include_coupon_information:1,guest_description:1};if($rootScope.checkoutSettings.bucket_charges==1)params["longterm_charging_rules"]=1;if($scope.advanced_reservations){var advanceDate=new Date($scope.advanced_reservations_date);var checkinDate=new Date($scope.startDate);if(checkinDate>=advanceDate&&$rootScope.enableAdvancedRes==1){params["type_id"]=428}}if($rootScope.checkoutSettings.checkout_layout==4){if(typeof $scope.checkout.state!="undefined"&&typeof $scope.checkout.country!="undefined"){params["state_name"]=$scope.checkout.state;params["country_name"]=$scope.checkout.country;params["guest_state_insurance_validation"]=$scope.checkout.state;params["guest_country_insurance_validation"]=$scope.checkout.country}}if($scope.pets){params["pets"]=$scope.pets}if($scope.occupants_small){params["occupants_small"]=$scope.occupants_small}if(use_default==1&&$rootScope.includeEnabledOptional===1){params["optional_default_enabled"]="yes"}var rate_type_name=$cookies.get("streamline-rate_type");if($rootScope.show_all_rates&&$rootScope.rate_type!=""){params["rate_type_name"]=$rootScope.rate_type}if($rootScope.bookingSettings.enable_rates_pw==1&&typeof rate_type_name!="undefined"){params["rate_type_name"]=rate_type_name;params["madetype_id"]=7}if($rootScope.enable_reservation_type==1){if($rootScope.travel_type_id!=""){params["travelagent_id"]=$rootScope.predefined_agent_id;params["madetype_id"]=2}params["status_id"]=4}var method="GetPreReservationPrice";if($rootScope.separate_taxes_and_feed==1){params["separate_taxes"]=1}if($scope.checkout&&$scope.checkout.promo_code!="")params["coupon_code"]=$scope.checkout.promo_code;var arr_fees=[];$scope.optionalItems=="";jQuery(".optional_fee:checked").each(function(index){if(jQuery(this).prop("checked")){var qty=parseInt(jQuery("#qty-optional-fee-"+jQuery(this).val()).val());if(!isNaN(qty)){params["optional_fee_"+jQuery(this).val()]=String(qty)}else{params["optional_fee_"+jQuery(this).val()]="1"}arr_fees.push(jQuery(this).val())}});jQuery(".opt_fee_sidebar").each(function(index){if(jQuery(this).prop("checked")){jQuery("#chk-"+jQuery(this).val()).prop("checked",true)}if(!jQuery("#optional-fee-"+jQuery(this).val()).is(":checked")){jQuery("#chk-"+jQuery(this).val()).prop("checked",false)}});jQuery(".optional_fee").each(function(index){if(jQuery(".optional_fee:checked").length>0){jQuery(".sidebarfees").show()}else{jQuery(".sidebarfees").hide()}if(jQuery(this).prop("checked")){jQuery(".sidebarfees-"+jQuery(this).val()).show()}else{jQuery(".sidebarfees-"+jQuery(this).val()).hide()}});$scope.optionalItems=arr_fees.join(",");if($scope.hash!==""||$scope.confirmationId>0){if($scope.hash!=="")params["hash"]=$scope.hash;if($scope.confirmationId>0)params["confirmation_id"]=$scope.confirmationId;method="GetReservationPrice";params["include_grandtotal_cost"]=1;params["include_grandtotal_cost_with_guest_deposits"]=1;params["include_security_deposits"]=1;if($rootScope.checkoutSettings.rentalGuardianRestrictions==1){params["check_insurance_eligibility"]=1}}run_waitMe(".form-checkout-wrapper","bounce","Updating Information...");rpapi.getWithParams(method,params).success(function(obj){if(jQuery(".chk2").length){var justTR=JSON.parse(JSON.stringify(obj.data.optional_fees));function trExist(){return justTR.some(function(el){return el.travel_insurance==1})}function cfarExist(){return justTR.some(function(el){return el.cfar==1})}if(justTR.length>0){if(trExist()||cfarExist()){function searchTR(nameKey,myArray){for(var i=0;i<myArray.length;i++){if(myArray[i].travel_insurance===nameKey){return myArray[i]}}}function searchCFR(nameKey,myArray){for(var i=0;i<myArray.length;i++){if(myArray[i].cfr===nameKey){return myArray[i]}}}var item1=searchTR(1,justTR);var item2=searchCFR(1,justTR);var index1=justTR.indexOf(item1);var index2=justTR.indexOf(item2);if(index1>-1||index2>-1){justTR.splice(index1,1);justTR.splice(index2,1);if(justTR.length==0){$scope.justTRI=1}else{$scope.hasBoth=1}justTR.push(item1);justTR.push(item2)}}if(!trExist()&&!cfarExist()){$scope.hasCfar=false;$scope.hasTravelInsurance=false;$scope.justFees=1}}else if(typeof justTR!="undefined"){if(justTR.travel_insurance==1||justTR.cfar==1){$scope.justTRI=1}else{$scope.hasCfar=false;$scope.hasTravelInsurance=false;$scope.justFees=1}}}$rootScope.reservationPrice=obj.data;hide_waitMe(".form-checkout-wrapper");$scope.preOptionalFees=obj.data.optional_fees;var arr_amenities=[];if(obj.data.optional_fees.id){resultData=[];resultData.push(obj.data.optional_fees);obj.data.optional_fees=resultData}if($scope.amenities.length==0){if(obj.data.optional_fees.length>0){angular.forEach(obj.data.optional_fees,function(optional_fee,i){if(optional_fee.active==1){total_optional_fees+=optional_fee.value}if(optional_fee.travel_insurance==0&&optional_fee.cfar==0&&optional_fee.damage_waiver==0){arr_amenities.push({amenity_cost:optional_fee.value,amenity_id:optional_fee.id,amenity_thumbnail:null,amenity_name:optional_fee.name,packages:optional_fee.packages,amenity_description:optional_fee.description,damage_waiver:optional_fee.damage_waiver,travel_insurance:optional_fee.travel_insurance,cfar:optional_fee.cfar,active:optional_fee.active,value:optional_fee.value})}});var amenityDescription,amenitiesParams={startdate:$scope.startDate,enddate:$scope.endDate,unit_id:$scope.unit}}$scope.amenities=arr_amenities;$scope.sidebarAmenities=arr_amenities}var amenities_sidebar=[];if(obj.data.optional_fees.length>0){angular.forEach(obj.data.optional_fees,function(optional_fee,i){if(optional_fee.active==1){total_optional_fees+=optional_fee.value}if(optional_fee.travel_insurance==0&&optional_fee.cfar==0&&optional_fee.damage_waiver==0){amenities_sidebar.push({amenity_cost:optional_fee.value,amenity_id:optional_fee.id,amenity_thumbnail:null,amenity_name:optional_fee.name,packages:optional_fee.packages,amenity_description:optional_fee.description,damage_waiver:optional_fee.damage_waiver,travel_insurance:optional_fee.travel_insurance,cfar:optional_fee.cfar,active:optional_fee.active,value:optional_fee.value})}})}$scope.sidebarAmenities=$scope.amenityAddons;if(obj.data.optional_fees.id){resultData=[];resultData.push(obj.data.optional_fees);obj.data.optional_fees=resultData}if(obj.data.required_fees.id){resultData=[];resultData.push(obj.data.required_fees);obj.data.required_fees=resultData}if(obj.data.taxes_details.id){resultData=[];resultData.push(obj.data.taxes_details);obj.data.taxes_details=resultData}if(obj.data.security_deposits&&obj.data.security_deposits.security_deposit.ledger_id){resultData=[];resultData.push(obj.data.security_deposits.security_deposit);obj.data.security_deposits.security_deposit=resultData}var total_fees=0;var total_taxes=0;var total_optional_fees=0;$scope.upliftTotal=obj.data.total;$scope.upliftInsurance=0;$scope.hasTravelInsurance=false;$scope.hasCfar=false;angular.forEach(obj.data.optional_fees,function(optional_fee){if(optional_fee.active==1){total_optional_fees+=optional_fee.value;if(optional_fee.damage_waiver==1||optional_fee.travel_insurance==1||optional_fee.cfar==1){$scope.upliftInsurance+=optional_fee.value}}if(optional_fee.damage_waiver==1){$scope.hasDamageProtection=true;$scope.damageProtection=optional_fee.value}if(optional_fee.travel_insurance==1){$scope.hasTravelInsurance=true;$scope.travelInsurance=optional_fee.value}if(optional_fee.cfar==1){$scope.hasCfar=true;$scope.cfar=optional_fee.value}});$scope.upliftTotal=parseFloat(obj.data.total)-parseFloat($scope.upliftInsurance);angular.forEach(obj.data.required_fees,function(fee,i){total_fees+=fee.value});angular.forEach(obj.data.taxes_details,function(fee,i){total_taxes+=fee.value});$scope.subTotal=$scope.calculateMarkup((obj.data.price+obj.data.coupon_discount).toString());var dif=$scope.subTotal-obj.data.coupon_discount-obj.data.price;$scope.totalFees=total_fees;$scope.totalTaxes=total_taxes;if($rootScope.separate_taxes_and_feed==1){$scope.taxes=obj.data.taxes_details_value;$scope.fees=obj.data.required_fees_value}else{$scope.taxesAndFees=total_taxes+total_fees+total_optional_fees-dif}$scope.totalPrice=obj.data.total;if(arr_fees.length>0)params["optional_fee"]=arr_fees.join();params.use_room_type_logic=parseInt($rootScope.roomTypeLogic);if(obj.data.expected_charges&&obj.data.expected_charges.type_id){resultData=[];resultData.push(obj.data.expected_charges);obj.data.expected_charges=resultData}$scope.securityDeposit=0;angular.forEach(obj.data.expected_charges,function(charge,i){if(charge.type_id==2&&charge.description.toLowerCase().indexOf("security")>=0){$scope.securityDeposit+=charge.charge_value}});if($rootScope.checkoutSettings.groupExpectedCharges===1&&obj.data.expected_charges.length>1){var grouped_charges=[];angular.forEach(obj.data.expected_charges,function(charge,i){var found_charge=false;angular.forEach(grouped_charges,function(grouped_charge,i){if(grouped_charge.charge_date==charge.charge_date){found_charge=true;grouped_charge.charge_value+=charge.charge_value}});if(!found_charge){grouped_charges.push(charge)}});obj.data.expected_charges=grouped_charges;angular.forEach(grouped_charges,function(expected_charges){if(expected_charges.description.includes("Required Payment")){if(grouped_charges[0]===expected_charges){expected_charges.description=$rootScope.checkoutSettings.payment_schedule_label}else{expected_charges.description=$rootScope.checkoutSettings.required_payment_label}}})}if($rootScope.checkoutSettings.groupExpectedCharges===1&&obj.data.expected_charges.length==1){obj.data.expected_charges[0].description=$rootScope.checkoutSettings.payment_schedule_label}$scope.reservationDetails=obj.data;if($rootScope.checkoutSettings.useAddOns==1){if($scope.new_optional_fees){$scope.setOptFeeAsAmenity($scope.new_optional_fees)}else{$scope.setOptFeeAsAmenity($scope.reservationDetails.optional_fees)}}if($scope.payFullResPrice){$scope.reservationDetails.due_today=$scope.reservationDetails.total}if(!$scope.hasDamageProtection&&!$scope.hasTravelInsurance&&!$scope.hasCfar){$scope.stepTwoDisabled=false}var totalDeposits=0;if(obj.data.security_deposits){angular.forEach(obj.data.security_deposits.security_deposit,function(value,key){totalDeposits+=value.deposit_required})}if(totalDeposits>$scope.securityDeposit&&$scope.securityDeposit==0){$scope.securityDeposit=totalDeposits}if(use_default==1){setTimeout(function(){$scope.loadUplift()},300)}else{setTimeout(function(){$scope.updateUplift()},300)}})};$scope.getTermsAndConditions=function(){if($scope.unit>0){var params={trigger_id:18,unit_id:$scope.unit};if(parseInt($rootScope.enableStreamShare)==1&&$scope.useStreamShare==1){$scope.getStreamshareTermsAndCondition()}else{rpapi.getWithParams("GetPropertyDocumentHtml",params).success(function(obj){if(obj.data&&!jQuery.isEmptyObject(obj.data.document_html_code)){$scope.terms=$sce.trustAsHtml(obj.data.document_html_code)}else{$scope.terms=""}})}}};$scope.getPrivacyPolicy=function(){if($scope.unit>0||$scope.hash!=""){var params={trigger_id:389};rpapi.getWithParams("GetCompanyDocumentHtml",params).success(function(obj){if(obj.data&&!jQuery.isEmptyObject(obj.data.document_html_code)){$scope.privacyPolicyHtml=$sce.trustAsHtml(obj.data.document_html_code)}else{$scope.privacyPolicyHtml=""}})}};$scope.getADVTermsAndConditions=function(){if($scope.unit>0){var params={trigger_id:428};rpapi.getWithParams("GetCompanyDocumentHtml",params).success(function(obj){if(obj.data&&!jQuery.isEmptyObject(obj.data.document_html_code)){$scope.advTerms=$sce.trustAsHtml(obj.data.document_html_code)}else{$scope.advTerms=""}})}};$scope.isString=function(val,allowEmpty){if(angular.isString(val)){if(allowEmpty){return true}else{if(val!=""){return true}}}return false};$scope.isNumber=function(val,allowZero){if(angular.isNumber(val)){if(allowZero){return true}else{if(val>0){return true}}}else{if(val&&val!==null){if(val.length>0){if(!Number.isNaN(val)){return true}}}}return false};$scope.getCountries=function(){rpapi.getWpActionWithParams("streamlinecore-get-countries",null).success(function(obj){$scope.countries=obj.data.countries})};$scope.getStates=function(){var country=$scope.checkout.country&&$scope.checkout.country!=""?$scope.checkout.country:"US";var params={country_name:country};run_waitMe(".panel-step-3","bounce","Processing...");rpapi.getWpActionWithParams("streamlinecore-get-states",params).success(function(obj){$scope.states=obj.data.states;hide_waitMe(".panel-step-3")})};$scope.processCheckout=function(checkout){var success_aptxx=[];if($scope.aptexx_response.length>0){var success_aptxx=JSON.parse($scope.aptexx_response.trim())}var repeats=0;var security_params=$cookies.getObject("streamline-checkout-params");if(typeof security_params!="undefined"&&security_params.repeats>0&&(checkout.fname==security_params.first_name||checkout.lname==security_params.last_name||checkout.email==security_params.email)){var repeats=security_params.repeats+1}else{repeats=1}run_waitMe("#step3","bounce","Processing your request");var params={pricing_model:0,startdate:$scope.startDate,enddate:$scope.endDate,occupants:$scope.occupants,occupants_small:$scope.occupants_small,first_name:checkout.fname,last_name:checkout.lname,email:checkout.email,phone:checkout.phone,mobile_phone:checkout.phone,address:checkout.address,address2:checkout.address2,city:checkout.city,state_name:checkout.state,country_name:checkout.country,credit_card_type_id:checkout.card_type};if(success_aptxx.errors&&success_aptxx.errors.length>0){if(success_aptxx.errors[0].type=="POSSIBLE_DUPLICATE"){angular.forEach(success_aptxx.duplicateCardMethods,function(method,key){success_aptxx.methodId=method.methodId;success_aptxx.brandType=method.brand;success_aptxx.channelType=method.type;success_aptxx.lastFour=method.lastFour;success_aptxx.expiresOn=method.expiresOn;params["do_not_verify_zip_code"]=1;params["zip"]=method.methodId})}}if($rootScope.checkoutSettings.enable_lynbrook==0||$rootScope.checkoutSettings.enable_lynbrook==1&&$scope.aptexx_gateway_id==0){params["zip"]=checkout.postal_code}var credit_card_expiration_month_year="";if(typeof success_aptxx.expiresOn!="undefined"){credit_card_expiration_month_year=success_aptxx.expiresOn.split("-");credit_card_expiration_month_year=credit_card_expiration_month_year[1]+"/"+credit_card_expiration_month_year[0]}if($rootScope.checkoutSettings.enable_lynbrook==1&&$scope.aptexx_gateway_id!=0&&checkout.card_type<5&&typeof success_aptxx.methodId!="undefined"){params["aptxx_method_id"]=success_aptxx.methodId;params["aptxx_account_person_id"]=$scope.aptexx_account_person_id;if($scope.aptexx_gateway_id>0){params["aptxx_target_id"]=$scope.aptexx_gateway_id}params["credit_card_brand"]=success_aptxx.brandType;params["credit_card_type"]=success_aptxx.channelType;params["credit_card_last_four"]=success_aptxx.lastFour;params["credit_card_expiration_month_year"]=credit_card_expiration_month_year;if(success_aptxx.zipCode)params["zip"]=success_aptxx.zipCode}if($scope.payFullResPrice){params["disable_payments"]=1}if($rootScope.checkoutSettings.createStreamSign==1){if($rootScope.checkoutSettings.units_exclude_streamsign!=""&&$rootScope.checkoutSettings.units_exclude_streamsign.indexOf($scope.unit)>=0){}else{params["streamsign_thankyou_url"]=location.protocol+"//"+location.host+"/thank-you/";params["streamsign_redirect"]="yes"}}if($rootScope.bookingSettings.enable_rates_pw==0){if(checkout.notes&&$rootScope.checkoutSettings.collect_terms_check==0){params["client_comments"]=checkout.notes}if(checkout.notes&&$rootScope.checkoutSettings.collect_terms_check==1&&$scope.CheckedTerms){params["client_comments"]="Terms & Conditions: Accepted; ";params["client_comments"]+="Notes: "+checkout.notes}if(!checkout.notes&&$rootScope.checkoutSettings.collect_terms_check==1&&$scope.CheckedTerms){params["client_comments"]="Terms & Conditions: Accepted;"}}else{var check_block_rates=$cookies.getObject("streamline-block_rates");var get_cookie_login=$cookies.get("streamline-rate_type");if(checkout.notes&&$rootScope.checkoutSettings.collect_terms_check==0){params["client_comments"]=checkout.notes}if(checkout.notes&&check_block_rates==0){params["client_comments"]="Login: "+get_cookie_login+" | ";params["client_comments"]+="Notes: "+checkout.notes}if(!checkout.notes&&check_block_rates==0){params["client_comments"]="Login:"+get_cookie_login}}if($rootScope.checkoutSettings.disable_payments==1){params["disable_payments"]=1}var rate_type_name=$cookies.get("streamline-rate_type");var rate_type_id=$cookies.get("streamline-rate_type_id");if($rootScope.show_all_rates&&$rootScope.rate_type!=""){params["rate_type_name"]=$rootScope.rate_type}if($rootScope.bookingSettings.enable_rates_pw==1&&typeof rate_type_name!="undefined"){params["rate_type_id"]=rate_type_id;params["madetype_id"]=7}if($rootScope.enable_reservation_type==1){params["status_id"]=4}if($rootScope.checkoutSettings.enableVGSProxy&&$scope.aptexx_gateway_id==0&&checkout.card_type<5){params["enable_vgs_alias"]=1}if($rootScope.travel_type_id!=""){params["travelagent_id"]=$rootScope.predefined_agent_id;params["madetype_id"]=2;params["type_id"]=7}if($rootScope.reservation_type>0){params["type_id"]=$rootScope.reservation_type}if(checkout.card_type<5){if($rootScope.checkoutSettings.enableVGSProxy!==1||$scope.aptexx_gateway_id==0){var exp_month,exp_year;if(checkout.expiration_date){var exp_date=checkout.expiration_date.split("/");exp_month=exp_date[0];exp_year=exp_date[1]}else{exp_month=checkout.expire_month;exp_year=checkout.expire_year}params["credit_card_type_id"]=checkout.card_type;params["credit_card_number"]=checkout.card_number;params["credit_card_expiration_month"]=exp_month;params["credit_card_expiration_year"]=exp_year;params["credit_card_cid"]=checkout.card_cvv}}else{params["payment_type_id"]=33;params["bank_account_number"]=checkout.bank_account_number;params["bank_routing_number"]=checkout.bank_routing_number;params["bank_account_holder_name"]=checkout.bank_account_holder_name}jQuery.ajax({url:$rootScope.checkoutSettings.ip_data,global:false,type:"GET",data:{},async:false,success:function(data){params["ip"]=data.ip;params["ip_location"]=data.country_name}});var advanceDate=new Date($scope.advanced_reservations_date);var checkinDate=new Date($scope.startDate);if(checkinDate>=advanceDate&&$rootScope.enableAdvancedRes==1){params["type_id"]=428}params["time_stamp"]=Math.floor(Date.now()/1e3);if(!$scope.isEmptyObject($scope.privacyPolicyHtml)){params["privacy_policy"]=$scope.privacyPolicyHtml}if(jQuery("#newsletter").is(":checked")){params["opt_in_marketing"]="yes"}else{params["opt_in_marketing"]="no"}if($rootScope.doNotVerifyZip==1){params["do_not_verify_zip_code"]=1}if($rootScope.roomTypeLogic==1){params["use_room_type_logic"]=1;params["condo_type_id"]=$scope.condo_type_id;params["location_id"]=$scope.location_id}else{params["unit_id"]=$scope.unit}if($rootScope.bookingSettings){if($rootScope.bookingSettings.hearedAboutId>0&&!$scope.hash)params["hear_about_id"]=$rootScope.bookingSettings.hearedAboutId;if($rootScope.bookingSettings.hearedAboutQuoteId>0&&$scope.hash)params["hear_about_id"]=$rootScope.bookingSettings.hearedAboutQuoteId;if($rootScope.bookingSettings.blockedRequest==1||$rootScope.bookingSettings.enable_rates_pw==1){params["status_id"]=10}if($rootScope.bookingSettings.nonBlockedRequest==1&&typeof $scope.hash!="undefined"){params["not_blocked_request"]="yes"}}if($scope.checkout&&$scope.checkout.promo_code!=""){params["coupon_code"]=$scope.checkout.promo_code}if($scope.pets&&$scope.pets>0){params["pets"]=$scope.pets}if(typeof $scope.hash!="undefined"){params["hash"]=$scope.hash}if($scope.referrer_url!=""){params["referrer_url"]=$scope.referrer_url}if($rootScope.travel_type_id==""){if($scope.confirmationId>0){params["confirmation_id"]=$scope.confirmationId}}var amenity_addons=[];jQuery(".optional_fee:checked").each(function(index){if(jQuery(this).prop("checked")){var qty=parseInt(jQuery("#qty-optional-fee-"+jQuery(this).val()).val());if(!isNaN(qty)){var amenity_addon={amenity_id:jQuery(this).val(),amenity_quantity:qty};amenity_addons.push(amenity_addon)}else{params["optional_fee_"+jQuery(this).val()]="yes"}}});if(amenity_addons.length>0){params["amenity_addon"]=amenity_addons}security_params={startdate:$scope.startDate,enddate:$scope.endDate,first_name:checkout.fname,last_name:checkout.lname,email:checkout.email,phone:checkout.phone,address:checkout.address,address2:checkout.address2,city:checkout.city,zip:checkout.postal_code,state_name:checkout.state,country_name:checkout.country,repeats:repeats};$cookies.putObject("streamline-checkout-params",security_params,{path:"/",secure:"true"});if($rootScope.checkoutSettings.enableVGSProxy==1&&$scope.aptexx_gateway_id==0&&checkout.card_type<5){var request={methodName:"GetVGSToken"};request.params=params;$scope.secureForm.submit("/api/json/",{serializer:"deep",data:request,mapDotToObject:"merge",headers:{"Content-Type":"application/json"}},function(status,response){var dates=response.data.credit_card_expiration_date.split("/");var month=dates[0];var year=dates[1];params["credit_card_number"]=response.data.credit_card_number;params["credit_card_expiration_month"]=month;params["credit_card_expiration_year"]=year;params["credit_card_cid"]=response.data.credit_card_cid;params["credit_card_holder_name"]=response.data.credit_card_holder;if(response.status){hide_waitMe("#step3");$scope.$apply(function(){Alert.clear();Alert.add(Alert.errorType,response.status.description)})}else{rpapi.getWithParams("MakeReservation",params).success(function(obj){if($scope.payFullResPrice){var res=obj.data.reservation;var params={first_name:checkout.fname,last_name:checkout.lname,email:checkout.email,phone:checkout.phone,address:checkout.street_address,city:checkout.city,zip:checkout.postal_code,state_name:checkout.region,country_name:"US",confirmation_id:res.confirmation_id,payment_amount:res.price_common,payment_type_id:1,credit_card_type_id:1,credit_card_number:response.data.credit_card_number,credit_card_expiration_month:month,credit_card_expiration_year:year,credit_card_cid:response.data.credit_card_cid,credit_card_holder:response.data.credit_card_holder,enable_vgs_alias:1};rpapi.getWithParams("AddReservationPayment",params).success(function(resPayment){if(resPayment){if(resPayment.status){hide_waitMe("#step3");Alert.clear();Alert.add(Alert.errorType,resPayment.status.description)}else{jQuery(document).find("#btn-checkout").attr("disabled","disabled");$scope.completeBooking(res)}}}).error(function(err){hide_waitMe("#step3");Alert.add(Alert.errorType,err)});if(obj.status){Alert.add(Alert.errorType,obj.status.description)}else{jQuery(document).find("#btn-checkout").attr("disabled","disabled");var res=obj.data.reservation;var now=new Date;now.setDate(now.getDate()-10);$cookies.putObject("streamline-confirmation-cookie",null,{path:"/",expires:now,secure:"true"});$cookies.remove("streamline-confirmation-cookie");rpapi.getWithParams("GetReservationInfo",{confirmation_id:res.confirmation_id}).success(function(obj){var res_info=obj.data.reservation;jQuery("#email").val(res_info.email);jQuery("#fname").val(res_info.first_name);jQuery("#lname").val(res_info.last_name);jQuery("#unit_id").val(res_info.unit_id)})}}else{if(obj.status){hide_waitMe("#step3");Alert.add(Alert.errorType,obj.status.description)}else{var res=obj.data.reservation;jQuery("#btn-checkout").attr("disabled","disabled");$scope.completeBooking(res)}}})}},function(errors){hide_waitMe("#step3");Alert.clear();Alert.add(Alert.errorType,"Invalid Credit Card Information provided, Please Review All Payment Information.")})}else if($rootScope.checkoutSettings.enable_lynbrook==1&&$scope.aptexx_gateway_id!=0&&checkout.card_type<5){if(typeof success_aptxx.methodId!="undefined"){rpapi.getWithParams("MakeReservation",params).success(function(obj){if($scope.payFullResPrice){var res=obj.data.reservation;var params={first_name:checkout.fname,last_name:checkout.lname,email:checkout.email,phone:checkout.phone,address:checkout.street_address,city:checkout.city,zip:checkout.postal_code,state_name:checkout.region,country_name:"US",confirmation_id:res.confirmation_id,payment_amount:res.price_common,payment_type_id:1,credit_card_type_id:1,credit_card_number:checkout.card_number,credit_card_expiration_month:exp_month,credit_card_expiration_year:exp_year,credit_card_cid:checkout.card_ccv,credit_card_name:checkout.name_on_card};rpapi.getWithParams("AddReservationPayment",params).success(function(resPayment){hide_waitMe("#step3");if(resPayment){if(resPayment.status){Alert.clear();Alert.add(Alert.errorType,resPayment.status.description)}else{$scope.completeBooking(res)}}}).error(function(err){hide_waitMe("#step3");Alert.clear();$scope.updateLynbrookHostedFields();Alert.add(Alert.errorType,err)});if(obj.status){Alert.add(Alert.errorType,obj.status.description)}else{jQuery("#btn-checkout").attr("disabled","disabled");var res=obj.data.reservation;var now=new Date;now.setDate(now.getDate()-10);$cookies.putObject("streamline-confirmation-cookie",null,{path:"/",expires:now,secure:"true"});$cookies.remove("streamline-confirmation-cookie");rpapi.getWithParams("GetReservationInfo",{confirmation_id:res.confirmation_id}).success(function(obj){var res_info=obj.data.reservation;jQuery("#email").val(res_info.email);jQuery("#fname").val(res_info.first_name);jQuery("#lname").val(res_info.last_name);jQuery("#unit_id").val(res_info.unit_id)})}}else{hide_waitMe("#step3");if(obj.status){Alert.add(Alert.errorType,obj.status.description);$scope.updateLynbrookHostedFields();var security_params=$cookies.getObject("streamline-checkout-params");if(typeof security_params!="undefined"&&security_params.repeats>=3){window.location.href="/security-check/"}}else{var res=obj.data.reservation;jQuery("#btn-checkout").attr("disabled","disabled");$scope.completeBooking(res)}}}).error(function(err){hide_waitMe("#step3");$scope.updateLynbrookHostedFields();$scope.paymentProcessed=false;Alert.add(Alert.errorType,err)})}else{$scope.$apply(function(){Alert.clear();angular.forEach(success_aptxx.errors,function(error,key){if(error.type=="SESSION_EXPIRED"||error.type=="SESSION_INVALID"||error.type=="SESSION_USED"||error.type=="SERVICE_API_NOT_AUTHENTICATED"){Alert.add(Alert.errorType,"An error occurred processing your request, please review the information and try again");$scope.updateLynbrookHostedFields()}else{var error=error.type;if(error=="INVALID"||error=="METHOD_ERROR"||error=="POSSIBLE_DUPLICATE")error="Credit card information provided cannot be verified, please review the credit card information and try again";Alert.add(Alert.errorType,error)}})})}}else{rpapi.getWithParams("MakeReservation",params).success(function(obj){if($scope.payFullResPrice){var res=obj.data.reservation;var params={first_name:checkout.fname,last_name:checkout.lname,email:checkout.email,phone:checkout.phone,address:checkout.street_address,city:checkout.city,zip:checkout.postal_code,state_name:checkout.region,country_name:"US",confirmation_id:res.confirmation_id,payment_amount:res.price_common,payment_type_id:1,credit_card_type_id:1,credit_card_number:checkout.card_number,credit_card_expiration_month:exp_month,credit_card_expiration_year:exp_year,credit_card_cid:checkout.card_ccv,credit_card_name:checkout.name_on_card};rpapi.getWithParams("AddReservationPayment",params).success(function(resPayment){hide_waitMe("#step3");if(resPayment){if(resPayment.status){Alert.clear();Alert.add(Alert.errorType,resPayment.status.description)}else{$scope.completeBooking(res)}}}).error(function(err){hide_waitMe("#step3");Alert.add(Alert.errorType,err)});if(obj.status){Alert.add(Alert.errorType,obj.status.description)}else{jQuery("#btn-checkout").attr("disabled","disabled");var res=obj.data.reservation;var now=new Date;now.setDate(now.getDate()-10);$cookies.putObject("streamline-confirmation-cookie",null,{path:"/",expires:now,secure:"true"});$cookies.remove("streamline-confirmation-cookie");rpapi.getWithParams("GetReservationInfo",{confirmation_id:res.confirmation_id}).success(function(obj){var res_info=obj.data.reservation;jQuery("#email").val(res_info.email);jQuery("#fname").val(res_info.first_name);jQuery("#lname").val(res_info.last_name);jQuery("#unit_id").val(res_info.unit_id)})}}else{hide_waitMe("#step3");if(obj.status){Alert.add(Alert.errorType,obj.status.description);var security_params=$cookies.getObject("streamline-checkout-params");if(typeof security_params!="undefined"&&security_params.repeats>=3){window.location.href="/security-check/"}}else{var res=obj.data.reservation;$scope.completeBooking(res)}}})}return false};$scope.initGReCaptcha=function(){var verifyCallback=function(response){alert(response)};var onloadCallback=function(){grecaptcha.render("grecaptcha",{sitekey:"6LfSaj8cAAAAAByAHCdwyHRAwqSd8EeG3eBo8rIm",callback:verifyCallback})};jQuery("#formStep3").on("submit",function(e){var response=grecaptcha.getResponse();if(response.length==0){alert("please verify you are human!");e.preventDefault();return false}})};$scope.completeBooking=function(res){jQuery("#btn-checkout").attr("disabled","disabled");rpapi.getWithParams("GetReservationInfo",{confirmation_id:res.confirmation_id}).success(function(obj){var res_info=obj.data.reservation;jQuery("#email").val(res_info.email);jQuery("#fname").val(res_info.first_name);jQuery("#lname").val(res_info.last_name);jQuery("#unit_id").val(res_info.unit_id);if(res.streamsign_url&&res.streamsign_url!=""){window.location.href=res.streamsign_url}else{$scope.submitForm(res)}})};$scope.payMonthly=function(){UpLift.Payments.select();$scope.showUpliftIframe=true;$scope.payFullSelected=false};$scope.payFullPrice=function(){UpLift.Payments.deselect();$scope.showUpliftIframe=false;$scope.payFullSelected=true};$scope.payFullResservationPrice=function(val){if(val==1){$scope.payFullResPrice=true}else{$scope.payFullResPrice=false}$scope.getPreReservation()};$scope.onConfirmUnreadyHandler=function(result){$scope.$apply(function(){$scope.disableBtnAgree=true;$scope.lblPayMonthly="from"})};$scope.onConfirmReadyHandler=function(result){$scope.$apply(function(){$scope.showBtnAgree=true;$scope.lblPayMonthly="";$scope.disableBtnAgree=false;$scope.monthlyAmount="$"+UpLift.Payments.getMonthlyAmount().replace(",","")})};$scope.onApprovedHandler=function(result){$scope.$apply(function(){$scope.showApprovedBtn=true;$scope.monthlyAmount="$"+UpLift.Payments.getMonthlyAmount();$scope.lblPayMonthly="from"})};$scope.onRejectedHandler=function(result){$scope.$apply(function(){$scope.showBtnAgree=false;$scope.showMonthlyPrice=false;$scope.showStartingFrom=false;$scope.lblPayMonthly=""})};$scope.onRejectedContinueHandler=function(result){UpLift.Payments.deselect();$scope.$apply(function(){$scope.showUpliftIframe=false;$scope.enableUplift=false;$scope.showMonthlyPrice=false;$scope.payFullSelected=true;$scope.lblPayMonthly=""})};$scope.onPaymentUnreadyHandler=function(){$scope.$apply(function(){$scope.showBtnAgree=false;$scope.lblPayMonthly="from";$scope.monthlyAmount=$filter("currency")(parseFloat(UpLift.Payments.getMonthlyAmount(true).replace(",","")),undefined,0)})};$scope.myPaymentsLoadCallback=function(result){if(result.show_iframe){$scope.$apply(function(){$scope.enableUplift=true;$scope.monthlyAmount="$"+UpLift.Payments.getMonthlyAmount()})}};$scope.myPaymentsUpdateCallback=function(result){if(result.show_iframe){$scope.$apply(function(){$scope.monthlyAmount="$"+UpLift.Payments.getMonthlyAmount();var monthlyValue=parseFloat(UpLift.Payments.getMonthlyAmount(true).replace(",",""));if(monthlyValue==0){$scope.showUpliftIframe=false;$scope.enableUplift=false;$scope.showMonthlyPrice=false;$scope.payFullPrice()}else{$scope.showUpliftIframe=true;$scope.enableUplift=true;$scope.showMonthlyPrice=true}})}};$scope.getTripObject=function(){var billing_contact={email:$scope.checkout.email};if($scope.isString($scope.checkout.phone)){billing_contact["phone"]=$scope.checkout.phone}if($scope.checkout&&$scope.checkout.address){billing_contact["street_address"]=$scope.checkout.address}if($scope.checkout&&$scope.checkout.city){billing_contact["city"]=$scope.checkout.city}if($scope.checkout&&$scope.checkout.state){billing_contact["region"]=$scope.checkout.state}if($scope.checkout&&$scope.checkout.postal_code){billing_contact["postal_code"]=$scope.checkout.postal_code.toString()}var order_amount=($scope.upliftTotal+$scope.upliftInsurance)*100;var response={order_amount:$scope.round(order_amount,2),travelers:[{first_name:$scope.checkout.fname,last_name:$scope.checkout.lname,id:0}],hotel_reservations:[{hotel_name:$scope.unit_name,check_in:$scope.startDate.substring(6,10)+$scope.startDate.substring(0,2)+$scope.startDate.substring(3,5),check_out:$scope.endDate.substring(6,10)+$scope.endDate.substring(0,2)+$scope.endDate.substring(3,5),number_of_rooms:1}],purchase_currency:"USD",locale:"en-US",billing_contact:billing_contact};if($scope.upliftInsurance>0){response["hotel_reservations"][0]["insurance"]=[{types:["cancellation"],price:$scope.upliftInsurance*100}]}return response};$scope.upliftNext=function(){UpLift.Payments.clickNext()};$scope.confirmLoan=function(){if($scope.isCheckout){$scope.makeReservationUplift($scope.card)}else{$scope.addReservationPaymentUplift($scope.card)}};$scope.onPaymentReadyHandler=function(){$scope.$apply(function(){$scope.card=UpLift.Payments.getVirtualCard();$scope.confirmLoan()})};$scope.addReservationPaymentUplift=function(card){run_waitMe(".add-payment-body","bounce","Processing your request");var params={confirmation_id:$scope.checkout.confirmation_id,first_name:card.contact.first_name,last_name:card.contact.last_name,email:card.contact.email,phone:card.contact.phone,mobile_phone:card.contact.phone,address:card.contact.street_address,city:card.contact.city,zip:card.contact.postal_code,state_name:card.contact.region,country_name:"US",credit_card_number:card.card_number,credit_card_expiration_month:card.expiration_month,credit_card_expiration_year:card.expiration_year,credit_card_cid:card.card_cvv,company_code:$rootScope.checkoutSettings.vgsToken,payment_amount:$scope.checkout.price_balance,payment_type_id:1};rpapi.secureGetWithParams("AddReservationPayment",params).success(function(obj){hide_waitMe(".add-payment-body");if(obj.data.message){if(obj.data.message.indexOf("successful")>-1){$scope.paymentComplete=true;Alert.clear();Alert.add(Alert.successType,obj.data.message)}else{Alert.add(Alert.infoType,obj.data.message)}}else{Alert.add(Alert.errorType,"Unknown error ocurred.")}})};$scope.makeReservationUplift=function(card){var params={startdate:$scope.startDate,enddate:$scope.endDate,occupants:$scope.occupants,occupants_small:$scope.occupants_small,first_name:card.contact.first_name,last_name:card.contact.last_name,email:card.contact.email,phone:card.contact.phone,mobile_phone:card.contact.phone,address:card.contact.street_address,city:card.contact.city,zip:card.contact.postal_code,state_name:card.contact.region,country_name:card.contact.country,disable_payments:1,payment_type_id:1,credit_card_type_id:1,credit_card_number:card.card_number,credit_card_expiration_month:card.expiration_month,credit_card_expiration_year:card.expiration_year,credit_card_cid:card.card_ccv,credit_card_name:card.name_on_card,credit_card_charge_required:"no",status_id:10,type_id:671};if($rootScope.checkoutSettings.createStreamSign==1){params["streamsign_thankyou_url"]=location.protocol+"//"+location.host+"/thank-you/";params["streamsign_redirect"]="yes";params["show_on_website"]="1"}params["time_stamp"]=Math.floor(Date.now()/1e3);params["privacy_policy"]=$scope.privacyPolicyHtml;if(jQuery("#newsletter").is(":checked")){params["opt_in_marketing"]="yes"}else{params["opt_in_marketing"]="no"}if($rootScope.doNotVerifyZip==1){params["do_not_verify_zip_code"]=1}if($rootScope.roomTypeLogic==1){params["use_room_type_logic"]=1;params["condo_type_id"]=$scope.checkout.condo_type_id;params["location_id"]=$scope.checkout.location_id}else{params["unit_id"]=$scope.unit}if($rootScope.bookingSettings){if($rootScope.bookingSettings.hearedAboutId>0&&!$scope.hash){params["hear_about_id"]=$rootScope.bookingSettings.hearedAboutId}if($rootScope.bookingSettings.hearedAboutQuoteId>0&&$scope.hash){params["hear_about_id"]=$rootScope.bookingSettings.hearedAboutQuoteId}if($rootScope.bookingSettings.blockedRequest==1){params["status_id"]=10}}if($scope.checkout&&$scope.checkout.promo_code!=""){params["coupon_code"]=$scope.checkout.promo_code}if($scope.pets&&$scope.pets>0){params["pets"]=$scope.pets}if(typeof $scope.hash!="undefined"){params["hash"]=$scope.hash}if($scope.referrer_url!=""){params["referrer_url"]=$scope.referrer_url}if($scope.confirmationId>0){params["confirmation_id"]=$scope.confirmationId}var amenity_addons=[];jQuery(".optional_fee:checked").each(function(index){if(jQuery(this).prop("checked")){var qty=parseInt(jQuery("#qty-optional-fee-"+jQuery(this).val()).val());if(!isNaN(qty)){var amenity_addon={amenity_id:jQuery(this).val(),amenity_quantity:qty};amenity_addons.push(amenity_addon)}else{params["optional_fee_"+jQuery(this).val()]="yes"}}});if(amenity_addons.length>0){params["amenity_addon"]=amenity_addons}run_waitMe("#step3","bounce","Processing your request");rpapi.getWithParams("MakeReservation",params).success(function(obj){if(obj.status){hide_waitMe("#step3");Alert.add(Alert.errorType,obj.status.description);UpLift.Payments.orderError(obj.status.description)}else{var res=obj.data.reservation;var params={first_name:card.contact.first_name,last_name:card.contact.last_name,email:card.contact.email,phone:card.contact.phone,address:card.contact.street_address,city:card.contact.city,zip:card.contact.postal_code,state_name:card.contact.region,country_name:"US",confirmation_id:res.confirmation_id,payment_amount:res.price_common,payment_type_id:1,credit_card_type_id:1,credit_card_number:card.card_number,credit_card_expiration_month:card.expiration_month,credit_card_expiration_year:card.expiration_year,credit_card_cid:card.card_ccv,credit_card_name:card.name_on_card};rpapi.getWithParams("AddReservationPayment",params).success(function(resPayment){if(resPayment){res.price_balance=0;$scope.submitForm(res)}else{hide_waitMe("#step3");UpLift.Payments.orderError(res.status.description)}}).error(function(err){hide_waitMe("#step3");Alert.add(Alert.errorType,err);UpLift.Payments.orderError(obj.status.description)})}})};$scope.modifyReservation=function(version){var amenity_addons=[];var params={};angular.forEach($rootScope.reservationPrice.optional_fees,function(optional_fee){if(optional_fee.active==1&&!optional_fee.real_id){var amenity_addon={amenity_id:optional_fee.id,amenity_quantity:optional_fee.quantity};amenity_addons.push(amenity_addon)}});angular.forEach($scope.new_addons,function(fee){var found_key=false;angular.forEach(amenity_addons,function(addon,key){if(addon.amenity_id==fee.amenity_id){found_key=true;amenity_addons[key].amenity_quantity+=fee.quantity}});if(!found_key){var amenity_addon={amenity_id:fee.amenity_id,amenity_quantity:fee.quantity};amenity_addons.push(amenity_addon)}});params["confirmation_id"]=$scope.confirmationId;if(amenity_addons.length>0){params["amenity_addon"]=amenity_addons;run_waitMe(".page");var reservationsResponse=streamlineService.modifyReservation(params);reservationsResponse.then(function(response){hide_waitMe(".page");if(response.data&&response.data.reservation){if(response.data.reservation.confirmation_id){$scope.message=response.data.reservation.message;$scope.modifiedOk=true;$scope.modifiedStatus="alert alert-success"}}else{$scope.message=response.status.description;$scope.modifiedOk=false;$scope.modifiedStatus="alert alert-danger"}$scope.addonsBtnDisabled=true;if(version=="visitor-guide"){jQuery("#modalModifyReservation").modal("hide");jQuery("body").removeClass("modal-open");jQuery(".modal-backdrop").remove();$location.path("reservation_details")}else if(version=="guest-app"){var dialog=document.getElementById("addons-alert-dialog");if(dialog){var arr_res=[];var login_cookie=$cookies.getObject("streamline-login-cookie");run_waitMe(".page");var reservationsResponse=streamlineService.getReservationsFromGuest(login_cookie.guest_id);reservationsResponse.then(function(response){hide_waitMe(".page");$localStorage.reservations=response;if(!response.status&&response.data.reservations.reservation){if(response.data.reservations.reservation.confirmation_id){arr_res.push(response.data.reservations.reservation)}else{arr_res=response.data.reservations.reservation}$scope.reservations=arr_res;angular.forEach($scope.reservations,function(reservation){if(reservation.confirmation_id==$scope.confirmationId){$rootScope.reservation=reservation;$localStorage.reservation=$rootScope.reservation}});angular.forEach($localStorage.reservation.fields.field,function(value){if(value.field_name_original=="Reservation Cost"){$scope.addonMessage="Your reservation cost has been updated to "+value.field_value}})}dialog.show()})}else{$scope.popPage()}}else if(version=="website"){alert("Website action goes here")}}).catch(function(response){Alert.add(Alert.errorType,"There was an error updating your reservation, please try again at a later time.")})}};$scope.getPropertyInfo=function(){rpapi.getWithParams("GetPropertyInfo",{unit_id:$scope.unit}).success(function(obj){$scope.property=obj.data;if($scope.checkout){$scope.checkout.country="US";$scope.checkout.condo_type_id=obj.data.condo_type_id;$scope.checkout.location_id=obj.data.location_id;if(parseInt($rootScope.roomTypeLogic)==1){$scope.unit_name=obj.data.condo_type_name}else{if(obj.data.web_name&&obj.data.name!=""){$scope.unit_name=obj.data.web_name}else if(obj.data.name=="Home"){$scope.unit_name=obj.data.location_name}else{$scope.unit_name=obj.data.name}}}})};$scope.submitForm=function(res){jQuery("#confirmation_id").val(res.confirmation_id);jQuery("#location_name").val(res.location_name);jQuery("#condo_type_name").val(res.condo_type_name);jQuery("#unit_name").val(res.unit_name);jQuery("#startdate").val(res.startdate);jQuery("#enddate").val(res.enddate);jQuery("#occupants").val(res.occupants);jQuery("#occupants_small").val(res.occupants_small);jQuery("#pets").val(res.pets);jQuery("#price_common").val(res.price_common);jQuery("#price_balance").val(res.price_balance);jQuery("#travelagent_name").val(res.travelagent_name);jQuery("#unit_name").val(res.unit_name);if(res.payment_amount){jQuery("#payment_amount").val(res.payment_amount)}jQuery("#email").val($scope.checkout.email);jQuery("#fname").val($scope.checkout.fname);jQuery("#lname").val($scope.checkout.lname);jQuery("#unit_id").val($scope.unit);jQuery("#form_thankyou").submit()};$scope.round=function(value,decimals){return Number(Math.round(value+"e"+decimals)+"e-"+decimals)};$scope.getStreamshareTermsAndCondition=function(){$scope.SSterms={data:{document_html_code:"<html><head><title></title><link href=\"https://svc.webspellchecker.net/spellcheck31/lf/scayt3/ckscayt/css/wsc.css\" rel=\"stylesheet\" type=\"text/css\" /></head><body aria-readonly=\"false\" class=\"wsc-instance\"><div style='padding:0 30px;'><h1 align=\"center\">STREAMSHARE.COM<br/>Privacy Policy</h1><br/><p style='font-size: 14px;line-height: 22px;color: #000;'>This Privacy Policy applies to the websites accessible at http://www.streamshare.com, (“Website”) the services and the mobile applications offered by Streamline Connect, LLC, an Arizona limited liability company (collectively, the “Company”). The Company may also be referred in this Privacy Policy as “we”, “us”, or “our”.  This Privacy Policy describes how the Company collects and uses personal information collected through the Website or through your correspondence with us by phone, email or otherwise. By accessing or using the Website or our services, you agree to this Privacy Policy. IF YOU DO NOT AGREE TO THIS PRIVACY POLICY, DO NOT ACCESS OUR WEBSITE OR USE OUR SERVICES.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>For purposes of the General Data Protection Regulation 2018 (“GDPR”), the data processor is Streamline Connect, LLC, an Arizona limited liability company, 5580 W. Chandler Blvd., Suite 3, Chandler, Arizona 85226.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Nature of Services</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>Streamshare is a service offered to property management companies utilizing the Streamline VRS, LLC software system. Streamshare allows property management companies to share inventory with other property management companies. Accordingly, when you choose to look at and inquire of additional inventory, you may be sharing your personal information with multiple property management companies.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Information We Collect About You</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>We adhere to ethical standards in gathering, using and safeguarding any information you provide. We collect personal information from you. Such information is collected when voluntarily submitted to us by you through access to the Website or filling out a form on the Website. The types of information that may be collected include your name, mailing address, email address, phone number, usage information, including the materials that you access on the Website and messages that you send through our online contact form. Because we are a data processor, this information is collected on behalf of and forwarded to our clients all of which are property management companies.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>We may automatically collect information from you each time you visit the Website. This includes technical information, information about your visit, and information about your activity on our Website such pages viewed, page response times, download errors, length of visit to certain pages, page interaction information (such as scrolling, clicks and mouseovers), methods to browse to and away from a page, and methods used to contact our support team. Technical information may also include the internet protocol address used to connect your computer to the Internet, browser type and version, time zone setting, browser plug-in types and versions, operating systems and device platform.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Information We Receive From Other Sources</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>This is information we receive about you from third parties that we work closely with to provide, promote and improve our services. These third parties include business and integration partners, vendors who assist in technical and payment services, analytics providers and search information providers.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>How We Collect Information</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>We collect information from you when you submit inquiries through our online contact form. We also use technology to collect information from you.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>We collect information from you when you speak to us or to our client by telephone. We or our client may record telephone conversations for quality assurance purposes. This Privacy Policy also governs those recordings.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>Cookies are small files that a site or its service provider transfers to your computer’s hard drive through your Web browser that enables the sites or service providers’ systems to recognize your browser and capture and remember certain information.  We do not link the information we store in cookies to any personal information you submit while on our site. We use both session ID cookies and persistent cookies.  A session ID cookie expires when you close your browser. A persistent cookie remains on your hard drive for an extended period of time.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>We use the following types of cookies:</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Strictly Necessary Cookies.</strong> These are cookies that are required for the operation of the Website and under our terms with you. They include, for example, cookies that enable you to log into secure areas of the Website, use a shopping cart or make use of e-billing services.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Analytical/Performance Cookies.</strong> They allow us to recognize and count the number of visitors and to see how visitors move around the Website. This helps us improve the way the Website works.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Functionality Cookies.</strong> These are used to recognize you when you return to the Website. This enables us, subject to your choices and preferences, to personalize our content and remember your preferences.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Targeting Cookies.</strong> These cookies record your visit to the Website, the pages you have visited and the links you have followed. We use this information to make the Website more relevant to your interests.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>This Website also includes certain components transmitted by Google Analytics, a web traffic analysis service provided by Google, Inc. (“Google”). Also in this case, they are third party cookies collected and managed anonymously to monitor and improve the performance of the Website. Google Analytics uses the cookies to collect and analyze anonymously the information on the behavior of use of the website. This information is collected by Google Analytics, which processes in order to prepare reports for the Company regarding activities on the Website. This Website doesn’t use the analysis tool of Google to track or collect personal information.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>We use the following web beacon technology:</p><p style='font-size: 14px;line-height: 22px;color: #000;'>Web beacons (a.k.a. clear gifs) are tiny graphics with a unique identifier, similar in function to cookies, which are used on our website to track online movements of web users and compile aggregated statistics to analyze how our site is used and may be used, in our services, or in our emails.  Our use of Web beacons also includes to count visits and to tell if an email has been opened and acted upon. We do not link the information gathered from web beacons to any personal information.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>As is true of most web sites, we gather certain information and store it in log files.  This information includes internet protocol (IP) addresses, browser type, internet service provider (ISP), referring/exist pages, operating system, date/time stamp, and clickstream data.  We use this information to analyze trends, to administer the site, to track users’ movements around the site and to gather demographic information about our user base as a whole.  We do not link this data to personal information.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>You have a variety of tools to control cookies, web beacons and similar technologies, including browser controls to block and delete cookies and controls from some third-party analytics service providers to opt out of data collection through web beacons and similar technologies.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Children</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>We do not knowingly collect information from anyone under the age of 16.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Social Media Widgets</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>Our Website includes Social Media Features (“Features”), such as the Facebook Like button and Widgets, such as the Twitter button, Share This button, or other interactive mini-programs that run on our site.  These Features may collect your IP address, which page you are visiting on our site, and may set a cookie to enable the Feature to function properly.  Features and Widgets are either hosted by a third party or hosted directly on our site.  Your interactions with these Features are governed by the privacy policy of the company providing it.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Use of Information</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>Company uses information, including personal information, to carry out the following purposes:</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Meeting our Obligations to You and to Our Clients.</strong> We and our clients may use your personal information to contact you at your request to provide further information about products and services offered by our client property management companies.  We and our clients may also contact you to carry out our obligations of delivering or supporting contracted services or products to you.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Improving and Maintaining the Website.</strong> Company may collect and use personal information to investigate any customer service issues that you or other users notify us about. We may use your IP address and other information collected from you to help diagnose problems with our server(s), create new functionality and to improve and administer the Website.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Improving and Developing Products and Services.</strong> We may use your personal information to improve and develop products or services offered. We may also use aggregated and anonymized information to assist us in providing the best service possible to our customers.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Communicating with You.</strong> We may collect and use personal information to inform you about new features of our software and advise you of offers that you may be interested in. Our clients, all of which are property management companies, may contact you directly concerning your bookings or to market to you.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Marketing the Website and Our Services.</strong> Additionally, we may use aggregated and anonymized information for marketing purposes such as generating or selling advertisements.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Disclosure of Your Information to Third-Parties</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>We will not sell your personal information to third parties for the purpose of such third parties' sending unsolicited offers or advertisements. However, based on the nature of our services, we will forward your personal information to third party property management companies when you inquire about a property and such third party property management companies may send you unsolicited offers and advertisements. Further, we may disclose your personal information as follows:</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Law Enforcement.</strong> We may need to share your information with law enforcement or government agencies in response to a subpoena, state and/or federal audit or as otherwise required by law.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Agents and Consultants.</strong> We sometimes hire other companies to perform certain business-related functions, such as sending email on our behalf, payment processing or conducting market research. We also share your email address with third parties, such as Facebook, LinkedIn and Twitter in order to provide custom marketing materials for you on their platforms. These companies are not permitted to use any personal information that we share with them for any other purpose aside from providing services to us.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Integration Partners.</strong> Our business integration partners offer products and services that complement our property management software. If you have requested information about services or products offered by an integration partner, we may give them your personal information. We may also give integration partners your personal information to offer products and services that enhance our system. These companies are not permitted to use any personal information that we share with them for any other purpose aside from providing services and offering products and services that complement our system.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Business Transfers.</strong> In the event that we sell all or part of our membership interests or assets or enter into a merger, we reserve the right to include personal information and non-personal information among assets transferred to the acquiring or surviving company.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>General Marketing Purposes.</strong> We may provide non-personal information about our customers’ sales, Website traffic patterns and related Website information to third party advertisers.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Individual Marketing Purposes.</strong> Our client property management companies may use your personal information to market specifically to you based on your interests.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Your Rights</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>In accordance with applicable privacy law, you have the following rights in respect of your personal information:</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Right of Access and Portability.</strong> The right to obtain access to your personal information along with certain information, and to receive that personal information in a commonly used format and to have it ported to another data controller.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Right to Rectification.</strong> The right to obtain rectification of your personal information without undue delay where that personal information is inaccurate or incomplete.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Right to Erasure.</strong> The right to obtain the erasure of your personal information without undue delay in certain circumstances, such as where the personal information is no longer necessary in relation to the purposes for which it was collected or processed.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Right to Restriction.</strong> The right to obtain the restriction of the processing undertaken by us on your personal information in certain circumstances, such as where the accuracy of the personal information is contested by you, for a period enabling us to verify the accuracy of that personal information.</p><p style='font-size: 14px;line-height: 22px;color: #000;'><strong>Right to Object.</strong> The right to object, on grounds relating to your particular situation, to the processing of your personal information, and to object to processing of your personal information for direct marketing purposes, to the extent it is related to such direct marketing.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>You have the right to request of each of our clients that they do not process your personal information for marketing purposes. You can exercise your right to prevent such processing by using the “Unsubscribe” link found in an email from a particular property management company or by contacting them directly using contact information found on their individual website. Please note that they may not include the opt-out information in e-mails that are transactional in nature and are not marketing communications. Please also note that because of the nature of our services, you may need to request that other property management companies not process your personal information for marketing purposes. Put simply, your request not to process your personal information for marketing purposes will apply to that particular property management company only and will not apply to other property management companies who obtained your information from your use of our services. We may not accommodate a request to change or delete personal information as we are a data processor for multiple property management companies and your information may be critical for your upcoming bookings with a particular property management company.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>If you are a California resident, California law permits you to request certain information regarding the disclosure of your personal information by us and our subsidiaries to third parties for the third parties’ direct marketing purposes. To make such a request, please use the contact information above.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>You can delete your account and erase all personal information associated with you at any time contacting the relevant property management company directly.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>For any request that you make, you should receive an email response from our client. Please contact our client if you do not receive confirmation within 30 days of your request.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Third Party Websites</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>The Company is not responsible for the privacy practices or policies of any third-party websites that are linked to the Website. We encourage you to read their respective privacy policies prior to providing any personal information at or to such sites.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Data Storage and Security</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>The information that we collect is stored in our database, which is secured through password authentication. Your information may be stored on our servers and also on servers of companies that we hire to provide services. Your information is also passed to our client property management companies and they may store your information on their servers.  In each case, information may be stored in the United States and in other countries where we operate, and in countries where our respective service providers operate. If you are in the European Union, Switzerland, or other regions with laws governing data collection and use, you acknowledge that we may transfer, process and store your personal information in the United States and other countries, the privacy laws of which may be considered less strict than those of your region.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>We understand that security of your personal and financial information is important to you, so we have taken steps to enhance the safety and confidentiality of personal and financial information sent to or from us. Company uses commercially reasonable efforts to maintain the security of the Website and your information. You must refer to each property management company for information containing their policies of maintaining the security of your information.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>Unfortunately, no data transmission over the Internet or any wireless network can be guaranteed to be 100% secure. As a result, while we strive to protect your personal information, you acknowledge that: (a) there are security and privacy limitations of the Internet that our beyond our control; (b) the security, integrity and privacy of any and all information and data exchanged between you and us through this Website cannot be guaranteed and we shall have no liability to you or any third party for loss, misuse, disclosure or alteration of such information; and (c) any such information and data may be viewed or tampered with in transit by a third party.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>If we become aware of a data breach that is likely to result in a risk for the rights and freedoms of individuals, we will notify you within 72 hours of first having become aware of the breach.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>Notwithstanding the foregoing, Company provides the Website 'as is' without any express or implied warranty of any kind, including warranties of merchantability, reliability, or fitness for a particular purpose.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Changes in Privacy Policy</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>This Privacy Policy may change from time to time to accommodate changes in the Website, changes in technology or legal developments. We will post any changes to the Privacy Policy on the Website.</p><h4 style='color:#2362AD;padding: 20px 0 10px;'>Contact Us</h4><p style='font-size: 14px;line-height: 22px;color: #000;'>To report any known or suspected privacy or security breaches or to submit privacy related questions or complaints please contact us at <a href='mailto:info@streamshare.com'>info@streamshare.com</a>.</p><p style='font-size: 14px;line-height: 22px;color: #000;'>Revised: July 2018</p></div></body></html>"}};$scope.terms=$sce.trustAsHtml($scope.SSterms.data.document_html_code)}}])})();(function(){var Filters=angular.module("resortpro.filters",[]);Filters.filter("trustedHtml",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]);Filters.filter("pluralizeRating",["$sce",function($sce){return function(rating){return rating>1?rating+" reviews":rating+" review"}}]);Filters.filter("toSlug",["$sce",function($sce){return function(input){if(typeof input=="undefined"){return""}return input.toLowerCase().replace(/ /g,"-").replace(/[^\w\-]-/g,"")}}]);Filters.filter("currencyTranslate",function(translator){var translated={};var separator="_";var filter=function(text,symbol,fractionSize){if(!text){return""}var currency=translator.settings.currency||translator.defaults.currency;if(angular.isObject(currency)){currency=translator.defaults.currency}if(!translated[currency]){translated[currency]={}}var key=text+separator+symbol+separator+fractionSize;if(translated[currency][key]){return translated[currency][key].translation}translated[currency][key]={translation:"Loading..."};translator.translateCurrency(text,symbol,fractionSize).then(function(translation){currency=translator.settings.currency;if(!translated[currency][key]){translated[currency][key]={}}translated[currency][key].translation=translation}).catch(function(){return false});return translated[currency][key].translation};filter.$stateful=true;return filter});Filters.filter("groupBy",["$parse","$filter",function($parse,$filter){return function(array,groupByField){var result=[];var prev_item=null;var groupKey=false;var filteredData=$filter("orderBy")(array,groupByField);for(var i=0;i<filteredData.length;i++){groupKey=false;if(prev_item!==null){if(prev_item[groupByField]!==filteredData[i][groupByField]){groupKey=true}}else{groupKey=true}if(groupKey){filteredData[i]["group_by_key"]=true}else{filteredData[i]["group_by_key"]=false}result.push(filteredData[i]);prev_item=filteredData[i]}return result}}])})();(function(){var app=angular.module("resortpro.property",["resortpro.services","resortpro.filters","resortpro.directives","ngCookies","infinite-scroll"]);var mod=angular.module("infinite-scroll",[]);mod.directive("infiniteScroll",["$rootScope","$window","$timeout",function($rootScope,$window,$timeout){return{link:function(scope,elem,attrs){var checkWhenEnabled,handler,scrollDistance,scrollEnabled;$window=angular.element($window);scrollDistance=0;if(attrs.infiniteScrollDistance!=null){scope.$watch(attrs.infiniteScrollDistance,function(value){return scrollDistance=parseInt(value,10)})}scrollEnabled=true;checkWhenEnabled=false;if(attrs.infiniteScrollDisabled!=null){scope.$watch(attrs.infiniteScrollDisabled,function(value){scrollEnabled=!value;if(scrollEnabled&&checkWhenEnabled){checkWhenEnabled=false;return handler()}})}handler=function(){if(scope.enableInfinitiScroll){var elementBottom,remaining,shouldScroll,windowBottom;windowBottom=$window.height()+$window.scrollTop();elementBottom=elem.offset().top+elem.height();remaining=elementBottom-windowBottom;shouldScroll=remaining<=$window.height()/scrollDistance;if(shouldScroll&&scrollEnabled){if($rootScope.$$phase){return scope.$eval(attrs.infiniteScroll)}else{return scope.$apply(attrs.infiniteScroll)}}else if(shouldScroll){return checkWhenEnabled=true}}};$window.on("scroll",handler);scope.$on("$destroy",function(){return $window.off("scroll",handler)});return $timeout(function(){if(attrs.infiniteScrollImmediateCheck){if(scope.$eval(attrs.infiniteScrollImmediateCheck)){return handler()}}else{return handler()}},0)}}}]);app.controller("PropertyController",["$scope","$rootScope","$sce","$http","$window","$filter","Alert","rpapi","rpuri","$cookies","$templateCache","toSlugFilter","$location",function($scope,$rootScope,$sce,$http,$window,$filter,Alert,rpapi,rpuri,$cookies,$templateCache,$toSlugFilter,$location){$rootScope.properties=[];$rootScope.reviews=[];$rootScope.rates_details=[];$rootScope.amenities=[];$rootScope.rates2=[];$rootScope.calendar=[];$rootScope.calendar2={};$scope.blockedPeriods=[];$rootScope.groups=[];$scope.loading=true;$scope.foundUnits=true;$scope.minPrice=0;$scope.maxPrice=500;$scope.maxOccupants=0;$scope.autoZoom=0;$scope.bedroomsNumber="";$scope.neighborhood="";$scope.viewname="";$scope.locationAreaId="";$scope.mapEnabled=false;$scope.mapSearch=false;$scope.inquiryOnly=false;$scope.showMoreButton=false;$scope.startDate=$filter("date")(rpuri.getQueryStringParam("sd"),"MM/dd/yyyy");$scope.endDate=$filter("date")(rpuri.getQueryStringParam("ed"),"MM/dd/yyyy");$scope.flexCount=0;$scope.flex=rpuri.getQueryStringParam("flex");$scope.flexPagination=1;$scope.flexTotalPages=0;$scope.flex_date_original=0;$scope.flex_min_stay=0;$scope.occupants=rpuri.getQueryStringParam("oc");$scope.minPriceSearch=rpuri.getQueryStringParam("min_price");$scope.maxPriceSearch=rpuri.getQueryStringParam("max_price");$scope.plusLogic=0;$scope.guest_plusLogic=0;$scope.campaign_code="";$scope.coupon_info=[];$scope.bed_plusLogic=0;$scope.isFitBounds=false;$scope.mapRecentered=false;$scope.skipUnits="";$scope.flexSkip=[];$scope.compareList=$cookies.getObject("streamline-compare-units");$scope.isDays=false;$scope.isWeeks=false;$scope.showDays=true;$scope.showQuickView=false;$scope.restrictedMinStayProps=[];$scope.restrictedDateStart=0;$scope.restrictedDateEnd=0;$scope.showDays_AD=true;$scope.modal_total_reservation=0;$scope.total_pages=0;$scope.total_units=0;$scope.daysDiff=0;$scope.method="";$scope.wishlist=[];$scope.foundCalendarBooking=false;$scope.maxCalendarDate=null;$scope.isAvailabilitySearch=false;$scope.currentPage=1;$scope.enableInfinitiScroll=false;$scope.initUplift=false;$scope.upIcon=10;$scope.downIcon=1;$scope.cartAbandomentMotivator=[];$scope.visible_btn_rates="";$scope.showAllRates=$rootScope.show_all_rates;$scope.foundReviews=true;$scope.enable_booking=true;$scope.onlyInquiry=false;$scope.flexUnit=true;$scope.percent="";$scope.selectedAmenities={};if($rootScope.enable_amp==1){$scope.cstUnitSrc={};$scope.AmpFlexDate=""}if($rootScope.avail_calendar_type=="arrival_depart"){$scope.showDays_AD=false}if($rootScope.avail_calendar_type=="arrival_weeks"){$scope.isWeeks=true}if($rootScope.avail_calendar_type=="arrival_nights"){$scope.isDays=true}if($rootScope.searchSettings.enable_all_pins==1){$scope.searchNumber=0}if($rootScope.bookingSettings.book_now=="disabled"){$scope.enable_booking=false}var map;var markerList={};var arrMarkers=[];var infowindow;var marker;var bounds;var currency;var markers=[];var circle="";var lines=[];var dist=$rootScope.searchSettings.added_marker_radius;if($rootScope.enable_multicurrency==1){currency=$filter("currencyTranslate")}else{currency=$filter("currency")}var check_block_rate=$cookies.getObject("streamline-block_rates");if(check_block_rate==1||typeof check_block_rate=="undefined"){jQuery(".login_btn_action").show();jQuery(".logout_btn_action").hide();jQuery(".detail_calendar").hide();jQuery(".login_availability_calendar").show()}else{jQuery(".login_btn_action").hide();jQuery(".logout_btn_action").show();jQuery(".login_availability_calendar").hide();jQuery(".detail_calendar").show()}$scope.checkPasswordRatelogin=function(){var today=new Date,expireDate=new Date(today);expireDate.setDate(today.getDate()+1);if($scope.rates.password==$rootScope.bookingSettings.enter_pw_1){jQuery(".rates_container").removeClass("block_rates_main");jQuery("#pwModal").modal("hide");jQuery(".book_now_btn_action").show();jQuery(".c-sidebar__inquiry-btn").show();jQuery(".login_btn_action").hide();jQuery(".logout_btn_action").show();$cookies.putObject("streamline-block_rates",0,{path:"/",expires:expireDate,secure:"true"});var selectedRateType=$rootScope.bookingSettings.rate_type_1;$cookies.put("streamline-rate_type",selectedRateType,{path:"/",expires:expireDate,secure:"true"});var selectedRateTypeID=$rootScope.bookingSettings.rate_type_id_1;$cookies.put("streamline-rate_type_id",selectedRateTypeID,{path:"/",expires:expireDate,secure:"true"})}else if($scope.rates.password==$rootScope.bookingSettings.enter_pw_2){jQuery(".rates_container").removeClass("block_rates_main");jQuery("#pwModal").modal("hide");jQuery(".book_now_btn_action").show();jQuery(".c-sidebar__inquiry-btn").show();jQuery(".login_btn_action").hide();jQuery(".logout_btn_action").show();$cookies.putObject("streamline-block_rates",0,{path:"/",expires:expireDate,secure:"true"});var selectedRateType=$rootScope.bookingSettings.rate_type_2;$cookies.put("streamline-rate_type",selectedRateType,{path:"/",expires:expireDate,secure:"true"});var selectedRateTypeID=$rootScope.bookingSettings.rate_type_id_2;$cookies.put("streamline-rate_type_id",selectedRateTypeID,{path:"/",expires:expireDate,secure:"true"})}else if($scope.rates.password==$rootScope.bookingSettings.enter_pw_3){jQuery(".rates_container").removeClass("block_rates_main");jQuery("#pwModal").modal("hide");jQuery(".book_now_btn_action").show();jQuery(".c-sidebar__inquiry-btn").show();jQuery(".login_btn_action").hide();jQuery(".logout_btn_action").show();$cookies.putObject("streamline-block_rates",0,{path:"/",expires:expireDate,secure:"true"});var selectedRateType=$rootScope.bookingSettings.rate_type_3;$cookies.put("streamline-rate_type",selectedRateType,{path:"/",expires:expireDate,secure:"true"});var selectedRateTypeID=$rootScope.bookingSettings.rate_type_id_3;$cookies.put("streamline-rate_type_id",selectedRateTypeID,{path:"/",expires:expireDate,secure:"true"})}else if($scope.rates.password==$rootScope.bookingSettings.enter_pw_4){jQuery(".rates_container").removeClass("block_rates_main");jQuery("#pwModal").modal("hide");jQuery(".book_now_btn_action").show();jQuery(".c-sidebar__inquiry-btn").show();jQuery(".login_btn_action").hide();jQuery(".logout_btn_action").show();$cookies.putObject("streamline-block_rates",0,{path:"/",expires:expireDate,secure:"true"});var selectedRateType=$rootScope.bookingSettings.rate_type_4;$cookies.put("streamline-rate_type",selectedRateType,{path:"/",expires:expireDate,secure:"true"});var selectedRateTypeID=$rootScope.bookingSettings.rate_type_id_4;$cookies.put("streamline-rate_type_id",selectedRateTypeID,{path:"/",expires:expireDate,secure:"true"})}else{jQuery(".error_pw").show()}$window.location.reload()};$scope.removeRateCookies=function(){$cookies.putObject("streamline-block_rates",1,{path:"/",secure:"true"});$cookies.remove("streamline-rate_type",{path:"/",secure:"true"});jQuery(".login_btn_action").show();jQuery(".logout_btn_action").hide();$window.location.reload()};$scope.isString=function(val,allowEmpty){if(angular.isString(val)){if(allowEmpty){return true}else{if(val!=""){return true}}}return false};$scope.checkString=function(val,allowEmpty){if(angular.isString(val)){if(allowEmpty){return true}else{if(val!=""){return true}}}return false};$scope.checkNumber=function(val,allowZero){if(angular.isNumber(val)){if(allowZero){return true}else{if(val>0){return true}}}else{if(val&&val!==null){if(val.length>0){if(!isNaN(val)){return true}}}}return false};$scope.isNumber=function(val,allowZero){if(angular.isNumber(val)){if(allowZero){return true}else{if(val>0){return true}}}else{if(val&&val!==null){if(val.length>0){if(!isNaN(val)){return true}}}}return false};$scope.isArray=angular.isArray;function m2k(miles){var mi=parseFloat(miles);var km="";if(!isNaN(mi))km=mi*1.609344*1e3;return km}var setRadius=m2k(parseInt(dist));$scope.searchBox=function(){var lineColor=$rootScope.searchSettings.line_color;var lineOpacity=$rootScope.searchSettings.line_opacity;var lineWeight=$rootScope.searchSettings.line_weight;setTimeout(function(){if(markers.length>0&&$rootScope.searchSettings.add_map_lines==1){var centerCircle=new google.maps.LatLng(markers[0].getPosition().lat(),markers[0].getPosition().lng());for(i=0;i<arrMarkers.length;i++){var markerPos=arrMarkers[i].getPosition();if(google.maps.geometry.spherical.computeDistanceBetween(centerCircle,markerPos)<=setRadius){lines.push(new google.maps.Polyline({path:[markerPos,centerCircle],strokeColor:lineColor,strokeOpacity:lineOpacity,strokeWeight:lineWeight,geodesic:true,map:map}))}}}},1300)};$scope.initializeData=function(){$scope.initializeMap();if($rootScope.searchSettings.enable_redirect_unit==1||$rootScope.searchSettings.block_hided_units==1){$scope.show_only_to+=$rootScope.searchSettings.neighborhoodIds;$scope.show_only_to+=$rootScope.searchSettings.locationIds;$scope.show_only_to+=$rootScope.searchSettings.GroupIds;$scope.show_only_to+=$rootScope.searchSettings.amenity_filtersIDs;$scope.show_only_to+=$rootScope.searchSettings.home_typesIDs;$scope.showArea=$rootScope.searchSettings.locationAreas;$scope.show_only_to=$rootScope.searchSettings.propertyDeleteUnits;setTimeout(function(){if($scope.show_only_to!=""||$scope.showArea!=""){var checkThem=[$scope.propertyId,$scope.inquiry.unit_name,$scope.area_id];var availableUnit=false;checkThem.filter(function(item){if($scope.show_only_to.includes(item)){availableUnit=true}if($scope.showArea.length&&$scope.showArea!==$scope.area_id){availableUnit=true}})[0];if(availableUnit==true&&$rootScope.searchSettings.enable_redirect_unit==1&&$rootScope.searchSettings.block_hided_units==0){window.location.href=$rootScope.searchSettings.redirect_link}else if(availableUnit==true&&$rootScope.searchSettings.block_hided_units==1&&$rootScope.searchSettings.enable_redirect_unit==0){hide_waitMe(".site-main");var rate_type_name=$cookies.get("streamline-unit_unlocked");if(rate_type_name==1){jQuery("#unitPW").modal("hide")}else{jQuery("#unitPW").modal("show");jQuery(".layout").addClass("block_unit_page")}$scope.checkPasswordUnit=function(){if($scope.units_password==$rootScope.bookingSettings.blocked_units_password){jQuery("#unitPW").modal("hide");jQuery(".layout").removeClass("block_unit_page");$cookies.putObject("streamline-unit_unlocked",1,{path:"/",secure:"true"})}else{jQuery(".error_pw").show()}};$scope.redirectSeach=function(){window.location.href="/search-results/"}}else{hide_waitMe(".site-main")}}else{hide_waitMe(".site-main")}},50)}};$scope.initializeMap=function(){$scope.mapSearchEnabled=true;$scope.mapEnabled=true;$scope.$on("mapInitialized",function(evt,evtMap){map=evtMap;bounds=map.getBounds();if($rootScope.disable_zoom==1){map.set("zoomControl",false);map.set("disableDoubleClickZoom",true)}var mapNew=evtMap;var max_zoom=parseInt($rootScope.searchSettings["max_map_zoom"],10);if($rootScope.map_hide_companies==1){var myStyle=[{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];map.set("styles",myStyle)}if($rootScope.searchSettings.enable_map_clusters==1){var myStyle=[{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];map.set("styles",myStyle)}map.set("streetViewControl",false);if(max_zoom>0){map.set("maxZoom",max_zoom);map.addListener("dblclick",function(e){var current_zoom=map.getZoom();if(current_zoom>max_zoom-1){jQuery(document).find(".map-search map").addClass("stop")}});google.maps.event.addListener(map,"zoom_changed",function(e){var current_zoom=map.getZoom();if(current_zoom>max_zoom-1){jQuery(document).find(".map-search map").addClass("stop")}else{jQuery(document).find(".map-search map").removeClass("stop")}})}if($rootScope.searchSettings.places_search_box==1){var options={componentRestrictions:{country:"us"}};var input=document.getElementById("loc-input");var search_box_btn=document.getElementById("loc-input-search");var searchBox=new google.maps.places.Autocomplete(input,options);map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);map.controls[google.maps.ControlPosition.TOP_LEFT].push(search_box_btn);map.addListener("bounds_changed",function(e){searchBox.setBounds(map.getBounds())});searchBox.addListener("place_changed",function(e){var place=searchBox.getPlace();if(place.length==0){return}if(circle!==""){circle.setMap(null)}angular.forEach(markers,function(marker,i){marker.setMap(null)});angular.forEach(lines,function(line,i){line.setMap(null)});markers=[];circle=[];lines=[];var bounds=new google.maps.LatLngBounds;if(!place.geometry){return}var icon={url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};markers.push(new google.maps.Marker({map:map,icon:icon,title:place.name,position:place.geometry.location,optimized:false,zIndex:-1,setOpacity:1}));circle=new google.maps.Circle({map:map,radius:setRadius,fillColor:"#000",fillOpacity:.2,strokeColor:0,strokeOpacity:0,strokeWeight:0});circle.bindTo("center",markers[0],"position");if(place.geometry.viewport){bounds.union(place.geometry.viewport)}else{bounds.extend(place.geometry.location)}map.fitBounds(bounds)});jQuery(document).ready(function(){setTimeout(function(){jQuery("#loc-input").show();jQuery("#loc-input-search").show()},1500)})}})};$scope.initQuotes=function(startdate,enddate){setTimeout(function(){if(typeof UpLift!=="undefined"){UpLift.Payments.init({apiKey:$rootScope.upliftApiKey,onModalClose:$scope.myOnModalCloseHandler,onModalOpen:$scope.myOnModalOpenHandler,locale:"en-US",currency:"USD"});var params={startdate:startdate,enddate:enddate,order_total:0};var tripInfo=$scope.buildTripInfo(params);setTimeout(function(){UpLift.Payments.load(tripInfo,$scope.myPaymentsLoadCallback)},500)}},1e3)};$scope.toggleMapSearch=function(){if($scope.mapSearchEnabled==false){$scope.mapSearchEnabled=true}else{$scope.mapSearchEnabled=false}};$scope.StreamshareStatus=function(){$scope.StreamshareStatus={status:"1"}};$scope.getStreamshareDestinationsOffer=function(Streamsharefilters){run_waitMe("#streamshareModal .modal-body","roundBounce","Updating Results...");$rootScope.Splitter="-";$rootScope.Streamsharefilters=Streamsharefilters;rpapi.getWithParams("GetGeographicHierarchy",{}).success(function(obj){hide_waitMe("#streamshareModal .modal-body");if(typeof obj.data["id"]!="undefined"){$scope.continentsList=[obj.data]}else{$scope.continentsList=obj.data}angular.forEach($scope.continentsList[0],function(continent){if(typeof continent.states["id"]!="undefined"){continent["states"]=[continent.states]}angular.forEach(continent.states,function(states){if(typeof states.cities["id"]!="undefined"){states["cities"]=[states.cities]}})});jQuery(document).ready(function(){setTimeout(function(){jQuery(function(){jQuery(".tree ul li").has("ul").addClass("parent_li").find("i").attr("title","Show Less Destinations");jQuery(".tree li.parent_li > i").on("click",function(e){var children=jQuery(this).parent("li.parent_li").find(" > ul > li");if(children.is(":visible")){children.hide("fast");jQuery(this).attr("title","Show More Destinations").addClass("fa-plus-square").removeClass("fa-minus-square-o")}else{children.show("fast");jQuery(this).attr("title","Show Less Destinations").addClass("fa-minus-square-o").removeClass("fa-plus-square")}e.stopPropagation()})})},1e3)})})};$scope.goToProperty=function(seo_page_name,sd,ed,adults,children,pets,sale,bedrooms_number,home_type,area,neighborhood,location_resort,view,group_type,campaign_code){var lowercase_seopage=$filter("lowercase")(seo_page_name);var url=$rootScope.propertyUrl+lowercase_seopage;if("1"==$rootScope.useHTML){url=url+".html"}else{url=url+"/"}var query_string="";if(sd!=undefined&&sd!="")query_string+="sd="+encodeURIComponent(sd)+"&";if(ed!=undefined&&ed!="")query_string+="ed="+encodeURIComponent(ed)+"&";if(adults!=undefined&&adults!="")query_string+="oc="+encodeURIComponent(adults)+"&";if(children!=undefined&&children!="")query_string+="ch="+encodeURIComponent(children)+"&";if(pets!=undefined&&pets!="")query_string+="pets="+encodeURIComponent(pets)+"&";if(sale!=undefined&&sale=="yes")query_string+="sale=1";if(bedrooms_number!=undefined&&bedrooms_number!="")query_string+="beds="+encodeURIComponent(bedrooms_number)+"&";if(home_type!=undefined&&home_type!="")query_string+="property_type_id="+encodeURIComponent(home_type)+"&";if(area!=undefined&&area!="")query_string+="area_id="+encodeURIComponent(area)+"&";if(neighborhood!=undefined&&neighborhood!="")query_string+="neighborhood_area_id="+encodeURIComponent(neighborhood)+"&";if(location_resort!=undefined&&location_resort!="")query_string+="resort_area_id="+encodeURIComponent(location_resort)+"&";if(view!=undefined&&view!="")query_string+="view_name="+encodeURIComponent(view)+"&";if(group_type!=undefined&&group_type!="")query_string+="group_id="+encodeURIComponent(group_type)+"&";if($location.search().campaign_code!=undefined&&$location.search().campaign_code!="")query_string+="campaign_code="+encodeURIComponent($location.search().campaign_code)+"&";if(query_string!="")url+="?"+query_string.replace(/&+$/,"");return encodeURI(url)};$scope.goToPropertyRedirect=function(property,search,flex_dates){var lowercase_seopage=$filter("lowercase")(property.seo_page_name);var url=$rootScope.propertyUrl+lowercase_seopage;if("1"==$rootScope.useHTML){url=url+".html"}else{url=url+"/"}var query_string="";if(search){if(flex_dates&&flex_dates.length==1){if(flex_dates[0].startdate!=undefined&&flex_dates[0].startdate!="")query_string+="sd="+encodeURIComponent(flex_dates[0].startdate)+"&";if(flex_dates[0].enddate!=undefined&&flex_dates[0].enddate!="")query_string+="ed="+encodeURIComponent(flex_dates[0].enddate)+"&"}else{if(search.start_date!=undefined&&search.start_date!="")query_string+="sd="+encodeURIComponent(search.start_date)+"&";if(search.end_date!=undefined&&search.end_date!="")query_string+="ed="+encodeURIComponent(search.end_date)+"&"}if(search.occupants!=undefined&&search.occupants!="")query_string+="oc="+encodeURIComponent(search.occupants)+"&";if(search.occupants_small!=undefined&&search.occupants_small!="")query_string+="ch="+encodeURIComponent(search.occupants_small)+"&";if(search.pets!=undefined&&search.pets!="")query_string+="pets="+encodeURIComponent(search.pets)+"&";if(property.sale_enabled!=undefined&&property.sale_enabled=="yes")query_string+="sale=1";if(search.bedrooms_number!=undefined&&search.bedrooms_number!="")query_string+="beds="+encodeURIComponent(search.bedrooms_number)+"&";if($location.search().campaign_code!=undefined&&$location.search().campaign_code!="")query_string+="campaign_code="+encodeURIComponent($location.search().campaign_code)+"&"}if(query_string!="")url+="?"+query_string.replace(/&+$/,"");property.url=url;return property};$scope.turnDateSearch=function(turnDay){$scope.turnDayFri=true;$scope.turnDaySat=true;$scope.turnDaySun=true;$scope.turnDayAll=true;$scope.turn_dates_logic=1;$scope.disable_minimal_days=1;$scope.turnDayMessage="Fri, Sat & Sun";if(turnDay==5){$scope.turnDayFri=false;$scope.turnDayMessage="Friday"}if(turnDay==6){$scope.turnDaySat=false;$scope.turnDayMessage="Saturday"}if(turnDay==7){$scope.turnDaySun=false;$scope.turnDayMessage="Sunday"}if(!turnDay)$scope.turnDayAll=false;if(turnDay){var params=$scope.getParams();params.show_restrictions=0;params.disable_minimal_days=0;$scope.disable_minimal_days=0;var startDate=new Date(params.startdate);var endDate=new Date(params.enddate);var startDay=startDate.getDay();if(startDay==0)startDay=7;var dayDifference=turnDay-startDay;var turnDayStartDate=new Date(startDate.getTime()+dayDifference*864e5);var turnDayEndDate=new Date(endDate.getTime()+dayDifference*864e5);params.startdate=$scope.formatDate(turnDayStartDate);params.enddate=$scope.formatDate(turnDayEndDate);$scope.search.start_date=params.startdate;$scope.search.end_date=params.enddate;var page_size=$rootScope.searchSettings.propertyPagination;if($rootScope.searchSettings.pagination_option==2){jQuery("#inventory-pagination").twbsPagination("destroy")}$scope.searchProperties(params,false,page_size,1,true)}};$scope.checkSorting=function(update_listing){if(update_listing){$scope.currentPage=1;$scope.availabilitySearch()}if($scope.sortBy=="pets"){$scope.sort=false}if($scope.sortBy=="max_occupants"){$scope.sort=true}if($scope.sortBy=="min_occupants"){$scope.sort=false}if($scope.sortBy=="price"){$scope.sort=true}if($scope.sortBy=="price_low"){$scope.sort=false}if($scope.sortBy=="price_daily"){$scope.sort=true}if($scope.sortBy=="price_daily_low"){$scope.sort=false}if($scope.sortBy=="name"){$scope.sort=false}if($scope.sortBy=="bedrooms_number"){$scope.sort=true}if($scope.sortBy=="min_bedrooms_number"){$scope.sort=false}if($scope.sortBy!="default"){$location.search("sort_by",$scope.sortBy)}else{$location.search("sort_by",null)}};jQuery("#choose_sort").on("click",function(){$scope.$watch("sortBy",function(){run_waitMe(".listings_wrapper_box","bounce","Updating Results");setTimeout(function(){hide_waitMe(".listings_wrapper_box")},500)})});$scope.customSorting=function(property){if($scope.sortBy=="max_occupants"||$scope.sortBy=="min_occupants"){return property.max_occupants}else if($scope.sortBy=="bedrooms_number"||$scope.sortBy=="min_bedrooms_number"){if(!property.bedrooms_number){property.bedrooms_number=0}return property.bedrooms_number}else if($scope.sortBy=="bathrooms_number"){return property.bathrooms_number}else if($scope.sortBy=="name"){if(property.location_name==null){property.location_name=""}return property.location_name}else if($scope.sortBy=="area"){return property.square_foots}else if($scope.sortBy=="view"){return property.view_name}else if($scope.sortBy=="price_low"||$scope.sortBy=="price"){var diffDays=0;if($scope.search){diffDays=$scope.getDaysDifference($scope.search.start_date,$scope.search.end_date)}var price=0;if($scope.method!="GetPropertyAvailabilityWithRatesWordPress"&&$scope.method!="BizcorGetPropertyAvailabilityWithRatesWordPress"){if($rootScope.searchSettings.useDailyPricing==1&&property.price_data.daily&&property.price_data.daily>0){price=property.price_data.daily}if($rootScope.searchSettings.useWeeklyPricing==1&&property.price_data.weekly&&property.price_data.weekly>0){price=property.price_data.weekly}if($rootScope.searchSettings.useMonthlyPricing==1&&property.price_data.monthly&&property.price_data.monthly>0){price=property.price_data.monthly}if(diffDays<7){price=property.price_data.daily}if(diffDays>=7&&diffDays<30&&property.price_data.weekly>0&&$rootScope.searchSettings.useDailyPricing==1&&$rootScope.searchSettings.useWeeklyPricing==1){price=property.price_data.weekly/7}if(diffDays>=30&&property.price_data.monthly>0&&$rootScope.searchSettings.useDailyPricing==1&&$rootScope.searchSettings.useMonthlyPricing==1){price=property.price_data.monthly/30}return price}else if($scope.method!=="GetPropertyAvailabilityWithRatesWordPress"&&$rootScope.enable_turn_day_searching==1){return property.price}else{return property.total}}else if($scope.sortBy=="pets"){return property.max_pets}else{return[]}};$scope.getUnitName=function(unit){if($scope.isString(unit.web_name)&&unit.web_name!=""){return unit.web_name}else{if($scope.isString(unit.location_name)&&(unit.name==""||unit.name=="Home")){return unit.location_name}else{return unit.name}}};$scope.sleepingArea=function(unit){var areas=[];unit.unit_amenities.amenity.filter(function(item){if(item.group_name==="# of Sleeping Areas"){areas.push(item.amenity_name)}})[0];var maxArea=areas.pop();if(maxArea==1){return maxArea+" Sleeping Area"}else{return maxArea+" Sleeping Areas"}};$scope.calculateMarkup=function(strPrice){var price=strPrice;if(typeof strPrice=="string"){price=parseFloat(strPrice.replace("$","").replace(",",""))}if($rootScope.rateMarkup>0){var pct=1+parseFloat($rootScope.rateMarkup)/100;price=price*pct}return price};$scope.disableMapSearch=function(){$scope.mapSearchEnabled=false;$scope.availabilitySearch($scope.search)};$scope.clearProperties=function(){$rootScope.properties=[]};$scope.isEmptyString=function(obj){return!(obj!=undefined&&obj!="")};$scope.isEmptyObject=function(obj){return angular.equals({},obj)||obj==null};$scope.isString=function(item){return angular.isString(item)};$scope.loadClusters=function(){var setGridSize=parseInt($rootScope.searchSettings.grid_size);var setMaxZoom=parseInt($rootScope.searchSettings.max_zoom);var setminClusterSize=parseInt($rootScope.searchSettings.minimum_cluster_size);if(map!=undefined){markerCluster=new MarkerClusterer(map,arrMarkers,{maxZoom:setMaxZoom,gridSize:setGridSize,minimumClusterSize:setminClusterSize})}};$scope.loadMarkers=function(properties,setBounds){if($scope.mapEnabled){var adjust_bounds=false;$scope.mapSearchEnabled=0;angular.forEach(properties,function(property,key){if(!isNaN(property.location_latitude)&&!isNaN(property.location_longitude)&&property.location_latitude!=null&&property.location_longitude!=null){var latLong=new google.maps.LatLng(property.location_latitude,property.location_longitude);if(key==0&&map!=undefined&&setBounds){map.setZoom(15);map.setCenter(latLong);$scope.mapRecentered=true}var marker={id:property.id,name:property.web_name?property.web_name:property.location_name,area:property.location_area_name,rating:property.rating_average>5&&property.rating_average?'<span style="width:'+property.rating_average+'%"></span>':'<span style="width:'+property.rating_average/5*100+'%"></span>',rating_count:property.rating_count>0&&property.rating_count?'<span class="c-star-rating__count pull-right">('+property.rating_count+") reviews</span>":'<span class="c-star-rating__count pull-right">New Property</span>',latitude:property.location_latitude,longitude:property.location_longitude,image:property.default_thumbnail_path,beds:property.bedrooms_number,baths:property.bathrooms_number,guests:property.max_occupants,seo_page_name:property.seo_page_name,home_type:property.home_type,area:property.location_area_name,area_id:property.location_area_id,state:property.state_name,state_id:property.state_id,ski_out:property.variable_ski_out,hot_tub:property.variable_hot_tub};if(property.gallery){marker["gallery"]=property.gallery.image}if(($scope.method=="GetPropertyAvailabilityWithRatesWordPress"||$scope.method=="BizcorGetPropertyAvailabilityWithRatesWordPress")&&property.total){if($rootScope.searchSettings.priceDisplay=="price"&&property.price>0){marker["price"]=property.price}else{marker["price"]=property.total}}else{marker["price"]=property.price_data}function checkMapBounds(){if(bounds!=undefined){if(!bounds.contains(latLong)){bounds.extend(latLong);map.fitBounds(bounds);adjust_bounds=true}$scope.loadMarker(marker)}}if(map!=undefined){bounds=map.getBounds();checkMapBounds()}else{setTimeout(function(){if(map!=undefined){bounds=map.getBounds();checkMapBounds()}},2e3)}}if($rootScope.searchSettings.enable_adv_geo_map_logic==1){jQuery(document).find("path#"+property.state_name).addClass("active");jQuery(document).find("#us-geo-map").show()}})}if($rootScope.searchSettings.enable_map_clusters==1&&map!=undefined){$scope.loadClusters()}if(map!=undefined&&setBounds){$scope.isFitBounds=false;if(adjust_bounds){$scope.isFitBounds=true;adjust_bounds=false}}$scope.mapSearchEnabled=1};$scope.view_more=function(property){$scope.showQuickView=true;$scope.showDays=true;$scope.modal_total_reservation=0;$scope.modal_nights="";$scope.modal_weeks="";$scope.popup_view=property;$scope.quickAmenities=[];if($scope.popup_view.unit_amenities){angular.forEach($scope.popup_view.unit_amenities.amenity,function(amenity,i){if(amenity.amenity_show_on_website=="yes"){$scope.quickAmenities.push(amenity)}})}$scope.getPropertyReviews($scope.popup_view.id);$scope.selected="1";if($rootScope.searchSettings.full_description==1){if($scope.popup_view.description==""){jQuery("#quick-description").css("display","none");$scope.selected=(parseInt($scope.selected)+1).toString()}else{jQuery("#quick-description").css("display","block")}}else{if($scope.popup_view.short_description==""){jQuery("#quick-description").css("display","none");$scope.selected=(parseInt($scope.selected)+1).toString()}else{jQuery("#quick-description").css("display","block")}}if(typeof $scope.popup_view.unit_amenities.amenity=="undefined"&&$scope.popup_view.unit_amenities.amenity.length<1){jQuery("#quick-amenities").css("display","none");if($scope.selected!=="1"){$scope.selected=(parseInt($scope.selected)+1).toString()}}else{jQuery("#quick-amenities").css("display","block")}jQuery(".slider").css({left:0});jQuery(document).on("click",".info-tabs .info-tab",function(){handleTabChange(jQuery(this))});function handleTabChange(tab){var nav=tab.closest(".nav");jQuery(".slider",nav).css({width:tab.outerWidth(),left:tab.position().left});tab.siblings().removeClass("active");tab.addClass("active")}jQuery("#resortpro_form_checkout")[0].reset();jQuery(".quick-pricing").hide();jQuery(".quick-booking").show();jQuery(".quick-booking .alert-danger").hide();$scope.number=property.max_occupants;$scope.view_price=function(property){if(jQuery("#book_start_date").val()==""&&jQuery("#book_end_date").val()==""){jQuery(".quick-booking .alert-danger").show()}else{if(jQuery("#book_occupants").val()==""){jQuery("#book_occupants").val("1")}jQuery(".quick-booking").fadeOut();jQuery(".quick-pricing").fadeIn(500);jQuery(".quick-booking .alert-danger").hide();var start_date=jQuery("#book_start_date").val();var end_date=jQuery("#book_end_date").val();var adults=jQuery("#book_occupants").val();var params={unit_id:$scope.popup_view.id,startdate:start_date,enddate:end_date,occupants:adults,use_description:"yes",include_coupon_information:1};run_waitMe(".quick-view-unit","bounce","Updating Results");rpapi.getWithParams("GetPreReservationPrice",params).success(function(obj){hide_waitMe(".quick-view-unit");if(obj.data!=undefined){var total_fees=0;var total_taxes=0;if(obj.data.required_fees.id){total_fees=obj.data.required_fees.value}else{angular.forEach(obj.data.required_fees,function(fee,i){total_fees+=fee.value})}if(obj.data.taxes_details.id){total_taxes=obj.data.taxes_details.value}else{angular.forEach(obj.data.taxes_details,function(fee,i){total_taxes+=fee.value})}$scope.total_reservation=obj.data.total;$scope.total_fees=total_fees;$scope.total_taxes=total_taxes;$scope.rent=obj.data.price;$scope.subTotal=$scope.calculateMarkup((obj.data.price+obj.data.coupon_discount).toString());var dif=$scope.subTotal-obj.data.coupon_discount-obj.data.price;$scope.taxes=obj.data.taxes-dif}})}}};$scope.moreReviews=function(){var page_size=5;$scope.limit+=5;var params=$scope.getParams();params["order_by"]="newest_first";params["page_number"]=1;params["page_results_number"]=5;$scope.searchReviews(params,false,page_size,$scope.currentPage);$scope.currentPage++};$scope.loadMore=function(){if(!$scope.loading){if($rootScope.searchSettings.intervalFilter!=0){var page_size=jQuery("#streamlinecore_fw_intfilter").val();$scope.limit+=jQuery("#streamlinecore_fw_intfilter").val()}else{var page_size=$rootScope.searchSettings.propertyPagination;$scope.limit+=$rootScope.searchSettings.propertyPagination}var params=$scope.getParams();var fullFlexCondition=$rootScope.searchSettings.enable_full_flex_range==1&&$scope.currentPage<=$scope.total_pages;var standardFlexCondition=$scope.flexPagination<$scope.flexTotalPages;if($scope.flex&&(fullFlexCondition||standardFlexCondition)){$scope.flexSearch(params,false,page_size,$scope.flexPagination++,false,$scope.flexSkip,[])}else{$scope.currentPage++;$scope.searchProperties(params,false,page_size,$scope.currentPage,false)}}};$scope.loadMoreFlex=function(){$scope.flexSearch()};$scope.prepareMarker=function(property,marker){var ne=map.getBounds().getNorthEast();var sw=map.getBounds().getSouthWest();if(property.location_latitude>=sw.lat()&&property.location_latitude<=ne.lat()&&property.location_longitude>=sw.lng()&&property.location_longitude<=ne.lng()){$scope.loadMarker(marker)}};$scope.getPropertyInfo=function(){rpapi.getWithParams("GetPropertyInfo",{unit_id:$scope.propertyId}).success(function(obj){$scope.property=obj.data;$scope.latitude=obj.data.latitude;$scope.longitude=obj.data.longitude;$scope.$on("mapInitialized",function(evt,evtMap){map=evtMap;var myLatlng={lat:obj.data.latitude,lng:obj.data.longitude};map.setCenter(myLatlng);var max_zoom=parseInt($rootScope.searchSettings["max_map_zoom"],10)})})};$scope.initPropertyMap=function(zoom,latitude,longitude){var zooomCtrl=true;var dbclickZoom=false;var scrlWheel=true;if($rootScope.disable_zoom){zooomCtrl=false;dbclickZoom=true;scrlWheel=false}var max_zoom=parseInt($rootScope.searchSettings["max_map_zoom"],10);var location={lat:latitude,lng:longitude};if($rootScope.add_click_zoom_maps==1){var gesture="greedy"}else{var gesture="none"}var map=new google.maps.Map(document.getElementById("mapLocation"),{zoom:zoom,center:location,gestureHandling:gesture,zoomControl:zooomCtrl,scrollwheel:scrlWheel,streetViewControl:false,disableDoubleClickZoom:dbclickZoom});var marker=new google.maps.Marker({position:location,map:map});if(max_zoom>0){map.set("maxZoom",max_zoom);map.addListener("dblclick",function(e){var current_zoom=map.getZoom();if(current_zoom>max_zoom-1){jQuery(document).find("#mapLocation").addClass("stop")}});google.maps.event.addListener(map,"zoom_changed",function(e){var current_zoom=map.getZoom();if(current_zoom>max_zoom-1){jQuery(document).find("#mapLocation").addClass("stop")}else{jQuery(document).find("#mapLocation").removeClass("stop")}})}};$scope.getPropertyImages=function(unit_id){rpapi.getWithParams("GetPropertyGalleryImages",{unit_id:unit_id}).success(function(obj){$scope.images=obj.data.image})};$scope.setAmenityFilter=function(amenityId){run_waitMe(".listings_wrapper_box","roundBounce","Updating Results...");setTimeout(function(){hide_waitMe(".listings_wrapper_box")},500);if($scope.amenity[amenityId]){$rootScope.amenities.push(amenityId)}else{var index=$rootScope.amenities.indexOf(amenityId);if(index>-1){$rootScope.amenities.splice(index,1)}}searchParam=$location.search();if($rootScope.amenities.length){searchParam["amenities"]=$rootScope.amenities.join(",")}else{searchParam["amenities"]=null}$location.search(searchParam)};$scope.setAmenityFilterOr=function(amenityId,group){run_waitMe(".listings_wrapper_box","roundBounce","Updating Results...");setTimeout(function(){hide_waitMe(".listings_wrapper_box")},500);var amenityFound=false;if(!$rootScope.groups.length>0){var gitem={name:group,amenities:[amenityId]};$rootScope.groups.push(gitem)}else{var removeFromArray=false;var indexToRemove=0;angular.forEach($rootScope.groups,function(amenity,key){if($scope.amenityOr[amenityId]){if(amenity.name==group){amenityFound=true;amenity.amenities.push(amenityId)}}else{if(amenity.name==group){amenityFound=true;var index=amenity.amenities.indexOf(amenityId);if(index>-1){amenity.amenities.splice(index,1)}if(amenity.amenities.length==0){removeFromArray=true;indexToRemove=key}}}});if(!amenityFound){var gitem={name:group,amenities:[amenityId]};$rootScope.groups.push(gitem)}if(removeFromArray){$rootScope.groups.splice(indexToRemove,1)}}searchParam=$location.search();if(typeof searchParam["amenities"]=="undefined"){amenities=[]}else{amenities=searchParam["amenities"].split(",")}amenityIdValue=$scope.amenityOr[amenityId];amenityIdPosition=amenities.indexOf(amenityId+"");if(amenityIdValue==false&&amenityIdPosition>-1){amenities.splice(amenityIdPosition,1)}else{amenities.push(amenityIdValue)}if(amenities.length){searchParam["amenities"]=amenities.join(",")}else{searchParam["amenities"]=null}$location.search(searchParam)};$scope.amenityFilter=function(item){var totalAmenities=$rootScope.amenities.length;var i=0;angular.forEach($rootScope.amenities,function(aId){angular.forEach(item.unit_amenities.amenity,function(uaId){if(aId==uaId.amenity_id){i++}})});if(totalAmenities==i){return true}else{return false}};$scope.amenityFilterOr=function(item){var result=true;if($rootScope.groups.length>0){result=false}var totalGroups=$rootScope.groups.length;var groupsFound=0;angular.forEach($rootScope.groups,function(group){var keepGoing=true;angular.forEach(group.amenities,function(amenity){angular.forEach(item.unit_amenities.amenity,function(ua){if(keepGoing){if(ua.amenity_id==amenity){groupsFound++;keepGoing=false}}})})});return totalGroups==groupsFound};$scope.getPropertyAmenities=function(){rpapi.getWithParams("GetPropertyAmenities",{unit_id:$scope.propertyId}).success(function(obj){$scope.amenities=obj.data.amenity})};$scope.getLocations=function(){rpapi.get("GetLocationAreasList").success(function(obj){$scope.locations=obj.data.location_area})};$scope.getPropertyReviews=function(unit_id){if(!unit_id){unit_id=$scope.propertyId}run_waitMe(".reviews_container","bounce","Get Reviews..");rpapi.getWithParams("GetPropertyFeedbacks",{unit_id:unit_id,order_by:"newest_first"}).success(function(obj){hide_waitMe(".reviews_container");if(obj.data.feedbacks.guest_name){var reviewsArray=[];reviewsArray.push(obj.data.feedbacks);$scope.reviews=reviewsArray;if($scope.reviews==""){jQuery("#quick-review").css("display","none")}else{jQuery("#quick-review").css("display","block")}}else{$scope.reviews=obj.data.feedbacks;if($scope.reviews==""){jQuery("#quick-review").css("display","none")}else{jQuery("#quick-review").css("display","block")}}});if($rootScope.bookingSettings.unit_tab_guest_survey==1){rpapi.getWithParams("GetGuestReviews",{unit_id:unit_id,return_all:1,order_by:"newest_first",show_in_site:1}).success(function(obj){hide_waitMe(".reviews_container");if(obj.data.reviews){angular.forEach(obj.data.reviews.review,function(survey,i){if(survey.rating>1){survey.guest_name=survey.first_name;survey.title="Guest Review";var date=moment(survey.last_time_status_changed).format("MM/DD/YYYY");survey.creation_date=date;survey.points=survey.rating;$scope.reviews.push(survey)}});if($scope.reviews==""){jQuery("#quick-review").css("display","none")}else{jQuery("#quick-review").css("display","block")}}})}};$scope.getPreReservationPrice=function(booking,res){if(booking.checkin&&booking.checkout||booking.date_range){var isFlexUnit=jQuery("#flexCalendar").val();if(isFlexUnit==0&&$rootScope.unit_flex_dates==0){$scope.flexUnit=false}else{$scope.flexUnit=true}if(booking.date_range){var tempChecking=booking.checkin,tempCheckout=booking.checkout;booking.checkin=booking.date_range.start_date,booking.checkout=booking.date_range.end_date;var checkin=new Date(booking.date_range.start_date),checkout=new Date(booking.date_range.end_date);if(booking.checkin&&booking.checkout)var checkin=new Date(booking.date_range.start_date),checkout=new Date(booking.date_range.end_date);else{var checkin=new Date(tempChecking);booking.checkin=tempChecking;var checkout=new Date(tempCheckout);booking.checkout=tempCheckout}if(void 0!==booking.checkin)var date_range=booking.checkin+" - "+booking.checkout;else var date_range=tempChecking+" - "+tempCheckout;$scope.book.date_range=date_range}else{var checkin=new Date(booking.checkin),checkout=new Date(booking.checkout),date_range=booking.checkin+" - "+booking.checkout;$scope.book.date_range=date_range}var stayLength=$scope.getDaysDifference(booking.checkin,booking.checkout);run_waitMe("#resortpro-book-unit, .availability","roundBounce","Updating Price...");Alert.clear();var totalOccupants=parseInt(booking.occupants)+parseInt(booking.occupants_small);if(parseInt($scope.maxOccupants)>0&&parseInt(booking.occupants)+parseInt(booking.occupants_small)>parseInt($scope.maxOccupants)){Alert.add(Alert.errorType,"You have selected a total of "+totalOccupants+" guests which exceeds the maximum occupancy of "+$scope.maxOccupants+" of this property. Please adjust your selection.");hide_waitMe("#resortpro-book-unit, .availability");$scope.isDisabled=true;return false}rpapi.getWithParams("VerifyPropertyAvailability",{unit_id:booking.unit_id,startdate:booking.checkin,enddate:booking.checkout,occupants:booking.occupants,occupants_small:booking.occupants_small,pets:booking.pets,use_room_type_logic:parseInt($rootScope.roomTypeLogic),include_coupon_information:1}).success(function(obj){if(obj.status){$scope.reservation_days=[];$scope.total_reservation=0;$scope.first_day_price=0;$scope.rent=0;$scope.taxes=0;var errorMsg=obj.status.description;if(obj.status.code=="E0031"&&$rootScope.searchSettings.restrictionMsg!=""){errorMsg=$rootScope.searchSettings.restrictionMsg}var unit=[];var min_stay=obj.status.description.split("required # of nights - ");unit.push({id:booking.unit_id,restriction_message:obj.status.description,id:booking.checkin,id:booking.checkout});$scope.reviewRestrictions(unit,booking.checkin,booking.checkout);booking.isRestricted=$scope.restrictedMinStayProps[0];if(errorMsg.indexOf("Sun to Sun")>=0){errorMsg="There is a restriction in place for your selected dates, dates have been updated";var newCheckin=new Date(booking.checkin);var newCheckout=new Date(booking.checkout);newCheckin.setDate(newCheckin.getDate()+1);newCheckout.setDate(newCheckout.getDate()+1);newCheckin=newCheckin.getMonth()+1+"/"+newCheckin.getDate()+"/"+newCheckin.getFullYear();newCheckout=newCheckout.getMonth()+1+"/"+newCheckout.getDate()+"/"+newCheckout.getFullYear();booking.checkin=newCheckin;booking.checkout=newCheckout;$scope.getPreReservationPrice(booking,res)}Alert.add(Alert.errorType,errorMsg);hide_waitMe("#resortpro-book-unit, .availability");$scope.isDisabled=true}else{if($rootScope.bookingSettings.inquiryOnlyFrom&&$rootScope.bookingSettings.inquiryOnlyTo){var inquiryOnlyFrom=new Date($rootScope.bookingSettings.inquiryOnlyFrom);var inquiryOnlyTo=new Date($rootScope.bookingSettings.inquiryOnlyTo);if(!(checkout.getTime()<=inquiryOnlyFrom.getTime()||checkin.getTime()>=inquiryOnlyTo.getTime())){Alert.add(Alert.errorType,"These dates are Inquiry Only, please send us a inquiry using the inquiry form ");hide_waitMe("#resortpro-book-unit, .availability");$scope.onlyInquiry=true;$scope.isDisabled=true;return false}}var maxLengthStay=$rootScope.bookingSettings.maxLengthStay;if(maxLengthStay>0&&stayLength>maxLengthStay){Alert.add(Alert.errorType,"the max stay is on.");hide_waitMe("#resortpro-book-unit, .availability");$scope.isDisabled=true;return false}var params={unit_id:booking.unit_id,startdate:booking.checkin,enddate:booking.checkout,occupants:booking.occupants,occupants_small:booking.occupants_small,pets:booking.pets,coupon_code:booking.coupon_code,include_coupon_information:1};if($rootScope.includeEnabledOptional===1){params["optional_default_enabled"]="yes"}if(!$scope.isEmptyString($scope.advanced_date)&&$rootScope.enableAdvancedRes==1){var advanceDate=new Date($scope.advanced_date);var checkinDate=new Date(booking.checkin);if(checkinDate>=advanceDate&&$rootScope.enableAdvancedRes==1){params["type_id"]=428}}var rate_type_name=$cookies.get("streamline-rate_type");if($rootScope.show_all_rates&&$rootScope.rate_type!=""){params["rate_type_name"]=$rootScope.rate_type}if($rootScope.bookingSettings.enable_rates_pw==1&&typeof rate_type_name!="undefined"){params["rate_type_name"]=rate_type_name;params["madetype_id"]=7}if($rootScope.enable_reservation_type==1&&$rootScope.reservation_type!=""){if($rootScope.travel_type_id!=""){params["type_id"]=$rootScope.travel_type_id}}if($rootScope.separate_taxes_and_feed==1){params["separate_taxes"]=1}$scope.isDisabled=false;rpapi.getWithParams("GetPreReservationPrice",params).success(function(obj){if(obj.data!=undefined){var total_fees=0;var total_taxes=0;if(obj.data.required_fees.id){total_fees=obj.data.required_fees.value}else{angular.forEach(obj.data.required_fees,function(fee,i){total_fees+=fee.value})}if(obj.data.taxes_details.id){total_taxes=obj.data.taxes_details.value}else{angular.forEach(obj.data.taxes_details,function(fee,i){total_taxes+=fee.value})}$scope.total_reservation=obj.data.total;$scope.total_fees=total_fees;$scope.total_taxes=total_taxes;$scope.rent=obj.data.price;$scope.subTotal=$scope.calculateMarkup((obj.data.price+obj.data.coupon_discount).toString());var dif=$scope.subTotal-obj.data.coupon_discount-obj.data.price;if($rootScope.separate_taxes_and_feed==1){$scope.taxes=obj.data.taxes_details_value;$scope.fees=obj.data.required_fees_value}else{$scope.taxes=obj.data.taxes-dif}$scope.coupon_discount=obj.data.coupon_discount;$scope.reservation_days=obj.data.reservation_days;$scope.security_deposits=obj.data.security_deposits;$scope.first_day_price=obj.data.first_day_price;$scope.required_fees=obj.data.required_fees;$scope.optional_fees=obj.data.optional_fees;$scope.taxes_details=obj.data.taxes_details;$scope.due_today=obj.data.due_today;$scope.res=res;$scope.coupon_info=obj.data.coupon_information;if(obj.data.reservation_days.date!=undefined){$scope.days=false}else{$scope.days=true}$scope.getFlexPreReservationPrice(booking);if(typeof UpLift!=="undefined"){params["order_total"]=obj.data.total;var tripInfo=$scope.buildTripInfo(params);if(!$scope.initUplift){UpLift.Payments.init({apiKey:$rootScope.upliftApiKey,onModalClose:$scope.myOnModalCloseHandler,onModalOpen:$scope.myOnModalOpenHandler,locale:"en-US",currency:"USD"});setTimeout(function(){UpLift.Payments.load(tripInfo,$scope.myPaymentsLoadCallback)},200);$scope.initUplift=true}else{setTimeout(function(){UpLift.Payments.update(tripInfo,$scope.myPaymentsLoadCallback)},200)}}hide_waitMe("#resortpro-book-unit, .availability")}})}})}};$scope.getFlexPreReservationPrice=function(booking,res){flex=3;$scope.flex=flex;$scope.flexDates=0;if(booking.checkin&&booking.checkout){var stayLength=$scope.getDaysDifference(booking.checkin,booking.checkout);var searchPattern="";for(i=0;i<stayLength;i++){searchPattern+="Y"}var timeUnit=864e5*$scope.flex_min_stay;var flexBegin=new Date(booking.checkin);flexBegin.setTime(flexBegin.getTime()-timeUnit);var flexEnd=new Date(booking.checkout);flexEnd.setTime(flexEnd.getTime()+timeUnit);run_waitMe("#resortpro-book-unit, .availability","roundBounce","Updating Price...");Alert.clear();var totalOccupants=parseInt(booking.occupants)+parseInt(booking.occupants_small);if(parseInt($scope.maxOccupants)>0&&parseInt(booking.occupants)+parseInt(booking.occupants_small)>parseInt($scope.maxOccupants)){Alert.add(Alert.errorType,"You have selected a total of "+totalOccupants+" guests which exceeds the maximum occupancy of "+$scope.maxOccupants+" of this property. Please adjust your selection.");hide_waitMe("#resortpro-book-unit, .availability");$scope.isDisabled=true;return false}var params={startdate:$scope.formatDate(flexBegin),enddate:$scope.formatDate(flexEnd),flex:1,unit_id:booking.unit_id};var flex_dates=[];var flex_dates2=[];rpapi.getWithParams("GetPropertyListWordPress",params).success(function(response){var property=response.data.property[0];if(property.flex.availability!=searchPattern){var flex_days=[-1,1,-2,2,-3,3];flex_dates=$scope.getFlexDates(property.flex.availability,new Date(booking.checkin),flex_days,searchPattern,3,[]);if(flex_dates2.length>0){flex_dates=flex_dates.concat(flex_dates2)}if(flex_dates.length>4){flex_dates.splice(3,flex_dates.length-4)}var sortedDates=flex_dates.slice(0);sortedDates.sort(function(a,b){return new Date(a.startdate)-new Date(b.startdate)});$scope.flexDates=sortedDates}})}};$scope.getFlexDatesRates=function(booking){run_waitMe("#resortpro-book-unit, .availability","bounce","Updating Alternate Prices...");$scope.alternateAvailability=[];angular.forEach($scope.flexDates,function(value,index){var params={unit_id:booking.unit_id,startdate:value.startdate,enddate:value.enddate,occupants:booking.occupants,occupants_small:booking.occupants_small,pets:booking.pets,coupon_code:booking.coupon_code};$scope.alternateAvailability.push({startdate:params.startdate,enddate:params.enddate});rpapi.getWithParams("GetPreReservationPrice",params).then(function(obj){var price=obj.data.data;$scope.alternateAvailability[index].total=price.total;$scope.alternateAvailability[index].nights=price.reservation_days.length})});hide_waitMe("#resortpro-book-unit, .availability");hide_waitMe("#modalDates .modal-dialog")};$scope.getParams=function(){var search=$scope.search;var params={};$scope.amenities=[];var wishlist=$cookies.getObject("streamline-favorites");if(wishlist){$scope.wishlist=wishlist}if(search&&search.sort_by){params.sort_by=search.sort_by}else{params.sort_by=$scope.sortBy}if($rootScope.searchSettings.searchMethod!=="GetPropertyAvailabilityWithRatesWordPress"&&search&&params.sort_by=="price_low"){params.sort_by="price_daily_low"}if($rootScope.searchSettings.searchMethod!=="GetPropertyAvailabilityWithRatesWordPress"&&search&&params.sort_by=="price"){params.sort_by="price_daily"}if($rootScope.searchSettings.use_webname_as_name==1&&params.sort_by=="name"){params.sort_by="web_name"}$scope.checkSorting();if($rootScope.searchSettings.enable_get_gallery_image==1){params.return_gallery=1;if($rootScope.searchSettings.max_images_number>0){params.max_images_number=$rootScope.searchSettings.max_images_number}}params.use_room_type_logic=parseInt($rootScope.roomTypeLogic);params.extra_charges=1;params.get_prices_starting_from=parseInt($rootScope.searchSettings.manualPricing);if($rootScope.searchSettings.disableMinimalDays){params.disable_minimal_days=1}if($rootScope.searchSettings.advancedMinStayLogic){params.show_min_nights=1;params.show_restrictions=1}if($rootScope.enable_turn_day_searching&&$scope.turnDayAll!=true){params.show_min_nights=1;params.show_restrictions=1}if($scope.skipUnits!=""){params.skip_units=$scope.skipUnits}if($rootScope.searchSettings.propertyDeleteUnits){if($scope.skipUnits!=""&&!$scope.skipUnits.includes($rootScope.searchSettings.propertyDeleteUnits)){params.skip_units=","+$rootScope.searchSettings.propertyDeleteUnits}if($scope.skipUnits==""){params.skip_units=$rootScope.searchSettings.propertyDeleteUnits}$scope.skipUnits=params.skip_units}if($scope.checkString($rootScope.searchSettings.locationAreas,false)){params.location_areas_id_filter=$rootScope.searchSettings.locationAreas}if($scope.checkString($rootScope.searchSettings.GroupIds,false)){if($rootScope.searchSettings.searchMethod==="GetPropertyAvailabilityWithRatesWordPress"&&search&&search.start_date&&search.end_date){params.condo_type_group_filter=$rootScope.searchSettings.GroupIds}else{params.condo_type_group_id_filter=$rootScope.searchSettings.GroupIds}}if($scope.checkString($rootScope.searchSettings.locationIds,false)){params.location_id_filter=$rootScope.searchSettings.locationIds}if($scope.checkString($rootScope.searchSettings.resortAreaIds,false)){params.resort_area_id_filter=$rootScope.searchSettings.resortAreaIds}if($scope.checkString($rootScope.searchSettings.neighborhoodIds,false)){params.neighborhood_area_id_filter=$rootScope.searchSettings.neighborhoodIds}if($scope.checkString($rootScope.searchSettings.amenity_filtersIDs,false)){params.amenities_filter=$rootScope.searchSettings.amenity_filtersIDs}if($scope.checkString($rootScope.searchSettings.home_typesIDs,false)){params.home_type_id_filter=$rootScope.searchSettings.home_typesIDs}if($scope.checkNumber($rootScope.searchSettings.home_length_type,false)){params.longterm_enabled=$rootScope.searchSettings.home_length_type}if($scope.checkNumber($rootScope.searchSettings.neighborhoodId,false)){params.neighborhood_area_id=$rootScope.searchSettings.neighborhoodId}if($rootScope.searchSettings.propertyShowUnits!=""){if($scope.checkNumber($rootScope.searchSettings.propertyShowUnits,false)){params.unit_id=$rootScope.searchSettings.propertyShowUnits}else{$scope.search_units=$rootScope.searchSettings.propertyShowUnits.split(",");params.unit_name=$scope.search_units}}if($rootScope.searchSettings.additionalVariables==1){params.additional_variables=1}if($rootScope.searchSettings.extraCharges==1){params.extra_charges=1}if(parseInt($rootScope.searchSettings.skipAmenities)===1){params.use_description="no";if($rootScope.searchSettings.enable_quick_view==1||parseInt($rootScope.searchSettings.enable_amenities)===1){params.use_amenities="yes"}else{params.use_amenities="no"}}if(typeof $location.search().campaign_code!="undefined"){$cookies.put("campaign_code",$location.search().campaign_code,{path:"/",secure:"true"})}if($rootScope.enable_amp==1){var path=$location.absUrl();if(path.length>1){var arcst=path.split("&");var sbStr="resortpro_sw_amenities";var srStr="resortpro_sw_lodging_unit";var flexStr="resortpro_sw_flex_dates";var final=[];var finalName=" ";var finalFl="";arcst.forEach(function(element){if(element.includes(sbStr)){var nr=element.substring(element.indexOf("=")+1);final.push(nr)}if(element.includes(srStr)){var uN=element.substring(element.indexOf("=")+1);finalName=uN}if(element.includes(flexStr)){var fl=element.substring(element.indexOf("=")+1);finalFl=fl}});var tsnumbers=final.map(Number);tstr=tsnumbers.join(",");if(tstr.length>0){search.amenities_filter=tstr}if(finalName!==""){params.unit_name=finalName;$scope.cstUnitSrc=finalName}if(finalFl){$scope.AmpFlexDate=finalFl}}}if(!$scope.isEmptyString($scope.checkNumber.resortpro_sw_destination_id)&&$scope.checkNumber.resortpro_sw_destination_id>0){if($scope.checkNumber.resortpro_sw_destination_level==1){params.country_id=$scope.checkNumber.resortpro_sw_destination_id}else if($scope.checkNumber.resortpro_sw_destination_level==2){params.state_id=$scope.checkNumber.resortpro_sw_destination_id}else if($scope.checkNumber.resortpro_sw_destination_level==3){params.city_id=$scope.checkNumber.resortpro_sw_destination_id}else{params.community_id=$scope.checkNumber.resortpro_sw_destination_id}}if($rootScope.searchSettings.show_streamshare_units=="0"){params.use_streamshare=0}else{if($scope.sortBy=="rotation"||$scope.sortBy=="random"){params.separate_streamshare_units=0}else{params.separate_streamshare_units=1}}if(search){if($rootScope.searchSettings.enable_adults_range==1){params.min_occupants=search.min_occupants;params.max_occupants=search.max_occupants;if(typeof search.min_occupants!="undefined"){$location.search("min_oc",parseInt(search.min_occupants));$location.search("max_oc",parseInt(search.max_occupants))}}var rate_type_name=$cookies.get("streamline-rate_type");if($rootScope.bookingSettings.enable_rates_pw==1&&typeof rate_type_name!="undefined"||$rootScope.rate_type!=""){params.rate_type_name=rate_type_name}if(!$scope.isEmptyString($scope.search.resortpro_sw_destination_id)&&$scope.search.resortpro_sw_destination_id>0){if($scope.search.resortpro_sw_destination_level==1){params.country_id=$scope.search.resortpro_sw_destination_id}else if($scope.search.resortpro_sw_destination_level==2){params.state_id=$scope.search.resortpro_sw_destination_id}else if($scope.search.resortpro_sw_destination_level==3){params.city_id=$scope.search.resortpro_sw_destination_id}else{params.community_id=$scope.search.resortpro_sw_destination_id}}if(search.country_id){params.country_id=search.country_id}if(search.state_id){params.state_id=search.state_id}if(search.city_id){params.city_id=search.city_id}if($rootScope.searchSettings.occupants_logic==0||$rootScope.searchSettings.occupants_logic==1){$location.search("plus_oc",null);if($scope.checkNumber(search.occupants,false)){if($scope.guest_plusLogic===0&&$rootScope.searchSettings.occupants_logic===0){if($rootScope.searchSettings.enable_max_occupants_logic==1){params.min_occupants=parseInt(search.occupants)}else{params.occupants=parseInt(search.occupants)}}else{if($rootScope.searchSettings.enable_max_occupants_logic==1){params.min_occupants_small=parseInt(search.occupants-1)}else{if(search.start_date&&search.end_date&&$rootScope.searchSettings.searchMethod==="GetPropertyAvailabilityWithRatesWordPress"){params.occupants=parseInt(search.occupants)}else if($scope.guest_plusLogic==1&&!params.startdate&&!params.enddate){params.occupants=parseInt(search.occupants)}else{params.min_occupants=parseInt(search.occupants)}}}$location.search("oc",search.occupants)}else{$location.search("oc",null);$location.search("plus_oc",null)}}else{if($scope.checkString(search.occupants,false)){if($location.search().plus_oc==1&&search.occupants.indexOf("+")==-1&&$scope.propertiesObj==undefined){search.occupants=search.occupants+"+"}if(search.occupants.indexOf("+")>=0){var plus_occ=search.occupants.split("+");plus_occ=plus_occ[0];params.occupants=parseInt(plus_occ);$location.search("oc",plus_occ)}else{$location.search("plus_oc",null);params.occupants=parseInt(search.occupants);$location.search("oc",params.occupants)}}else{$location.search("oc",null);$location.search("plus_oc",null)}}if(search.start_date&&search.end_date){params.startdate=search.start_date;params.enddate=search.end_date;$location.search("sd",search.start_date);$location.search("ed",search.end_date)}if($scope.checkNumber(search.occupants_small,false)){params.occupants_small=parseInt(search.occupants_small);params.min_occupants+=params.occupants_small;$location.search("ch",params.occupants_small)}else{$location.search("ch",null)}if($scope.checkNumber(search.pets,false)){if(search.start_date&&search.end_date){params.pets=parseInt(search.pets)}else{params.min_pets=parseInt(search.pets)}$location.search("pets",search.pets)}else{$location.search("pets",null)}if(typeof search!="undefined"&&search.occupants&&$rootScope.searchSettings.occupants_logic==2){if(search.occupants.indexOf("+")>=0){$location.search("plus_oc",1)}else{$location.search("plus_oc",null)}}if($scope.checkNumber(search.location_id,false)){params.location_id=parseInt(search.location_id)}var newSelectedAmenities=$scope.selectedAmenities;if($scope.checkString(search.amenities_filter,false)){params.amenities_filter=search.amenities_filter;if($scope.amenities.length==0){angular.forEach(search.amenities_filter.split(","),function(item){if($scope.selectedAmenities[item]!=false){newSelectedAmenities[item]=parseInt(item)}});$scope.selectedAmenities=newSelectedAmenities}$location.search("amenities_filter",search.amenities_filter)}else{$location.search("amenities_filter",null);delete params.amenities_filter}if($scope.checkString(search.include_units,false)){params.include_units=search.include_units}if($scope.checkNumber(search.longterm_enabled,false)){params.longterm_enabled=parseInt(search.longterm_enabled)}if($scope.checkNumber(search.location_area_id,false)){params.location_area_id=parseInt(search.location_area_id);$location.search("location_area_id",params.location_area_id)}else{$location.search("location_area_id",null);delete params.location_area_id}if($scope.checkNumber(search.lodging_type_id,false)){params.lodging_type_id=parseInt(search.lodging_type_id);$location.search("lodging_type_id",params.lodging_type_id)}else{$location.search("lodging_type_id",null);delete params.lodging_type_id}if($rootScope.searchSettings.enable_bedroom_range==1){params.min_bedrooms_number=search.min_bedrooms_number;params.max_bedrooms_number=search.max_bedrooms_number;if(typeof search.min_bedrooms_number!="undefined"){$location.search("min_beds",parseInt(search.min_bedrooms_number));$location.search("max_beds",parseInt(search.max_bedrooms_number))}}if(typeof search.max_price!="undefined"&&typeof search.min_price!="undefined"){$scope.priceRangeEnabled=true;$scope.minPrice=search.min_price;$scope.maxPrice=search.max_price;var initMinPrice=jQuery(".search_range_price").attr("min-price");var initMaxPrice=jQuery(".search_range_price").attr("max-price");if(initMinPrice==$scope.minPrice){$scope.minPrice=initMinPrice;$location.search("min_price",null)}else{$scope.minPrice=search.min_price;$location.search("min_price",search.min_price)}if(initMaxPrice==$scope.maxPrice){$scope.maxPrice=initMaxPrice;$location.search("max_price",null)}else{$scope.maxPrice=search.max_price;$location.search("max_price",search.max_price)}}if($rootScope.searchSettings.bedrooms_logic==0||$rootScope.searchSettings.bedrooms_logic==1){$location.search("plus_beds",null);if($scope.checkNumber(search.num_bedrooms,false)){if($rootScope.searchSettings.bedrooms_logic===0){params.bedrooms_number=parseInt(search.num_bedrooms)}else{params.min_bedrooms_number=parseInt(search.num_bedrooms)}$location.search("beds",search.num_bedrooms)}else{$location.search("beds",null);$location.search("plus_beds",null)}}else{if($scope.checkString(search.num_bedrooms,false)){if(search.num_bedrooms.indexOf("+")>=0){$location.search("plus_beds",1)}else{$location.search("plus_beds",null)}if(search.num_bedrooms.indexOf("+")>=0||typeof $location.search().plus_bed!="undefined"&&$location.search().plus_bed==1){if($location.search().plus_bed==1&&search.num_bedrooms.indexOf("+")==-1){search.num_bedrooms=search.num_bedrooms+"+"}var plus_bedc=search.num_bedrooms.split("+");plus_bedc=plus_bedc[0];params.min_bedrooms_number=parseInt(plus_bedc);$location.search("beds",plus_bedc)}else{$location.search("plus_beds",null);params.bedrooms_number=parseInt(search.num_bedrooms);$location.search("beds",params.bedrooms_number)}}else{$location.search("beds",null);$location.search("plus_beds",null)}}if(!$scope.checkNumber($rootScope.searchSettings.resortAreaId,false)){if($scope.checkNumber(search.resort_area_id,false)){params.resort_area_id=parseInt(search.resort_area_id);$location.search("resort_area_id",params.resort_area_id)}else{delete params.resort_area_id;$location.search("resort_area_id",null)}}if(!$scope.checkNumber($rootScope.searchSettings.locationId,false)){if($scope.checkNumber(search.location,false)){params.location_id=parseInt(search.location);$location.search("location_id",params.location_id)}else{$location.search("location_id",null)}}if(!$scope.checkNumber($rootScope.searchSettings.neighborhoodId,false)){if($scope.checkNumber(search.neighborhood_area_id,false)){params.neighborhood_area_id=parseInt(search.neighborhood_area_id);$location.search("neighborhood_area_id",params.neighborhood_area_id)}else{delete params.neighborhood_area_id;$location.search("neighborhood_area_id",null)}}if($scope.checkNumber(search.home_type_id,false)){params.home_type_id=parseInt(search.home_type_id);$location.search("home_type_id",params.home_type_id)}else{delete params.home_type_id;$location.search("home_type_id",null)}if($scope.checkNumber(search.show_streamshare_units,false)){if(search.show_streamshare_units==0){params.use_streamshare=parseInt(search.show_streamshare_units);delete params.separate_streamshare_units}else{delete params.use_streamshare;params.separate_streamshare_units=parseInt(search.show_streamshare_units)}}if($scope.checkString(search.view_name,false)){if(search.start_date&&search.end_date){params.view_name_filter=search.view_name}else{params.view_name=search.view_name}$location.search("view_name",search.view_name)}else{delete params.view_name_filter;$location.search("view_name",null)}if($scope.checkString(search.view_id,false)){params.view_id_filter=search.view_id;$location.search("view_id",search.view_id)}else{delete params.view_id_filter;$location.search("view_id",null)}if($scope.checkNumber(search.condo_type_id,false)){params.condo_type_id=parseInt(search.condo_type_id);$location.search("condo_type_id",params.condo_type_id)}else{$location.search("condo_type_id",null)}if($scope.checkNumber(search.group_type,false)){params.condo_type_group_id=parseInt(search.group_type);$location.search("group_id",params.condo_type_group_id)}else{$location.search("group_id",null)}if($scope.checkNumber(search.adults,false)){params.adults=parseInt(search.adults)}if($scope.checkNumber(search.min_occupants,false)){params.min_occupants=parseInt(search.min_occupants)}if($scope.checkNumber(search.min_adults,false)){params.min_occupants=parseInt(search.min_adults)}if($scope.checkNumber(search.min_pets,false)){if(search.start_date&&search.end_date){params.pets=parseInt(search.min_pets)}else{params.min_pets=parseInt(search.min_pets)}}if($scope.checkNumber(search.bedrooms_number,false)){params.bedrooms_number=parseInt(search.bedrooms_number)}if($scope.checkNumber(search.min_bedrooms_number,false)){params.min_bedrooms_number=parseInt(search.min_bedrooms_number)}if($scope.checkNumber(search.max_bedrooms_number,false)){params.max_bedrooms_number=parseInt(search.max_bedrooms_number)}if($scope.checkNumber(search.minPriceSearch,false)){params.minPriceSearch=parseInt(search.minPriceSearch)}if($scope.checkNumber(search.maxPriceSearch,false)){params.maxPriceSearch=parseInt(search.maxPriceSearch)}if($scope.checkNumber(search.min_price,false)&&search.min_price!=initMinPrice){params.min_price=parseInt(search.min_price)}if($scope.checkNumber(search.max_price,false)&&search.max_price!=initMaxPrice){params.max_price=parseInt(search.max_price)}if($scope.checkNumber(search.bathrooms_number,false)){params.bathrooms_number=parseInt(search.bathrooms_number)}if($scope.checkNumber(search.min_bathrooms_number,false)){params.min_bathrooms_number=parseInt(search.min_bathrooms_number)}if($scope.checkString(search.neighborhood_area_id_filter,false)){params.neighborhood_area_id_filter=search.neighborhood_area_id_filter}if($scope.checkString(search.condo_type_group_filter,false)){params.condo_type_group_filter=search.condo_type_group_filter}if($scope.checkString(search.condo_type_id_filter,false)){params.condo_type_id_filter=search.condo_type_id_filter}if($scope.checkString(search.condo_type_group_id_filter,false)){params.condo_type_group_id_filter=search.condo_type_group_id_filter}if($scope.checkString(search.condo_type_id_filter,false)){params.condo_type_id_filter=search.condo_type_id_filter}if($scope.checkString(search.home_type_id_filter,false)){params.home_type_id_filter=search.home_type_id_filter}if($scope.checkString(search.location_id_filter,false)){params.location_id_filter=search.location_id_filter}if($scope.checkString(search.city_id_filter,false)){params.city_id_filter=search.city_id_filter}if($scope.checkString(search.location_areas_id_filter,false)){params.location_areas_id_filter=search.location_areas_id_filter}if($scope.checkString(search.resort_area_id_filter,false)){params.resort_area_id_filter=search.resort_area_id_filter}if($scope.checkString(search.location_area_name,false)){params.location_area_name=search.location_area_name}if($scope.checkNumber(search.country_id,false)){params.country_id=parseInt(search.country_id)}if($scope.checkNumber(search.state_id,false)){params.state_id=parseInt(search.state_id)}if($scope.checkNumber(search.city_id,false)){params.city_id=parseInt(search.city_id)}if($scope.checkString(search.location_name,false)){params.location_name=search.location_name}if($scope.checkString(search.unit_name,false)){if($rootScope.searchSettings.enable_combined_search_name==0){params.unit_name=search.unit_name}else{jQuery("#resortpro_sw_lodging_unit").val(search.unit_name);if($scope.continentsList!=="undefined"){angular.forEach($scope.continentsList[0].states,function(state,key){if(state.description.toLowerCase()==search.unit_name.toLowerCase()||state.name.toLowerCase()==search.unit_name.toLowerCase()){params.state_id=state.id}else{if(angular.isArray(state.cities)){angular.forEach(state.cities,function(city,key){if(city.name.toLowerCase()==search.unit_name.toLowerCase()){params.city_id=city.id}})}else{if(state.cities.name.toLowerCase()==search.unit_name.toLowerCase()){params.city_id=state.cities.id}}}})}if(!$scope.checkNumber(params.state_id,false)&&!$scope.checkNumber(params.city_id,false)){params.unit_name=search.unit_name}}}if($scope.checkString(search.location_type_name,false)){params.location_type_name=search.location_type_name}if($scope.checkString(search.condo_type_group_name,false)){params.condo_type_group_name=search.condo_type_group_name}if($scope.checkString(search.sale_enabled,false)){params.sale_enabled="yes"}if($scope.checkNumber(search.condo_type_group_id,false)){params.condo_type_group_id=parseInt(search.condo_type_group_id)}if($scope.checkNumber(search.city_id,false)){params.city_id=parseInt(search.city_id)}if($rootScope.searchSettings.customFilter&&(search.bedrooms_number||search.min_bedrooms_number||search.min_bedrooms_number||search.num_bedrooms)){search.sort_by=$rootScope.searchSettings.customFilter;$scope.sortBy=search.sort_by}}angular.forEach($scope.selectedAmenities,function(item){if(item!=false){$scope.amenities.push(item)}});if($scope.amenities.length>0){$location.search("amenities_filter",null);if(typeof $scope.search!="undefined"){var amenities=$scope.amenities.join();$scope.search.amenities_filter=params.amenities_filter=amenities}else{amenities=$scope.amenities.join();params.amenities_filter=amenities}$location.search("amenities_filter",params.amenities_filter)}else{if(typeof $scope.search!="undefined"){params.amenities_filter="";$scope.search.amenities_filter=params.amenities_filter}$location.search("amenities_filter",null)}if($scope.mapSearchEnabled&&angular.isNumber($scope.latNE)){params.latNe=$scope.latNE;params.longNe=$scope.longNE;params.latSw=$scope.latSW;params.longSw=$scope.longSW}if(params.amenities_filter){if($rootScope.searchSettings.global_amenity_logic!=1){params.global_amenities_logic="AND"}else{params.global_amenities_logic="OR"}}return params};$scope.loadUnitsMapOverlay=function(){rpapi.getWithParams("GetGeographicHierarchy",{}).success(function(obj){if(typeof obj.data["id"]!="undefined"){$scope.continentsList=[obj.data]}else{$scope.continentsList=obj.data}angular.forEach($scope.continentsList[0].states,function(state,key){jQuery(document).find("path#"+state.name.toUpperCase()).addClass("units_present")})})};$scope.requestPropertyList=function(method){if($rootScope.searchSettings.enable_adv_geo_map_logic==1||$rootScope.searchSettings.enable_combined_search_name==1){rpapi.getWithParams("GetGeographicHierarchy",{}).success(function(obj){if(typeof obj.data["id"]!=="undefined"){$scope.continentsList=[obj.data]}else{$scope.continentsList=obj.data}$scope.availabilitySearch()})}else{$scope.checkSorting()}};$scope.formatDate=function(date){var day=date.getDate();var month=date.getMonth()+1;var year=date.getFullYear();return month+"/"+day+"/"+year};$scope.getFlexDates=function(availability,startdate,indexes,searchPattern,flexLength,isRestricted){var new_dates=new Array;flex=3;var timeUnit=864e5*searchPattern.length;if($rootScope.searchSettings.enable_flex_weekly_range==1){timeUnit=864e5*7}angular.forEach(indexes,function(index){var startIndex=$scope.flex_min_stay+index;var flex_availability=false;if(availability.substring(startIndex,startIndex+searchPattern.length)==searchPattern||searchPattern.includes(availability.substring(startIndex,startIndex+searchPattern.length))){flex_availability=true}if(flex_availability){if($rootScope.searchSettings.enable_flex_weekly_range==1){var flexBegin=new Date(startdate.getTime()+index*timeUnit)}else{var flexBegin=new Date(startdate.getTime()+index*864e5)}var flexEnd=new Date(flexBegin.getTime()+timeUnit);var allowFlexDate=0;if(isRestricted.day!=null){if(flexBegin.getDay()==isRestricted.day&&isRestricted.min_stay<=searchPattern.length){allowFlexDate=1}}else{allowFlexDate=1}if(Object.keys(isRestricted).length>0&&allowFlexDate==1&&($scope.flex!=null||$rootScope.searchSettings.advancedMinStayLogic)){new_dates.push({startdate:$scope.formatDate(flexBegin),enddate:$scope.formatDate(flexEnd),nights:searchPattern.length})}if(Object.keys(isRestricted).length==0){new_dates.push({startdate:$scope.formatDate(flexBegin),enddate:$scope.formatDate(flexEnd),nights:searchPattern.length})}}});return new_dates};$scope.getFlexDatesFull=function(availability,startdate,indexes,searchPattern,flexLength){flex_dates=[];flex=3;var timeUnit=864e5*searchPattern.length;if($rootScope.searchSettings.enable_flex_weekly_range==1){timeUnit=864e5*7}angular.forEach(indexes,function(index){var startIndex=flex+index;if(flexLength>=Math.abs(index)&&availability.substring(startIndex,startIndex+searchPattern.length)==searchPattern){if($rootScope.searchSettings.enable_flex_weekly_range==1){var flexBegin=new Date(startdate.getTime()+index*timeUnit)}else{var flexBegin=new Date(startdate.getTime()+index*864e5)}var flexEnd=new Date(flexBegin.getTime()+timeUnit);flex_dates.push({startdate:$scope.formatDate(flexBegin),enddate:$scope.formatDate(flexEnd),nights:searchPattern.length})}});return flex_dates};$scope.openAlternateDates=function(property){$scope.alternateAvailability=[];run_waitMe("#modalDates");angular.forEach(property.flex_dates,function(value){var params={unit_id:property.id,startdate:value.startdate,enddate:value.enddate,occupants:2};rpapi.getWithParams("GetPreReservationPrice",params).success(function(obj){hide_waitMe("#modalDates");$scope.alternateAvailability.push({startdate:params.startdate,enddate:params.enddate,total:obj.data.total,nights:obj.data.reservation_days.length,seo_page_name:property.seo_page_name})})});jQuery("#modalDates").modal("show");return false};$scope.flexSearch=function(params,searchNumber,size,page,clearUnits,found_ids,restrict_ids){params.page_number=page;params.page_results_number=size*4;var flexSearchMethod="GetPropertyListWordPress";if($scope.search&&$scope.search.start_date&&$scope.search.end_date){var startDate=$scope.search.start_date;var endDate=$scope.search.end_date;if(params.sort_by=="random"){params.page_number=1}$scope.loading=true;flex=3;if($scope.flex>0||$scope.restrictedMinStayProps.length>0){if(!$scope.enableInfinitiScroll){run_waitMe(".listings_wrapper_box","roundBounce"," Updating Results...")}var stayLength=$scope.daysDiff;var searchPattern="";for(i=0;i<stayLength;i++){searchPattern+="Y"}var timeUnit=864e5*$scope.flex_min_stay;if($rootScope.searchSettings.enable_flex_weekly_range==1){timeUnit=864e5*7}var flexBegin=new Date(params.startdate);flexBegin.setTime(flexBegin.getTime()-timeUnit);var flexEnd=new Date(params.enddate);flexEnd.setTime(flexEnd.getTime()+timeUnit);var params2=params;if(params.occupants>0){params2.min_occupants=params.occupants;params2.occupants=null}params2.startdate=$scope.formatDate(flexBegin);params2.enddate=$scope.formatDate(flexEnd);params2.flex=1;params2.return_gallery=1;params2.page_number=1;params2.use_description="no";params2.use_amenities="no";if($rootScope.searchSettings.enable_full_flex_range==1){if(found_ids){params2.include_units=found_ids.join(",")}params2.page_results_number=size*4;params2.skip_units="";params2.page_number=1}else{params2.page_results_number=size*4;if($scope.flexSkip){params2.skip_units=$scope.flexSkip.join(",")}if(restrict_ids){if(restrict_ids.length>0){params2.include_units=restrict_ids.join(",");params2.page_number=1}}}if($scope.restrictedMinStayProps.length>0&&restrict_ids.length>0){params2.skip_units="";$scope.restrictedDateStart=flexBegin;$scope.restrictedDateEnd=flexEnd}if($rootScope.searchSettings.max_images_number>0){params2.max_images_number=$rootScope.searchSettings.max_images_number}rpapi.getWithParams(flexSearchMethod,params2).success(function(response2){hide_waitMe(".listings_wrapper_box");var properties=[];var flex_properties=[];$scope.flexPagination=response2.data.available_properties.pagination.current_page;$scope.flexTotalPages=response2.data.available_properties.pagination.total_pages;if(response2.data&&response2.data.property){if(response2.data.property.id){properties=[response2.data.property]}else{properties=response2.data.property}if($rootScope.searchSettings.enable_full_flex_range==0&&$scope.restrictedMinStayProps.length==0){angular.forEach(properties,function(property,index){if(property.flex.availability.indexOf(searchPattern)===-1){properties.splice(index,1)}})}angular.forEach(properties,function(property,index){var searchPattern="";for(i=0;i<stayLength;i++){searchPattern+="Y"}var flex_dates=[];var flex_dates2=[];var isRestricted=[];angular.forEach($scope.restrictedMinStayProps,function(restrictedProp,index){if(property.id==restrictedProp.id){isRestricted=restrictedProp;return false}});if(isRestricted.min_stay==7||searchPattern.length<isRestricted.min_stay){searchPattern="";for(i=0;i<isRestricted.min_stay;i++){searchPattern+="Y"}}if(isRestricted.min_stay!=7||isRestricted.day!=null){if(property.flex.availability.indexOf(searchPattern)!=-1?true:false){var flex_days=[-1,1,-2,2,-3,3,0];if($scope.flex_min_stay>=7)var flex_days=[-1,1,-2,2,-3,3,-4,4,-5,5,-6,6,0];if(searchPattern.length>=parseInt(property.flex.min_stay.split(",")[0])||$scope.restrictedMinStayProps.length>0){var flex_dates=$scope.getFlexDates(property.flex.availability,new Date($scope.search.start_date),flex_days,searchPattern,3,isRestricted)}if(searchPattern.substr(0,searchPattern.length-1).length>=parseInt(property.flex.min_stay.split(",")[0])&&isRestricted.length>0){var flex_dates2=$scope.getFlexDates(property.flex.availability,new Date($scope.search.start_date),flex_days,searchPattern.substr(0,searchPattern.length-1),3,isRestricted)}if(flex_dates2.length>0){flex_dates=flex_dates.concat(flex_dates2)}if(flex_dates.length>4){flex_dates.splice(3,flex_dates.length-4)}if(flex_dates&&flex_dates.length>0){properties[index]["flex_dates"]=flex_dates;flex_properties.push(properties[index])}}else{var flex_dates=$scope.getFlexDates(property.flex.availability,new Date($scope.search.start_date),flex_days,searchPattern,3,isRestricted);if($rootScope.searchSettings.advancedMinStayLogic&&$rootScope.searchSettings.disableMinimalDays&&$scope.flex==0||flex_dates.length>0){properties[index]["flex_dates"]=flex_dates;flex_properties.push(properties[index])}}}});$rootScope.properties=$rootScope.propertiesObj;if($rootScope.searchSettings.enable_full_flex_range==1||$scope.restrictedMinStayProps.length>0&&($rootScope.searchSettings.advancedMinStayLogic==1||$scope.flex)){for(var i in $rootScope.properties){for(var j in flex_properties){if($rootScope.properties[i].id==flex_properties[j].id){$rootScope.properties[i].flex_dates=flex_properties[j].flex_dates;$rootScope.properties[i].flex=flex_properties[j].flex;angular.forEach($scope.restrictedMinStayProps,function(restrictedProp,index){if($rootScope.properties[i].id==restrictedProp.id){$rootScope.properties[i].min_stay=restrictedProp.min_stay;$rootScope.properties[i].restricted_day=restrictedProp.day}})}}}}else{if($rootScope.properties.length>0){$rootScope.properties=$rootScope.properties.concat(flex_properties)}else{$rootScope.properties=flex_properties}}if($rootScope.searchSettings.enable_full_flex_range==0||$scope.restrictedMinStayProps.length==0){$scope.flexCount=flex_properties.length}$scope.removeDuplicates($rootScope.properties,"id");$rootScope.propertiesObj=Object.keys($rootScope.properties).map(function(key){return $rootScope.properties[key]});angular.forEach(arrMarkers,function(item,i){item.setMap(null)});arrMarkers=[];if($rootScope.searchSettings.enable_full_flex_range==1||$scope.restrictedMinStayProps.length>0){$scope.method="GetPropertyAvailabilityWithRatesWordPress"}$scope.noResults=false;if(flex_properties.length==0&&$rootScope.properties.length==0){$scope.noResults=true}$scope.loadMarkers($rootScope.propertiesObj,$scope.autoZoom==1?true:false)}$scope.total_units=$scope.total_units+$scope.flexCount;$scope.limit+=$scope.flexCount;$scope.loading=false;if($scope.flexPagination<$scope.flexTotalPages&&$rootScope.properties.length>0){$scope.showMoreButton=true}})}}};$scope.availabilitySearch=function(search,map_search){var interval_filt=rpuri.getQueryStringParam("int_filt");var page_size=$rootScope.searchSettings.propertyPagination;$scope.noResults=false;$scope.skipUnits="";if(typeof search!="undefined"&&typeof search.int_filt!="undefined"){page_size=search.int_filt;$scope.limit=page_size}else if(typeof interval_filt!=="undefined"){page_size=interval_filt;$scope.limit=page_size}else{$scope.limit=page_size}map_search=typeof map_search!=="undefined"?map_search:false;$scope.mapSearch=map_search;$scope.loading=true;var params=$scope.getParams();params["page_number"]=$scope.currentPage;params["page_results_number"]=page_size;$scope.total_units=0;$scope.total_pages=0;angular.forEach(arrMarkers,function(item,i){item.setMap(null)});arrMarkers=[];if($rootScope.searchSettings.enable_all_pins==1){$scope.keepSearching=true;$scope.searchNumber++}if($rootScope.show_all_rates&&$rootScope.rate_type!=""){params["rate_type_name"]=$rootScope.rate_type}if($rootScope.bookingSettings.enable_rates_pw==1&&typeof rate_type_name!="undefined"){params["rate_type_name"]=rate_type_name;params["madetype_id"]=7}if($rootScope.searchSettings.enable_adv_geo_map_logic==1){jQuery(document).find("path").each(function(){jQuery(this).removeClass("active")})}if(typeof search!="undefined"&&typeof search.end_date!="undefined"||typeof search!="undefined"&&typeof search.start_date=="undefined"&&typeof search.end_date=="undefined"||typeof search=="undefined"){if($rootScope.searchSettings.enable_all_pins==1){$scope.searchProperties(params,$scope.searchNumber,page_size,1,true)}else{$scope.searchProperties(params,false,page_size,1,true)}}};$scope.searchReviews=function(params,searchNumber,size,page){params.page_number=page;params.page_results_number=parseInt($rootScope.pagination_reviews);$scope.showReviewButton=true;$scope.loading=true;params.show_booking_dates=1;var paginationType=parseInt($rootScope.select_load_reviews);if(paginationType==1){$scope.enableInfinitiScroll=true}run_waitMe(".testimonials_area","roundBounce","loading reviews...");rpapi.getWithParams("GetAllFeedback",params).success(function(obj){$scope.loading=false;$rootScope.reviewsObj=[];$rootScope.properties=[];$scope.total_feedbacks=0;$scope.limit=5;var total_review_pages=obj.data.pagination.total_pages;hide_waitMe(".testimonials_area");if(!Array.isArray(obj.data.comments)){var comments=[];comments.push(obj.data.comments);obj.data.comments=comments}if(!obj.status&&obj.data&&obj.data.pagination.total_feedbacks>0){$scope.foundReviews=true;var tempReviews=[];tempReviews=obj.data.comments;if($rootScope.reviews.length>0){if(paginationType!==2){$rootScope.reviews=$rootScope.reviews.concat(tempReviews)}else{$rootScope.reviews=tempReviews}}else{$rootScope.reviews=tempReviews}$rootScope.reviewsObj=Object.keys($rootScope.reviews).map(function(key){var newDate=new Date($rootScope.reviews[key].startdate);newDate.setDate(newDate.getDate()+1);newDate=moment(newDate).format("MM/DD/YYYY");$rootScope.reviews[key].reservationStartDate=newDate;return $rootScope.reviews[key]})}else{$scope.noResults=true}if(obj.data.pagination.total_pages==params.page_number){$scope.showReviewButton=false}if(paginationType==2){jQuery("#pagination-demo").twbsPagination({totalPages:total_review_pages,initiateStartPageClick:false,hideOnlyOnePage:true,visiblePages:5,next:">",first:"<<",last:">>",prev:"<",onPageClick:function(event,page){$scope.searchReviews(params,false,total_review_pages,page);jQuery("#page-content").text("Page "+page)+" content here"}})}})};$scope.searchProperties=function(params,searchNumber,size,page,clearUnits){params.page_number=page;params.page_results_number=size;$currentPage=page;if($rootScope.searchSettings.full_description==1&&$rootScope.searchSettings.enable_quick_view==1){params.use_description="yes"}if(params.sort_by=="random"){params.page_number=1;params.skip_units=$scope.skipUnits}$scope.loading=true;var method=$rootScope.searchSettings.searchMethod;if($rootScope.searchSettings.enable_max_occupants_logic==1){method="BizcorGetPropertyAvailabilityWithRatesWordPress"}if(params.startdate&&params.enddate){$scope.daysDiff=$scope.getDaysDifference(params.startdate,params.enddate);if($scope.daysDiff>$rootScope.searchSettings.maxSearchDays){method="GetPropertyAvailabilitySimple"}else{params.use_bundled_fees_in_room_rate=1;params.square_feet=1;params.floor_name=1;params.square_feet=1;if($rootScope.travel_type_id!=""){params.type_id=$rootScope.travel_type_id}}}else if($scope.guest_plusLogic==1&&!params.startdate&&!params.enddate){method="GetPropertyAvailabilitySimple"}else{method="GetPropertyListWordPress"}$scope.method=method;if(params.page_number<=1&&$rootScope.searchSettings.enable_all_pins==1){run_waitMe(".listings_wrapper_box","roundBounce"," Updating Results...")}else if($rootScope.searchSettings.enable_all_pins==0){run_waitMe(".listings_wrapper_box","roundBounce"," Updating Results...")}rpapi.getWithParams(method,params).success(function(response){$scope.loading=false;if(clearUnits){$rootScope.propertiesObj=[];$rootScope.properties=[];$scope.total_units=0;$scope.total_pages=0;$scope.limit=$rootScope.searchSettings.propertyPagination;if(params.skip_units){$scope.skipUnits=params.skip_units}else{$scope.skipUnits=""}}if(params.page_number<=1&&$rootScope.searchSettings.enable_all_pins==1){setTimeout(function(){hide_waitMe(".listings_wrapper_box")},500)}else if($rootScope.searchSettings.enable_all_pins==0){hide_waitMe(".listings_wrapper_box")}if(!response.status&&response.data.available_properties&&response.data.available_properties.pagination.total_units>0){if(clearUnits){$scope.total_units=response.data.available_properties.pagination.total_units;$scope.total_pages=response.data.available_properties.pagination.total_pages}$scope.foundUnits=true;var tempProperties=[];if(response.data.available_properties.pagination.total_pages==params.page_number){$scope.showMoreButton=false}else{$scope.showMoreButton=true;$scope.enableInfinitiScroll=true}if(method=="GetPropertyAvailabilitySimple"||method=="GetPropertyListWordPress"){if(response.data.property.id){tempProperties=[response.data.property]}else{tempProperties=response.data.property}}else{if(response.data.available_properties.property.id){tempProperties=[response.data.available_properties.property]}else{tempProperties=response.data.available_properties.property}}if(method!="GetPropertyListWordPress"&&$rootScope.searchSettings.total_units_pagination!=""){var number=$rootScope.searchSettings.total_units_pagination;var percent_calcuation=$scope.total_units/number*100;$scope.percent=percent_calcuation.toFixed(1)+"%"}if($rootScope.enable_turn_day_searching){angular.forEach(tempProperties,function(property,key){var turn_over_message="";if(property["restrictions"]){var min_days=property["restrictions"]["min_days"];if(property["restrictions"]["Weekly-Check-In-is-Sat"]==0&&min_days==7){turn_over_message="Arriving Saturday";$scope.turn_day_sat=1}if(property["restrictions"]["Weekly-Check-In-is-Sun"]==0&&min_days==7){turn_over_message="Arriving Sunday";$scope.turn_day_sun=1}if(property["restrictions"]["Weekly-Check-In-is-Fri"]==0&&min_days==7){turn_over_message="Arriving Friday";$scope.turn_day_fri=1}if(turn_over_message!=""){tempProperties[key]["turn_over_message"]=turn_over_message}}})}if($rootScope.properties.length>0){$rootScope.properties=$rootScope.properties.concat(tempProperties)}else{$rootScope.properties=tempProperties}var restrict_ids=[];if(($rootScope.searchSettings.advancedMinStayLogic==1||$rootScope.enable_turn_day_searching==1)&&$scope.search&&$scope.search.start_date&&$scope.search.end_date){$scope.reviewRestrictions(tempProperties,$scope.search.start_date,$scope.search.end_date);angular.forEach($scope.restrictedMinStayProps,function(property){restrict_ids.push(property.id)})}var found_ids=[];angular.forEach(tempProperties,function(property){if(!restrict_ids.includes(property.id))found_ids.push(property.id);$scope.flexSkip.push(property.id);if(params.sort_by=="random"){if($scope.skipUnits==""){$scope.skipUnits=property.id}else{$scope.skipUnits+=","+property.id}}});$scope.total_pages=response.data.available_properties.pagination.total_pages;$scope.loadMarkers(tempProperties,$scope.autoZoom==1?true:false);flex=3;if(restrict_ids.length>0&&$rootScope.searchSettings.advancedMinStayLogic==1||$rootScope.searchSettings.enable_full_flex_range==1||$scope.flex&&$scope.total_pages<=$scope.currentPage){$scope.flexSearch(params,false,size,1,true,$scope.flexSkip,restrict_ids)}if(method=="GetPropertyAvailabilityWithRatesWordPress"&&typeof UpLift!=="undefined"){params["order_total"]=0;var tripInfo=$scope.buildTripInfo(params);if(clearUnits){UpLift.Payments.init({apiKey:$rootScope.upliftApiKey,onModalClose:$scope.myOnModalCloseHandler,onModalOpen:$scope.myOnModalOpenHandler,locale:"en-US",currency:"USD"});setTimeout(function(){UpLift.Payments.load(tripInfo,$scope.myPaymentsLoadCallback)},500)}else{setTimeout(function(){UpLift.Payments.update(tripInfo,$scope.myPaymentsLoadCallback)},500)}}$rootScope.propertiesObj=Object.keys($rootScope.properties).map(function(key){return $rootScope.properties[key]});if($rootScope.searchSettings.enable_all_pins==1&&$scope.showMoreButton){$scope.limit+=$rootScope.searchSettings.propertyPagination;if(params.sort_by=="random"){$scope.searchProperties(params,searchNumber,size,1,false)}else{$currentPage++;params=$scope.getParams();$scope.searchProperties(params,searchNumber,size,$currentPage,false)}}if($rootScope.searchSettings.pagination_option==2){jQuery("#inventory-pagination").twbsPagination({totalPages:$scope.total_pages,initiateStartPageClick:false,hideOnlyOnePage:true,visiblePages:5,next:">",first:"<<",last:">>",prev:"<",onPageClick:function(event,page){$currentPage=page;if($scope.turn_dates_logic==0){params.turn_dates_logic=0;params.disable_minimal_days=0}$scope.searchProperties(params,searchNumber,size,page,true)}})}}else{$scope.showMoreButton=false;if(($scope.sortBy=="random"||page!=0)&&$scope.enableInfinitiScroll==true){$scope.noResults=false}else{$scope.noResults=true}if(response.status){$rootScope.searchSettings.noIvnMessage=response.status.description;$scope.noResults=true}if($scope.flex>0){$scope.flexSearch(params,false,size,1,true)}}$scope.loading=false})};$scope.reviewRestrictions=function(Properties,start_date,end_date){var restrict_ids=[];var stayLength=$scope.getDaysDifference(start_date,end_date);var checkin_date=new Date(start_date);angular.forEach(Properties,function(property){if(property.restrictions){var min_days=null;var day=null;if(property.restrictions["min_days"]){min_days=property.restrictions.min_days}if(property.restrictions["Weekly-Check-In-is-Fri"]===0&&(checkin_date.getDay()!=5||checkin_date.getDay()==5&&min_days==7&&stayLength<min_days)){day=5}if(property.restrictions["Weekly-Check-In-is-Sat"]===0&&(checkin_date.getDay()!=6||checkin_date.getDay()==6&&min_days==7&&stayLength<min_days)){day=6}if(property.restrictions["Weekly-Check-In-is-Sun"]===0&&(checkin_date.getDay()!=0||checkin_date.getDay()==0&&min_days==7&&stayLength<min_days)){day=0}if(stayLength<=property.restrictions.min_days||day!=null)restrict_ids.push({id:property.id,min_stay:min_days,day:day})}else if($scope.isString(property.restriction_message)){var min_stay=property.restriction_message.split("required # of nights - ");if(min_stay.length>1){min_stay=min_stay[1].split("<br>")[0];$scope.restrictedMinStayProps.push({id:property.id,min_stay:min_stay,day:null});restrict_ids.push({id:property.id,min_stay:min_stay,day:null})}if(property.restriction_message.indexOf("Sun")!=-1){$scope.restrictedMinStayProps.push({id:property.id,day:0,min_stay:7});restrict_ids.push({id:property.id,min_stay:7,day:0})}if(property.restriction_message.indexOf("Sat")!=-1){$scope.restrictedMinStayProps.push({id:property.id,day:6,min_stay:7});restrict_ids.push({id:property.id,min_stay:7,day:6})}if(property.restriction_message.indexOf("Fri")!=-1){$scope.restrictedMinStayProps.push({id:property.id,day:5,min_stay:7});restrict_ids.push({id:property.id,min_stay:7,day:5})}}else{if(property.flex){var min_stay=property.flex.min_stay.split(",")[0];restrict_ids.push({id:property.id,min_stay:min_stay,day:null})}}if(min_days>$scope.flex_min_stay)$scope.flex_min_stay=min_days});$scope.restrictedMinStayProps=restrict_ids};$scope.initQuotes=function(startdate,enddate){setTimeout(function(){if(typeof UpLift!=="undefined"){UpLift.Payments.init({apiKey:$rootScope.upliftApiKey,onModalClose:$scope.myOnModalCloseHandler,onModalOpen:$scope.myOnModalOpenHandler,locale:"en-US",currency:"USD"});var params={startdate:startdate,enddate:enddate,order_total:0};var tripInfo=$scope.buildTripInfo(params);setTimeout(function(){UpLift.Payments.load(tripInfo,$scope.myPaymentsLoadCallback)},500)}},1e3)};$scope.myOnModalCloseHandler=function(){};$scope.myOnModalOpenHandler=function(){};$scope.setAdvancedMinStayLogicDays=function(startDate,days,fullDate){var newDate=new Date(startDate);newDate.setDate(newDate.getDate()+days);if(fullDate){newDate=newDate.getMonth()+1+"/"+newDate.getDate()+"/"+newDate.getFullYear();return newDate}else{return newDate.getDate()}};$scope.advancedMinStayLogicDates=function(property,days){var selectedDate=$scope.setAdvancedMinStayLogicDays(property.flex.startdate,days,true);var startDate=new Date(selectedDate);var endDate=new Date(selectedDate);endDate.setDate(endDate.getDate()+parseInt(property.min_stay));var availability=property.flex.availability.split("");var isAvailable=true;availability=availability.slice(days);availability=availability.slice(0,parseInt(property.min_stay));if(availability.length>=parseInt(property.min_stay)){for(var i=0;i<availability.length;i++){if(availability[i]=="N"){isAvailable=false}}}if(isAvailable&&endDate<=$scope.restrictedDateEnd){property.restrictedMinStayDates=[];property.restrictedMinStayDates.startDate=$scope.formatDate(startDate);property.restrictedMinStayDates.endDate=$scope.formatDate(endDate)}else{property.restrictedMinStayDates=[];property.restrictedMinStayDates.message="Dates not available, Please visit property to see full property availability"}};$scope.myPaymentsLoadCallback=function(result){$scope.monthlyAmount=UpLift.Payments.getMonthlyAmount(true)};$scope.buildTripInfo=function(params){var tripInfo={order_amount:params["order_total"],travelers:[{id:0}],hotel_reservations:[{hotel_name:"Unit",check_in:params["startdate"].substring(6,10)+params["startdate"].substring(0,2)+params["startdate"].substring(3,5),check_out:params["enddate"].substring(6,10)+params["enddate"].substring(0,2)+params["enddate"].substring(3,5),number_of_rooms:1}]};return tripInfo};$scope.paymentLogin=function(login){var data={action:"streamlinecore-payment-login",confirmation_id:login.confirmation_id,zip_code:login.zip_code,nonce:login.nonce};run_waitMe("#login-payment-form","roundBounce","Updating Results...");$http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data}).then(function successCallback(response){hide_waitMe("#login-payment-form");if(response.data.success){var form_action=jQuery("#form_payment_login").attr("action");jQuery("#form_payment_login").attr("action",form_action+"?hash="+response.data.data.hash);jQuery("#hash").val(response.data.data.hash);jQuery("#form_payment_login").submit()}else{if($rootScope.use_last_name==1){Alert.add(Alert.errorType,"Confirmation number or Last Name incorrect.")}else{Alert.add(Alert.errorType,"Confirmation number or zip code incorrect.")}}},function errorCallback(response){Alert.add(Alert.errorType,"Cant send email")})};$scope.shareWithFriends=function(){if($scope.frmShare.$valid){var link=$scope.goToProperty($scope.share.seo_page_name,$scope.share.start_date,$scope.share.end_date,$scope.share.occupants,$scope.share.occupants_small,$scope.share.pets);var message=$scope.share.message;var data={action:"streamlinecore-share-with-friends",fnames:$scope.share.fnames,femails:$scope.share.femails,name:$scope.share.name,email:$scope.share.email,msg:message,slug:$scope.share.seo_page_name,link:link,nonce:$scope.share.nonce};$http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data}).then(function successCallback(response){if(response.data.success){Alert.add(Alert.successType,response.data.data.message);setTimeout(function(){jQuery("#modalShare").modal("hide")},3e3)}else{Alert.add(Alert.errorType,response.data.data.message)}},function errorCallback(response){Alert.add(Alert.errorType,"Cant send email")})}return false};$scope.signupForPriceAlert=function(signup){run_waitMe(".modal-body","roundBounce","Submit Request...");var data_params={action:"streamlinecore-signup_price_alert",unit_id:$scope.book.unit_id,first_name:signup.first_name,last_name:signup.last_name,start_date:signup.start_date,end_date:signup.end_date,unit_name:signup.unit_name,seo_name:signup.seo_name,email:signup.email};$http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data_params}).then(function successCallback(response){hide_waitMe(".modal-body");jQuery("#sign_up").modal("toggle")},function errorCallback(response){Alert.add(Alert.errorType,"Cant sign up for price alert")})};$scope.signupForCancelationAlert=function(cancelation){run_waitMe(".modal-body","roundBounce","Submit Request...");var data_params={action:"streamlinecore-signup_cancelation_alert",unit_id:$scope.book.unit_id,first_name:cancelation.first_name,last_name:cancelation.last_name,start_date:cancelation.start_date,end_date:cancelation.end_date,unit_name:cancelation.unit_name,seo_name:cancelation.seo_name,email:cancelation.email};rpapi.getWithParams("VerifyPropertyAvailability",{unit_id:$scope.book.unit_id,startdate:cancelation.start_date,enddate:cancelation.end_date,occupants:1,use_room_type_logic:parseInt($rootScope.roomTypeLogic)}).success(function(obj){if(obj.status){$http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data_params}).then(function successCallback(response){hide_waitMe(".modal-body");jQuery("#cancelation_sign_up").modal("toggle")},function errorCallback(response){hide_waitMe(".modal-body");Alert.add(Alert.errorType,"Cant sign up for price alert")})}else{hide_waitMe(".modal-body");Alert.add(Alert.successType,"Good News!, This property is available for booking on the selected dates.")}})};$scope.noInventorySubmit=function(){Alert.clear();var data={action:"streamlinecore-noInventory-form",noInventory_name:$scope.search.no_inventory_name,noInventory_email:$scope.search.no_inventory_email,noInventory_phone:$scope.search.no_inventory_phone,noInventory_subject:$scope.search.no_inventory_subject,noInventory_message:$scope.search.no_inventory_message,nonce:$scope.search.nonce};$http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data}).then(function successCallback(response){if(response.data.success){msg=response.data.data.message;Alert.add(Alert.successType,msg);$scope.resetNoInventory()}else{msg=response.data.data.message;Alert.add(Alert.errorType,msg)}},function errorCallback(response){Alert.add(Alert.errorType,"Cant send email")});return false};$scope.filterByBedroom=function(minBedroom,maxBedroom){$scope.BedroomsRangeEnabled=true;$scope.minBedroom=minBedroom;$scope.maxBedroom=maxBedroom};$scope.bedroomFilter=function(item){var result=true;if($scope.bedroomsNumber.indexOf("-")!==-1){var beds=$scope.bedroomsNumber.split("-");if(item.bedrooms_number>=beds[0]&&item.bedrooms_number<=beds[1]){return true}else{return false}}else{if(parseInt($scope.bedroomsNumber)>0){if(item.bedrooms_number==$scope.bedroomsNumber){result=true}else{result=false}}}return result};$scope.locationFilter=function(item){var result=true;if($scope.locationAreaId>0){if(item.location_area_id==$scope.locationAreaId){result=true}else{result=false}}return result};$scope.neighborhoodFilter=function(item){var result=true;if($scope.neighborhood!=""){if(item.neighborhood_name==$scope.neighborhood){result=true}else{result=false}}return result};$scope.viewNameFilter=function(item){var result=true;if($scope.viewname!=""){if(item.view_name==$scope.viewname){result=true}else{result=false}}return result};var calendarMonthsLimit=jQuery("#monthsLimit").text();var date=calendarMonthsLimit;var message="";var checkMessage=$rootScope.calendar_limit_alert;if(checkMessage=="defaultMessage"){message="Pricing is not ready past "+date}else{message=checkMessage}jQuery(document).on("click",".ui-datepicker-next",function(){if(jQuery(this).hasClass("ui-state-disabled")){Swal.fire({allowOutsideClick:false,text:message,icon:"warning",confirmButtonText:"Okay"})}});$scope.addBedCount=function(){var page_size=$rootScope.searchSettings.propertyPagination;$scope.limit+=$rootScope.searchSettings.propertyPagination;var paramsBed=$scope.getParams();if(paramsBed.bedrooms_number&&$rootScope.searchSettings.bedroom_count==1){jQuery(".add_bed_count").show();paramsBed.plusBed=true;paramsBed.bedrooms_number=paramsBed.bedrooms_number+1;if($scope.flex&&$rootScope.searchSettings.enable_full_flex_range==1&&$scope.total_pages<=$scope.currentPage){$scope.flexSearch(paramsBed,false,40,$scope.currentPage,false,$scope.flex)}else{$scope.searchProperties(paramsBed,false,40,$scope.currentPage,false)}}else{jQuery(".add_bed_count").hide()}};$scope.popularProperties=function(){if($rootScope.searchSettings.popular_properties_id){jQuery(".popular_prop").show();var paramsCateg=$scope.getParams();paramsCateg.resort_area_id=$rootScope.searchSettings.popular_properties_id;paramsCateg.occupants="";paramsCateg.home_type="";paramsCateg.group_type="";paramsCateg.bedroom_type="";paramsCateg.bedrooms_number="";$scope.maxPrice="";if($scope.flex&&$rootScope.searchSettings.enable_full_flex_range==1&&$scope.total_pages<=$scope.currentPage){$scope.flexSearch(paramsCateg,false,40,$scope.currentPage,false,$scope.flex)}else{$scope.searchProperties(paramsCateg,false,40,$scope.currentPage,false)}}else{jQuery(".popular_prop").hide()}};$scope.searchWithoutDates=function(){var search=$scope.search;var page_size=$rootScope.searchSettings.propertyPagination;$scope.limit+=$rootScope.searchSettings.propertyPagination;var paramsDate={};if(search.start_date&&search.end_date){paramsDate.justDates=true;paramsDate.startdate=search.start_date;paramsDate.enddate=search.end_date;$location.search("sd",search.start_date);$location.search("ed",search.end_date)}if($scope.flex&&$rootScope.searchSettings.enable_full_flex_range==1&&$scope.total_pages<=$scope.currentPage){$scope.flexSearch(paramsDate,true,40,$scope.currentPage,false,$scope.flex)}else{$scope.searchProperties(paramsDate,true,40,$scope.currentPage,false)}};$scope.goToTapeChart=function(){window.location.href="/show-reservation-block/"};$scope.noInvetoryFrm=function(){jQuery(".noInvetoryForm").parent().addClass("noInventory-alert")};$scope.bedroom_count=$rootScope.searchSettings.bedroom_count;$scope.noInventoryForm=$rootScope.searchSettings.noInventoryForm;$scope.tapeChart=$rootScope.searchSettings.enable_tapeChart;$scope.popular_properties=$rootScope.searchSettings.popular_properties;$scope.without_dates=$rootScope.searchSettings.without_dates;jQuery(".lightbox-trigger").click(function(){jQuery(".ms-sl-selected .ms-lightbox-btn .ms-lightbox").click();if(jQuery(".layout-3").length){jQuery(".ekko-lightbox").addClass("msLightbox")}});if($rootScope.searchSettings.enable_calendar_arrows==1){jQuery(".date-group .date-arrows").show();jQuery(".nextDayDate").click(function(){if(jQuery(this).parents(".wdfilter").length){var startDate=new Date(jQuery("#filter_start_date").val());var endDate=new Date(jQuery("#filter_end_date").val());startDate.setDate(startDate.getDate()+1);endDate.setDate(endDate.getDate()+1);jQuery("#filter_start_date").datepicker("setDate",startDate);jQuery("#filter_end_date").datepicker("setDate",endDate);var newSdate=("0"+(startDate.getMonth()+1)).slice(-2)+"/"+("0"+startDate.getDate()).slice(-2)+"/"+startDate.getFullYear();var newEdate=("0"+(endDate.getMonth()+1)).slice(-2)+"/"+("0"+endDate.getDate()).slice(-2)+"/"+endDate.getFullYear();$scope.search.start_date=newSdate;$scope.search.end_date=newEdate;$scope.availabilitySearch()}else{var startDate=new Date(jQuery("#search_start_date").val());var endDate=new Date(jQuery("#search_end_date").val());startDate.setDate(startDate.getDate()+1);endDate.setDate(endDate.getDate()+1);jQuery("#search_start_date").datepicker("setDate",startDate);jQuery("#search_end_date").datepicker("setDate",endDate)}});jQuery(".prevDayDate").click(function(){if(jQuery(this).parents(".wdfilter").length){var startDate=new Date(jQuery("#filter_start_date").val());var endDate=new Date(jQuery("#filter_end_date").val());startDate.setDate(startDate.getDate()-1);endDate.setDate(endDate.getDate()-1);jQuery("#filter_start_date").datepicker("setDate",startDate);jQuery("#filter_end_date").datepicker("setDate",endDate);var newSdate=("0"+(startDate.getMonth()+1)).slice(-2)+"/"+("0"+startDate.getDate()).slice(-2)+"/"+startDate.getFullYear();var newEdate=("0"+(endDate.getMonth()+1)).slice(-2)+"/"+("0"+endDate.getDate()).slice(-2)+"/"+endDate.getFullYear();$scope.search.start_date=newSdate;$scope.search.end_date=newEdate;$scope.availabilitySearch()}else{var startDate=new Date(jQuery("#search_start_date").val());var endDate=new Date(jQuery("#search_end_date").val());startDate.setDate(startDate.getDate()-1);endDate.setDate(endDate.getDate()-1);jQuery("#search_start_date").datepicker("setDate",startDate);jQuery("#search_end_date").datepicker("setDate",endDate)}})}else{jQuery(".date-group.date-arrows").hide()}var addGuest="";if($scope.occupants!==undefined){addGuest=$scope.occupants;jQuery("#streamlinecore_fw_adults").val(addGuest)}else{addGuest=0}jQuery(".increase_guest").click(function(){var maxGuest=jQuery("#streamlinecore_fw_adults").attr("max");if(parseInt(maxGuest)>parseInt(addGuest)){addGuest++;jQuery("#streamlinecore_fw_adults").val(addGuest)}});jQuery(".decrease_guest").click(function(){var minGuest=jQuery("#streamlinecore_fw_adults").attr("min");if(parseInt(minGuest)<parseInt(addGuest)){addGuest--;jQuery("#streamlinecore_fw_adults").val(addGuest)}else{jQuery("#streamlinecore_fw_adults").val("")}});$scope.resetSearch=function(){$scope.search.occupants="";$scope.search.end_date="";$scope.search.start_date="";$scope.search.home_type="";$scope.search.group_type="";$scope.search.bedroom_type="";$scope.search.viewname="";$scope.search.area="";$scope.search.location_resort="";$scope.search.neighborhood_id="";$scope.search.location="";$scope.search.num_bedrooms="";$scope.search.occupants_small="";$scope.search.pets="";jQuery(".ui-slider-range").css("left","0");jQuery(".ui-slider-range").css("width","100%");jQuery(".resortpro-search-price .ui-slider-handle").first().css("left","0");jQuery(".resortpro-search-price .ui-slider-handle").last().css("right","0");jQuery(".resortpro-search-price .ui-slider-handle").last().css("left","auto");$scope.minPrice=100;$scope.maxPrice="";window.setTimeout(function(){$scope.availabilitySearch("");$scope.filterByPrice($scope.minPrice,$scope.maxPrice);$scope.priceRangeEnabled=false;$scope.priceRange()},100);$location.search({"":null});jQuery(".amenity_group input").removeAttr("checked")};if($rootScope.bookingSettings.show_booking_calendar_daily_rate==1){jQuery("#ui-datepicker-div").addClass("bigCalendar")}$scope.availableProperties=function(id){if($scope.results.length>=0){if($.inArray(id,$scope.results)>=0){return true}else{return false}}else{return true}};$scope.roomDetails=function(){jQuery(".room-details-content").slick({dots:false,infinite:false,speed:300,slidesToShow:2,prevArrow:"<span class='a-left control-c prev slick-prev'><i class='fa fa-long-arrow-left'></i></span>",nextArrow:"<span class='a-right control-c next slick-next'><i class='fa fa-long-arrow-right'></i></span>",adaptiveHeight:true,responsive:[{breakpoint:600,settings:{slidesToShow:1}},{breakpoint:480,settings:{slidesToShow:1}}]})};$scope.getRoomDetails=function(unit_id){$scope.room_details=[];if(!unit_id){unit_id=$scope.propertyId}rpapi.getWithParams("GetPropertyRoomsDetailsRawData",{unit_id:unit_id}).success(function(obj){if(obj.data.roomsdetails){if(obj.data.roomsdetails.name){var results=[];results.push(obj.data.roomsdetails);$scope.room_details=results}else{$scope.room_details=obj.data.roomsdetails}}})};$scope.getRatesDetails=function(unit_id){if($rootScope.rates_details.length==0){var params={unit_id:unit_id};var yearLimit=$rootScope.bookingSettings.restrict_rate_table;var enableRestrictRate=$rootScope.bookingSettings.restrict_rates;var daysLimit=$rootScope.bookingSettings.rate_restrict_days;if($rootScope.yielding=="1")params["use_yielding"]="yes";if($rootScope.show_all_rates=="1")params["show_all_rates"]="true";if($rootScope.show_all_rates=="0")jQuery(".login_btn_action").hide();rpapi.getWithParams("GetPropertyRatesRawData",params).success(function(obj){var ratelist=obj.data.rates;if($rootScope.show_all_rates=="1"&&$rootScope.rate_type!==""){var selectedRateType=$rootScope.rate_type;var rateResults=[];angular.forEach(obj.data.rates,function(rate,index){angular.forEach(rate,function(rates,index){if(rates.rate_type_name==selectedRateType){rateResults.push(rates)}})});ratelist=rateResults}if($rootScope.show_all_rates=="1"&&$rootScope.bookingSettings.enable_rates_pw==1){var get_rate_type=$cookies.get("streamline-rate_type");if(typeof get_rate_type!="undefined"){var selectedRateType=get_rate_type;var rateResults=[];angular.forEach(obj.data.rates,function(rate,index){angular.forEach(rate,function(rates,index){if(rates.rate_type_name==selectedRateType){rateResults.push(rates)}})});ratelist=rateResults}}if(ratelist.period_begin){var results=[];var limitDate=new Date(obj.data.rates.period_begin);if(enableRestrictRate==1&&(yearLimit.length||daysLimit>0)){if(yearLimit.length&&daysLimit==0){if(Date.parse(requiredDate)>=Date.parse(limitDate)){results.push(obj.data.rates)}}else{var n=parseInt(daysLimit);var requiredDate=new Date;requiredDate.setDate(requiredDate.getDate()+n);if(Date.parse(requiredDate)>=Date.parse(limitDate)){results.push(obj.data.rates)}}}else{results.push(obj.data.rates)}$rootScope.rates_details=results;if($rootScope.bookingSettings.show_calendar_daily_rate==1){jQuery.datepicker._generateHTML=function(){var realGenerateHtml=jQuery.datepicker._generateHTML;return function(instance){var html=realGenerateHtml.apply(this,arguments),jQuerytemp;if(instance.input.is(".availability-calendar")){jQuerytemp=jQuery("<table></table>").append(html);jQuerytemp.find(".ui-datepicker-calendar td").each(function(key,value){var YY=jQuery(this).data("year"),mm=jQuery(this).data("month"),dd=jQuery(this).find("a").text();if(dd==""){dd=jQuery(this).find("span").text()}if(jQuery(this).attr("title")!=undefined){var daily_rate=jQuery(this).attr("title")}else{var daily_rate=""}if(typeof dd!="undefined"&&(typeof mm!="undefined"&&dd!="NaN")){if(typeof daily_rate!="undefined"){if(jQuery(this).hasClass("booked")){jQuery(this).append("<small>Not Available</small>")}else{jQuery(this).append("<small data-date='"+mm+"/"+dd+"/"+YY+"' class='c_daily_rate'>"+daily_rate+"</small>")}}}});html=jQuerytemp[0].innerHTML}return html}}();setTimeout(function(){jQuery(".availability").find("td.booked > span").addClass("show_daily_rate")},500)}if($rootScope.bookingSettings.show_booking_calendar_daily_rate==1){jQuery.datepicker._generateHTML=function(){var realGenerateHtml=jQuery.datepicker._generateHTML;return function(instance){var html=realGenerateHtml.apply(this,arguments),jQuerytemp;if(instance.input.is("#book_start_date")||instance.input.is("#book_end_date")){jQuerytemp=jQuery("<table></table>").append(html);jQuerytemp.find(".ui-datepicker-calendar td").each(function(key,value){var YY=jQuery(this).data("year"),mm=jQuery(this).data("month"),dd=jQuery(this).find("a").text();if(dd==""){dd=jQuery(this).find("span").text()}if(jQuery(this).attr("title")!=undefined){var daily_rate=jQuery(this).attr("title")}else{var daily_rate=""}if(typeof dd!="undefined"&&(typeof mm!="undefined"&&dd!="NaN")){if(typeof daily_rate!="undefined"){if(jQuery(this).hasClass("booked")){jQuery(this).append("<small>Not Available</small>")}else{jQuery(this).append("<small data-date='"+mm+"/"+dd+"/"+YY+"' class='c_daily_rate'>"+daily_rate+"</small>")}}}});html=jQuerytemp[0].innerHTML}return html}}();setTimeout(function(){jQuery("#ui-datepicker-div").find("td.available > span").addClass("show_daily_rate")},500)}}else{$rootScope.rates_details=obj.data.rates;var allRates=$rootScope.rates_details;var ratelist=[];if(enableRestrictRate==1&&(yearLimit.length||daysLimit>0)){if(yearLimit.length&&daysLimit==0){angular.forEach(allRates,function(rate){var startRate=new Date(rate.period_begin);if(Date.parse(yearLimit)>=Date.parse(startRate)){ratelist.push(rate)}})}else{var n=parseInt(daysLimit);var requiredDate=new Date;requiredDate.setDate(requiredDate.getDate()+n);angular.forEach(allRates,function(rate){var startRate=new Date(rate.period_begin);if(Date.parse(requiredDate)>=Date.parse(startRate)){ratelist.push(rate)}})}}else{if($rootScope.bookingSettings.enable_rates_pw==1){angular.forEach(allRates,function(rate){angular.forEach(rate,function(single_rate){ratelist.push(single_rate)})})}else{angular.forEach(allRates,function(rate){ratelist.push(rate)})}}$rootScope.rates_details=ratelist;if($rootScope.bookingSettings.show_calendar_daily_rate==1){jQuery.datepicker._generateHTML=function(){var realGenerateHtml=jQuery.datepicker._generateHTML;return function(instance){var html=realGenerateHtml.apply(this,arguments),jQuerytemp;if(instance.input.is(".availability-calendar")){jQuerytemp=jQuery("<table></table>").append(html);jQuerytemp.find(".ui-datepicker-calendar td").each(function(key,value){var YY=jQuery(this).data("year"),mm=jQuery(this).data("month"),dd=jQuery(this).find("a").text();if(dd==""){dd=jQuery(this).find("span").text()}var daily_rate=jQuery(this).attr("title");if(typeof daily_rate!="undefined"){if(jQuery(this).hasClass("booked")){jQuery(this).append("<small>Not Available</small>")}else{jQuery(this).append("<small data-date='"+mm+"/"+dd+"/"+YY+"' class='c_daily_rate'>"+daily_rate+"</small>")}}});html=jQuerytemp[0].innerHTML}return html}}();setTimeout(function(){jQuery(".availability").find("td.booked > span").addClass("show_daily_rate")},500)}if($rootScope.bookingSettings.show_booking_calendar_daily_rate==1){jQuery.datepicker._generateHTML=function(){var realGenerateHtml=jQuery.datepicker._generateHTML;return function(instance){var html=realGenerateHtml.apply(this,arguments),jQuerytemp;if(instance.input.is("#book_start_date")||instance.input.is("#book_end_date")){jQuerytemp=jQuery("<table></table>").append(html);jQuerytemp.find(".ui-datepicker-calendar td").each(function(key,value){var YY=jQuery(this).data("year"),mm=jQuery(this).data("month"),dd=jQuery(this).find("a").text();if(dd==""){dd=jQuery(this).find("span").text()}var daily_rate=jQuery(this).attr("title");if(typeof daily_rate!="undefined"){jQuery(this).append("<small data-date='"+mm+"/"+dd+"/"+YY+"' class='c_daily_rate_booking'>"+daily_rate+"</small>")}});html=jQuerytemp[0].innerHTML}return html}}();setTimeout(function(){jQuery("#ui-datepicker-div").find("td.available > span").addClass("show_daily_rate")},500)}}jQuery(".availability-calendar").datepicker("refresh");if($rootScope.hideTooltips!=1){add_tooltip()}if($rootScope.bookingSettings.enable_season_graph==1){var graphBorderColor=$rootScope.bookingSettings.graph_border_color;var graphGradientColors=$rootScope.bookingSettings.graph_gradient_colors;var gradients=graphGradientColors.split(",");var gradientStart=gradients[0];var gradientStop=gradients[1];var d=new Date;function goToDate(s){var b=s.split("/");return b[2]+"-"+b[0]+"-"+b[1]}function dateDMY(s){var b=s.split("/");return b[1]+"/"+b[0]+"/"+b[2]}var ctx=document.getElementById("seasonGraph").getContext("2d");var ratesPrice=obj.data.rates;var seasonRates=[];var date=[];var treeMonthsLimit=[];var initialData=[];var treemonthsLimit=d.setMonth(d.getMonth()+3);var yLabels={};for(var i=0;i<ratesPrice.length;i++){seasonRates.push({price:ratesPrice[i].daily_first_interval_price.replace(/[^\d\.]/g,""),name:ratesPrice[i].season_name,startSeason:ratesPrice[i].period_begin});date.push({t:new Date(goToDate(ratesPrice[i].period_begin)),y:ratesPrice[i].daily_first_interval_price.replace(/[^\d\.]/g,""),name:ratesPrice[i].season_name});if(new Date(goToDate(ratesPrice[i].period_begin))<=treemonthsLimit){treeMonthsLimit.push({t:new Date(goToDate(ratesPrice[i].period_begin)),y:ratesPrice[i].daily_first_interval_price.replace(/[^\d\.]/g,""),name:ratesPrice[i].season_name})}}if($rootScope.bookingSettings.enable_graph_limit_months==0){initialData=date;$scope.graphPagination=false}else{initialData=treeMonthsLimit;$scope.graphPagination=true}for(var i=0;i<seasonRates.length;i++){yLabels[seasonRates[i].price]=seasonRates[i].name}var gradient=ctx.createLinearGradient(0,0,0,400);gradient.addColorStop(0,gradientStart);gradient.addColorStop(1,gradientStop);var chart=new Chart(ctx,{type:"line",data:{datasets:[{label:"Hover on dot to see the season name",borderWidth:3,data:initialData,borderColor:graphBorderColor,backgroundColor:gradient,pointHoverRadius:4,pointRadius:2,id:"default"}]},options:{layout:{padding:1},tooltips:{enabled:true,mode:"single",callbacks:{title:function(tooltipItem,data){return"Start Date: "+dateDMY(tooltipItem[0].xLabel)},label:function(tooltipItem,data){var y=tooltipItem.yLabel.toFixed(2);var x=tooltipItem.yLabel;if(y in yLabels){label=yLabels[y]}label2="Nightly Rate - "+x.toString()+"$";return[label,label2]}}},layout:{padding:2},legend:{display:false},title:{display:false},scales:{yAxes:[{scaleLabel:{display:true},ticks:{callback:function(value,index,values){return"$"+value}}}],xAxes:[{type:"time",time:{tooltipFormat:"DD/MM/YYYY",unit:"month",unitStepSize:1},scaleLabel:{display:true}}]}}});jQuery(document).on("click","#chart .dropdown-menu li",function(){var charPagination=jQuery(this).val();var getValue=jQuery(this).text();jQuery("#chart .dropdown-select").text(getValue);var newDate=[];var limitdate=new Date;if(charPagination==0){newDate=date}else{limitdate.setMonth(limitdate.getMonth()+parseInt(charPagination));angular.forEach(date,function(month,i){if(month.t<=limitdate){newDate.push({t:month.t,y:month.y,name:month.name})}})}var newDataset={label:"Hover on dot to see the season name",borderWidth:3,data:newDate,borderColor:graphBorderColor,backgroundColor:gradient,pointHoverRadius:4,pointRadius:2,id:"default"};angular.forEach(chart.data.datasets,function(dataset,index){if(dataset.id=="default"){chart.data.datasets.splice(index,1);chart.data.datasets.push(newDataset);return true}});chart.update()})}else{jQuery("#chart").remove()}})}};if($rootScope.bookingSettings.enable_rates_pw==1){var check_block_rates=$cookies.getObject("streamline-block_rates");if(check_block_rates==0)jQuery(".login_btn_action").hide();if(typeof check_block_rates=="undefined"||check_block_rates==1){$scope.sl_type_rate=1}else{$scope.sl_type_rate=0}$scope.checkPasswordRateSearch=function(){if($scope.rates.password==$rootScope.bookingSettings.enter_pw_1){jQuery(".rates_container").removeClass("block_rates_main");jQuery("#pwModal").modal("hide");jQuery(".login_btn_action").hide();$cookies.putObject("streamline-block_rates",0,{path:"/",secure:"true"});var selectedRateType=$rootScope.bookingSettings.rate_type_1;$cookies.put("streamline-rate_type",selectedRateType,{path:"/",secure:"true"});var selectedRateTypeId=$rootScope.bookingSettings.rate_type_id_1;$cookies.put("streamline-rate_type",selectedRateTypeId,{path:"/",secure:"true"});$scope.availabilitySearch();$scope.sl_type_rate=0;jQuery(".rate_price").show();jQuery(".rate_text").hide()}else if($scope.rates.password==$rootScope.bookingSettings.enter_pw_2){jQuery(".rates_container").removeClass("block_rates_main");jQuery("#pwModal").modal("hide");jQuery(".login_btn_action").hide();$cookies.putObject("streamline-block_rates",0,{path:"/",secure:"true"});var selectedRateType=$rootScope.bookingSettings.rate_type_2;$cookies.put("streamline-rate_type",selectedRateType,{path:"/",secure:"true"});var selectedRateTypeId=$rootScope.bookingSettings.rate_type_id_2;$cookies.put("streamline-rate_type",selectedRateTypeId,{path:"/",secure:"true"});$scope.availabilitySearch();$scope.sl_type_rate=0;jQuery(".rate_price").show();jQuery(".rate_text").hide()}else if($scope.rates.password==$rootScope.bookingSettings.enter_pw_3){jQuery(".rates_container").removeClass("block_rates_main");jQuery("#pwModal").modal("hide");jQuery(".login_btn_action").hide();$cookies.putObject("streamline-block_rates",0,{path:"/",secure:"true"});var selectedRateType=$rootScope.bookingSettings.rate_type_3;$cookies.put("streamline-rate_type",selectedRateType,{path:"/",secure:"true"});var selectedRateTypeId=$rootScope.bookingSettings.rate_type_id_3;$cookies.put("streamline-rate_type",selectedRateTypeId,{path:"/",secure:"true"});$scope.availabilitySearch();$scope.sl_type_rate=0;jQuery(".rate_price").show();jQuery(".rate_text").hide()}else if($scope.rates.password==$rootScope.bookingSettings.enter_pw_4){jQuery(".rates_container").removeClass("block_rates_main");jQuery("#pwModal").modal("hide");jQuery(".login_btn_action").hide();$cookies.putObject("streamline-block_rates",0,{path:"/",secure:"true"});var selectedRateType=$rootScope.bookingSettings.rate_type_4;$cookies.put("streamline-rate_type",selectedRateType,{path:"/",secure:"true"});var selectedRateTypeId=$rootScope.bookingSettings.rate_type_id_4;$cookies.put("streamline-rate_type",selectedRateTypeId,{path:"/",secure:"true"});$scope.availabilitySearch();$scope.sl_type_rate=0;jQuery(".rate_price").show();jQuery(".rate_text").hide()}else{jQuery(".error_pw").show()}}}$scope.getCalendarData=function(unit_id){rpapi.getWithParams("GetPropertyAvailabilityCalendarRawData",{unit_id:unit_id}).success(function(obj){if(obj.data.blocked_period.startdate){var results=[];results.push(obj.data.blocked_period);$rootScope.calendar=results}else{$rootScope.calendar=obj.data.blocked_period}if($rootScope.hideTooltips!=1){add_tooltip()}if($rootScope.show_all_rates=="1"&&$rootScope.bookingSettings.enable_rates_pw==1){var check_block_rates=$cookies.getObject("streamline-block_rates");$scope.block_rates=check_block_rates;if(check_block_rates==0){$scope.getRatesDetails(unit_id)}else{$cookies.putObject("streamline-block_rates",1,{path:"/",secure:"true"});jQuery(".rates_container").addClass("block_rates_main")}}else{$scope.getRatesDetails(unit_id)}jQuery(".availability-calendar").datepicker("refresh")})};$scope.getCalendarDataNew=function(unit_id){var use_room_type="no";if($rootScope.roomTypeLogic=="1"){use_room_type="yes"}run_waitMe("#resortpro-book-unit, .availability","bounce","Updating Price...");run_waitMe(".quick-view-unit","bounce","Updating Results...");if($rootScope.show_back_to_back_reservations==1){$scope.getBlockedPeriods(unit_id)}rpapi.getWithParams("GetPropertyAvailabilityRawData",{unit_id:unit_id,use_room_type_logic:use_room_type,standard_pricing:1}).success(function(obj){if(obj.data){$rootScope.calendar2=obj.data}hide_waitMe("#resortpro-book-unit, .availability, .quick-view-unit");if($rootScope.hideTooltips!=1){add_tooltip()}if(jQuery(".quick-view-unit").length){setTimeout(function(){jQuery(".slider").css({width:jQuery("#quick-availability").width()})},100)}if($rootScope.show_all_rates=="1"&&$rootScope.bookingSettings.enable_rates_pw==1){jQuery(".book_now_btn_action").hide();jQuery(".login_btn_action").show();jQuery(".c-sidebar__inquiry-btn").hide();var check_block_rates=$cookies.getObject("streamline-block_rates");if(typeof check_block_rates=="undefined"||check_block_rates==1){$scope.visible_btn_rates=1;jQuery(".login_btn_action").show()}else{$scope.visible_btn_rates=0;$scope.getRatesDetails(unit_id)}if(check_block_rates==0){jQuery(".rates_container").removeClass("block_rates_main");jQuery(".book_now_btn_action").show();jQuery(".c-sidebar__inquiry-btn").show();jQuery(".login_btn_action").hide()}else{$cookies.putObject("streamline-block_rates",1,{path:"/",secure:"true"})}}else{$scope.getRatesDetails(unit_id)}jQuery(".availability-calendar").datepicker("refresh")})};$scope.getBlockedPeriods=function(unit_id){rpapi.getWithParams("GetPropertyAvailabilityCalendarRawData",{unit_id:unit_id}).success(function(obj){if(obj.data.blocked_period.startdate){var results=[];results.push(obj.data.blocked_period);$rootScope.calendar=results}else{$rootScope.calendar=obj.data.blocked_period}angular.forEach($rootScope.calendar,function(calObj,index){var startdate=new Date(calObj.startdate);var enddate=new Date(calObj.enddate);if($rootScope.calendar[index-1]){var previousdate=new Date($rootScope.calendar[index-1].enddate);previousdate.setTime(previousdate.getTime()+1*864e5);if(previousdate.getTime()===startdate.getTime()){$scope.blockedPeriods.push(startdate.getTime())}}})})};$scope.getPropertyRatesAndStay=function(unit_id){var today=new Date;var dd=today.getDate();var mm=today.getMonth()+1;var yyyy=today.getFullYear();if(dd<10){dd="0"+dd}if(mm<10){mm="0"+mm}today=mm+"/"+dd+"/"+yyyy;var d=new Date;d.setFullYear(yyyy+1);dd=d.getDate();mm=d.getMonth()+1;yyyy=d.getFullYear();var next_year=mm+"/"+dd+"/"+yyyy;var params={unit_id:unit_id,startdate:today,enddate:next_year};if($rootScope.roomTypeLogic=="1")params["use_room_type_logic"]="yes";rpapi.getWithParams("GetPropertyRates",params).success(function(obj){if(obj.data.season){$rootScope.rates.push(obj.data)}else{angular.forEach(obj.data,function(rate,index){$rootScope.rates.push(rate)})}jQuery(".availability-calendar").datepicker("refresh");if($rootScope.hideTooltips!=1){add_tooltip()}})};$scope.renderCalendar=function(date,checkout){var title="";var booked=false;var strClass="available";angular.forEach($rootScope.rates_details,function(rateObj,index){var periodBegin=new Date(rateObj.period_begin);var periodEnd=new Date(rateObj.period_end);if(date>=periodBegin&&date<=periodEnd){var daysMapping={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};if(rateObj.daily_first_interval){var arrInterval=rateObj.daily_first_interval.split("-");title=rateObj.daily_first_interval_price;if(arrInterval.length>1){var firstInt=daysMapping[arrInterval[0]];var secondInt=daysMapping[arrInterval[1]];if(secondInt>firstInt){if(date.getDay()>=firstInt&&date.getDay()<=secondInt){title=rateObj.daily_first_interval_price}else{title=rateObj.daily_second_interval_price}}else{if(date.getDay()<firstInt&&date.getDay()>secondInt){title=rateObj.daily_second_interval_price}else{title=rateObj.daily_first_interval_price}}}else{title=rateObj.daily_first_interval_price}}else{title=String(rateObj.season_name)}}});angular.forEach($rootScope.calendar,function(calObj,index){var use_slash=false;var startdate=new Date(calObj.startdate);var enddate=new Date(calObj.enddate);if($rootScope.slash=="1")use_slash=true;if(use_slash){enddate.setTime(enddate.getTime()+1*864e5);if(!checkout){if(date>=startdate&&date<=enddate){booked=true;strClass="booked";if(date.getTime()===startdate.getTime()){if($rootScope.calendar[index-1]){var previousdate=new Date($rootScope.calendar[index-1].enddate);previousdate.setTime(previousdate.getTime()+1*864e5);if(previousdate.getTime()!==startdate.getTime()){booked=true;strClass="slashl"}}else{booked=true;strClass="slashl"}}else if(date.getTime()===enddate.getTime()){booked=false;strClass="slashr"}}}else{if(date.getTime()===startdate.getTime()){if($rootScope.calendar[index-1]){var previousdate=new Date($rootScope.calendar[index-1].enddate);previousdate.setTime(previousdate.getTime()+1*864e5);if(previousdate.getTime()!==startdate.getTime()){booked=false;strClass="slashl"}else{booked=false;strClass="booked"}}else{booked=false;strClass="slashl"}}if(date>startdate&&date<=enddate){booked=true;strClass="booked";if($scope.book.checkin){checkin=new Date($scope.book.checkin);if(date>checkin){$scope.maxCalendarDate=date}}}}}else{if(!checkout){if(date>=startdate&&date<=enddate){booked=true;strClass="booked"}}else{if(date.getTime()===startdate.getTime()){booked=false;strClass="available"}if(date>startdate&&date<=enddate){booked=true;strClass="booked"}}}});if($rootScope.hideTooltips==1){hide_tooltip()}if($rootScope.dynamicCalendarMinStay==1){strClass+=" restricted_hover"}return[!booked,strClass,title]};if($rootScope.dayOffEnable==1){jQuery(".availability").append("<span style='display:none' class='dayOff'>"+$rootScope.seasonOffMessage+"</span>")}$scope.renderCalendarNew=function(date,restriction,action){setTimeout(function(){$scope.block_rates_av=$cookies.getObject("streamline-block_rates")},50);if($rootScope.calendar2.range){var str_price="";var start_date=new Date($rootScope.calendar2.range.beginDate);var end_date=new Date($rootScope.calendar2.range.endDate);angular.forEach($rootScope.rates_details,function(rateObj){var periodBegin=new Date(rateObj.period_begin);var periodEnd=new Date(rateObj.period_end);if(date>=periodBegin&&date<=periodEnd){var daysMapping={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};if(rateObj.daily_first_interval){var arrInterval=rateObj.daily_first_interval.split("-");str_price=rateObj.daily_first_interval_price;if(arrInterval.length>1){var firstInt=daysMapping[arrInterval[0]];var secondInt=daysMapping[arrInterval[1]];if(secondInt>firstInt){if(date.getDay()>=firstInt&&date.getDay()<=secondInt){str_price=rateObj.daily_first_interval_price}else{str_price=rateObj.daily_second_interval_price}}else{if(date.getDay()<firstInt&&date.getDay()>secondInt){str_price=rateObj.daily_second_interval_price}else{str_price=rateObj.daily_first_interval_price}}}else{str_price=rateObj.daily_first_interval_price}if($rootScope.calendar_decimal==0){str_price=str_price.split(".")[0]}else{str_price=str_price}}else{str_price=String(rateObj.season_name)}}if($rootScope.hideTooltips==1){hide_tooltip()}});var loop=new Date(start_date);var i=0;while(loop<=end_date){if(date.toDateString()==loop.toDateString()){var prev_available=$rootScope.calendar2.availability.substring(i-1,i);var available=$rootScope.calendar2.availability.substring(i,i+1);var change_over=$rootScope.calendar2.changeOver.substring(i,i+1);if(available=="Y"){if($rootScope.searchSettings.disabledBooking=="disabled"){var is_available=false}else{var is_available=true}if(restriction&&action=="checkin"&&(change_over=="X"||change_over=="O")){is_available=false}else if(restriction&&action=="checkout"&&(change_over=="X"||change_over=="I")){is_available=false}else if(!restriction){is_available=false}if($rootScope.searchSettings.disabledBooking=="disabled"){var class_available=prev_available=="N"?"slash-end available":" slash-start available"}else{var class_available=prev_available=="N"?"slash-end available":" available"}if($rootScope.hideTooltips==1){hide_tooltip()}if($rootScope.dynamicCalendarMinStay==1){class_available+=" restricted_hover"}return[is_available,class_available,str_price]}else{var class_available=prev_available=="Y"?"slash-start available":"booked";var is_available=false;if(prev_available=="Y"&&action=="checkout"){is_available=true;class_available="slash-start available"}if($rootScope.show_back_to_back_reservations==1){if(jQuery.inArray(loop.getTime(),$scope.blockedPeriods)>-1){class_available+=" slash-new-booking"}}if($rootScope.calendar_decimal==0){str_price=str_price.split(".")[0]}else{str_price=str_price}if($rootScope.hideTooltips==1){hide_tooltip()}if($rootScope.dynamicCalendarMinStay==1){class_available+=" restricted_hover"}return[is_available,class_available,str_price]}}var current_date=loop.setDate(loop.getDate()+1);loop=new Date(current_date);i++}}return[false,"booked",""]};$scope.myShowDaysFunction=function(date){var res=$scope.renderCalendar(date,false);return res};$scope.myShowDaysFunctionCheckout=function(date){var res=$scope.renderCalendar(date,true);return res};if($rootScope.searchSettings.enable_drag_search==1){$scope.autoZoom=0;if($rootScope.searchSettings.enable_map_clusters==1){$scope.dragEnd=function(search){$scope.autoZoom=0;if($scope.mapSearchEnabled){var ne=map.getBounds().getNorthEast();var sw=map.getBounds().getSouthWest();$scope.latNE=ne.lat();$scope.longNE=ne.lng();$scope.latSW=sw.lat();$scope.longSW=sw.lng();markerCluster.clearMarkers();$scope.availabilitySearch($scope.search,true);$scope.autoZoom=0}}}else{$scope.dragEnd=function(search){$scope.autoZoom=0;if($scope.mapSearchEnabled){var ne=map.getBounds().getNorthEast();var sw=map.getBounds().getSouthWest();$scope.latNE=ne.lat();$scope.longNE=ne.lng();$scope.latSW=sw.lat();$scope.longSW=sw.lng();$scope.availabilitySearch($scope.search,true);$scope.autoZoom=0}}}}$scope.isSimplePricing=function(property){return!property.price?true:false};$scope.getNightlyPrice=function(property,decimals){var nightly_price="N/A";if($rootScope.searchSettings.searchMethod=="GetPropertyAvailabilityWithRatesWordPress"||$scope.method=="BizcorGetPropertyAvailabilityWithRatesWordPress"){nightly_price=currency(property.minimum_day_price,undefined,decimals)}return nightly_price};$scope.getTotalPrice=function(property,decimals){var price="N/A";if($rootScope.searchSettings.searchMethod=="GetPropertyAvailabilityWithRatesWordPress"||$scope.method=="BizcorGetPropertyAvailabilityWithRatesWordPress"){if($rootScope.searchSettings.priceDisplay=="price"&&property.price>0){price=currency(property.price,undefined,decimals)}else{price=currency(property.total,undefined,decimals)}}return price};$scope.getOldPrice=function(property,decimals){var price="N/A";if($rootScope.searchSettings.searchMethod=="GetPropertyAvailabilityWithRatesWordPress"||$scope.method=="BizcorGetPropertyAvailabilityWithRatesWordPress"){if($rootScope.searchSettings.priceDisplay=="price"&&property.price>0){var total=property.price+property.coupon_discount;price=currency(total,undefined,decimals)}else{var total=property.total+property.coupon_discount;price=currency(total,undefined,decimals)}}return price};$scope.getReservationPrice=function(property){var price=0;if($rootScope.searchSettings.searchMethod=="GetPropertyAvailabilityWithRatesWordPress"||$scope.method=="BizcorGetPropertyAvailabilityWithRatesWordPress"){if($rootScope.searchSettings.priceDisplay=="price"&&property.price>0){price=property.price}else{price=property.total}}return price};$scope.getTotalAppend=function(property){if($rootScope.searchSettings.priceDisplay=="price"&&property.total&&property.total>0){return"excluding taxes & fees"}else{return"including taxes & fees"}};$scope.getSimplePrice=function(price_data,decimals){var priceText="N/A";var diffDays=0;if($scope.search){diffDays=$scope.getDaysDifference($scope.search.start_date,$scope.search.end_date)}if($rootScope.searchSettings.useMonthlyPricing==1&&price_data.monthly&&price_data.monthly>0){priceText=currency(price_data.monthly,undefined,decimals)}if($rootScope.searchSettings.useWeeklyPricing==1&&price_data.weekly&&price_data.weekly>0){priceText=currency(price_data.weekly,undefined,decimals)}if($rootScope.searchSettings.useDailyPricing==1&&price_data.daily&&price_data.daily>0){priceText=currency(price_data.daily,undefined,decimals)}if(diffDays>=7&&diffDays<30&&price_data.weekly>0&&$rootScope.searchSettings.useDailyPricing==1&&$rootScope.searchSettings.useWeeklyPricing==1){dailyPrice=price_data.weekly/7;priceText=currency(dailyPrice,undefined,decimals)}if(diffDays>=30&&price_data.monthly>0&&$rootScope.searchSettings.useDailyPricing==1&&$rootScope.searchSettings.useMonthlyPricing==1){dailyPrice=price_data.monthly/30;priceText=currency(dailyPrice,undefined,decimals)}if($rootScope.searchSettings.manualPricing==1&&diffDays>0){Price=price_data.daily*diffDays;priceText=currency(Price,undefined,decimals)}return priceText};$scope.getDaysDifference=function(start_date,end_date){var oneDay=24*60*60*1e3;var checkin=new Date(start_date);var checkout=new Date(end_date);return Math.round(Math.abs((checkin.getTime()-checkout.getTime())/oneDay))};$scope.getArrivalDay=function(start_date){var checkin=new Date(start_date);return checkin.getDay()};$scope.getDailyPrice=function(price_data){var price=0;var diffDays=0;if($scope.search){diffDays=$scope.getDaysDifference($scope.search.start_date,$scope.search.end_date)}if($rootScope.searchSettings.useDailyPricing==1&&price_data.daily&&price_data.daily>0){var dailyPrice=price_data.daily;if(diffDays>=7&&diffDays<30&&price_data.weekly>0){dailyPrice=price_data.weekly/7}if(diffDays>=30&&price_data.monthly>0){dailyPrice=price_data.monthly/30}price=dailyPrice}else if($rootScope.searchSettings.useWeeklyPricing==1&&price_data.weekly&&price_data.weekly>0){price=price_data.weekly}else if($rootScope.searchSettings.useMonthlyPricing==1&&price_data.monthly&&price_data.monthly>0){price=price_data.monthly}return price};$scope.getPrependTex=function(price_data){var prependText="";var diffDays=0;if($scope.search){diffDays=$scope.getDaysDifference($scope.search.start_date,$scope.search.end_date)}if($rootScope.searchSettings.useMonthlyPricing==1&&price_data.monthly&&price_data.monthly>0){prependText=$rootScope.searchSettings.monthlyPrepend}if($rootScope.searchSettings.useWeeklyPricing==1&&price_data.weekly&&price_data.weekly>0){prependText=$rootScope.searchSettings.weeklyPrepend}if($rootScope.searchSettings.useDailyPricing==1&&price_data.daily&&price_data.daily>0){prependText=$rootScope.searchSettings.dailyPrepend}if(diffDays>=7&&diffDays<30&&price_data.weekly>0&&$rootScope.searchSettings.useWeeklyPricing==1&&$rootScope.searchSettings.useDailyPricing==1){prependText=$rootScope.searchSettings.dailyPrepend}if(diffDays>=30&&price_data.monthly>0&&$rootScope.searchSettings.useMonthlyPricing==1&&$rootScope.searchSettings.useMonthlyPricing==1){prependText=$rootScope.searchSettings.dailyPrepend}if($rootScope.searchSettings.manualPricing==1&&diffDays>0){prependText=""}return prependText};$scope.getAppendTex=function(price_data){var appendText="";var diffDays=0;if($scope.search){diffDays=$scope.getDaysDifference($scope.search.start_date,$scope.search.end_date)}if($rootScope.searchSettings.useMonthlyPricing==1&&price_data.monthly&&price_data.monthly>0){appendText=$rootScope.searchSettings.monthlyAppend}if($rootScope.searchSettings.useWeeklyPricing==1&&price_data.weekly&&price_data.weekly>0){appendText=$rootScope.searchSettings.weeklyAppend}if($rootScope.searchSettings.useDailyPricing==1&&price_data.daily&&price_data.daily>0){appendText=$rootScope.searchSettings.dailyAppend}if(diffDays>=7&&diffDays<30&&price_data.weekly>0&&$rootScope.searchSettings.useWeeklyPricing==1&&$rootScope.searchSettings.useDailyPricing==1){appendText=$rootScope.searchSettings.dailyAppend}if(diffDays>=30&&price_data.monthly>0&&$rootScope.searchSettings.useMonthlyPricing==1&&$rootScope.searchSettings.useDailyPricing==1){appendText=$rootScope.searchSettings.dailyAppend}if($rootScope.searchSettings.manualPricing==1&&diffDays>0){appendText=$rootScope.searchSettings.manualPricingMessage}return appendText};$scope.loadMarker=function(markerData){if(markers.length>0&&$rootScope.searchSettings.add_map_lines==1){$scope.searchBox();angular.forEach(lines,function(line,i){if(line.id!==markerData.id){line.setMap(null)}});var markerPos=new google.maps.LatLng(markerData.latitude,markerData.longitude);var centerCircle=new google.maps.LatLng(markers[0].getPosition().lat(),markers[0].getPosition().lng());var distance=google.maps.geometry.spherical.computeDistanceBetween(centerCircle,markerPos);function k2m(kilometers){var km=parseFloat(kilometers);var mi="";if(!isNaN(km))mi=km*.621371192;return mi}if(distance<=setRadius){var unitDist="";var unitDistLong="";var unitOfmeasurement=$rootScope.searchSettings.map_unit_measurement;if(unitOfmeasurement=="K"){unitDist=(distance/1e3).toFixed(2);unitDistLong="Km"}else{unitDist=k2m(distance/1e3).toFixed(2);unitDistLong="M"}markerData["distance"]=unitDist}}var myLatlng=new google.maps.LatLng(markerData.latitude,markerData.longitude);var price="";var icon="";function checkIcon(custom_home_icon,ski_out,ski_out_icon,hot_tub,hot_tub_icon){if(hot_tub==="yes"&&hot_tub_icon!==""){var icon_c=hot_tub_icon}else if(ski_out==="yes"&&ski_out_icon!==""){var icon_c=ski_out_icon}else if(custom_home_icon!==""){var icon_c=custom_home_icon}else{var icon_c='<i style="font-size:14px" class="fa fa-home"></i>'}icon=icon_c;return icon}if($scope.method=="GetPropertyAvailabilityWithRatesWordPress"||$scope.method=="BizcorGetPropertyAvailabilityWithRatesWordPress"){price=$filter("currency")(markerData.price,undefined,0);checkIcon($rootScope.custom_home_icon,markerData.ski_out,$rootScope.ski_out_icon,markerData.hot_tub,$rootScope.hot_tub_icon);if(markerData.price.daily||markerData.price.weekly||markerData.price.monthly){price='<i style="font-size:14px" class="fa fa-home"></i>'}}else if($rootScope.searchSettings.manualPricing!=1){checkIcon($rootScope.custom_home_icon,markerData.ski_out,$rootScope.ski_out_icon,markerData.hot_tub,$rootScope.hot_tub_icon);if(markerData.price){if($rootScope.searchSettings.useDailyPricing==1&&markerData.price.daily&&markerData.price.daily>0){price=$filter("currency")(markerData.price.daily,undefined,0)}else if($rootScope.searchSettings.useWeeklyPricing==1&&markerData.price.weekly&&markerData.price.weekly>0){price=$filter("currency")(markerData.price.weekly,undefined,0)}else if($rootScope.searchSettings.useMonthlyPricing==1&&markerData.price.monthly&&markerData.price.monthly>0){price=$filter("currency")(markerData.price.monthly,undefined,0)}}}else{checkIcon($rootScope.custom_home_icon,markerData.ski_out,$rootScope.ski_out_icon,markerData.hot_tub,$rootScope.hot_tub_icon);if(markerData.price){if($rootScope.searchSettings.useDailyPricing==1&&markerData.price.daily&&markerData.price.daily>0){price=$filter("currency")(markerData.price.daily,undefined,0)}else if($rootScope.searchSettings.useWeeklyPricing==1&&markerData.price.weekly&&markerData.price.weekly>0){price=$filter("currency")(markerData.price.weekly,undefined,0)}else if($rootScope.searchSettings.useMonthlyPricing==1&&markerData.price.monthly&&markerData.price.monthly>0){price=$filter("currency")(markerData.price.monthly,undefined,0)}}}var pin=$templateCache.get("pin.html");pin=pin.replace("%icon%",icon);pin=pin.replace("%price%",price);if($scope.markerType=="marker"){var marker=new RichMarker({id:markerData.id,map:map,title:markerData.name,position:myLatlng,shadow:"none",content:pin});$scope.highlightIcon=function(unit_id){if($rootScope.searchSettings.view_on_map_button==1){jQuery("#viewMap-"+unit_id).css("bottom","10px")}angular.forEach(arrMarkers,function(item){if(item.id==unit_id){if(item.getContent()){if($rootScope.searchSettings.enable_highlighted_unit_on_map==1){jQuery(".listings_wrapper_box > div").addClass("hightlight");map.panTo(item.position)}item.setContent(item.getContent().replace("arrow_box","arrow_box_hover"));item.setZIndex($scope.upIcon)}}})};$scope.restoreIcon=function(unit_id){if($rootScope.searchSettings.view_on_map_button==1){jQuery("#viewMap-"+unit_id).css("bottom","-40px")}angular.forEach(arrMarkers,function(item){if(item.id==unit_id){if(item.getContent()){item.setContent(item.getContent().replace("arrow_box_hover","arrow_box"));item.setZIndex($scope.downIcon)}}})};$scope.raiseMapControls=function(){var mapControls=jQuery(".gm-bundled-control-on-bottom");jQuery(mapControls).addClass("moved")};if($rootScope.searchSettings.enable_map_slider==1){$scope.raiseMapControls()}$scope.closeMapSlider=function(){var slider=jQuery("#map-slider");jQuery(slider).addClass("closed");var mapControls=jQuery(".gm-bundled-control-on-bottom");jQuery(mapControls).removeClass("moved")};$scope.MapSlider=function(){jQuery("#map-slider").one("slide.bs.carousel",function(e){var id=e.relatedTarget;var unit_id=jQuery(id).data("propid");angular.forEach(arrMarkers,function(item){if(item.id==unit_id){if(item.getContent()){map.panTo(item.position);var itemContent=jQuery(item.getContent());if(jQuery(itemContent).hasClass("arrow_box")){item.setContent(item.getContent().replace("arrow_box","arrow_box_hover"));item.setZIndex($scope.upIcon)}}}else{var itemContent=jQuery(item.getContent());if(jQuery(itemContent).hasClass("arrow_box_hover")){item.setContent(item.getContent().replace("arrow_box_hover","arrow_box"));item.setZIndex($scope.downIcon)}}})})};$scope.MapSliderMarker=function(slide_index){var slider=jQuery("#map-slider");var mapControls=jQuery(".gm-bundled-control-on-bottom");if(slider.hasClass("closed")){jQuery(slider).removeClass("closed");jQuery(mapControls).addClass("moved")}var slide=jQuery(slider).find("[data-propid='"+slide_index+"']").index();jQuery("#map-slider").carousel(slide)}}else if($scope.markerType=="circle"){var marker=new google.maps.Circle({strokeColor:$scope.strokeColor,strokeOpacity:$scope.strokeOpacity,strokeWeight:$scope.strokeWeight,fillColor:$scope.fillColor,fillOpacity:$scope.fillOpacity,map:map,id:markerData.id,title:markerData.name,center:myLatlng,radius:$scope.radius})}infowindow=new google.maps.InfoWindow;var start_date="";var end_date="";var occupants="";var occupants_small="";var pets="";if($scope.search){start_date=$scope.search.start_date;end_date=$scope.search.end_date;occupants=$scope.search.occupants;occupants_small=$scope.search.occupants_small;pets=$scope.search.pets}var url=$scope.goToProperty(markerData.seo_page_name,start_date,end_date,occupants,occupants_small,pets);google.maps.event.addListener(marker,"click",function(marker){return function(){var content=$templateCache.get("marker.html");content=content.replace(/%id%/g,markerData.id);content=content.replace(/%name%/g,markerData.name);content=content.replace(/%area%/g,markerData.area);var gallery="";if(markerData.gallery&&$rootScope.searchSettings.enable_marker_gallery==1){gallery='<div class="carousel-inner"><div class="item active"><a class="thumb" href="'+url+'"><img src="'+markerData.gallery[0].thumbnail_path+'" /></a></div>';for(i=1;i<markerData.gallery.length;i++){gallery+='<div class="item"><a class="thumb" href="'+url+'"><img src="'+markerData.gallery[i].thumbnail_path+'" /></a></div>'}gallery+='</div><a class="left carousel-control" href="#mapCarousel-'+markerData.id+'" data-slide="prev"><span class="glyphicon glyphicon-chevron-left"></span><span class="sr-only">Previous</span></a><a class="right carousel-control" href="#mapCarousel-'+markerData.id+'" data-slide="next"><span class="glyphicon glyphicon-chevron-right"></span><span class="sr-only">Next</span></a>'}else{gallery='<a href="'+url+'"><img src="'+markerData.image+'" alt="'+markerData.name+'" class="marker-image" />'}content=content.replace(/%gallery%/g,gallery);content=content.replace(/%rating%/g,markerData.rating);content=content.replace(/%rating_count%/g,markerData.rating_count);content=content.replace(/%url%/g,url);content=content.replace(/%image%/g,markerData.image);content=content.replace(/%beds%/g,markerData.beds);content=content.replace(/%baths%/g,markerData.baths);content=content.replace(/%guests%/g,markerData.guests);content=content.replace(/%price%/g,price);if(markerData.distance!=undefined){content=content.replace(/%dist%/g,markerData.distance);content=content.replace(/%distUnit%/g,unitDistLong)}else{content=content.replace(/%block%/g,"none")}content=content.replace(/%price_append%/g,$scope.getAppendTex(markerData.price));infowindow.setContent(content);infowindow.open(map,marker);if($scope.markerType=="circle"){infowindow.setPosition(marker.getCenter())}if($rootScope.searchSettings.enable_map_slider==1){$scope.MapSlider();$scope.MapSliderMarker(marker.id);var popup=jQuery(document).find(".map-search");jQuery(popup).addClass("slider-map")}}}(marker));$scope.viewOnMap=function(unit_id){angular.forEach(arrMarkers,function(item){if(item.id==unit_id){google.maps.event.trigger(item,"click",{})}})};if($scope.markerType=="circle"){google.maps.event.addListener(infowindow,"domready",function(){var iwOuter=document.querySelector(".gm-style-iw");iwOuter.previousSibling.style.display="none";iwOuter.parentElement.classList.add("gm-iw-wrapper")})}arrMarkers.push(marker)};$scope.setModalCheckin=function(date){$scope.modal_checkin=date;nts=1;var checkinDate=new Date(date);if($rootScope.dynamicCalendarMinStay){angular.forEach($rootScope.rates_details,function(rate){var startDate=new Date(rate.period_begin);var endDate=new Date(rate.period_end);if(checkinDate.getTime()<=endDate.getTime()&&checkinDate.getTime()>=startDate.getTime()){nts=parseInt(rate.narrow_defined_days);return false}})}jQuery("#modal_start_date").data("min-stay",nts);var the_year=checkinDate.getFullYear();if(the_year<2e3)the_year=2e3+the_year%100;var to=new Date(the_year,checkinDate.getMonth(),parseInt(checkinDate.getDate())+parseInt(nts));if($rootScope.avail_calendar_type=="arrival_depart"){var frm=new Date(to);jQuery("#modal_end_date").datepicker("option","minDate",frm)}};$scope.resetCalendarPopup=function(){$scope.showDays=true;$scope.modal_total_reservation=0;$scope.modal_nights="";$scope.modal_weeks=""};$scope.setNights=function(){var frm=new Date($scope.modal_checkin);nts=parseInt($scope.modal_nights);var the_year=frm.getFullYear();if(the_year<2e3)the_year=2e3+the_year%100;var to=new Date(the_year,frm.getMonth(),frm.getDate()+nts);$scope.modal_checkout=to.format("mm/dd/yyyy");var unitID="";if(jQuery(".quick-view-unit").length){unitID=jQuery(".quickID").html()}else{unitID=$scope.book.unit_id}var booking={checkin:frm.format("mm/dd/yyyy"),checkout:to.format("mm/dd/yyyy"),unit_id:unitID,occupants:1,occupants_small:0,pets:0};jQuery("#modal_end_date").datepicker("option","minDate",frm);$scope.modal_checkin=frm.format("mm/dd/yyyy");$scope.modal_checkout=to.format("mm/dd/yyyy");$scope.updatePricePopupCalendar()};$scope.setWeeks=function(){var frm=new Date($scope.modal_checkin);nts=parseInt($scope.modal_weeks)*7;var the_year=frm.getFullYear();if(the_year<2e3)the_year=2e3+the_year%100;var to=new Date(the_year,frm.getMonth(),frm.getDate()+nts);$scope.modal_checkout=to.format("mm/dd/yyyy");var unitID="";if(jQuery(".quick-view-unit").length){unitID=jQuery(".quickID").html()}else{unitID=$scope.book.unit_id}var booking={checkin:frm.format("mm/dd/yyyy"),checkout:to.format("mm/dd/yyyy"),unit_id:unitID,occupants:1,occupants_small:0,pets:0};jQuery("#modal_end_date").datepicker("option","minDate",frm);$scope.modal_checkin=frm.format("mm/dd/yyyy");$scope.modal_checkout=to.format("mm/dd/yyyy");$scope.updatePricePopupCalendar()};$scope.updatePricePopupCalendar=function(){run_waitMe("#myModal .modal-content","roundBounce","Updating Results..");Alert.clear();jQuery(".text-uplift").css("display","none");$scope.modal_total_reservation=0;var unitID="";if(jQuery(".quick-view-unit").length){unitID=jQuery(".quickID").html()}else{unitID=$scope.book.unit_id}rpapi.getWithParams("VerifyPropertyAvailability",{unit_id:unitID,startdate:$scope.modal_checkin,enddate:$scope.modal_checkout,occupants:$scope.modal_occupants,occupants_small:$scope.modal_occupants_small,pets:$scope.modal_pets}).success(function(obj){if(obj.status){$scope.reservation_days=[];$scope.total_reservation=0;$scope.first_day_price=0;$scope.rent=0;$scope.taxes=0;var errorMsg=obj.status.description;if(obj.status.code=="E0031"&&$rootScope.searchSettings.restrictionMsg!=""){errorMsg=$rootScope.searchSettings.restrictionMsg}if(obj.status.description=="Invalid Check-Out date format/value.\n"){Alert.add(Alert.errorType,"Please select number of nights.")}else{if($rootScope.searchSettings.restrictionMsg.indexOf("Sun to Sun")>=0){errorMsg="There is a restriction in place for your selected dates, dates have been updated";var newCheckin=new Date(booking.checkin);var newCheckout=new Date(booking.checkout);newCheckout.setDate(booking.checkout.getDate()+1);newCheckout.toLocaleDateString()}Alert.add(Alert.errorType,errorMsg)}hide_waitMe("#myModal .modal-content")}else{$scope.reservation_days=[];$scope.total_reservation=0;$scope.first_day_price=0;$scope.rent=0;$scope.taxes=0;var stayLength=$scope.getDaysDifference($scope.modal_checkin,$scope.modal_checkout);if($rootScope.bookingSettings.inquiryOnlyFrom&&$rootScope.bookingSettings.inquiryOnlyTo){var inquiryOnlyFrom=new Date($rootScope.bookingSettings.inquiryOnlyFrom);var inquiryOnlyTo=new Date($rootScope.bookingSettings.inquiryOnlyTo);if(!(to.getTime()<=inquiryOnlyFrom.getTime()||from.getTime()>=inquiryOnlyTo.getTime())){Alert.add(Alert.errorType,"These dates are Inquiry Only, please send us a inquiry using the form below");hide_waitMe("#myModal .modal-content");$scope.isDisabled=true;return false}}var maxLengthStay=$rootScope.bookingSettings.maxLengthStay;if(maxLengthStay>0&&stayLength>maxLengthStay){Alert.add(Alert.errorType,"the max stay is on.");hide_waitMe("#myModal .modal-content");$scope.isDisabled=true;return false}var params={unit_id:unitID,startdate:$scope.modal_checkin,enddate:$scope.modal_checkout,occupants:$scope.modal_occupants,occupants_small:$scope.modal_occupants_small,pets:$scope.modal_pets};var rate_type_name=$cookies.get("streamline-rate_type");if($rootScope.bookingSettings.enable_rates_pw==1&&typeof rate_type_name!="undefined"||$rootScope.rate_type!=""){params["rate_type_name"]=rate_type_name}rpapi.getWithParams("GetPreReservationPrice",params).success(function(obj){if(obj.data!=undefined){$scope.showDays=false;$scope.modal_total_reservation=obj.data.total;$scope.modal_rent=obj.data.price;$scope.modal_taxes=obj.data.taxes;$scope.modal_coupon_discount=obj.data.coupon_discount;$scope.modal_reservation_days=obj.data.reservation_days;$scope.modal_security_deposits=obj.data.security_deposits;$scope.modal_first_day_price=obj.data.first_day_price;$scope.modal_required_fees=obj.data.required_fees;$scope.modal_taxes_details=obj.data.taxes_details;if(obj.data.reservation_days.date!=undefined){$scope.modal_days=false}else{$scope.modal_days=true}if(typeof UpLift!=="undefined"){params["order_total"]=obj.data.total;var tripInfo=$scope.buildTripInfo(params);if(!$scope.initUplift){UpLift.Payments.init({apiKey:$rootScope.upliftApiKey,onModalClose:$scope.myOnModalCloseHandler,onModalOpen:$scope.myOnModalOpenHandler,locale:"en-US",currency:"USD"});setTimeout(function(){UpLift.Payments.load(tripInfo,$scope.myPaymentsLoadCallback)},200);$scope.initUplift=true}else{setTimeout(function(){UpLift.Payments.update(tripInfo,$scope.myPaymentsLoadCallback)},200)}}hide_waitMe("#myModal .modal-content")}})}})};$scope.maxTpResults="";$scope.initReservationBlock=function(page){run_waitMe("#calendar","roundBounce","Loading results...");var params=$scope.getParams();params.page_number=1;if(!page){page=50}params.page_results_number=page;rpapi.getWithParams("GetPropertyListWordPress",params).success(function(obj){var bookingColor=$rootScope.tapeChart_booking_color;var headerColor=$rootScope.tapeChart_header_color;var slashStartHeight=$rootScope.slash_start_height;var slashEndHeight=$rootScope.slash_end_height;var tempProperties=[];tempProperties=obj.data.property;$scope.maxTpResults=obj.data.available_properties.pagination.total_units;var units=[];var rangedates=$rootScope.max_months_number;for(var i=0;i<tempProperties.length;i++){var content='<span class="fc-cell-text unit"><div class="title">'+tempProperties[i].name+'</div><div class="description">';if(tempProperties[i].max_pets>0){content+='<span class="icon pets"><i class="fa fa-paw"></i></span>'}content+='<span class="icon occupants"> Sleeps '+tempProperties[i].max_occupants+"</span>";content+='<span class="icon" bedrooms> | Bedrooms '+tempProperties[i].bedrooms_number+"</span>";content+='<span class="icon sleeps"> | Baths '+tempProperties[i].bathrooms_number+"</span></span></div>";units.push({id:tempProperties[i].id,unitID:tempProperties[i].id,title:tempProperties[i].name,resort_area_name:tempProperties[i].resort_area_name,view_name:tempProperties[i].view_name,home_type:tempProperties[i].home_type,neighborhood_name:tempProperties[i].neighborhood_name,img:tempProperties[i].default_image_path,sleeps:tempProperties[i].max_occupants,bedrooms:tempProperties[i].bedrooms_number,baths:tempProperties[i].bathrooms_number,pets:tempProperties[i].max_pets,location_area_name:tempProperties[i].location_area_name,description:content,eventColor:bookingColor,occupancy:tempProperties[i].seo_page_name})}function convertDate(s){var b=s.split("-");return new Date(b[2],b[0]-1,b[1])}function cnvDate(s){var b=s.split("/");return b[2]+"-"+b[0]+"-"+b[1]}function focusDate(s){var b=s.split("-");return b[2]+"-"+b[0]+"-"+b[1]}function goToDate(s){var b=s.split("-");return b[1]+"/"+b[2]+"/"+b[0]}function fillCells(x){var b=x.split("px");return(parseInt(b[0])+43).toString()+"px"}function posNr(x){var b=x.split("px");return parseInt(b[0])}function fillCells(x){var b=x.split("px");return(parseInt(b[0])+40).toString()+"px"}function posNr(x){var b=x.split("px");return parseInt(b[0])}$scope.tapeChart=false;var ids=[];var unit_ids=[];angular.forEach(units,function(unit,key){unit_ids.push(unit.id)});var d=new Date;var todayBlock=d.getFullYear()+"-"+("0"+(d.getMonth()+1)).slice(-2)+"-"+("0"+d.getDate()).slice(-2);var strDate=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear();var newParams={return_full:"yes",departing_after:strDate,status_code:[1,2,3,4,6,5],unit_id:unit_ids};var workOrderParams={status_id:[1]};function addSlashLogic(){setTimeout(function(){var books=jQuery(".fc-timeline-event.fc-h-event");angular.forEach(books,function(event,key){if(event.classList.value.includes("fc-sl-start")){event.appendChild(document.createElement("span")).classList.add("fc-slash-start")}if(event.classList.value.includes("fc-bk-start")){event.appendChild(document.createElement("span")).classList.add("fc-book-start")}if(event.classList.value.includes("fc-sl-end")){event.appendChild(document.createElement("span")).classList.add("fc-slash-end")}if(event.classList.value.includes("fc-bk-end")){event.appendChild(document.createElement("span")).classList.add("fc-book-end")}});if(bookingColor!=="#ccc"){jQuery(".fc-slash-start").css("border-bottom-color",bookingColor);jQuery(".fc-slash-end").css("border-top-color",bookingColor);jQuery(".fc-book-start").css("background",bookingColor);jQuery(".fc-book-end").css("background",bookingColor);jQuery(".legend .square").css("background",bookingColor)}else{jQuery(".legend .square").css("background","#ccc")}jQuery(".fc-slash-start").css("border-bottom",slashStartHeight+" solid "+bookingColor);jQuery(".fc-slash-end").css("border-top",slashEndHeight+" solid "+bookingColor);if(navigator.appVersion.indexOf("Chrome/")!=-1||navigator.appVersion.indexOf("Safari/")!=-1){jQuery(".fc-slash-start").css("top","-1px")}},1)}var workOrderBlocks=[];rpapi.getWithParams("GetWorkOrders",workOrderParams).success(function(obj){if(obj.data.maintenances.length>0){var workOrder=obj.data.maintenances.maintenance;var idnr=0;for(var i=0;i<workOrder.length;i++){var swDate=new Date(workOrder[i].blocked_completion_date);var swID=workOrder[i].unit_id;if(!isNaN(swDate.getTime())&&typeof swID==="number"){idnr++;swDate.setDate(swDate.getDate()+1);var wDate=swDate.getFullYear()+"-"+("0"+(swDate.getMonth()+1)).slice(-2)+"-"+("0"+swDate.getDate()).slice(-2);if($scope.isString(workOrder[i].blocked_start_date)&&$scope.isString(wDate)){workOrderBlocks.push({id:idnr.toString(),resourceId:workOrder[i].unit_id.toString(),start:cnvDate(workOrder[i].blocked_start_date),end:wDate,title:""})}}}}});rpapi.getWithParams("GetReservations",newParams).success(function(obj){var eventsBlock=obj.data.reservations;var blockReservation=[];if(workOrderBlocks.length>0){blockReservation=workOrderBlocks}var blockEventID=workOrderBlocks.length;for(var i=0;i<eventsBlock.length;i++){var srDate=new Date(eventsBlock[i].startdate);var enDate=new Date(eventsBlock[i].enddate);if(eventsBlock[i].auto_check_in==undefined){var auto_check_in=false}else{var ckin_hour=eventsBlock[i].auto_check_in.split(":")[0]>=15}if(eventsBlock[i].auto_check_out==undefined){var ckout_hour=false}else{var ckout_hour=eventsBlock[i].auto_check_out.split(":")[0]>11}var ckeckinHour="";var ckeckoutHour="";if($rootScope.fc_slash_logic==1){if(srDate.setHours(0,0,0,0)>=d.setHours(0,0,0,0)){if(!ckin_hour){ckeckinHour="fc-bk-start"}else{ckeckinHour="fc-sl-start"}}if(ckout_hour){ckeckoutHour="fc-bk-end"}else{ckeckoutHour="fc-sl-end"}}else{if(srDate.setHours(0,0,0,0)>d.setHours(0,0,0,0)){ckeckinHour="fc-bk-start"}ckeckoutHour="fc-bk-end"}srDate.setDate(srDate.getDate()+1);var rDate=srDate.getFullYear()+"-"+("0"+(srDate.getMonth()+1)).slice(-2)+"-"+("0"+srDate.getDate()).slice(-2);var nDate=cnvDate(eventsBlock[i].enddate);blockEventID=blockEventID+1;blockReservation.push({id:blockEventID.toString(),resourceId:eventsBlock[i].unit_id.toString(),start:rDate,end:nDate,classNames:["asdasd",ckeckoutHour,ckeckinHour]})}addSlashLogic();var left="";var right="";var firstUnit="";var unitID="";var fc_start_date="";var fc_end_date="";var fc_unit="";var fc_title="";var fc_default_image_path="";var checkdates="";var date=new Date;var calendarEl=document.getElementById("calendar");var calendar=new FullCalendar.Calendar(calendarEl,{schedulerLicenseKey:"0286663994-fcs-1562151016",plugins:["interaction","resourceTimeline"],now:date,slotLabelFormat:[{month:"long",week:"long"},{weekday:"short",day:"numeric",omitCommas:true}],editable:false,aspectRatio:2,contentHeight:"auto",defaultView:"resourceTimelineTenDay",header:false,resizable:false,views:{resourceTimelineTenDay:{type:"resourceTimeline",duration:{months:rangedates}}},resourceColumns:[{field:"title"}],selectable:true,selectAllow:function(select){return moment().diff(select.start,"days")<=0},validRange:function(nowDate){if($rootScope.rbCurrentDay==1){return{start:nowDate}}},dateClick:function(info){var position=info.jsEvent.explicitOriginalTarget;if(info.jsEvent.explicitOriginalTarget){position=info.jsEvent.explicitOriginalTarget}else{position=info.jsEvent.target}if(position.attributes!==undefined){var selectedDates=[];if(!jQuery(".fc-oneClick").length&&!jQuery(".fc-twoClicks").length){unitID=info.resource.extendedProps.unitID;var selectDates=jQuery(position).parent().parent();var positionDate=position.attributes.style.value;firstUnit=info.resource.extendedProps.occupancy;selectDates.append("<div class='fc-selectDates-container firstDate'><div class='fc-select-dates' style='"+positionDate+"'></div></div>");fc_start_date=goToDate(info.dateStr);jQuery(".fc-select-dates").addClass("fc-oneClick");left=position.attributes.style.ownerElement.style.left}else if(!jQuery(".fc-twoClicks").length&&jQuery(".fc-oneClick").length){var secondUnit=info.resource.extendedProps.occupancy;fc_unit=info.resource.extendedProps.occupancy;fc_title=info.resource.title;fc_default_image_path=info.resource.extendedProps.img;var selectDates=jQuery(position).parent().parent();var positionDate=position.attributes.style.value;right=position.attributes.style.ownerElement.style.left;if(secondUnit==firstUnit){if(posNr(left)!==posNr(right)){fc_end_date=goToDate(info.dateStr);var st="";var en="";if(new Date(fc_start_date)<=new Date(fc_end_date)){st=fc_start_date;en=fc_end_date}else{st=fc_end_date;en=fc_start_date}for(dt=new Date(st);dt<=new Date(en);dt.setDate(dt.getDate()+1)){var date=new Date(dt);var intvaldate=date.getFullYear()+"-"+("0"+(date.getMonth()+1)).slice(-2)+"-"+("0"+date.getDate()).slice(-2);selectedDates.push(intvaldate)}var isBooked=false;angular.forEach(blockReservation,function(res,key){if(res.resourceId==unitID){var end=new Date(res.end);end.setDate(end.getDate()-1);var endDate=end.getFullYear()+"-"+("0"+(end.getMonth()+1)).slice(-2)+"-"+("0"+end.getDate()).slice(-2);if(selectedDates.indexOf(res.start)!==-1||selectedDates.indexOf(endDate)!==-1){return isBooked=true}}});if(!isBooked){selectDates.append("<div class='fc-selectDates-container secondDate'><div class='fc-select-dates' style='"+positionDate+"'></div></div>");jQuery(".fc-select-dates").addClass("fc-twoClicks");var pos1=posNr(left);var pos2=posNr(right);if(pos1>pos2){selectDates.append("<div class='fc-selectDates'><div class='fc-select-dates fc-rv fc-date-book' style='left:"+fillCells(right)+";right:-"+left+"'><div type='button' class='fc-booking' data-toggle='modal' data-target='#fullCalendarView'>View Property</div></div></div>")}else{selectDates.append("<div class='fc-selectDates'><div class='fc-select-dates' style='left:"+fillCells(left)+";right:-"+right+"'><div type='button' class='fc-booking' data-toggle='modal' data-target='#fullCalendarView'>View Property</div></div></div>")}}}else{jQuery(".fc-selectDates-container").remove();jQuery(".fc-selectDates").remove()}}else{jQuery(".fc-selectDates-container").remove();jQuery(".fc-selectDates").remove()}}if(jQuery(".fc-twoClicks").length&&jQuery(".fc-oneClick").length){var check_unit=info.resource.extendedProps.occupancy;if(check_unit!==fc_unit){jQuery(".fc-selectDates-container").remove();jQuery(".fc-selectDates").remove()}else{var changeDates=position.attributes.style.ownerElement.style.left;var rightPos=left;var leftPos=right;if(posNr(changeDates)!==posNr(rightPos)&&posNr(changeDates)!==posNr(leftPos)){if(posNr(changeDates)>posNr(rightPos)&&posNr(changeDates)>posNr(leftPos)){var fc_ini_end_date=fc_end_date;fc_end_date=goToDate(info.dateStr);var exBooked1=false;angular.forEach(blockReservation,function(res,key){if(res.resourceId==unitID){var end=new Date(res.end);end.setDate(end.getDate()-1);var endDate=end.getFullYear()+"-"+("0"+(end.getMonth()+1)).slice(-2)+"-"+("0"+end.getDate()).slice(-2);if(new Date(res.start)>new Date(fc_start_date)&&new Date(endDate)<new Date(fc_end_date)){return exBooked1=true}}});if(!exBooked1){var newDate=changeDates;if(jQuery(".fc-rv").length){jQuery(".fc-selectDates .fc-select-dates").css("right","-"+newDate);jQuery(".firstDate .fc-select-dates").css("left",newDate);jQuery(".firstDate .fc-select-dates").css("right","-"+fillCells(newDate))}else{jQuery(".fc-selectDates .fc-select-dates").css("right","-"+newDate);jQuery(".secondDate .fc-select-dates").css("left",newDate);jQuery(".secondDate .fc-select-dates").css("right","-"+fillCells(newDate))}}else{fc_end_date=fc_ini_end_date}}if(posNr(changeDates)<posNr(rightPos)&&posNr(changeDates)<posNr(leftPos)){var fc_ini_start_date=fc_start_date;fc_start_date=goToDate(info.dateStr);var exBooked2=false;angular.forEach(blockReservation,function(res,key){var end=new Date(res.end);end.setDate(end.getDate()-1);var endDate=end.getFullYear()+"-"+("0"+(end.getMonth()+1)).slice(-2)+"-"+("0"+end.getDate()).slice(-2);if(res.resourceId==unitID){if(new Date(res.start)>new Date(fc_start_date)&&new Date(endDate)<new Date(fc_end_date)){return exBooked2=true}}});if(!exBooked2){var newDate=changeDates;if(jQuery(".fc-rv").length){jQuery(".fc-selectDates .fc-select-dates").css("left",fillCells(newDate));jQuery(".secondDate .fc-select-dates").css("left",newDate);jQuery(".secondDate .fc-select-dates").css("right","-"+fillCells(newDate))}else{jQuery(".fc-selectDates .fc-select-dates").css("left",fillCells(newDate));jQuery(".firstDate .fc-select-dates").css("left",newDate);jQuery(".firstDate .fc-select-dates").css("right","-"+fillCells(newDate))}}else{fc_start_date=fc_ini_start_date}}}else{}}}}jQuery(".fc-booking").one("click",function(e){e.preventDefault();if(new Date(fc_start_date)>new Date(fc_end_date)){var newStart=fc_start_date;var newEnd=fc_end_date;fc_end_date=newStart;fc_start_date=newEnd}if(checkdates!==unitID+fc_start_date+fc_end_date){run_waitMe("#fullCalendarView .modal-content","bounce");var fc_params={unit_id:unitID,startdate:fc_start_date,enddate:fc_end_date,occupants:1,use_description:"yes",include_coupon_information:1};rpapi.getWithParams("GetPreReservationPrice",fc_params).success(function(obj){hide_waitMe("#fullCalendarView .modal-content","bounce");checkdates=unitID+fc_start_date+fc_end_date;if(obj.data!=undefined){var total_fees=0;var total_taxes=0;if(obj.data.required_fees.id){total_fees=obj.data.required_fees.value}else{angular.forEach(obj.data.required_fees,function(fee,i){total_fees+=fee.value})}if(obj.data.taxes_details.id){total_taxes=obj.data.taxes_details.value}else{angular.forEach(obj.data.taxes_details,function(fee,i){total_taxes+=fee.value})}$scope.fc_total_reservation=obj.data.total;$scope.fc_total_fees=total_fees;$scope.fc_total_taxes=total_taxes;$scope.fc_rent=obj.data.price;$scope.fc_subTotal=$scope.calculateMarkup((obj.data.price+obj.data.coupon_discount).toString());var dif=$scope.fc_subTotal-obj.data.coupon_discount-obj.data.price;$scope.fc_taxes=obj.data.taxes-dif;$scope.fc_title=fc_title;$scope.fc_default_image_path=fc_default_image_path;$scope.fc_start_date=fc_start_date;$scope.fc_end_date=fc_end_date;$scope.fc_viewUnit="/"+fc_unit+"/?sd="+fc_start_date+"&ed="+fc_end_date}})}})},navLinks:true,resourceAreaWidth:"25%",resourceLabelText:"Unit Name",resourceRender:function(renderInfo){renderInfo.el.innerHTML=renderInfo.resource.extendedProps.description;renderInfo.el.innerHTML+='<a href="#" style="margin:0 10px;padding:3px;"  title="Click for more info about '+renderInfo.resource.title+'" class="fcviewProp" data-toggle="modal" data-target="#fcView"><i class="fa fa-question-circle" aria-hidden="true"></i></a>';renderInfo.el.querySelector(".fc-cell-text").addEventListener("click",function(){$window.location.href="/"+renderInfo.resource.extendedProps.occupancy});renderInfo.el.querySelector(".fcviewProp").addEventListener("click",function(){var petfrindly="No";if(renderInfo.resource.extendedProps.pets>0){petfrindly="Yes"}jQuery("#fcView .fc_bathrooms").html(renderInfo.resource.extendedProps.baths);jQuery("#fcView .fc_sleeps").html(renderInfo.resource.extendedProps.sleeps);jQuery("#fcView .fc_bedrooms").html(renderInfo.resource.extendedProps.bedrooms);jQuery("#fcView .fc_location").html(renderInfo.resource.extendedProps.location_area_name);jQuery("#fcView .fc_title").text(renderInfo.resource.title);jQuery("#fcView .fc_pet_friendly").html(petfrindly);jQuery("#fcView .map-image img").attr("src",renderInfo.resource.extendedProps.img);jQuery("#fcView .fcbk").attr("href","/"+renderInfo.resource.extendedProps.occupancy)})},resourceOrder:"id",resources:units,events:blockReservation});calendar.render();function changeHeaderBg(){if(headerColor!==""){jQuery("body .fc-view-container table thead.fc-head").css("background-color",headerColor);jQuery(".fc-timeline .fc-head .fc-time-area .fc-cell-content").css("background-color",headerColor);jQuery("body .fc-btns.fc-button.fc-button-primary").css("background-color",headerColor)}}$scope.tapeChartFilters={};var bedroomsArr=[];var sleepsArr=[];var bathsArr=[];var petsArr=[];var areaArr=[];var homeArr=[];var viewArr=[];var neighborhoodArr=[];var resortArr=[];$scope.enableSearch=false;if($rootScope.enable_search==1){$scope.enableSearch=true}function addStringFields(enable,elm,val,type){if(enable==1){$scope.tapeChartFilters[elm]=[{id:0,value:val,type:type}]}}function filtersOptions(maxNr,element){if(maxNr>0){for(var i=1;i<=maxNr;i++){element.push({id:i,value:i})}}}function addStringFilterOptions(enable,option,array){if(enable==1){for(var i=0;i<array.length;i++){option.push({id:i+1,value:array[i]})}}}function addNrFilters(enable,elArr,filEl,addFilter,value){if(enable==1){elArr.push(filEl);$scope.tapeChartFilters[addFilter]=[{id:0,value:value,type:addFilter}]}}function numberFilters(filEl,selEl,elID){if(filEl!==selEl&&!isNaN(selEl)){var deleteRes=calendar.getResourceById(elID);if(deleteRes!==null){deleteRes.remove()}}}function stringFilters(filEl,selEl,elID,type){if(filEl!==selEl&&selEl!==type&&selEl!==undefined){var deleteRes=calendar.getResourceById(elID);if(deleteRes!==null){deleteRes.remove()}}}function addStringFilters(typeArr,selEl){if(typeArr.indexOf(selEl)==-1&&typeof selEl==="string"){typeArr.push(selEl)}}addStringFields($rootScope.tape_chart_filter_area,"location_area_name","Area","location_area_name");addStringFields($rootScope.tape_chart_filter_resort,"resort_area_name","Resort","resort_area_name");addStringFields($rootScope.tape_chart_filter_view,"view_name","View","view_name");addStringFields($rootScope.tape_chart_filter_neighborhood,"neighborhood_name","Neighborhood","neighborhood_name");addStringFields($rootScope.tape_chart_filter_home_type,"home_type","Home Type","home_type");angular.forEach(units,function(unit,key){addNrFilters($rootScope.tape_chart_filter_beds,bedroomsArr,unit.bedrooms,"bedrooms","Bedrooms");addNrFilters($rootScope.tape_chart_filter_sleeps,sleepsArr,unit.sleeps,"sleeps","Guests");addNrFilters($rootScope.tape_chart_filter_baths,bathsArr,unit.baths,"baths","Baths");addNrFilters($rootScope.tape_chart_filter_pets,petsArr,unit.pets,"pets","Pets");addStringFilters(homeArr,unit.home_type);addStringFilters(resortArr,unit.resort_area_name);addStringFilters(viewArr,unit.view_name);addStringFilters(neighborhoodArr,unit.neighborhood_name);addStringFilters(areaArr,unit.location_area_name)});var maxBedrooms=Math.max.apply(Math,bedroomsArr);var maxBaths=Math.max.apply(Math,bathsArr);var maxSleeps=Math.max.apply(Math,sleepsArr);var maxPets=Math.max.apply(Math,petsArr);addStringFilterOptions($rootScope.tape_chart_filter_area,$scope.tapeChartFilters.location_area_name,areaArr);addStringFilterOptions($rootScope.tape_chart_filter_home_type,$scope.tapeChartFilters.home_type,homeArr);addStringFilterOptions($rootScope.tape_chart_filter_resort,$scope.tapeChartFilters.resort_area_name,resortArr);addStringFilterOptions($rootScope.tape_chart_filter_neighborhood,$scope.tapeChartFilters.neighborhood_name,neighborhoodArr);addStringFilterOptions($rootScope.tape_chart_filter_view,$scope.tapeChartFilters.view_name,viewArr);filtersOptions(maxBedrooms,$scope.tapeChartFilters.bedrooms);filtersOptions(maxBaths,$scope.tapeChartFilters.baths);filtersOptions(maxSleeps,$scope.tapeChartFilters.sleeps);filtersOptions(maxPets,$scope.tapeChartFilters.pets);jQuery(document).on("click",".fc-search #fc-filters-search li",function(){var getText=jQuery(this).text();var getValue=jQuery(this).attr("data-value");jQuery(this).parent().siblings(".dropdown-select").text(getText);jQuery(this).parent().siblings(".dropdown-select").attr("data-value",getValue)});jQuery(document).on("click",".calendar_search",function(){run_waitMe("#calendar","bounce");run_waitMe(".TPnoInventory","bounce");calendar.refetchResources();setTimeout(function(){var search_unit=jQuery(".search-unit #search-name").val();var bedroomFilter=parseInt(jQuery(".filter_tp.bedrooms").attr("data-value"));var bathsFilter=parseInt(jQuery(".filter_tp.baths").attr("data-value"));var sleepsFilter=parseInt(jQuery(".filter_tp.sleeps").attr("data-value"));var petsFilter=parseInt(jQuery(".filter_tp.pets").attr("data-value"));var areafilter=jQuery(".filter_tp.location_area_name").attr("data-value");var homefilter=jQuery(".filter_tp.home_type").attr("data-value");var neighborhoodfilter=jQuery(".filter_tp.neighborhood_name").attr("data-value");var viewfilter=jQuery(".filter_tp.view_name").attr("data-value");var resortfilter=jQuery(".filter_tp.resort_area_name").attr("data-value");angular.forEach(units,function(unit,key){if($rootScope.enable_search==1&&search_unit!==""&&unit.title.toLowerCase().indexOf(search_unit.toLowerCase())==-1){var deleteRes=calendar.getResourceById(unit.id);deleteRes.remove()}numberFilters(unit.bedrooms,bedroomFilter,unit.id);numberFilters(unit.baths,bathsFilter,unit.id);numberFilters(unit.sleeps,sleepsFilter,unit.id);numberFilters(unit.pets,petsFilter,unit.id);stringFilters(unit.location_area_name,areafilter,unit.id,"Area");stringFilters(unit.home_type,homefilter,unit.id,"Home Type");stringFilters(unit.neighborhood_name,neighborhoodfilter,unit.id,"Neighborhood");stringFilters(unit.view_name,viewfilter,unit.id,"View");stringFilters(unit.resort_area_name,resortfilter,unit.id,"Resort")});if(jQuery("#calendar .fc-resource-area.fc-widget-content .fc-scroller-canvas").height()<500){calendar.setOption("contentHeight","auto")}else{calendar.setOption("contentHeight",500)}var resources=calendar.getResources();if(!resources.length){jQuery("#calendar").css({visibility:"hidden"});jQuery("#calendar").css({height:0});jQuery(".TPnoInventory").show()}else{jQuery("#calendar").css({visibility:"visible"});jQuery("#calendar").css({height:"auto"});jQuery(".TPnoInventory").hide()}addSlashLogic()},1);setTimeout(function(){hide_waitMe("#calendar","bounce");hide_waitMe(".TPnoInventory","bounce")},1)});jQuery(document).on("click",".calendar_reset",function(){run_waitMe("#calendar","bounce");calendar.refetchResources();jQuery(".filter_tp.bedrooms").attr("data-value","Bedrooms");jQuery(".filter_tp.bedrooms").text("Bedrooms");jQuery(".filter_tp.baths").attr("data-value","Baths");jQuery(".filter_tp.baths").text("Baths");jQuery(".filter_tp.sleeps").attr("data-value","Guests");jQuery(".filter_tp.sleeps").text("Guests");jQuery(".filter_tp.pets").attr("data-value","Pets");jQuery(".filter_tp.pets").text("Pets");jQuery(".filter_tp.location_area_name").attr("data-value","Area");jQuery(".filter_tp.location_area_name").text("Area");jQuery(".filter_tp.home_type").attr("data-value","Home Type");jQuery(".filter_tp.home_type").text("Home Type");jQuery(".filter_tp.neighborhood_name").attr("data-value","Neighborhood");jQuery(".filter_tp.neighborhood_name").text("Neighborhood");jQuery(".filter_tp.view_name").attr("data-value","View");jQuery(".filter_tp.view_name").text("View");jQuery(".filter_tp.resort_area_name").attr("data-value","Resort");jQuery(".filter_tp.resort_area_name").text("Resort");if(jQuery("#calendar .fc-resource-area.fc-widget-content .fc-scroller-canvas").height()<500){calendar.setOption("contentHeight","auto")}else{calendar.setOption("contentHeight",500)}var resources=calendar.getResources();if(!resources.length){jQuery("#calendar").css({visibility:"hidden"});jQuery("#calendar").css({height:0});jQuery(".TPnoInventory").show()}else{jQuery("#calendar").css({visibility:"visible"});jQuery("#calendar").css({height:"auto"});jQuery(".TPnoInventory").hide()}addSlashLogic();setTimeout(function(){hide_waitMe("#calendar","bounce");hide_waitMe(".TPnoInventory","bounce")},1)});if($rootScope.show_fc_sortBy==1){jQuery(".fc-dropdown").show();jQuery(".fc-dropdown .dropdown-menu li").on("click",function(){addSlashLogic();var getText=jQuery(this).text();var getValue=jQuery(this).attr("data-value");jQuery(".fc-dropdown #sortbyTP").text(getText);jQuery(".fc-dropdown #sortbyTP").attr("data-value",getValue);var sortedBy=jQuery("#sortbyTP").attr("data-value");calendar.setOption("resourceOrder",sortedBy);jQuery(".fc-scroller").scrollTop(0);changeHeaderBg()})}if($rootScope.sort_alphabetical==1){calendar.setOption("resourceOrder","title")}if(jQuery("#calendar").height()>500){calendar.setOption("contentHeight",500)}changeHeaderBg();function scrollToDate(){jQuery("[data-date]").each(function(index,el){var toDate=jQuery(this).attr("data-date");jQuery(this).attr("id",toDate)});var newDate=jQuery("#fullCalendar").val();if(jQuery("#"+focusDate(newDate)).length>0){var scroller=jQuery("table .fc-time-area.fc-widget-content .fc-scroller");var scrollTo=jQuery("#"+focusDate(newDate)).position().left;scroller.animate({scrollLeft:scrollTo})}}jQuery("#fullCalendar").datepicker({dateFormat:"mm-dd-yy",setDate:date,onSelect:function(date){scrollToDate()}});jQuery("#fullCalendar").datepicker("setDate",date);$scope.tapeChart=true;hide_waitMe("#calendar","roundBounce","Loading results...")})})};$scope.fcResults="50";$scope.tapeChartPagination=function(fcResults){jQuery(".fc-view-container").remove();if(fcResults=="all"){fcResults=$scope.maxTpResults}$scope.initReservationBlock(fcResults)};$scope.setCheckoutDate=function(date){if($scope.book.checkout){$scope.book.checkout=date.format("mm/dd/yyyy")}};if(jQuery("#pm-inquiry-container").length){var pm_stardate=new Date;var dd=pm_stardate.getDate();var dd2=pm_stardate.getDate()+1;var mm=pm_stardate.getMonth()+1;var yyyy=pm_stardate.getFullYear();pm_stardate=mm+"/"+dd+"/"+yyyy;var pm_endddate=mm+"/"+dd2+"/"+yyyy;$scope.pm_stardate=pm_stardate;$scope.pm_endddate=pm_endddate}$scope.resetInquiry=function(){$scope.inquiry.unit_id=0;$scope.inquiry.startDate="";$scope.inquiry.endDate="";$scope.inquiry.rangeDate="";$scope.inquiry.email="";$scope.inquiry.occupants="";$scope.inquiry.occupantsSmall="";$scope.inquiry.first_name="";$scope.inquiry.last_name="";$scope.inquiry.pets="";$scope.inquiry.phone="";$scope.inquiry.message="";$scope.inquiry.property_address="";$scope.resortpro_inquiry.$setPristine();$scope.resortpro_inquiry.$setUntouched();$scope.alerts=[]};$scope.resetFavorites=function(favorites){$scope.favorites.unit_id=0;$scope.favorites.startDate="";$scope.favorites.endDate="";$scope.favorites.email="";$scope.favorites.occupants="";$scope.favorites.occupantsSmall="";$scope.favorites.first_name="";$scope.favorites.last_name="";$scope.favorites.phone="";$scope.favorites.message="";$scope.resortpro_save_fav.$setPristine();$scope.resortpro_save_fav.$setUntouched()};$scope.resetNoInventory=function(){$scope.search.no_inventory_name="";$scope.search.no_inventory_email="";$scope.search.no_inventory_phone="";$scope.search.no_inventory_subject="";$scope.search.no_inventory_message="";$scope.search.frm_noInventory.$setPristine();$scope.search.frm_noInventory.$setUntouched()};$scope.setUnitForInquiry=function(book){if(typeof unit_id!=="undefined"&&unit_id!==0){if(typeof $scope.inquiry=="undefined"){$scope.inquiry={}}$scope.inquiry.unit_id=unit_id;$scope.inquiry.startDate=$scope.book.checkin;$scope.inquiry.endDate=$scope.book.checkout;$scope.inquiry.occupants=parseInt($scope.book.occupants);$scope.inquiry.occupantsSmall=parseInt($scope.book.occupants_small);$scope.inquiry.pets=$scope.book.pets}};$scope.validateFavorites=function(favorites){var error=false;if($scope.resortpro_save_fav.favorites_email.$error.required&&$scope.resortpro_save_fav.favorites_phone.$error.required){error=true}if($scope.resortpro_save_fav.favorites_first_name.$error.required||$scope.resortpro_save_fav.favorites_last_name.$error.required||$scope.resortpro_save_fav.favorites_startdate.$error.required||$scope.resortpro_save_fav.favorites_enddate.$error.required){error=true}if($scope.resortpro_inquiry.side_inquiry_range_date.$error.required){error=true}if(!error){$scope.saveFavorites(favorites)}};$scope.validateInquiry=function(inquiry,popup){var error=false;var checkEmailPhone=$rootScope.bookingSettings.inquiryReqEmailPhone;if(checkEmailPhone===1){if($scope.resortpro_inquiry.inquiry_email.$error.required||$scope.resortpro_inquiry.inquiry_phone.$error.required){error=true}}else{if($scope.resortpro_inquiry.inquiry_email.$error.required&&$scope.resortpro_inquiry.inquiry_phone.$error.required){error=true}}if($scope.resortpro_inquiry.inquiry_first_name.$error.required||$scope.resortpro_inquiry.inquiry_last_name.$error.required||$scope.resortpro_inquiry.inquiry_startdate.$error.required||$scope.resortpro_inquiry.inquiry_enddate.$error.required||($scope.resortpro_inquiry.inquiry_occupants.$error.required||$scope.resortpro_inquiry.inquiry_occupants.$error.dirty)){error=true}if(!error){$scope.propertyInquiry(inquiry,popup)}};$scope.validateInquiryReCaptcha=function(inquiry){if($rootScope.checkoutSettings.enable_grecaptcha){run_waitMe("#myModal2","bounce","Processing your request");var response=grecaptcha.getResponse();if($scope.isString(response)){params={response:response};rpapi.gReCaptcha(params).success(function(response){if(response.success==true){$scope.validateInquiry(inquiry,true)}else{alert("please fill out reCAPTCHA")}})}hide_waitMe("#myModal2")}};$scope.loadFavorites=function(){$scope.loading=true;var fav_ids=$cookies.getObject("streamline-favorites");if(fav_ids){var params={include_units:fav_ids.join(),return_gallery:1};if($rootScope.searchSettings.max_images_number>0){params.max_images_number=$rootScope.searchSettings.max_images_number}rpapi.getWithParams("GetPropertyListWordPress",params).success(function(obj){$scope.loading=false;if(obj.data.property.id){$scope.favoritesObj=[];$scope.favoritesObj.push(obj.data.property)}else{$scope.favoritesObj=Object.keys(obj.data.property).map(function(key){return obj.data.property[key]})}})}else{$scope.favoritesObj=[]}};$scope.checkFavorites=function(property){var favorites=$cookies.getObject("streamline-favorites");var found=false;if(favorites){angular.forEach(favorites,function(value,key){if(property.id==value){found=true}})}return found};$scope.checkUnitDetailsFavorites=function(property){var favorites=$cookies.getObject("streamline-favorites");var found=false;if(favorites){angular.forEach(favorites,function(value,key){if(property==value){found=true}})}return found};$scope.removeFromFavorites=function(property){if(confirm("Are you sure you want to remove unit "+property.name)){var favorites=$cookies.getObject("streamline-favorites");if(favorites){angular.forEach(favorites,function(value,key){if(property.id==value){favorites.splice(key,1)}});angular.forEach($scope.favoritesObj,function(prop,key){if(property.id==prop.id){$scope.favoritesObj.splice(key,1)}});if(favorites.length==0){$cookies.remove("streamline-favorites",{path:"/"});$scope.wishlist=[]}else{$scope.wishlist=favorites;$cookies.putObject("streamline-favorites",favorites,{path:"/",secure:"true"})}}}};$scope.removeFromFavoritesDetails=function(property){if(jQuery(".sliderInfoLine").val()!=undefined){var unit_name=jQuery(".sliderInfoLine").val()}else{var unit_name=jQuery("h1").text()}if(confirm("Are you sure you want to remove unit "+unit_name+" from favorites")){var favorites=$cookies.getObject("streamline-favorites");if(favorites){angular.forEach(favorites,function(value,key){if(property==value){favorites.splice(key,1)}});angular.forEach($scope.favoritesObj,function(prop,key){if(property==prop.id){$scope.favoritesObj.splice(key,1)}});if(favorites.length==0){$cookies.remove("streamline-favorites",{path:"/"});$scope.wishlist=[]}else{$scope.wishlist=favorites;$cookies.putObject("streamline-favorites",favorites,{path:"/",secure:"true"})}}}};$scope.addToFavorites=function(property){var favorites=$cookies.getObject("streamline-favorites");if(favorites){var foundUnit=false;angular.forEach(favorites,function(value,key){if(property.id==value){foundUnit=true}});favorites.push(property.id)}else{favorites=[];favorites.push(property.id)}var now=new Date;now.setDate(now.getDate()+30);$scope.wishlist=favorites;$cookies.putObject("streamline-favorites",favorites,{path:"/",expires:now})};$scope.addUnitDetailsToFavorites=function(property){var unit_details_favorites=$cookies.getObject("streamline-favorites");if(unit_details_favorites){var foundUnit=false;angular.forEach(unit_details_favorites,function(value,key){if(property==value){foundUnit=true}});unit_details_favorites.push(property)}else{unit_details_favorites=[];unit_details_favorites.push(property)}var now=new Date;now.setDate(now.getDate()+30);$scope.wishlist=unit_details_favorites;$cookies.putObject("streamline-favorites",unit_details_favorites,{path:"/",expires:now})};$scope.loadRecents=function(){$scope.loading=true;var recent_ids=$cookies.getObject("streamline-recents");if(recent_ids!==undefined){var params={include_units:recent_ids.join()};if($rootScope.searchSettings.max_images_number>0){params.return_gallery=1;params.max_images_number=$rootScope.searchSettings.max_images_number}rpapi.getWithParams("GetPropertyListWordPress",params).success(function(obj){$scope.loading=false;if(obj.data.property){if(obj.data.property.id){$scope.recentsObj=[];$scope.recentsObj.push(obj.data.property)}else{$scope.recentsObj=Object.keys(obj.data.property).map(function(key){return obj.data.property[key]})}}})}};$scope.addToRecents=function(property){var recents=$cookies.getObject("streamline-recents");if(recents){var foundUnit=false;angular.forEach(recents,function(value,key){if(property.id==value){foundUnit=true}});if(!foundUnit){recents.unshift(property.id)}if(recents.length>10){recents.pop()}}else{recents=[];recents.push(property.id)}var now=new Date;now.setDate(now.getDate()+30);$scope.recentProp=recents;$cookies.putObject("streamline-recents",recents,{path:"/",expires:now})};$scope.loadCartAbandonmentMotivator=function(){$scope.cartMotivatorLoading=true;var cartAbandonment=$cookies.getObject("streamline-confirmation-cookie");if(cartAbandonment!==undefined){$scope.cartMotivatorLoading=false;$scope.cartAbandomentMotivator=cartAbandonment}};$scope.nearbyUnits=function(){$scope.loading=true;if($scope.nearbyIDs){var params={unit_name:$scope.nearbyIDs,use_description:"no",use_amenities:"no"};run_waitMe(".similar-units");rpapi.getWithParams("GetPropertyListWordPress",params).success(function(obj){$scope.nearbyObj=obj.data.property;var params2={seo_page_name:$scope.unit_seo_page,enable_nearby_units:$rootScope.enable_nearby_units,range:$rootScope.nearby_range};if($scope.nearbyObj!=undefined){rpapi.getWithParams("GetPropertyInfoBySeoNameWordPress",params2).success(function(obj2){hide_waitMe(".similar-units");angular.forEach(obj2.data.units_nearby.units,function(single_unit,index){if(index<=$scope.nearbyObj.length-1){$scope.nearbyObj[index].distance_from_this_unit=single_unit.distance_from_this_unit}})})}else{hide_waitMe(".similar-units")}})}};function toRad(Value){return Value*Math.PI/180}function sortByKeyAsc(array,sortKey,item){var items=[];var sorted=array.sort(function(a,b){var x=parseFloat(a[sortKey]);var y=parseFloat(b[sortKey]);return x<y?-1:x>y?1:0});jQuery.each(sorted,function(key,val){items.push(val[item])});return items}function calcDist(lat1,lon1,lat2,lon2,unit){var R=6371;var dLat=toRad(lat2-lat1);var dLon=toRad(lon2-lon1);var lat1=toRad(lat1);var lat2=toRad(lat2);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;if(unit=="M"){return d*.6214}else{return d}}function sliceContainer(container,limit){jQuery(container).each(function(){var categ=jQuery(this).find(".categ-sections-list");categ.hide();categ.slice(0,limit).show();if(categ.length<=limit){jQuery(this).find(".vb-categ-loadMore").hide()}})}jQuery(".getMenuItem").on("click",function(){var generateToID=jQuery(this).attr("data-category");var menu_item_id=jQuery(this).attr("data-section");var singleCateg=jQuery(this).attr("data-single");var loadItem=jQuery(this).attr("data-load");var propertyIdLat=jQuery(".propSertion").attr("data-lat");var propertyIdLon=jQuery(".propSertion").attr("data-lon");var distance_limit=parseInt(jQuery(this).closest(".propSertion").attr("data-limit"));var number_limit=parseInt(jQuery(this).closest(".propSertion").attr("data-show"));if(loadItem=="true"){if(singleCateg=="true"){var categName=generateToID+"-mb";run_waitMe("#"+generateToID+"-mb .panel-body","ios")}else{var categName=generateToID+"-sc-mb";run_waitMe("#"+generateToID+"-sc-mb .panel-body","ios")}var loadmore='<div class="col-xs-12">'+"<button name="+categName+' class="btn mobileBtn vb-categ-loadMore">Load More </button>'+"</div>";var data={action:"streamlinecore-getGuestAppMenuItemRecords",menu_item_id:menu_item_id};$http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data}).then(function successCallback(response){var menuItem=response.data.data.data;var menuItems=[];if(response.data.data.data.length==undefined){menuItem=[].concat(response.data.data.data)}for(i=0;i<menuItem.length;i++){var dist=calcDist(menuItem[i].latitude,menuItem[i].longitude,propertyIdLat,propertyIdLon,"M").toFixed(2);if(dist!=="NaN"&&parseFloat(dist)<parseFloat(distance_limit)){var name=menuItem[i].name;var address=menuItem[i].address;var city=menuItem[i].city;var state_name=menuItem[i].state_name;var zip=menuItem[i].zip;var landing_page=menuItem[i].landing_page;var weblink=address+", "+city+", "+state_name+", "+zip;var item='<div data-name="'+name+'" class="col-xs-12 categ-sections-list">'+'   <div class="vb-event-list">'+'<div class="row event-list">'+'   <div class="col-xs-4 no-padding">'+'       <div class="image-bk vb-ev ">'+'           <div class="book-image" style="background-image:url('+menuItem[i].image_url+')">'+"             </div>"+"           </div>"+"         </div>"+'         <div class="col-xs-8">'+'                <div class="event-desc">'+'                   <div class="unit-name" data-placement="top">'+name+"</div>"+'                  <div class="distance"> '+dist+" Miles From Property</div>"+'                   <div class="loc">'+address+city+state_name+zip+" </div>"+'                  <div class="foodType">'+menuItem[i].phone_number+"</div>"+'                    <div class="googleInfo">'+'                         <a class="goto-website" target="_blank" href="'+landing_page+'">Website</a>'+'                         <div> <a class="goto-website" href="https://www.google.com/maps/search/?api=1&query='+weblink+' target="_blank">View On Google Map </a></div>'+"                  </div>"+"              </div>"+"          </div>"+"      </div>"+"  </div>"+"</div>";menuItems.push({dist:dist,item:item})}}if(menuItems.length==0){if(singleCateg=="true"){jQuery("#"+generateToID+"-mb .section_units").html('<div class="vg-gen-info">No Results</div>');hide_waitMe("#"+generateToID+"-mb .panel-body","ios")}else{jQuery("#"+generateToID+"-sc-mb .panel-body").html('<div class="vg-gen-info">No Results</div>');hide_waitMe("#"+generateToID+"-sc-mb .panel-body","ios")}}else{menuItems=sortByKeyAsc(menuItems,"dist","item");if(singleCateg=="true"){jQuery("#"+generateToID+"-mb .section_units").html(menuItems);jQuery("#"+generateToID+"-mb .section_units").append(loadmore);sliceContainer(".section_units",number_limit);hide_waitMe("#"+generateToID+"-mb .panel-body","ios")}else{jQuery("#"+generateToID+"-sc-mb .panel-body").html(menuItems);jQuery("#"+generateToID+"-sc-mb .panel-body").append(loadmore);sliceContainer(".category",number_limit);hide_waitMe("#"+generateToID+"-sc-mb .panel-body","ios")}}});jQuery(this).attr("data-load","false")}});var y=6;jQuery(document).on("click",".vb-categ-loadMore",function(e){e.stopPropagation();e.preventDefault();var thisCateg=jQuery(this).attr("name");y=y+6;jQuery("#"+thisCateg+" .categ-sections-list").slice(0,y).show();if(jQuery("#"+thisCateg+" .categ-sections-list").find(":hidden").length==0){jQuery(this).hide()}});$scope.loadSimilar=function(){$scope.loading=true;var similar_ids=$cookies.getObject("streamline-similar");if(similar_ids){if(similar_ids.startdate&&similar_ids.enddate&&$rootScope.enable_similar_dates==1){var params2={skip_units:similar_ids.id,startdate:similar_ids.startdate,location_area_id:similar_ids.location_area_id,enddate:similar_ids.enddate};rpapi.getWithParams("GetPropertyAvailabilityWithRatesWordPress",params2).success(function(obj2){$scope.loading=false;if(obj2.data.available_properties.property.id){$scope.similarObject=[];$scope.similarObject.push(obj2.data.available_properties.property)}else{$scope.similarObject=Object.keys(obj2.data.available_properties.property).map(function(key){return obj2.data.available_properties.property[key]})}$scope.similarObj=[];if($rootScope.similar_price_range!=="0"){angular.forEach($scope.similarObject,function(prop,key){if(Math.abs(similar_ids.price-prop.total)<=parseInt($rootScope.similar_price_range)){$scope.similarObj.push(prop)}})}if($scope.similarObj.length<3){for(var i=0;i<$scope.similarObject.length;i++){if($scope.similarObject[i].max_occupants==similar_ids.max_occupants){$scope.similarObj.push($scope.similarObject[i])}}}if($scope.similarObj.length<3){for(var i=0;i<$scope.similarObject.length;i++){if($scope.similarObject[i].max_occupants>similar_ids.max_occupants&&$scope.similarObject[i].max_occupants<=similar_ids.max_occupants+2){$scope.similarObj.indexOf($scope.similarObject[i])===-1?$scope.similarObj.push($scope.similarObject[i]):console.log("This already exists")}}}if($scope.similarObj.length<3){for(var i=0;i<$scope.similarObject.length;i++){if($scope.similarObject[i].bedrooms_number==similar_ids.bedrooms_number){$scope.similarObj.indexOf($scope.similarObject[i])===-1?$scope.similarObj.push($scope.similarObject[i]):console.log("This already exists")}}}})}else{var params={skip_units:similar_ids.id,location_area_id:similar_ids.location_area_id};rpapi.getWithParams("GetPropertyListWordPress",params).success(function(obj){$scope.loading=false;if(obj.data.property.id){$scope.similarObject=[];$scope.similarObject.push(obj.data.property)}else{$scope.similarObject=Object.keys(obj.data.property).map(function(key){return obj.data.property[key]})}$scope.similarObj=[];for(var i=0;i<$scope.similarObject.length;i++){if($scope.similarObject[i].max_occupants==similar_ids.max_occupants){$scope.similarObj.push($scope.similarObject[i])}}if($scope.similarObj.length<3){for(var i=0;i<$scope.similarObject.length;i++){if($scope.similarObject[i].max_occupants>similar_ids.min_occupants&&$scope.similarObject[i].max_occupants<=similar_ids.min_occupants+2){$scope.similarObj.indexOf($scope.similarObject[i])===-1?$scope.similarObj.push($scope.similarObject[i]):console.log("This already exists")}}}if($scope.similarObj.length<3){for(var i=0;i<$scope.similarObject.length;i++){if($scope.similarObject[i].bedrooms_number==similar_ids.bedrooms_number){$scope.similarObj.indexOf($scope.similarObject[i])===-1?$scope.similarObj.push($scope.similarObject[i]):console.log("This already exists")}}}})}}};$scope.addToSimilar=function(property){var sim={id:property.id,location_area_id:property.location_area_id,bedrooms_number:property.bedrooms_number,max_occupants:property.max_occupants};if($scope.startDate&&$scope.endDate){sim["startdate"]=decodeURIComponent($scope.startDate);sim["enddate"]=decodeURIComponent($scope.endDate);sim["price"]=property.total}var now=new Date;now.setDate(now.getDate()+30);$cookies.putObject("streamline-similar",sim,{path:"/",expires:now})};$scope.propertyInquiry=function(inquiry,popup){run_waitMe("#myModal2 .modal-dialog, #inquiry_box","roundBounce","Please wait, sending inquiry...");setTimeout(function(){var keyword=jQuery("#navis_keyword").val();if(jQuery("#pm-inquiry-container").length){inquiry.startDate=pm_stardate;inquiry.endDate=pm_endddate;var params={use_unassigned_lead_unit:1,allow_invalid:1,startdate:inquiry.startDate,enddate:inquiry.endDate,occupants:1,first_name:inquiry.first_name,last_name:inquiry.last_name,mobile_phone:inquiry.phone,email:inquiry.email,address:inquiry.property_address,client_comments:inquiry.message};rpapi.getWithParams("MakeReservation",params).success(function(obj){hide_waitMe("#myModal2 .modal-dialog, #inquiry_box");if(obj.status){Alert.add(Alert.errorType,obj.status.description)}else{Swal.fire({allowOutsideClick:false,text:"Thank You",icon:"success",timer:3e3,confirmButtonText:"OK"});jQuery(".swal2-confirm").click(function(){jQuery("#resortpro_btn_inquiry").prop("disabled",true)});$scope.resetInquiry()}})}else{if($rootScope.integrationSettings.enableNavis){var params={firstName:inquiry.first_name,lastName:inquiry.last_name,cellPhone:inquiry.phone,emailAddress:inquiry.email,subject:"Property Inquiry",message:inquiry.message,checkinDate:inquiry.startDate,checkoutDate:inquiry.endDate,inqRangeDate:inquiry.rangeDate,adults:inquiry.occupants,children:inquiry.occupantsSmall,keyword:keyword,unit:inquiry.unit_name};rpapi.sendToNavis(params).success(function(response){hide_waitMe("#myModal2 .modal-dialog, #inquiry_box");if(response){if($rootScope.bookingSettings&&$rootScope.bookingSettings.inquiryThankUrl!=""){$window.location.href=$rootScope.bookingSettings.inquiryThankUrl}else{Alert.add(Alert.successType,$rootScope.bookingSettings.inquiryThankMsg);alert($rootScope.bookingSettings.inquiryThankMsg)}}$scope.resetInquiry()})}else{var params={unit_id:inquiry.unit_id,startdate:inquiry.startDate,enddate:inquiry.endDate,iqrangedate:inquiry.rangeDate,occupants:inquiry.occupants,occupants_small:inquiry.occupantsSmall,first_name:inquiry.first_name,last_name:inquiry.last_name,email:inquiry.email,mobile_phone:inquiry.phone,extra_notes:inquiry.message,pets:inquiry.pets,disable_minimal_days:"yes"};if($rootScope.bookingSettings.inquiry_blocked_request==1){params["city"]=inquiry.city;params["zip"]=inquiry.postal_code;params["address"]=inquiry.address;params["status_id"]=10}else{params["not_blocked_request"]="yes"}if($rootScope.bookingSettings.inqury_heard_about&&$rootScope.bookingSettings.inqury_heard_about>0){params["hear_about_id"]=$rootScope.bookingSettings.inqury_heard_about}rpapi.getWithParams("MakeReservation",params).success(function(obj){hide_waitMe("#myModal2 .modal-dialog, #inquiry_box");if(obj.status){Alert.add(Alert.errorType,obj.status.description)}else{if($rootScope.bookingSettings&&$rootScope.bookingSettings.inquiryThankUrl!=""){$window.location.href=$rootScope.bookingSettings.inquiryThankUrl}else{if($rootScope.bookingSettings.disableThanksPopup==0){var autoclose=null;if($rootScope.bookingSettings.autocloseMsg!==""){autoclose=parseInt($rootScope.bookingSettings.autocloseMsg)*1e3}var message=$rootScope.bookingSettings.inquiryThankMsg;Swal.fire({allowOutsideClick:false,text:message,icon:"success",timer:autoclose,confirmButtonText:"OK"});jQuery(".swal2-confirm").click(function(){jQuery("#resortpro_btn_inquiry").prop("disabled",true);if(popup){jQuery("#myModal2").modal("hide")}});if(autoclose!==null){setTimeout(function(){jQuery("#resortpro_btn_inquiry").prop("disabled",true);if(popup){jQuery("#myModal2").modal("hide")}},autoclose)}}else{Alert.add(Alert.successType,$rootScope.bookingSettings.inquiryThankMsg)}}$scope.resetInquiry()}})}}},500);return false};$scope.SendSideInquiry=function(inquiry){run_waitMe(".side_inquiry","roundBounce","Please wait, sending inquiry...");setTimeout(function(){var params={unit_id:inquiry.unit_id,not_blocked_request:"yes",startdate:inquiry.startDate,enddate:inquiry.endDate,rangedate:inquiry.rangeDate,first_name:inquiry.first_name,last_name:inquiry.last_name,email:inquiry.email,mobile_phone:inquiry.phone,client_comments:inquiry.message,disable_minimal_days:"yes"};rpapi.getWithParams("MakeReservation",params).success(function(obj){hide_waitMe(".side_inquiry");if(obj.status){Alert.add(Alert.errorType,obj.status.description)}else{$scope.resetInquiry()}})},500);return false};$scope.saveFavorites=function(favorites){run_waitMe("#modalFav .modal-dialog, #inquiry_box","roundBounce","Please wait, saving favorites...");setTimeout(function(){var unit_id=0;var str_favorites="";angular.forEach($scope.favoritesObj,function(prop,key){if(unit_id==0){unit_id=prop.id}str_favorites+=prop.name+",\n\r"});var params={unit_id:unit_id,not_blocked_request:"yes",startdate:favorites.startDate,enddate:favorites.endDate,occupants:1,occupants_small:0,first_name:favorites.first_name,last_name:favorites.last_name,email:favorites.email,favorites:favorites.phone,extra_notes:"Comments: "+favorites.message+". Favorite Units: \n\r"+str_favorites,pets:0,disable_minimal_days:"yes"};rpapi.getWithParams("MakeReservation",params).success(function(obj){hide_waitMe("#modalFav .modal-dialog, #inquiry_box");if(obj.status){Alert.add(Alert.errorType,obj.status.description)}else{$scope.resetFavorites();Alert.add(Alert.successType,"Favorites saved successfully");setTimeout(function(){jQuery("#modalFav").modal("hide")},3e3)}})},500);return false};$scope.loadCompare=function(){$scope.loading=true;var compare_ids=$cookies.getObject("streamline-compare-units");if(compare_ids){var params={include_units:compare_ids.join(),additional_variables:1};if($rootScope.searchSettings.enable_get_gallery_image==1){params.return_gallery=1;if($rootScope.searchSettings.max_images_number>0){params.max_images_number=$rootScope.searchSettings.max_images_number}}var cmp_amenity=[];rpapi.getWithParams("GetPropertyListWordPress",params).success(function(obj){$scope.loading=false;angular.forEach(obj.data.property,function(value,property){if(value.unit_amenities!==null){angular.forEach(value.unit_amenities.amenity,function(amenity,key){if($scope.compareAmenities!="undefined"){if(property===0){cmp_amenity[cmp_amenity.length]={name:amenity.amenity_name,group:amenity.group_name,id:amenity.amenity_id,show:amenity.amenity_show_on_website}}if(property!==0){var amenityCheck={name:amenity.amenity_name,group:amenity.group_name,id:amenity.amenity_id,show:amenity.amenity_show_on_website};if(jQuery.inArray(amenityCheck,cmp_amenity)===-1){cmp_amenity[cmp_amenity.length]={name:amenity.amenity_name,group:amenity.group_name,id:amenity.amenity_id,show:amenity.amenity_show_on_website}}}}})}});$scope.remove_duplicates(cmp_amenity);var sortedGroups=[];var compareIds=$rootScope.searchSettings.compareAmenityGroups.split(",");angular.forEach(cmp_amenity,function(amenityCompare,key){if(amenityCompare.show=="yes"){if(compareIds!=""){angular.forEach(compareIds,function(id,groupKey){if(id==amenityCompare.id||id==amenityCompare.group){sortedGroups[sortedGroups.length]={name:amenityCompare.name,group:amenityCompare.group}}})}else{sortedGroups[sortedGroups.length]={name:amenityCompare.name,group:amenityCompare.group}}}});cmp_amenity=sortedGroups;cmp_amenity.sort(function(a,b){return a.group.localeCompare(b.group)});if(obj.data.property.id){$scope.compareObj=[];$scope.compareObj.push(obj.data.property)}else{$scope.compareAmenities=cmp_amenity;var compare=[];angular.forEach(obj.data.property,function(value,property){compare[property]=[];tempCompare=[];if(value.unit_amenities!==null){angular.forEach(value.unit_amenities.amenity,function(amenity,key){tempCompare[amenity.amenity_name]={name:amenity.amenity_name,group:amenity.group_name,id:amenity.amenity_id}})}angular.forEach($scope.compareAmenities,function(amenityCompare,key){if(amenityCompare.name in tempCompare){compare[property].push({name:amenityCompare.name,group:amenityCompare.group,id:amenityCompare.amenity_id,status:true})}else{compare[property].push({name:amenityCompare.name,group:amenityCompare.group,id:amenityCompare.amenity_id,status:false})}})});$scope.compareObj=Object.keys(obj.data.property).map(function(key){obj.data.property[key].compareAmenities=compare[key];return obj.data.property[key]})}})}else{return false}};$scope.removeDuplicates=function(originalArray,prop){var newArray=[];var lookupObject={};for(var i in originalArray){lookupObject[originalArray[i][prop]]=originalArray[i]}for(i in lookupObject){newArray.push(lookupObject[i])}return newArray};$scope.remove_duplicates=function(objectsArray){var usedObjects={};for(var i=objectsArray.length-1;i>=0;i--){var so=JSON.stringify(objectsArray[i]);if(usedObjects[so]){objectsArray.splice(i,1)}else{usedObjects[so]=true}}return objectsArray};$scope.checkCompare=function(property){var compare=$cookies.getObject("streamline-compare-units");var found=false;if(compare){angular.forEach(compare,function(value,key){if(property.id==value){found=true}})}return found};$scope.removeFromCompare=function(property){var compare=$cookies.getObject("streamline-compare-units");if(compare){angular.forEach(compare,function(value,key){if(property.id==value){compare.splice(key,1);jQuery(".compare-"+property.id).each(function(){jQuery(this).remove()});jQuery(".compare-"+property.id).slick("slickRemove");setTimeout(function(){jQuery(".slider").slick("reinit")},1e3)}});if(compare.length==0){$cookies.remove("streamline-compare-units",{path:"/"})}else{$cookies.putObject("streamline-compare-units",compare,{path:"/",secure:"true"})}$scope.compareList=compare}if(window.location.pathname=="/compare/"){if(compare.length==2){$window.location.href="/compare"}if(compare.length==1){$scope.clearCompare();$window.location.href="/search-results"}}};$scope.addToCompare=function(property){var compare=$cookies.getObject("streamline-compare-units");$scope.compareList=compare;if(compare){var foundUnit=false;angular.forEach(compare,function(value,key){if(property.id==value){foundUnit=true}});compare.push(property.id)}else{compare=[];compare.push(property.id)}var now=new Date;now.setDate(now.getDate()+30);$cookies.putObject("streamline-compare-units",compare,{path:"/",expires:now});if(compare.length>=2){$scope.showCompare=true}else{$scope.showCompare=false}};$scope.clearCompare=function(property){$cookies.remove("streamline-compare-units",{path:"/"});$cookies.getObject("streamline-compare-units")};$scope.isMobile=function(){if(window.innerWidth<=768){return true}else{return false}};$scope.$watch($scope.isMobile,function(){},true);angular.element($window).bind("orientationchange",function(){$scope.$apply()})}])})();(function(){var app=angular.module("resortpro.services",[]);app.service("streamlineService",function(rpapi,$q){this.getPreReservationPrice=function(params){return rpapi.getWithParams("GetPreReservationPrice",params).then(function(response){return response.data},function(error){return error})};this.getReservationPrice=function(params){return rpapi.getWithParams("GetReservationPrice",params).then(function(response){return response.data},function(error){return error})};this.getReservationInfo=function(confirmation_id){return rpapi.getWithParams("GetReservationPrice",{confirmation_id:confirmation_id}).then(function(response){return response.data},function(error){return error})};this.verifyPropertyAvailability=function(startdate,enddate,unit_id,occupants,occupants_small,pets,use_room_type){return rpapi.getWithParams("VerifyPropertyAvailability",{unit_id:unit_id,startdate:startdate,enddate:enddate,occupants:occupants,occupants_small:occupants_small,pets:pets,use_room_type_logic:use_room_type}).then(function(response){return response.data},function(error){return error})};this.getPropertyInfo=function(unit_id){return rpapi.getWithParams("GetPropertyInfo",{unit_id:unit_id}).then(function(obj){var response=obj.data;return response},function(error){return error})};this.getPropertyRoomsDetailsRawData=function(unit_id){return rpapi.getWithParams("GetPropertyRoomsDetailsRawData",{unit_id:unit_id}).then(function(obj){var result=[];var response=obj.data.data;if(response){if(response.roomsdetails.name){result.push(response.roomsdetails)}else{result=response.roomsdetails}}return result},function(error){return error})};this.getPropertyRatesRawData=function(unit_id,use_yielding){return rpapi.getWithParams("GetPropertyRatesRawData",{unit_id:unit_id,use_yielding:use_yielding}).then(function(obj){var result=[];var response=obj.data.data;if(response){if(response.rates.period_begin){result.push(response.rates)}else{result=response.rates}}return result},function(error){return error})};this.getPropertyFeedbacks=function(unit_id){return rpapi.getWithParams("GetPropertyFeedbacks",{unit_id:unit_id}).then(function(obj){var result=[];var response=obj.data.data;if(response){if(response.feedbacks.guest_name){result.push(response.feedbacks)}else{result=response.feedbacks}}return result},function(error){return error})};this.getPropertyAvailabilityCalendarRawData=function(unit_id){return rpapi.getWithParams("GetPropertyAvailabilityCalendarRawData",{unit_id:unit_id}).then(function(obj){var result=[];var response=obj.data.data;if(response){if(response.blocked_period.startdate){result.push(response.blocked_period)}else{result=response.blocked_period}}return result},function(error){return error})};this.modifyReservation=function(params){return rpapi.getWithParams("ModifyReservation",params).then(function(response){return response.data},function(error){return error})};this.getPropertyAmenitiesWithRates=function(unit_id,startdate,enddate){var params={startdate:startdate,enddate:enddate,unit_id:unit_id};return rpapi.getWithParams("GetPropertyAmenitiesWithRates",params).then(function(response){return response.data},function(error){return error})};this.makeReservation=function(params){return rpapi.getWithParams("MakeReservation",params).then(function(obj){var result=[];var response=obj.data;return response},function(error){return error})}});app.factory("beforeUnload",function($rootScope,$window){$window.onbeforeunload=function(e){var confirmation={};var event=$rootScope.$broadcast("onBeforeUnload",confirmation);if(event.defaultPrevented){return confirmation.message}};$window.onunload=function(){$rootScope.$broadcast("onUnload")};return{}}).run(function(beforeUnload){})})();(function($){var app=angular.module("resortpro.services");app.factory("$ajax",function($rootScope,$http){return{post:function(action,data){data=angular.isObject(data)?data:{};data.action=action;data.nonce=$rootScope.ajaxNonce;return $http.post($rootScope.ajaxUrl,$.param(data),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},get:function(action,data){data=angular.isObject(data)?data:{};data.action=action;data.nonce=$rootScope.ajaxNonce;return $http.get(streamlinecoreConfig.ajaxUrl,{params:data})},yahoo:function(query){var data={q:query,format:"json"};return $http.get("https://query.yahooapis.com/v1/public/yql",{params:data})}}})})(jQuery);(function(){var app=angular.module("resortpro.services");app.service("Alert",function($rootScope,$timeout){$rootScope.alerts=[];this.clear=function(){$rootScope.alerts=[]};this.add=function(type,message){var alert={type:type,message:message,timestamp:Date.now()};$rootScope.alerts.push(alert)};this.errorType="danger",this.errorMessage="Sorry, there was an error while processing your request.";this.successType="success",this.successMessage="Saved successfully.";this.infoType="info",this.successMessage="Sent successfully."})})();(function(){var app=angular.module("resortpro.services");app.factory("rpapi",function($http,$rootScope){return{get:function(method){var request={};var params={};var use_tokens=false;if($rootScope.companyCode){params.company_code=$rootScope.companyCode}else{use_tokens=true}request.methodName=method;request.params=params;var _obj=JSON.stringify(request);$http.defaults.useXDomain=true;if(use_tokens){var data={action:"streamlinecore-api-request",params:request};return $http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data})}else{return $http.post($rootScope.APIServer,JSON.stringify(request))}},getWithParams:function(method,params){var request={};var use_tokens=false;request.methodName=method;if($rootScope.companyCode){params.company_code=$rootScope.companyCode}else{use_tokens=true}request.params=params;var _obj=JSON.stringify(request);$http.defaults.useXDomain=true;delete $http.defaults.headers.common["X-Requested-With"];if(use_tokens){var data={action:"streamlinecore-api-request",params:request};return $http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data})}else{return $http.post($rootScope.APIServer,JSON.stringify(request))}},getWpActionWithParams:function(action,params){var data={action:action};for(var propertyName in params){data[propertyName]=params[propertyName]}return $http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data})},secureGetWithParams:function(method,params){var request={};var use_tokens=false;request.methodName=method;if($rootScope.companyCode){params.company_code=$rootScope.companyCode}else{use_tokens=false}request.params=params;var _obj=JSON.stringify(request);$http.defaults.useXDomain=true;delete $http.defaults.headers.common["X-Requested-With"];if(use_tokens){var data={action:"streamlinecore-api-request",params:request};return $http({method:"POST",headers:{"Content-type":"application/json"},url:streamlinecoreConfig.ajaxUrl,params:data})}else{return $http.post("https://secure.streamlinevrs.com/api/json",JSON.stringify(request))}},sendToNavis:function(params){var data={action:"navis-api-request",params:params};return $http({method:"GET",url:streamlinecoreConfig.ajaxUrl,params:data})},gReCaptcha:function(params){var data={action:"grecaptcha_validation",params:params};return $http({method:"POST",url:streamlinecoreConfig.ajaxUrl,params:data})}}});app.factory("rpuri",function($http,$rootScope){return{getQueryStringParam:function(sParam){var sPageUrl=window.location.search.substring(1);var sURLVariables=sPageUrl.split("&");for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split("=");if(sParameterName[0]==sParam){return sParameterName[1]}}}}})})();(function($){var app=angular.module("resortpro.services");app.factory("translator",function($q,$cookies,$ajax,$http,$translate,$filter){var defaults={language:"en",currency:"USD",symbol:"$"};var settings={};var translated={};return{settings:settings,defaults:defaults,translate:function(text){return $translate(text)},translateCurrency:function(text,symbol,fractionSize){if(!angular.isString(text)){text+=""}var key=[settings.currency,text,symbol,fractionSize].join("_");var d=$q.defer();d.resolve(translated[key]||this.getExchangeRate().then(function(rate){var amount=parseFloat(text.replace(/[^0-9\.\-]+/gi,""));amount=Math.ceil(amount*rate*100)/100;var the_symbol=symbol||angular.isUndefined(symbol)?settings.symbol+"":"";return translated[key]=$filter("currency")(amount,the_symbol,fractionSize)}));return translated[key]=d.promise},getLanguage:function(){var d=$q.defer();d.resolve(settings.language||function(){settings.language=$cookies.get("_icl_current_language");if(!settings.language){settings.language=defaults.language}return settings.language}());return settings.language=d.promise},getCurrency:function(){var d=$q.defer();d.resolve(settings.currency||this.getSupportedCurrencies().then(function(currencies){settings.currency=$cookies.get("_icl_current_currency");if(!settings.currency||!angular.isObject(currencies)||!currencies[settings.currency]){settings.symbol=defaults.symbol;return settings.currency=defaults.currency}settings.symbol=currencies[settings.currency].symbol;return settings.currency},function(){settings.symbol=defaults.symbol;return settings.currency=defaults.currency}));return settings.currency=d.promise},getSymbol:function(){var d=$q.defer();d.resolve(settings.symbol||this.getCurrency().then(function(){return settings.symbol}));return settings.symbol=d.promise},getExchangeRate:function(){var d=$q.defer();d.resolve(settings.exchangeRate||this.getCurrency().then(function(currency){if(currency=="USD"){return settings.exchangeRate=1}else{return $ajax.get("supported_translation_exchange_rates",{currency:currency}).then(function(response){if(!response.data||!angular.isObject(response.data)){return settings.exchangeRate=1}return settings.exchangeRate=response.data.rate})}}));return settings.exchangeRate=d.promise},getSupportedCurrencies:function(){var d=$q.defer();d.resolve(settings.currencyList||$ajax.get("streamlinecore-supported-translation-currencies").then(function(response){if(!response.data||!angular.isObject(response.data)){return settings.currencyList={}}return settings.currencyList=response.data},function(){return settings.currencyList={}}));return settings.currencyList=d.promise}}});app.run(function($translate,translator){translator.getLanguage().then(function(language){$translate.use(language)})});app.factory("wpmlTranslationLoader",function($rootScope,$q,$ajax){if($rootScope.enable_multicurrency==1){return function(options){var deferred=$q.defer();$(document).ready(function(){$ajax.get("streamlinecore-get-translations",{lang:options.key}).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(options.key)})});return deferred.promise}}});app.factory("missingTranslationHandler",function($translate,$ajax){var missing=[];return function(key){if($.inArray(key,missing)>=0){return}missing.push(key);$ajax.post("streamlinecore-register-translation-string",{str:key})}})})(jQuery);